(function(st,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(st=typeof globalThis<"u"?globalThis:st||self,e(st.VueCMSEditor={},st.Vue))})(this,function(st,e){"use strict";const c={debug:(t,...r)=>{},info:(t,...r)=>{},warn:(t,...r)=>{},error:(t,...r)=>{},success:(t,...r)=>{},process:(t,...r)=>{},time:t=>{},timeEnd:t=>{},group:t=>{},groupEnd:()=>{}};var jr=Object.defineProperty,Ht=Object.getOwnPropertySymbols,Oo=Object.prototype.hasOwnProperty,Ro=Object.prototype.propertyIsEnumerable,Ho=(t,r,o)=>r in t?jr(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,_t=(t,r)=>{for(var o in r||(r={}))Oo.call(r,o)&&Ho(t,o,r[o]);if(Ht)for(var o of Ht(r))Ro.call(r,o)&&Ho(t,o,r[o]);return t},Zo=(t,r)=>{var o={};for(var n in t)Oo.call(t,n)&&r.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&Ht)for(var n of Ht(t))r.indexOf(n)<0&&Ro.call(t,n)&&(o[n]=t[n]);return o};const Dp="[vue-draggable-plus]: ";function Tp(t){}function Vp(t){}function jo(t,r,o){return o>=0&&o<t.length&&t.splice(o,0,t.splice(r,1)[0]),t}function Ur(t){return t.replace(/-(\w)/g,(r,o)=>o?o.toUpperCase():"")}function Wr(t){return Object.keys(t).reduce((r,o)=>(typeof t[o]<"u"&&(r[Ur(o)]=t[o]),r),{})}function Uo(t,r){return Array.isArray(t)&&t.splice(r,1),t}function Wo(t,r,o){return Array.isArray(t)&&t.splice(r,0,o),t}function qr(t){return typeof t>"u"}function Kr(t){return typeof t=="string"}function qo(t,r,o){const n=t.children[o];t.insertBefore(r,n)}function po(t){t.parentNode&&t.parentNode.removeChild(t)}function Xr(t,r=document){var o;let n=null;return typeof r?.querySelector=="function"?n=(o=r?.querySelector)==null?void 0:o.call(r,t):n=document.querySelector(t),n||(`${t}`,void 0),n}function Yr(t,r,o=null){return function(...n){return t.apply(o,n),r.apply(o,n)}}function Jr(t,r){const o=_t({},t);return Object.keys(r).forEach(n=>{o[n]?o[n]=Yr(t[n],r[n]):o[n]=r[n]}),o}function Gr(t){return t instanceof HTMLElement}function Ko(t,r){Object.keys(t).forEach(o=>{r(o,t[o])})}function Qr(t){return t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97)}const en=Object.assign;/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Xo(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),o.push.apply(o,n)}return o}function Ge(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?Xo(Object(o),!0).forEach(function(n){tn(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Xo(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function Zt(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Zt=function(r){return typeof r}:Zt=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Zt(t)}function tn(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function ot(){return ot=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},ot.apply(this,arguments)}function on(t,r){if(t==null)return{};var o={},n=Object.keys(t),s,f;for(f=0;f<n.length;f++)s=n[f],!(r.indexOf(s)>=0)&&(o[s]=t[s]);return o}function rn(t,r){if(t==null)return{};var o=on(t,r),n,s;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(t);for(s=0;s<f.length;s++)n=f[s],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var nn="1.15.2";function rt(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var nt=rt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Nt=rt(/Edge/i),Yo=rt(/firefox/i),kt=rt(/safari/i)&&!rt(/chrome/i)&&!rt(/android/i),Jo=rt(/iP(ad|od|hone)/i),Go=rt(/chrome/i)&&rt(/android/i),Qo={capture:!1,passive:!1};function ie(t,r,o){t.addEventListener(r,o,!nt&&Qo)}function le(t,r,o){t.removeEventListener(r,o,!nt&&Qo)}function jt(t,r){if(r){if(r[0]===">"&&(r=r.substring(1)),t)try{if(t.matches)return t.matches(r);if(t.msMatchesSelector)return t.msMatchesSelector(r);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(r)}catch{return!1}return!1}}function an(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function qe(t,r,o,n){if(t){o=o||document;do{if(r!=null&&(r[0]===">"?t.parentNode===o&&jt(t,r):jt(t,r))||n&&t===o)return t;if(t===o)break}while(t=an(t))}return null}var er=/\s+/g;function He(t,r,o){if(t&&r)if(t.classList)t.classList[o?"add":"remove"](r);else{var n=(" "+t.className+" ").replace(er," ").replace(" "+r+" "," ");t.className=(n+(o?" "+r:"")).replace(er," ")}}function te(t,r,o){var n=t&&t.style;if(n){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(o=t.currentStyle),r===void 0?o:o[r];!(r in n)&&r.indexOf("webkit")===-1&&(r="-webkit-"+r),n[r]=o+(typeof o=="string"?"":"px")}}function $t(t,r){var o="";if(typeof t=="string")o=t;else do{var n=te(t,"transform");n&&n!=="none"&&(o=n+" "+o)}while(!r&&(t=t.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(o)}function tr(t,r,o){if(t){var n=t.getElementsByTagName(r),s=0,f=n.length;if(o)for(;s<f;s++)o(n[s],s);return n}return[]}function Qe(){var t=document.scrollingElement;return t||document.documentElement}function ze(t,r,o,n,s){if(!(!t.getBoundingClientRect&&t!==window)){var f,y,h,_,C,A,w;if(t!==window&&t.parentNode&&t!==Qe()?(f=t.getBoundingClientRect(),y=f.top,h=f.left,_=f.bottom,C=f.right,A=f.height,w=f.width):(y=0,h=0,_=window.innerHeight,C=window.innerWidth,A=window.innerHeight,w=window.innerWidth),(r||o)&&t!==window&&(s=s||t.parentNode,!nt))do if(s&&s.getBoundingClientRect&&(te(s,"transform")!=="none"||o&&te(s,"position")!=="static")){var N=s.getBoundingClientRect();y-=N.top+parseInt(te(s,"border-top-width")),h-=N.left+parseInt(te(s,"border-left-width")),_=y+f.height,C=h+f.width;break}while(s=s.parentNode);if(n&&t!==window){var z=$t(s||t),T=z&&z.a,B=z&&z.d;z&&(y/=B,h/=T,w/=T,A/=B,_=y+A,C=h+w)}return{top:y,left:h,bottom:_,right:C,width:w,height:A}}}function or(t,r,o){for(var n=lt(t,!0),s=ze(t)[r];n;){var f=ze(n)[o],y=void 0;if(y=s>=f,!y)return n;if(n===Qe())break;n=lt(n,!1)}return!1}function Et(t,r,o,n){for(var s=0,f=0,y=t.children;f<y.length;){if(y[f].style.display!=="none"&&y[f]!==oe.ghost&&(n||y[f]!==oe.dragged)&&qe(y[f],o.draggable,t,!1)){if(s===r)return y[f];s++}f++}return null}function mo(t,r){for(var o=t.lastElementChild;o&&(o===oe.ghost||te(o,"display")==="none"||r&&!jt(o,r));)o=o.previousElementSibling;return o||null}function We(t,r){var o=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==oe.clone&&(!r||jt(t,r))&&o++;return o}function rr(t){var r=0,o=0,n=Qe();if(t)do{var s=$t(t),f=s.a,y=s.d;r+=t.scrollLeft*f,o+=t.scrollTop*y}while(t!==n&&(t=t.parentNode));return[r,o]}function sn(t,r){for(var o in t)if(t.hasOwnProperty(o)){for(var n in r)if(r.hasOwnProperty(n)&&r[n]===t[o][n])return Number(o)}return-1}function lt(t,r){if(!t||!t.getBoundingClientRect)return Qe();var o=t,n=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var s=te(o);if(o.clientWidth<o.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return Qe();if(n||r)return o;n=!0}}while(o=o.parentNode);return Qe()}function ln(t,r){if(t&&r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t}function uo(t,r){return Math.round(t.top)===Math.round(r.top)&&Math.round(t.left)===Math.round(r.left)&&Math.round(t.height)===Math.round(r.height)&&Math.round(t.width)===Math.round(r.width)}var Pt;function nr(t,r){return function(){if(!Pt){var o=arguments,n=this;o.length===1?t.call(n,o[0]):t.apply(n,o),Pt=setTimeout(function(){Pt=void 0},r)}}}function dn(){clearTimeout(Pt),Pt=void 0}function ar(t,r,o){t.scrollLeft+=r,t.scrollTop+=o}function sr(t){var r=window.Polymer,o=window.jQuery||window.Zepto;return r&&r.dom?r.dom(t).cloneNode(!0):o?o(t).clone(!0)[0]:t.cloneNode(!0)}function lr(t,r,o){var n={};return Array.from(t.children).forEach(function(s){var f,y,h,_;if(!(!qe(s,r.draggable,t,!1)||s.animated||s===o)){var C=ze(s);n.left=Math.min((f=n.left)!==null&&f!==void 0?f:1/0,C.left),n.top=Math.min((y=n.top)!==null&&y!==void 0?y:1/0,C.top),n.right=Math.max((h=n.right)!==null&&h!==void 0?h:-1/0,C.right),n.bottom=Math.max((_=n.bottom)!==null&&_!==void 0?_:-1/0,C.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var Ze="Sortable"+new Date().getTime();function cn(){var t=[],r;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(n){if(!(te(n,"display")==="none"||n===oe.ghost)){t.push({target:n,rect:ze(n)});var s=Ge({},t[t.length-1].rect);if(n.thisAnimationDuration){var f=$t(n,!0);f&&(s.top-=f.f,s.left-=f.e)}n.fromRect=s}})}},addAnimationState:function(o){t.push(o)},removeAnimationState:function(o){t.splice(sn(t,{target:o}),1)},animateAll:function(o){var n=this;if(!this.options.animation){clearTimeout(r),typeof o=="function"&&o();return}var s=!1,f=0;t.forEach(function(y){var h=0,_=y.target,C=_.fromRect,A=ze(_),w=_.prevFromRect,N=_.prevToRect,z=y.rect,T=$t(_,!0);T&&(A.top-=T.f,A.left-=T.e),_.toRect=A,_.thisAnimationDuration&&uo(w,A)&&!uo(C,A)&&(z.top-A.top)/(z.left-A.left)===(C.top-A.top)/(C.left-A.left)&&(h=mn(z,w,N,n.options)),uo(A,C)||(_.prevFromRect=C,_.prevToRect=A,h||(h=n.options.animation),n.animate(_,z,A,h)),h&&(s=!0,f=Math.max(f,h),clearTimeout(_.animationResetTimer),_.animationResetTimer=setTimeout(function(){_.animationTime=0,_.prevFromRect=null,_.fromRect=null,_.prevToRect=null,_.thisAnimationDuration=null},h),_.thisAnimationDuration=h)}),clearTimeout(r),s?r=setTimeout(function(){typeof o=="function"&&o()},f):typeof o=="function"&&o(),t=[]},animate:function(o,n,s,f){if(f){te(o,"transition",""),te(o,"transform","");var y=$t(this.el),h=y&&y.a,_=y&&y.d,C=(n.left-s.left)/(h||1),A=(n.top-s.top)/(_||1);o.animatingX=!!C,o.animatingY=!!A,te(o,"transform","translate3d("+C+"px,"+A+"px,0)"),this.forRepaintDummy=pn(o),te(o,"transition","transform "+f+"ms"+(this.options.easing?" "+this.options.easing:"")),te(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){te(o,"transition",""),te(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},f)}}}}function pn(t){return t.offsetWidth}function mn(t,r,o,n){return Math.sqrt(Math.pow(r.top-t.top,2)+Math.pow(r.left-t.left,2))/Math.sqrt(Math.pow(r.top-o.top,2)+Math.pow(r.left-o.left,2))*n.animation}var wt=[],go={initializeByDefault:!0},St={mount:function(t){for(var r in go)go.hasOwnProperty(r)&&!(r in t)&&(t[r]=go[r]);wt.forEach(function(o){if(o.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),wt.push(t)},pluginEvent:function(t,r,o){var n=this;this.eventCanceled=!1,o.cancel=function(){n.eventCanceled=!0};var s=t+"Global";wt.forEach(function(f){r[f.pluginName]&&(r[f.pluginName][s]&&r[f.pluginName][s](Ge({sortable:r},o)),r.options[f.pluginName]&&r[f.pluginName][t]&&r[f.pluginName][t](Ge({sortable:r},o)))})},initializePlugins:function(t,r,o,n){wt.forEach(function(y){var h=y.pluginName;if(!(!t.options[h]&&!y.initializeByDefault)){var _=new y(t,r,t.options);_.sortable=t,_.options=t.options,t[h]=_,ot(o,_.defaults)}});for(var s in t.options)if(t.options.hasOwnProperty(s)){var f=this.modifyOption(t,s,t.options[s]);typeof f<"u"&&(t.options[s]=f)}},getEventProperties:function(t,r){var o={};return wt.forEach(function(n){typeof n.eventProperties=="function"&&ot(o,n.eventProperties.call(r[n.pluginName],t))}),o},modifyOption:function(t,r,o){var n;return wt.forEach(function(s){t[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[r]=="function"&&(n=s.optionListeners[r].call(t[s.pluginName],o))}),n}};function un(t){var r=t.sortable,o=t.rootEl,n=t.name,s=t.targetEl,f=t.cloneEl,y=t.toEl,h=t.fromEl,_=t.oldIndex,C=t.newIndex,A=t.oldDraggableIndex,w=t.newDraggableIndex,N=t.originalEvent,z=t.putSortable,T=t.extraEventProperties;if(r=r||o&&o[Ze],!!r){var B,I=r.options,d="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!nt&&!Nt?B=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(B=document.createEvent("Event"),B.initEvent(n,!0,!0)),B.to=y||o,B.from=h||o,B.item=s||o,B.clone=f,B.oldIndex=_,B.newIndex=C,B.oldDraggableIndex=A,B.newDraggableIndex=w,B.originalEvent=N,B.pullMode=z?z.lastPutMode:void 0;var a=Ge(Ge({},T),St.getEventProperties(n,r));for(var l in a)B[l]=a[l];o&&o.dispatchEvent(B),I[d]&&I[d].call(r,B)}}var gn=["evt"],Oe=function(t,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=o.evt,s=rn(o,gn);St.pluginEvent.bind(oe)(t,r,Ge({dragEl:j,parentEl:be,ghostEl:re,rootEl:ge,nextEl:gt,lastDownEl:Ut,cloneEl:fe,cloneHidden:it,dragStarted:Dt,putSortable:Ne,activeSortable:oe.active,originalEvent:n,oldIndex:zt,oldDraggableIndex:It,newIndex:je,newDraggableIndex:dt,hideGhostForTarget:gr,unhideGhostForTarget:fr,cloneNowHidden:function(){it=!0},cloneNowShown:function(){it=!1},dispatchSortableEvent:function(f){Me({sortable:r,name:f,originalEvent:n})}},s))};function Me(t){un(Ge({putSortable:Ne,cloneEl:fe,targetEl:j,rootEl:ge,oldIndex:zt,oldDraggableIndex:It,newIndex:je,newDraggableIndex:dt},t))}var j,be,re,ge,gt,Ut,fe,it,zt,je,It,dt,Wt,Ne,vt=!1,qt=!1,Kt=[],ft,Ke,fo,ho,ir,dr,Dt,Ct,Tt,Vt=!1,Xt=!1,Yt,Ie,yo=[],bo=!1,Jt=[],Gt=typeof document<"u",Qt=Jo,cr=Nt||nt?"cssFloat":"float",fn=Gt&&!Go&&!Jo&&"draggable"in document.createElement("div"),pr=function(){if(Gt){if(nt)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),mr=function(t,r){var o=te(t),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),s=Et(t,0,r),f=Et(t,1,r),y=s&&te(s),h=f&&te(f),_=y&&parseInt(y.marginLeft)+parseInt(y.marginRight)+ze(s).width,C=h&&parseInt(h.marginLeft)+parseInt(h.marginRight)+ze(f).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&y.float&&y.float!=="none"){var A=y.float==="left"?"left":"right";return f&&(h.clear==="both"||h.clear===A)?"vertical":"horizontal"}return s&&(y.display==="block"||y.display==="flex"||y.display==="table"||y.display==="grid"||_>=n&&o[cr]==="none"||f&&o[cr]==="none"&&_+C>n)?"vertical":"horizontal"},hn=function(t,r,o){var n=o?t.left:t.top,s=o?t.right:t.bottom,f=o?t.width:t.height,y=o?r.left:r.top,h=o?r.right:r.bottom,_=o?r.width:r.height;return n===y||s===h||n+f/2===y+_/2},yn=function(t,r){var o;return Kt.some(function(n){var s=n[Ze].options.emptyInsertThreshold;if(!(!s||mo(n))){var f=ze(n),y=t>=f.left-s&&t<=f.right+s,h=r>=f.top-s&&r<=f.bottom+s;if(y&&h)return o=n}}),o},ur=function(t){function r(s,f){return function(y,h,_,C){var A=y.options.group.name&&h.options.group.name&&y.options.group.name===h.options.group.name;if(s==null&&(f||A))return!0;if(s==null||s===!1)return!1;if(f&&s==="clone")return s;if(typeof s=="function")return r(s(y,h,_,C),f)(y,h,_,C);var w=(f?y:h).options.group.name;return s===!0||typeof s=="string"&&s===w||s.join&&s.indexOf(w)>-1}}var o={},n=t.group;(!n||Zt(n)!="object")&&(n={name:n}),o.name=n.name,o.checkPull=r(n.pull,!0),o.checkPut=r(n.put),o.revertClone=n.revertClone,t.group=o},gr=function(){!pr&&re&&te(re,"display","none")},fr=function(){!pr&&re&&te(re,"display","")};Gt&&!Go&&document.addEventListener("click",function(t){if(qt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),qt=!1,!1},!0);var ht=function(t){if(j){t=t.touches?t.touches[0]:t;var r=yn(t.clientX,t.clientY);if(r){var o={};for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);o.target=o.rootEl=r,o.preventDefault=void 0,o.stopPropagation=void 0,r[Ze]._onDragOver(o)}}},bn=function(t){j&&j.parentNode[Ze]._isOutsideThisEl(t.target)};function oe(t,r){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=r=ot({},r),t[Ze]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return mr(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(f,y){f.setData("Text",y.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:oe.supportPointer!==!1&&"PointerEvent"in window&&!kt,emptyInsertThreshold:5};St.initializePlugins(this,t,o);for(var n in o)!(n in r)&&(r[n]=o[n]);ur(r);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=r.forceFallback?!1:fn,this.nativeDraggable&&(this.options.touchStartThreshold=1),r.supportPointer?ie(t,"pointerdown",this._onTapStart):(ie(t,"mousedown",this._onTapStart),ie(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(ie(t,"dragover",this),ie(t,"dragenter",this)),Kt.push(this.el),r.store&&r.store.get&&this.sort(r.store.get(this)||[]),ot(this,cn())}oe.prototype={constructor:oe,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(Ct=null)},_getDirection:function(t,r){return typeof this.options.direction=="function"?this.options.direction.call(this,t,r,j):this.options.direction},_onTapStart:function(t){if(t.cancelable){var r=this,o=this.el,n=this.options,s=n.preventOnFilter,f=t.type,y=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,h=(y||t).target,_=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||h,C=n.filter;if(An(o),!j&&!(/mousedown|pointerdown/.test(f)&&t.button!==0||n.disabled)&&!_.isContentEditable&&!(!this.nativeDraggable&&kt&&h&&h.tagName.toUpperCase()==="SELECT")&&(h=qe(h,n.draggable,o,!1),!(h&&h.animated)&&Ut!==h)){if(zt=We(h),It=We(h,n.draggable),typeof C=="function"){if(C.call(this,t,h,this)){Me({sortable:r,rootEl:_,name:"filter",targetEl:h,toEl:o,fromEl:o}),Oe("filter",r,{evt:t}),s&&t.cancelable&&t.preventDefault();return}}else if(C&&(C=C.split(",").some(function(A){if(A=qe(_,A.trim(),o,!1),A)return Me({sortable:r,rootEl:A,name:"filter",targetEl:h,fromEl:o,toEl:o}),Oe("filter",r,{evt:t}),!0}),C)){s&&t.cancelable&&t.preventDefault();return}n.handle&&!qe(_,n.handle,o,!1)||this._prepareDragStart(t,y,h)}}},_prepareDragStart:function(t,r,o){var n=this,s=n.el,f=n.options,y=s.ownerDocument,h;if(o&&!j&&o.parentNode===s){var _=ze(o);if(ge=s,j=o,be=j.parentNode,gt=j.nextSibling,Ut=o,Wt=f.group,oe.dragged=j,ft={target:j,clientX:(r||t).clientX,clientY:(r||t).clientY},ir=ft.clientX-_.left,dr=ft.clientY-_.top,this._lastX=(r||t).clientX,this._lastY=(r||t).clientY,j.style["will-change"]="all",h=function(){if(Oe("delayEnded",n,{evt:t}),oe.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Yo&&n.nativeDraggable&&(j.draggable=!0),n._triggerDragStart(t,r),Me({sortable:n,name:"choose",originalEvent:t}),He(j,f.chosenClass,!0)},f.ignore.split(",").forEach(function(C){tr(j,C.trim(),_o)}),ie(y,"dragover",ht),ie(y,"mousemove",ht),ie(y,"touchmove",ht),ie(y,"mouseup",n._onDrop),ie(y,"touchend",n._onDrop),ie(y,"touchcancel",n._onDrop),Yo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,j.draggable=!0),Oe("delayStart",this,{evt:t}),f.delay&&(!f.delayOnTouchOnly||r)&&(!this.nativeDraggable||!(Nt||nt))){if(oe.eventCanceled){this._onDrop();return}ie(y,"mouseup",n._disableDelayedDrag),ie(y,"touchend",n._disableDelayedDrag),ie(y,"touchcancel",n._disableDelayedDrag),ie(y,"mousemove",n._delayedDragTouchMoveHandler),ie(y,"touchmove",n._delayedDragTouchMoveHandler),f.supportPointer&&ie(y,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(h,f.delay)}else h()}},_delayedDragTouchMoveHandler:function(t){var r=t.touches?t.touches[0]:t;Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){j&&_o(j),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;le(t,"mouseup",this._disableDelayedDrag),le(t,"touchend",this._disableDelayedDrag),le(t,"touchcancel",this._disableDelayedDrag),le(t,"mousemove",this._delayedDragTouchMoveHandler),le(t,"touchmove",this._delayedDragTouchMoveHandler),le(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,r){r=r||t.pointerType=="touch"&&t,!this.nativeDraggable||r?this.options.supportPointer?ie(document,"pointermove",this._onTouchMove):r?ie(document,"touchmove",this._onTouchMove):ie(document,"mousemove",this._onTouchMove):(ie(j,"dragend",this),ie(ge,"dragstart",this._onDragStart));try{document.selection?to(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,r){if(vt=!1,ge&&j){Oe("dragStarted",this,{evt:r}),this.nativeDraggable&&ie(document,"dragover",bn);var o=this.options;!t&&He(j,o.dragClass,!1),He(j,o.ghostClass,!0),oe.active=this,t&&this._appendGhost(),Me({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){if(Ke){this._lastX=Ke.clientX,this._lastY=Ke.clientY,gr();for(var t=document.elementFromPoint(Ke.clientX,Ke.clientY),r=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(Ke.clientX,Ke.clientY),t!==r);)r=t;if(j.parentNode[Ze]._isOutsideThisEl(t),r)do{if(r[Ze]){var o=void 0;if(o=r[Ze]._onDragOver({clientX:Ke.clientX,clientY:Ke.clientY,target:t,rootEl:r}),o&&!this.options.dragoverBubble)break}t=r}while(r=r.parentNode);fr()}},_onTouchMove:function(t){if(ft){var r=this.options,o=r.fallbackTolerance,n=r.fallbackOffset,s=t.touches?t.touches[0]:t,f=re&&$t(re,!0),y=re&&f&&f.a,h=re&&f&&f.d,_=Qt&&Ie&&rr(Ie),C=(s.clientX-ft.clientX+n.x)/(y||1)+(_?_[0]-yo[0]:0)/(y||1),A=(s.clientY-ft.clientY+n.y)/(h||1)+(_?_[1]-yo[1]:0)/(h||1);if(!oe.active&&!vt){if(o&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<o)return;this._onDragStart(t,!0)}if(re){f?(f.e+=C-(fo||0),f.f+=A-(ho||0)):f={a:1,b:0,c:0,d:1,e:C,f:A};var w="matrix(".concat(f.a,",").concat(f.b,",").concat(f.c,",").concat(f.d,",").concat(f.e,",").concat(f.f,")");te(re,"webkitTransform",w),te(re,"mozTransform",w),te(re,"msTransform",w),te(re,"transform",w),fo=C,ho=A,Ke=s}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!re){var t=this.options.fallbackOnBody?document.body:ge,r=ze(j,!0,Qt,!0,t),o=this.options;if(Qt){for(Ie=t;te(Ie,"position")==="static"&&te(Ie,"transform")==="none"&&Ie!==document;)Ie=Ie.parentNode;Ie!==document.body&&Ie!==document.documentElement?(Ie===document&&(Ie=Qe()),r.top+=Ie.scrollTop,r.left+=Ie.scrollLeft):Ie=Qe(),yo=rr(Ie)}re=j.cloneNode(!0),He(re,o.ghostClass,!1),He(re,o.fallbackClass,!0),He(re,o.dragClass,!0),te(re,"transition",""),te(re,"transform",""),te(re,"box-sizing","border-box"),te(re,"margin",0),te(re,"top",r.top),te(re,"left",r.left),te(re,"width",r.width),te(re,"height",r.height),te(re,"opacity","0.8"),te(re,"position",Qt?"absolute":"fixed"),te(re,"zIndex","100000"),te(re,"pointerEvents","none"),oe.ghost=re,t.appendChild(re),te(re,"transform-origin",ir/parseInt(re.style.width)*100+"% "+dr/parseInt(re.style.height)*100+"%")}},_onDragStart:function(t,r){var o=this,n=t.dataTransfer,s=o.options;if(Oe("dragStart",this,{evt:t}),oe.eventCanceled){this._onDrop();return}Oe("setupClone",this),oe.eventCanceled||(fe=sr(j),fe.removeAttribute("id"),fe.draggable=!1,fe.style["will-change"]="",this._hideClone(),He(fe,this.options.chosenClass,!1),oe.clone=fe),o.cloneId=to(function(){Oe("clone",o),!oe.eventCanceled&&(o.options.removeCloneOnHide||ge.insertBefore(fe,j),o._hideClone(),Me({sortable:o,name:"clone"}))}),!r&&He(j,s.dragClass,!0),r?(qt=!0,o._loopId=setInterval(o._emulateDragOver,50)):(le(document,"mouseup",o._onDrop),le(document,"touchend",o._onDrop),le(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(o,n,j)),ie(document,"drop",o),te(j,"transform","translateZ(0)")),vt=!0,o._dragStartId=to(o._dragStarted.bind(o,r,t)),ie(document,"selectstart",o),Dt=!0,kt&&te(document.body,"user-select","none")},_onDragOver:function(t){var r=this.el,o=t.target,n,s,f,y=this.options,h=y.group,_=oe.active,C=Wt===h,A=y.sort,w=Ne||_,N,z=this,T=!1;if(bo)return;function B(V,F){Oe(V,z,Ge({evt:t,isOwner:C,axis:N?"vertical":"horizontal",revert:f,dragRect:n,targetRect:s,canSort:A,fromSortable:w,target:o,completed:d,onMove:function(X,O){return eo(ge,r,j,n,X,ze(X),t,O)},changed:a},F))}function I(){B("dragOverAnimationCapture"),z.captureAnimationState(),z!==w&&w.captureAnimationState()}function d(V){return B("dragOverCompleted",{insertion:V}),V&&(C?_._hideClone():_._showClone(z),z!==w&&(He(j,Ne?Ne.options.ghostClass:_.options.ghostClass,!1),He(j,y.ghostClass,!0)),Ne!==z&&z!==oe.active?Ne=z:z===oe.active&&Ne&&(Ne=null),w===z&&(z._ignoreWhileAnimating=o),z.animateAll(function(){B("dragOverAnimationComplete"),z._ignoreWhileAnimating=null}),z!==w&&(w.animateAll(),w._ignoreWhileAnimating=null)),(o===j&&!j.animated||o===r&&!o.animated)&&(Ct=null),!y.dragoverBubble&&!t.rootEl&&o!==document&&(j.parentNode[Ze]._isOutsideThisEl(t.target),!V&&ht(t)),!y.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),T=!0}function a(){je=We(j),dt=We(j,y.draggable),Me({sortable:z,name:"change",toEl:r,newIndex:je,newDraggableIndex:dt,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),o=qe(o,y.draggable,r,!0),B("dragOver"),oe.eventCanceled)return T;if(j.contains(t.target)||o.animated&&o.animatingX&&o.animatingY||z._ignoreWhileAnimating===o)return d(!1);if(qt=!1,_&&!y.disabled&&(C?A||(f=be!==ge):Ne===this||(this.lastPutMode=Wt.checkPull(this,_,j,t))&&h.checkPut(this,_,j,t))){if(N=this._getDirection(t,o)==="vertical",n=ze(j),B("dragOverValid"),oe.eventCanceled)return T;if(f)return be=ge,I(),this._hideClone(),B("revert"),oe.eventCanceled||(gt?ge.insertBefore(j,gt):ge.appendChild(j)),d(!0);var l=mo(r,y.draggable);if(!l||wn(t,N,this)&&!l.animated){if(l===j)return d(!1);if(l&&r===t.target&&(o=l),o&&(s=ze(o)),eo(ge,r,j,n,o,s,t,!!o)!==!1)return I(),l&&l.nextSibling?r.insertBefore(j,l.nextSibling):r.appendChild(j),be=r,a(),d(!0)}else if(l&&En(t,N,this)){var p=Et(r,0,y,!0);if(p===j)return d(!1);if(o=p,s=ze(o),eo(ge,r,j,n,o,s,t,!1)!==!1)return I(),r.insertBefore(j,p),be=r,a(),d(!0)}else if(o.parentNode===r){s=ze(o);var E=0,P,$=j.parentNode!==r,i=!hn(j.animated&&j.toRect||n,o.animated&&o.toRect||s,N),m=N?"top":"left",g=or(o,"top","top")||or(j,"top","top"),b=g?g.scrollTop:void 0;Ct!==o&&(P=s[m],Vt=!1,Xt=!i&&y.invertSwap||$),E=zn(t,o,s,N,i?1:y.swapThreshold,y.invertedSwapThreshold==null?y.swapThreshold:y.invertedSwapThreshold,Xt,Ct===o);var u;if(E!==0){var v=We(j);do v-=E,u=be.children[v];while(u&&(te(u,"display")==="none"||u===re))}if(E===0||u===o)return d(!1);Ct=o,Tt=E;var D=o.nextElementSibling,k=!1;k=E===1;var S=eo(ge,r,j,n,o,s,t,k);if(S!==!1)return(S===1||S===-1)&&(k=S===1),bo=!0,setTimeout($n,30),I(),k&&!D?r.appendChild(j):o.parentNode.insertBefore(j,k?D:o),g&&ar(g,0,b-g.scrollTop),be=j.parentNode,P!==void 0&&!Xt&&(Yt=Math.abs(P-ze(o)[m])),a(),d(!0)}if(r.contains(j))return d(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){le(document,"mousemove",this._onTouchMove),le(document,"touchmove",this._onTouchMove),le(document,"pointermove",this._onTouchMove),le(document,"dragover",ht),le(document,"mousemove",ht),le(document,"touchmove",ht)},_offUpEvents:function(){var t=this.el.ownerDocument;le(t,"mouseup",this._onDrop),le(t,"touchend",this._onDrop),le(t,"pointerup",this._onDrop),le(t,"touchcancel",this._onDrop),le(document,"selectstart",this)},_onDrop:function(t){var r=this.el,o=this.options;if(je=We(j),dt=We(j,o.draggable),Oe("drop",this,{evt:t}),be=j&&j.parentNode,je=We(j),dt=We(j,o.draggable),oe.eventCanceled){this._nulling();return}vt=!1,Xt=!1,Vt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),$o(this.cloneId),$o(this._dragStartId),this.nativeDraggable&&(le(document,"drop",this),le(r,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),kt&&te(document.body,"user-select",""),te(j,"transform",""),t&&(Dt&&(t.cancelable&&t.preventDefault(),!o.dropBubble&&t.stopPropagation()),re&&re.parentNode&&re.parentNode.removeChild(re),(ge===be||Ne&&Ne.lastPutMode!=="clone")&&fe&&fe.parentNode&&fe.parentNode.removeChild(fe),j&&(this.nativeDraggable&&le(j,"dragend",this),_o(j),j.style["will-change"]="",Dt&&!vt&&He(j,Ne?Ne.options.ghostClass:this.options.ghostClass,!1),He(j,this.options.chosenClass,!1),Me({sortable:this,name:"unchoose",toEl:be,newIndex:null,newDraggableIndex:null,originalEvent:t}),ge!==be?(je>=0&&(Me({rootEl:be,name:"add",toEl:be,fromEl:ge,originalEvent:t}),Me({sortable:this,name:"remove",toEl:be,originalEvent:t}),Me({rootEl:be,name:"sort",toEl:be,fromEl:ge,originalEvent:t}),Me({sortable:this,name:"sort",toEl:be,originalEvent:t})),Ne&&Ne.save()):je!==zt&&je>=0&&(Me({sortable:this,name:"update",toEl:be,originalEvent:t}),Me({sortable:this,name:"sort",toEl:be,originalEvent:t})),oe.active&&((je==null||je===-1)&&(je=zt,dt=It),Me({sortable:this,name:"end",toEl:be,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){Oe("nulling",this),ge=j=be=re=gt=fe=Ut=it=ft=Ke=Dt=je=dt=zt=It=Ct=Tt=Ne=Wt=oe.dragged=oe.ghost=oe.clone=oe.active=null,Jt.forEach(function(t){t.checked=!0}),Jt.length=fo=ho=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":j&&(this._onDragOver(t),_n(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],r,o=this.el.children,n=0,s=o.length,f=this.options;n<s;n++)r=o[n],qe(r,f.draggable,this.el,!1)&&t.push(r.getAttribute(f.dataIdAttr)||Cn(r));return t},sort:function(t,r){var o={},n=this.el;this.toArray().forEach(function(s,f){var y=n.children[f];qe(y,this.options.draggable,n,!1)&&(o[s]=y)},this),r&&this.captureAnimationState(),t.forEach(function(s){o[s]&&(n.removeChild(o[s]),n.appendChild(o[s]))}),r&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,r){return qe(t,r||this.options.draggable,this.el,!1)},option:function(t,r){var o=this.options;if(r===void 0)return o[t];var n=St.modifyOption(this,t,r);typeof n<"u"?o[t]=n:o[t]=r,t==="group"&&ur(o)},destroy:function(){Oe("destroy",this);var t=this.el;t[Ze]=null,le(t,"mousedown",this._onTapStart),le(t,"touchstart",this._onTapStart),le(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(le(t,"dragover",this),le(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(r){r.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Kt.splice(Kt.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!it){if(Oe("hideClone",this),oe.eventCanceled)return;te(fe,"display","none"),this.options.removeCloneOnHide&&fe.parentNode&&fe.parentNode.removeChild(fe),it=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(it){if(Oe("showClone",this),oe.eventCanceled)return;j.parentNode==ge&&!this.options.group.revertClone?ge.insertBefore(fe,j):gt?ge.insertBefore(fe,gt):ge.appendChild(fe),this.options.group.revertClone&&this.animate(j,fe),te(fe,"display",""),it=!1}}};function _n(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function eo(t,r,o,n,s,f,y,h){var _,C=t[Ze],A=C.options.onMove,w;return window.CustomEvent&&!nt&&!Nt?_=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(_=document.createEvent("Event"),_.initEvent("move",!0,!0)),_.to=r,_.from=t,_.dragged=o,_.draggedRect=n,_.related=s||r,_.relatedRect=f||ze(r),_.willInsertAfter=h,_.originalEvent=y,t.dispatchEvent(_),A&&(w=A.call(C,_,y)),w}function _o(t){t.draggable=!1}function $n(){bo=!1}function En(t,r,o){var n=ze(Et(o.el,0,o.options,!0)),s=lr(o.el,o.options,re),f=10;return r?t.clientX<s.left-f||t.clientY<n.top&&t.clientX<n.right:t.clientY<s.top-f||t.clientY<n.bottom&&t.clientX<n.left}function wn(t,r,o){var n=ze(mo(o.el,o.options.draggable)),s=lr(o.el,o.options,re),f=10;return r?t.clientX>s.right+f||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>s.bottom+f||t.clientX>n.right&&t.clientY>n.top}function zn(t,r,o,n,s,f,y,h){var _=n?t.clientY:t.clientX,C=n?o.height:o.width,A=n?o.top:o.left,w=n?o.bottom:o.right,N=!1;if(!y){if(h&&Yt<C*s){if(!Vt&&(Tt===1?_>A+C*f/2:_<w-C*f/2)&&(Vt=!0),Vt)N=!0;else if(Tt===1?_<A+Yt:_>w-Yt)return-Tt}else if(_>A+C*(1-s)/2&&_<w-C*(1-s)/2)return vn(r)}return N=N||y,N&&(_<A+C*f/2||_>w-C*f/2)?_>A+C/2?1:-1:0}function vn(t){return We(j)<We(t)?1:-1}function Cn(t){for(var r=t.tagName+t.className+t.src+t.href+t.textContent,o=r.length,n=0;o--;)n+=r.charCodeAt(o);return n.toString(36)}function An(t){Jt.length=0;for(var r=t.getElementsByTagName("input"),o=r.length;o--;){var n=r[o];n.checked&&Jt.push(n)}}function to(t){return setTimeout(t,0)}function $o(t){return clearTimeout(t)}Gt&&ie(document,"touchmove",function(t){(oe.active||vt)&&t.cancelable&&t.preventDefault()}),oe.utils={on:ie,off:le,css:te,find:tr,is:function(t,r){return!!qe(t,r,t,!1)},extend:ln,throttle:nr,closest:qe,toggleClass:He,clone:sr,index:We,nextTick:to,cancelNextTick:$o,detectDirection:mr,getChild:Et},oe.get=function(t){return t[Ze]},oe.mount=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];r[0].constructor===Array&&(r=r[0]),r.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(oe.utils=Ge(Ge({},oe.utils),n.utils)),St.mount(n)})},oe.create=function(t,r){return new oe(t,r)},oe.version=nn;var ve=[],Bt,Eo,wo=!1,zo,vo,oo,Mt;function Nn(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this))}return t.prototype={dragStarted:function(r){var o=r.originalEvent;this.sortable.nativeDraggable?ie(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ie(document,"pointermove",this._handleFallbackAutoScroll):o.touches?ie(document,"touchmove",this._handleFallbackAutoScroll):ie(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(r){var o=r.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?le(document,"dragover",this._handleAutoScroll):(le(document,"pointermove",this._handleFallbackAutoScroll),le(document,"touchmove",this._handleFallbackAutoScroll),le(document,"mousemove",this._handleFallbackAutoScroll)),hr(),ro(),dn()},nulling:function(){oo=Eo=Bt=wo=Mt=zo=vo=null,ve.length=0},_handleFallbackAutoScroll:function(r){this._handleAutoScroll(r,!0)},_handleAutoScroll:function(r,o){var n=this,s=(r.touches?r.touches[0]:r).clientX,f=(r.touches?r.touches[0]:r).clientY,y=document.elementFromPoint(s,f);if(oo=r,o||this.options.forceAutoScrollFallback||Nt||nt||kt){Co(r,this.options,y,o);var h=lt(y,!0);wo&&(!Mt||s!==zo||f!==vo)&&(Mt&&hr(),Mt=setInterval(function(){var _=lt(document.elementFromPoint(s,f),!0);_!==h&&(h=_,ro()),Co(r,n.options,_,o)},10),zo=s,vo=f)}else{if(!this.options.bubbleScroll||lt(y,!0)===Qe()){ro();return}Co(r,this.options,lt(y,!1),!1)}}},ot(t,{pluginName:"scroll",initializeByDefault:!0})}function ro(){ve.forEach(function(t){clearInterval(t.pid)}),ve=[]}function hr(){clearInterval(Mt)}var Co=nr(function(t,r,o,n){if(r.scroll){var s=(t.touches?t.touches[0]:t).clientX,f=(t.touches?t.touches[0]:t).clientY,y=r.scrollSensitivity,h=r.scrollSpeed,_=Qe(),C=!1,A;Eo!==o&&(Eo=o,ro(),Bt=r.scroll,A=r.scrollFn,Bt===!0&&(Bt=lt(o,!0)));var w=0,N=Bt;do{var z=N,T=ze(z),B=T.top,I=T.bottom,d=T.left,a=T.right,l=T.width,p=T.height,E=void 0,P=void 0,$=z.scrollWidth,i=z.scrollHeight,m=te(z),g=z.scrollLeft,b=z.scrollTop;z===_?(E=l<$&&(m.overflowX==="auto"||m.overflowX==="scroll"||m.overflowX==="visible"),P=p<i&&(m.overflowY==="auto"||m.overflowY==="scroll"||m.overflowY==="visible")):(E=l<$&&(m.overflowX==="auto"||m.overflowX==="scroll"),P=p<i&&(m.overflowY==="auto"||m.overflowY==="scroll"));var u=E&&(Math.abs(a-s)<=y&&g+l<$)-(Math.abs(d-s)<=y&&!!g),v=P&&(Math.abs(I-f)<=y&&b+p<i)-(Math.abs(B-f)<=y&&!!b);if(!ve[w])for(var D=0;D<=w;D++)ve[D]||(ve[D]={});(ve[w].vx!=u||ve[w].vy!=v||ve[w].el!==z)&&(ve[w].el=z,ve[w].vx=u,ve[w].vy=v,clearInterval(ve[w].pid),(u!=0||v!=0)&&(C=!0,ve[w].pid=setInterval(function(){n&&this.layer===0&&oe.active._onTouchMove(oo);var k=ve[this.layer].vy?ve[this.layer].vy*h:0,S=ve[this.layer].vx?ve[this.layer].vx*h:0;typeof A=="function"&&A.call(oe.dragged.parentNode[Ze],S,k,t,oo,ve[this.layer].el)!=="continue"||ar(ve[this.layer].el,S,k)}.bind({layer:w}),24))),w++}while(r.bubbleScroll&&N!==_&&(N=lt(N,!1)));wo=C}},30),yr=function(t){var r=t.originalEvent,o=t.putSortable,n=t.dragEl,s=t.activeSortable,f=t.dispatchSortableEvent,y=t.hideGhostForTarget,h=t.unhideGhostForTarget;if(r){var _=o||s;y();var C=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:r,A=document.elementFromPoint(C.clientX,C.clientY);h(),_&&!_.el.contains(A)&&(f("spill"),this.onSpill({dragEl:n,putSortable:o}))}};function Ao(){}Ao.prototype={startIndex:null,dragStart:function(t){var r=t.oldDraggableIndex;this.startIndex=r},onSpill:function(t){var r=t.dragEl,o=t.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var n=Et(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(r,n):this.sortable.el.appendChild(r),this.sortable.animateAll(),o&&o.animateAll()},drop:yr},ot(Ao,{pluginName:"revertOnSpill"});function No(){}No.prototype={onSpill:function(t){var r=t.dragEl,o=t.putSortable,n=o||this.sortable;n.captureAnimationState(),r.parentNode&&r.parentNode.removeChild(r),n.animateAll()},drop:yr},ot(No,{pluginName:"removeOnSpill"}),oe.mount(new Nn),oe.mount(No,Ao);function kn(t){return t==null?t:JSON.parse(JSON.stringify(t))}function Pn(t){e.getCurrentInstance()&&e.onUnmounted(t)}function Sn(t){e.getCurrentInstance()?e.onMounted(t):e.nextTick(t)}let br=null,_r=null;function $r(t=null,r=null){br=t,_r=r}function In(){return{data:br,clonedData:_r}}const Er=Symbol("cloneElement");function Dn(...t){var r,o;const n=(r=e.getCurrentInstance())==null?void 0:r.proxy;let s=null;const f=t[0];let[,y,h]=t;Array.isArray(e.unref(y))||(h=y,y=null);let _=null;const{immediate:C=!0,clone:A=kn,customUpdate:w}=(o=e.unref(h))!=null?o:{};function N(i){var m;const{from:g,oldIndex:b,item:u}=i;s=Array.from(g.childNodes);const v=e.unref((m=e.unref(y))==null?void 0:m[b]),D=A(v);$r(v,D),u[Er]=D}function z(i){const m=i.item[Er];if(!qr(m)){if(po(i.item),e.isRef(y)){const g=[...e.unref(y)];y.value=Wo(g,i.newDraggableIndex,m);return}Wo(e.unref(y),i.newDraggableIndex,m)}}function T(i){const{from:m,item:g,oldIndex:b,oldDraggableIndex:u,pullMode:v,clone:D}=i;if(qo(m,g,b),v==="clone"){po(D);return}if(e.isRef(y)){const k=[...e.unref(y)];y.value=Uo(k,u);return}Uo(e.unref(y),u)}function B(i){if(w){w(i);return}const{from:m,item:g,oldIndex:b,oldDraggableIndex:u,newDraggableIndex:v}=i;if(po(g),qo(m,g,b),e.isRef(y)){const D=[...e.unref(y)];y.value=jo(D,u,v);return}jo(e.unref(y),u,v)}function I(i){const{newIndex:m,oldIndex:g,from:b,to:u}=i;let v=null;const D=m===g&&b===u;try{if(D){let k=null;s?.some((S,V)=>{if(k&&s?.length!==u.childNodes.length)return b.insertBefore(k,S.nextSibling),!0;const F=u.childNodes[V];k=u?.replaceChild(S,F)})}}catch(k){v=k}finally{s=null}e.nextTick(()=>{if($r(),v)throw v})}const d={onUpdate:B,onStart:N,onAdd:z,onRemove:T,onEnd:I};function a(i){const m=e.unref(f);return i||(i=Kr(m)?Xr(m,n?.$el):m),i&&!Gr(i)&&(i=i.$el),i||void 0,i}function l(){var i;const m=(i=e.unref(h))!=null?i:{},{immediate:g,clone:b}=m,u=Zo(m,["immediate","clone"]);return Ko(u,(v,D)=>{Qr(v)&&(u[v]=(k,...S)=>{const V=In();return en(k,V),D(k,...S)})}),Jr(y===null?{}:d,u)}const p=i=>{i=a(i),_&&E.destroy(),_=new oe(i,l())};e.watch(()=>h,()=>{_&&Ko(l(),(i,m)=>{_?.option(i,m)})},{deep:!0});const E={option:(i,m)=>_?.option(i,m),destroy:()=>{_?.destroy(),_=null},save:()=>_?.save(),toArray:()=>_?.toArray(),closest:(...i)=>_?.closest(...i)},P=()=>E?.option("disabled",!0),$=()=>E?.option("disabled",!1);return Sn(()=>{C&&p()}),Pn(E.destroy),_t({start:p,pause:P,resume:$},E)}const ko=["update","start","add","remove","choose","unchoose","end","sort","filter","clone","move","change"],Tn=["clone","animation","ghostClass","group","sort","disabled","store","handle","draggable","swapThreshold","invertSwap","invertedSwapThreshold","removeCloneOnHide","direction","chosenClass","dragClass","ignore","filter","preventOnFilter","easing","setData","dropBubble","dragoverBubble","dataIdAttr","delay","delayOnTouchOnly","touchStartThreshold","forceFallback","fallbackClass","fallbackOnBody","fallbackTolerance","fallbackOffset","supportPointer","emptyInsertThreshold","scroll","forceAutoScrollFallback","scrollSensitivity","scrollSpeed","bubbleScroll","modelValue","tag","target","customUpdate",...ko.map(t=>`on${t.replace(/^\S/,r=>r.toUpperCase())}`)],Vn=e.defineComponent({name:"VueDraggable",model:{prop:"modelValue",event:"update:modelValue"},props:Tn,emits:["update:modelValue",...ko],setup(t,{slots:r,emit:o,expose:n,attrs:s}){const f=ko.reduce((A,w)=>{const N=`on${w.replace(/^\S/,z=>z.toUpperCase())}`;return A[N]=(...z)=>o(w,...z),A},{}),y=e.computed(()=>{const A=e.toRefs(t),{modelValue:w}=A,N=Zo(A,["modelValue"]),z=Object.entries(N).reduce((T,[B,I])=>{const d=e.unref(I);return d!==void 0&&(T[B]=d),T},{});return _t(_t({},f),Wr(_t(_t({},s),z)))}),h=e.computed({get:()=>t.modelValue,set:A=>o("update:modelValue",A)}),_=e.ref(),C=e.reactive(Dn(t.target||_,h,y));return n(C),()=>{var A;return e.h(t.tag||"div",{ref:_},(A=r?.default)==null?void 0:A.call(r,C))}}});function wr(){const t=e.ref(new Set),r="zero-code-collapsed-items",o=()=>{try{t.value=new Set,c.debug("初期表示：すべて展開状態で開始")}catch(N){c.error("初期化に失敗:",N),t.value=new Set}},n=()=>{try{const N=Array.from(t.value);localStorage.setItem(r,JSON.stringify(N)),c.debug("折りたたみ状態を保存:",N.length,"アイテム")}catch(N){c.error("折りたたみ状態の保存に失敗:",N)}},s=N=>t.value.has(N),f=N=>{const z=new Set(t.value);z.has(N)?(z.delete(N),c.debug(`アイテム展開: ${N}`)):(z.add(N),c.debug(`アイテム折りたたみ: ${N}`)),t.value=z},y=N=>{if(!t.value.has(N)){const z=new Set(t.value);z.add(N),t.value=z,c.debug(`アイテム折りたたみ: ${N}`)}},h=N=>{if(t.value.has(N)){const z=new Set(t.value);z.delete(N),t.value=z,c.debug(`アイテム展開: ${N}`)}},_=()=>{const N=t.value.size;t.value=new Set,c.debug(`すべてのアイテムを展開: ${N}アイテム`)},C=N=>{t.value=new Set(N),c.debug(`すべてのアイテムを折りたたみ: ${N.length}アイテム`)},A=e.computed(()=>t.value.size),w=N=>N-t.value.size;return e.watch(()=>t.value,()=>{n()},{deep:!0}),o(),{collapsedItems:e.computed(()=>t.value),collapsedCount:A,isCollapsed:s,toggleCollapse:f,collapseItem:y,expandItem:h,expandAll:_,collapseAll:C,getExpandedCount:w,loadCollapsedState:o,saveCollapsedState:n}}const Bn={class:"zero-code-data-display"},Mn={class:"zero-code-data-tabs"},Fn={class:"zero-code-tab-buttons"},xn=["onClick"],Ln={key:0,class:"zero-code-collapse-controls"},On={class:"zero-code-collapse-stats"},Rn=["disabled"],Hn=["disabled"],Zn={class:"zero-code-data-content"},jn={key:0,class:"zero-code-data-section"},Un={key:0,class:"zero-code-rendered-content"},Wn={class:"zero-code-add-part-button-container"},qn={class:"zero-code-component-header"},Kn={class:"zero-code-component-meta"},Xn={class:"zero-code-component-type"},Yn={class:"zero-code-component-module"},Jn={class:"zero-code-header-actions"},Gn=["title","onClick"],Qn=["onClick"],ea=["onClick"],ta=["innerHTML"],oa={class:"zero-code-add-part-button-container"},ra=["onClick"],na={key:1,class:"zero-code-no-data"},aa={class:"zero-code-empty-state"},sa={class:"zero-code-add-part-button-container"},la={key:1,class:"zero-code-data-section"},ia={class:"zero-code-data-display-section"},da={class:"zero-code-parts-sub-content"},ca={class:"zero-code-parts-sub-section"},pa={class:"zero-code-data-display-pre"},ma=e.defineComponent({__name:"DataDisplay",props:{modelValue:{type:String},pageData:{type:Array},parts:{type:Array},commonParts:{type:Array},individualParts:{type:Array},commonImages:{type:Array},individualImages:{type:Array},renderComponentWithNested:{type:Function},isTextEditing:{type:Boolean}},emits:["update:modelValue","add-part","edit-part","delete-part","reorder-parts"],setup(t,{emit:r}){const o=t,n=r,s=e.computed({get:()=>o.pageData,set:d=>{n("reorder-parts",d)}}),f=()=>{c.debug("ドラッグ開始")},y=()=>{c.debug("ドラッグ終了")},{isCollapsed:h,toggleCollapse:_,collapsedCount:C,expandAll:A,collapseAll:w}=wr(),N=()=>{const d=o.pageData.map((a,l)=>a.id||`component-${l}`);w(d)},z=["rendered","page"],T=d=>({rendered:"レンダリング結果",source:"HTMLソース",page:"データ表示"})[d],B=e.computed(()=>I(o.pageData)),I=d=>{const a=(l,p=0)=>{const E="  ".repeat(p),P="  ".repeat(p+1);if(Array.isArray(l))return l.length===0?"[]":`[
${l.map(i=>P+a(i,p+1)).join(`,
`)}
${E}]`;if(typeof l=="object"&&l!==null){const $=Object.entries(l);return $.length===0?"{}":`{
${$.map(([m,g])=>{let b;if(typeof g=="string"){const u=g.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if(u.includes(`
`)){const v=u.split(`
`);b=v.map((k,S)=>S===0?`\`${k}`:S===v.length-1?`${P}${k}\``:`${P}${k}`).join(`
`)}else b=`"${u}"`}else b=a(g,p+1);return`${P}"${m}": ${b}`}).join(`,
`)}
${E}}`}return typeof l=="string"?`"${l.replace(/"/g,'\\"')}"`:JSON.stringify(l)};return a(d)};return(d,a)=>(e.openBlock(),e.createElementBlock("div",Bn,[e.createElementVNode("div",Mn,[e.createElementVNode("div",Fn,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(z,l=>e.createElementVNode("button",{key:l,class:e.normalizeClass(["zero-code-data-tab-button",{active:d.modelValue===l}]),onClick:p=>d.$emit("update:modelValue",l)},e.toDisplayString(T(l)),11,xn)),64))]),d.modelValue==="rendered"?(e.openBlock(),e.createElementBlock("div",Ln,[e.createElementVNode("span",On,e.toDisplayString(e.unref(C))+"/"+e.toDisplayString(d.pageData.length)+" 折りたたみ中 ",1),e.createElementVNode("button",{class:"zero-code-collapse-all-btn",disabled:d.pageData.length===0,onClick:N}," すべて折りたたみ ",8,Rn),e.createElementVNode("button",{class:"zero-code-expand-all-btn",disabled:e.unref(C)===0,onClick:a[0]||(a[0]=(...l)=>e.unref(A)&&e.unref(A)(...l))}," すべて展開 ",8,Hn)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Zn,[d.modelValue==="rendered"?(e.openBlock(),e.createElementBlock("div",jn,[Array.isArray(d.pageData)&&d.pageData.length>0?(e.openBlock(),e.createElementBlock("div",Un,[e.createElementVNode("div",Wn,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:a[1]||(a[1]=l=>d.$emit("add-part",0))},a[4]||(a[4]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"パーツを追加",-1)]))]),e.createVNode(e.unref(Vn),{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value=l),animation:200,disabled:d.isTextEditing,"ghost-class":"ghost","chosen-class":"chosen","drag-class":"drag",onStart:f,onEnd:y},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.pageData,(l,p)=>(e.openBlock(),e.createElementBlock("div",{key:`${l.id||p}`,class:"zero-code-rendered-component zero-code-draggable-item"},[e.createElementVNode("div",qn,[e.createElementVNode("div",Kn,[a[5]||(a[5]=e.createElementVNode("div",{class:"zero-code-drag-handle"},[e.createElementVNode("span",{class:"zero-code-drag-icon"},"⠿")],-1)),e.createElementVNode("span",Xn,e.toDisplayString(l.type||"unknown"),1),e.createElementVNode("span",Yn,e.toDisplayString(l.module_name||""),1)]),e.createElementVNode("div",Jn,[e.createElementVNode("button",{class:"zero-code-collapse-btn",title:e.unref(h)(l.id||`component-${p}`)?"展開":"折りたたみ",onClick:E=>e.unref(_)(l.id||`component-${p}`)},e.toDisplayString(e.unref(h)(l.id||`component-${p}`)?"＋":"－"),9,Gn),e.createElementVNode("button",{class:"zero-code-edit-btn",onClick:E=>d.$emit("edit-part",p)},"編集",8,Qn),e.createElementVNode("button",{class:"zero-code-delete-btn",onClick:E=>d.$emit("delete-part",p)},"削除",8,ea)])]),e.createVNode(e.Transition,{name:"collapse"},{default:e.withCtx(()=>[e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:`preview-${l.id}`,class:"zero-code-component-preview",innerHTML:d.renderComponentWithNested(l,p)},null,8,ta)),[[e.vShow,!e.unref(h)(l.id||`component-${p}`)]])]),_:2},1024),e.createElementVNode("div",oa,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:E=>d.$emit("add-part",p+1)},a[6]||(a[6]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"パーツを追加",-1)]),8,ra)])]))),128))]),_:1},8,["modelValue","disabled"])])):(e.openBlock(),e.createElementBlock("div",na,[e.createElementVNode("div",aa,[a[8]||(a[8]=e.createElementVNode("p",{class:"zero-code-empty-message"},"パーツがありません",-1)),e.createElementVNode("div",sa,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:a[3]||(a[3]=l=>d.$emit("add-part",0))},a[7]||(a[7]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"最初のパーツを追加",-1)]))])])]))])):e.createCommentVNode("",!0),d.modelValue==="page"?(e.openBlock(),e.createElementBlock("div",la,[e.createElementVNode("div",ia,[e.createElementVNode("div",da,[e.createElementVNode("div",ca,[a[9]||(a[9]=e.createElementVNode("h4",{style:{margin:"0 0 16px 0",color:"#374151","font-size":"1.1rem"}},"Pageデータ（リアルタイム更新）",-1)),e.createElementVNode("pre",pa,e.toDisplayString(B.value),1)])])])])):e.createCommentVNode("",!0)])]))}}),ua={class:"zero-code-modal-header"},ga={class:"zero-code-data-tabs"},fa={class:"zero-code-tab-buttons"},ha=["onClick"],ya={class:"zero-code-modal-body"},ba={key:0,class:"zero-code-parts-section"},_a={key:0,class:"zero-code-parts-list"},$a={class:"zero-code-part-section-title"},Ea={class:"zero-code-modules-grid"},wa=["onClick"],za={class:"zero-code-module-title"},va=["innerHTML"],Ca={key:1,class:"zero-code-empty-state"},Aa={key:1,class:"zero-code-parts-section"},Na={key:0,class:"zero-code-parts-list"},ka={class:"zero-code-part-section-title"},Pa={class:"zero-code-modules-grid"},Sa=["onClick"],Ia={class:"zero-code-module-title"},Da=["innerHTML"],Ta={key:1,class:"zero-code-empty-state"},zr=e.defineComponent({__name:"PartSelector",props:{parts:{type:Array},isNested:{type:Boolean,default:!1},modalContainer:{default:"body",type:String}},emits:["close","select-part"],setup(t,{emit:r}){const o=t;e.computed(()=>!o.modalContainer||o.modalContainer==="body"?!0:typeof document<"u");const n=e.computed(()=>!o.modalContainer||o.modalContainer==="body"?"body":typeof document<"u"&&document.querySelector(o.modalContainer)?o.modalContainer:"body"),s=e.ref("common"),f=["common","individual"],y=N=>({common:"共通パーツ",individual:"個別パーツ"})[N],h=e.computed(()=>o.parts.map(N=>({...N,module:N.module.filter(z=>{const T=z;return!T.category||T.category==="common"})})).filter(N=>N.module.length>0)),_=e.computed(()=>o.parts.map(N=>({...N,module:N.module.filter(z=>z.category==="individual")})).filter(N=>N.module.length>0)),C=r,A=(N,z)=>{C("select-part",N,z)},w=N=>{if(!N)return"";try{let z=N;return z=z.replace(/@slot\(\$[^)]+\)@/g,""),z=z.replace(/\{\$([^:]+):([^}]*)\}/g,(T,B,I)=>I&&I.trim()?I:{title:"サンプルタイトル",text:"サンプルテキストです。",image:"/sample-image.jpg",link:"#",url:"https://example.com",alt:"サンプル画像",content:"サンプルコンテンツ",description:"サンプル説明文です。"}[B]||`[${B}]`),z=z.replace(/\(\$([^:]+):([^)]+)\)/g,(T,B,I)=>I.split("|").filter(a=>a.trim())[0]||""),z=z.replace(/\(\$([^:?]+)\?:([^)]*)\)/g,(T,B,I)=>I||""),z=z.replace(/z-for-wrapper="[^"]*"/g,""),z=z.replace(/z-for="[^"]*"/g,""),z=z.replace(/z-slot="[^"]*"/g,""),z=z.replace(/\$(\w+)/g,(T,B)=>({title:"タイトル",text:"テキスト",content:"コンテンツ"})[B]||`[${B}]`),z}catch{return N}};return(N,z)=>(e.openBlock(),e.createBlock(e.Teleport,{to:n.value},[e.createElementVNode("div",{class:"zero-code-modal-overlay",onClick:z[2]||(z[2]=T=>N.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:z[1]||(z[1]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",ua,[e.createElementVNode("h4",null,e.toDisplayString(o.isNested?"ネストパーツを選択":"パーツを選択"),1),e.createElementVNode("button",{class:"zero-code-close-button",onClick:z[0]||(z[0]=T=>N.$emit("close"))},"✖️")]),e.createElementVNode("div",ga,[e.createElementVNode("div",fa,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(f,T=>e.createElementVNode("button",{key:T,class:e.normalizeClass(["zero-code-data-tab-button",{active:s.value===T}]),onClick:B=>s.value=T},e.toDisplayString(y(T)),11,ha)),64))])]),e.createElementVNode("div",ya,[s.value==="common"?(e.openBlock(),e.createElementBlock("div",ba,[h.value.length>0?(e.openBlock(),e.createElementBlock("div",_a,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,(T,B)=>(e.openBlock(),e.createElementBlock("div",{key:B,class:"zero-code-part-section"},[e.createElementVNode("h5",$a,e.toDisplayString(T.type),1),e.createElementVNode("div",Ea,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.module,(I,d)=>(e.openBlock(),e.createElementBlock("div",{key:d,class:"zero-code-module-card",onClick:a=>A(T.type,I)},[e.createElementVNode("div",za,e.toDisplayString(I.title),1),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:w(I.body)},null,8,va)],8,wa))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",Ca,z[3]||(z[3]=[e.createElementVNode("p",null,"共通パーツが登録されていません。",-1)])))])):e.createCommentVNode("",!0),s.value==="individual"?(e.openBlock(),e.createElementBlock("div",Aa,[_.value.length>0?(e.openBlock(),e.createElementBlock("div",Na,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.value,(T,B)=>(e.openBlock(),e.createElementBlock("div",{key:B,class:"zero-code-part-section"},[e.createElementVNode("h5",ka,e.toDisplayString(T.type),1),e.createElementVNode("div",Pa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.module,(I,d)=>(e.openBlock(),e.createElementBlock("div",{key:d,class:"zero-code-module-card",onClick:a=>A(T.type,I)},[e.createElementVNode("div",Ia,e.toDisplayString(I.title),1),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:w(I.body)},null,8,Da)],8,Sa))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",Ta,z[4]||(z[4]=[e.createElementVNode("p",null,"個別パーツが登録されていません。",-1)])))])):e.createCommentVNode("",!0)])])])],8,["to"]))}}),Va={class:"zero-code-array-field"},Ba={class:"zero-code-array-header"},Ma={key:0,class:"zero-code-empty-array-message"},Fa={class:"zero-code-empty-message-content"},xa={class:"zero-code-empty-text"},La={class:"zero-code-button-text"},Oa=["onDragstart","onDrop"],Ra={class:"zero-code-array-item-header"},Ha={class:"zero-code-component-meta"},Za=["onClick"],ja={class:"zero-code-array-item-fields"},Ua=["for"],Wa={key:0,class:"zero-code-radio-group"},qa=["id","value","name","checked","onChange"],Ka=["for"],Xa={key:1,class:"zero-code-checkbox-group"},Ya=["id","checked","onChange"],Ja=["for"],Ga=["id","value","onInput"],Qa=["value"],es=["id","value","onChange"],ts=["value","selected"],os=["id","value","onInput"],rs=["id","value","type","onInput"],ns={key:0,class:"zero-code-nested-array-field"},as={class:"zero-code-nested-array-label"},ss={class:"zero-code-nested-array-info"},ls={class:"zero-code-array-count"},is=["onClick"],ds=e.defineComponent({__name:"ArrayFieldEditor",props:{componentId:{type:String},arrayKey:{type:String},items:{type:Array},fields:{type:Object},label:{type:String},itemLabel:{type:String}},emits:["add","remove","update","reorder","edit-nested"],setup(t,{emit:r}){const o=t,n=r,s=(z,T,B)=>{n("update",z,T,B)},f=(z,T,B)=>{const I=z[T];return Array.isArray(I)&&I.includes(B)},y=(z,T,B,I)=>{let a=o.items[z][T]||[];Array.isArray(a)||(a=[]),I?a.includes(B)||(a=[...a,B]):a=a.filter(l=>l!==B),n("update",z,T,a)};let h=null;const _=(z,T)=>{h=T,z.dataTransfer&&(z.dataTransfer.effectAllowed="move",z.dataTransfer.setData("text/plain",T.toString()));const B=z.target;B.style.opacity="0.5"},C=z=>{z.preventDefault(),z.dataTransfer&&(z.dataTransfer.dropEffect="move")},A=(z,T)=>{z.preventDefault(),h!==null&&h!==T&&n("reorder",h,T),h=null},w=z=>{const T=z.target;T.style.opacity="1",h=null},N=(z,T)=>!Array.isArray(T)||z==="id"||["nested_parts","content"].includes(z)?!1:T.length>0&&typeof T[0]=="object"&&T[0]!==null;return(z,T)=>(e.openBlock(),e.createElementBlock("div",Va,[e.createElementVNode("div",Ba,[e.createElementVNode("h5",null,e.toDisplayString(z.label),1),e.createElementVNode("button",{class:"zero-code-btn zero-code-add-array-item",onClick:T[0]||(T[0]=B=>z.$emit("add"))},"+ 追加")]),z.items.length===0?(e.openBlock(),e.createElementBlock("div",Ma,[e.createElementVNode("div",Fa,[e.createElementVNode("p",xa,e.toDisplayString(z.label)+"はまだ追加されていません",1),e.createElementVNode("button",{class:"zero-code-btn zero-code-add-array-item-empty",onClick:T[1]||(T[1]=B=>z.$emit("add"))},[T[2]||(T[2]=e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1)),e.createElementVNode("span",La,"最初の"+e.toDisplayString(z.label)+"を追加",1)])])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(z.items,(B,I)=>(e.openBlock(),e.createElementBlock("div",{key:B?.id||I,class:"zero-code-array-item",draggable:"true",onDragstart:d=>_(d,I),onDragover:C,onDrop:d=>A(d,I),onDragend:w},[e.createElementVNode("div",Ra,[e.createElementVNode("div",Ha,[T[3]||(T[3]=e.createElementVNode("span",{class:"zero-code-drag-handle"},"⠿",-1)),e.createElementVNode("h6",null,e.toDisplayString(z.itemLabel)+" "+e.toDisplayString(I+1),1)]),e.createElementVNode("button",{class:"zero-code-btn zero-code-remove-array-item",onClick:d=>z.$emit("remove",I)},"削除",8,Za)]),e.createElementVNode("div",ja,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(z.fields,(d,a)=>(e.openBlock(),e.createElementBlock("div",{key:a,class:"zero-code-field-group"},[e.createElementVNode("label",{for:`${z.componentId}_${z.arrayKey}_${I}_${a}`},e.toDisplayString(d.label)+": ",9,Ua),d.type==="radio"&&d.options&&d.options.length>0?(e.openBlock(),e.createElementBlock("div",Wa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-radio-item"},[e.createElementVNode("input",{id:`${z.componentId}_${z.arrayKey}_${I}_${a}_${l}`,value:l,type:"radio",name:`${z.componentId}_${z.arrayKey}_${I}_${a}`,class:"zero-code-radio-input",checked:B[a]===l||l==="指定なし"&&!B[a],onChange:p=>s(I,a,l==="指定なし"?"":l)},null,40,qa),e.createElementVNode("label",{for:`${z.componentId}_${z.arrayKey}_${I}_${a}_${l}`,class:"zero-code-radio-label"},e.toDisplayString(l),9,Ka)]))),128))])):e.createCommentVNode("",!0),d.type==="checkbox"&&d.options&&d.options.length>0?(e.openBlock(),e.createElementBlock("div",Xa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-checkbox-item"},[e.createElementVNode("input",{id:`${z.componentId}_${z.arrayKey}_${I}_${a}_${l}`,checked:f(B,a,l),type:"checkbox",class:"zero-code-checkbox-input",onChange:p=>{const E=p.target;y(I,a,l,E.checked)}},null,40,Ya),e.createElementVNode("label",{for:`${z.componentId}_${z.arrayKey}_${I}_${a}_${l}`,class:"zero-code-checkbox-label"},e.toDisplayString(l),9,Ja)]))),128))])):d.type==="select"?(e.openBlock(),e.createElementBlock("select",{key:2,id:`${z.componentId}_${z.arrayKey}_${I}_${a}`,value:B[a],class:"zero-code-field-input zero-code-select-input",onInput:l=>{const p=l.target;s(I,a,p.value)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l),9,Qa))),128))],40,Ga)):d.type==="select-multiple"?(e.openBlock(),e.createElementBlock("select",{key:3,id:`${z.componentId}_${z.arrayKey}_${I}_${a}`,value:B[a]||d.defaultValue,multiple:"",class:"zero-code-field-input zero-code-select-multiple",onChange:l=>{const p=l.target,E=Array.from(p.selectedOptions).map(P=>P.value);s(I,a,E)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l,selected:Array.isArray(B[a])&&B[a].includes(l)},e.toDisplayString(l),9,ts))),128))],40,es)):d.type==="textarea"?(e.openBlock(),e.createElementBlock("textarea",{key:4,id:`${z.componentId}_${z.arrayKey}_${I}_${a}`,value:B[a],class:"zero-code-field-input zero-code-field-textarea",onInput:l=>{const p=l.target;s(I,a,p.value)}},null,40,os)):d.type==="text"||d.type==="number"?(e.openBlock(),e.createElementBlock("input",{key:5,id:`${z.componentId}_${z.arrayKey}_${I}_${a}`,value:B[a],type:d.type==="text"?"text":d.type,class:"zero-code-field-input",onInput:l=>{const p=l.target;s(I,a,p.value)}},null,40,rs)):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B,(d,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:`nested_${a}`},[Array.isArray(d)&&a!=="id"&&N(a,d)?(e.openBlock(),e.createElementBlock("div",ns,[e.createElementVNode("h6",as,e.toDisplayString(a)+" (ネスト配列)",1),e.createElementVNode("div",ss,[e.createElementVNode("span",ls,e.toDisplayString(d.length)+"個の要素",1),e.createElementVNode("button",{class:"zero-code-btn zero-code-edit-nested-array-btn",title:"ネスト配列を編集",onClick:l=>z.$emit("edit-nested",I,a)}," 編集 ",8,is)])])):e.createCommentVNode("",!0)],64))),128))])],40,Oa))),128))]))}});var cs=Object.defineProperty,ps=(t,r,o)=>r in t?cs(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,vr=(t,r,o)=>ps(t,typeof r!="symbol"?r+"":r,o),ue=(t=>(t.VALIDATION="VALIDATION",t.NETWORK="NETWORK",t.COMPONENT="COMPONENT",t.TEMPLATE="TEMPLATE",t.FILE="FILE",t.PERMISSION="PERMISSION",t.IMAGE_LOAD_FAILED="IMAGE_LOAD_FAILED",t.UNKNOWN="UNKNOWN",t.NETWORK_ERROR="NETWORK_ERROR",t.VALIDATION_ERROR="VALIDATION_ERROR",t.PERMISSION_ERROR="PERMISSION_ERROR",t.COMPONENT_ERROR="COMPONENT_ERROR",t.TEMPLATE_PARSE_ERROR="TEMPLATE_PARSE_ERROR",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t))(ue||{});class ms{constructor(){vr(this,"errorHistory",[]),vr(this,"maxHistorySize",100)}handleError(r,o,n,s,f){const y={type:r,message:o,details:n,componentId:s,action:f,timestamp:Date.now()};return this.errorHistory.unshift(y),this.errorHistory.length>this.maxHistorySize&&(this.errorHistory=this.errorHistory.slice(0,this.maxHistorySize)),r==="VALIDATION"||r==="PERMISSION"?c.warn(`[${r}] ${o}`,n):c.error(`[${r}] ${o}`,n),y}componentError(r,o,n){return this.handleError("COMPONENT",r,n,o,"component_operation")}templateError(r,o){return this.handleError("TEMPLATE",r,o,void 0,"template_processing")}validationError(r,o){return this.handleError("VALIDATION",r,o,void 0,"validation")}fileError(r,o){return this.handleError("FILE",r,o,void 0,"file_operation")}networkError(r,o){return this.handleError("NETWORK",r,o,void 0,"network_request")}permissionError(r,o){return this.handleError("PERMISSION",r,o,void 0,"permission_check")}unknownError(r,o){return this.handleError("UNKNOWN",r,o,void 0,"unknown")}getErrorHistory(){return[...this.errorHistory]}getErrorsByType(r){return this.errorHistory.filter(o=>o.type===r)}clearHistory(){this.errorHistory=[],c.debug("エラー履歴をクリアしました")}getErrorStats(){const r=Object.values(ue).reduce((o,n)=>(o[n]=0,o),{});return this.errorHistory.forEach(o=>{r[o.type]++}),r}}function et(t,r,o,n="UNKNOWN"){try{return t()}catch(s){const f=s instanceof Error?{stack:s.stack,name:s.name}:{error:String(s)};return r.handleError(n,o,f),null}}const tt=new ms,us=["content","nested_parts"],Cr=["_isZForItem","_parentComponentId","_arrayName","_arrayIndex","_zForTemplate"];function no(t){const r=(i,m)=>{if(m.length===0||m[0]>=i.length)return null;let g=i[m[0]];for(let b=1;b<m.length;b++){if(!g.nested_parts||!Array.isArray(g.nested_parts)||m[b]>=g.nested_parts.length)return null;g=g.nested_parts[m[b]]}return g},o=(i,m)=>{if(m.length===1)return i;let g=i[m[0]];for(let b=1;b<m.length-1;b++){if(!g.nested_parts||!Array.isArray(g.nested_parts))return[];g=g.nested_parts[m[b]]}return g.nested_parts||[]},n=i=>i.split("-").map(Number),s=i=>i.join("-"),f=(i,m,g=[])=>{if(c.debug(`findComponentRecursively: 検索開始 - componentId=${m}, depth=${g.length}`),!i||!Array.isArray(i))return c.debug(`findComponentRecursively: 無効なデータ - data=${i}, isArray=${Array.isArray(i)}`),null;c.debug(`findComponentRecursively: ${i.length}個のコンポーネントを検索中`);for(let b=0;b<i.length;b++){const u=i[b],v=[...g,b];if(c.debug(`findComponentRecursively: [${b}] チェック中 - id=${u.id}, type=${u.type}`),u.id===m)return c.success(`findComponentRecursively: 発見！ - ${m} at path=${v.join("-")}`),u;if(u.nested_parts&&Array.isArray(u.nested_parts)){c.debug(`findComponentRecursively: nested_parts検索 - ${u.id} (${u.nested_parts.length}個)`);const k=f(u.nested_parts,m,v);if(k)return k}const D=Object.keys(u);for(const k of D){const S=u[k];if(Array.isArray(S)&&k!=="nested_parts"){c.debug(`findComponentRecursively: z-for配列検索 - ${u.id}.${k} (${S.length}個)`);for(let V=0;V<S.length;V++){const F=S[V];if(F&&typeof F=="object"&&F.id){if(c.debug(`findComponentRecursively: z-for配列アイテム - ${F.id} in ${u.id}.${k}[${V}]`),F.id===m)return c.success(`findComponentRecursively: z-for配列アイテムで発見！ - ${m}`),F;if(F.nested_parts&&Array.isArray(F.nested_parts)){c.debug(`findComponentRecursively: z-for配列アイテムのネストパーツ検索 - ${F.id}.nested_parts (${F.nested_parts.length}個)`);const X=f(F.nested_parts,m,[...v,V]);if(X)return c.success(`findComponentRecursively: z-for配列内のネストパーツで発見！ - ${m}`),X}}}}}}return c.debug(`findComponentRecursively: 未発見 - ${m}`),null},y=(i,m)=>et(()=>{if(i==="z-for-item")return"";if(!Array.isArray(t))throw new Error("Parts配列が無効です");if(!i||!m)throw new Error("Type または ModuleName が指定されていません");const g=t.find(u=>u.type===i);if(!g)throw new Error(`パーツタイプ "${i}" が見つかりません`);const b=g.module.find(u=>u.title===m);if(!b)throw new Error(`モジュール "${m}" が見つかりません (type: ${i})`);return b.body},tt,`テンプレート取得エラー: ${i}/${m}`,ue.TEMPLATE)||"",h=new Set,_=(i,m)=>{c.debug(`extractZForTemplate開始: arrayName=${m}`);const g=new RegExp(`<(\\w+)[^>]*z-for="${m}"[^>]*>`),b=i.match(g);if(!b)return c.warn(`z-for="${m}" 開始タグが見つかりません`),c.debug("親テンプレート内容:",i.substring(0,500)),"";const u=i.indexOf(b[0]),v=b[1];let D=0,k=u,S=u;for(;S<i.length;)if(i.substring(S,S+v.length+1)===`<${v}`){const F=i.indexOf(">",S);F!==-1?(D++,S=F+1):S++}else if(i.substring(S,S+v.length+3)===`</${v}>`){if(D--,D===0){k=S+v.length+3;break}S+=v.length+3}else S++;if(D!==0)return c.warn(`z-for="${m}" の対応する終了タグが見つかりません（深度: ${D}）`),"";const V=i.substring(u,k).trim();return c.debug(`z-for内テンプレート抽出成功: ${m}`,{extractedContent:V.substring(0,200),fullContent:V,startIndex:u,endIndex:k,depth:0}),V},C=()=>"comp_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36),A=i=>{const m=`${i.id}_${i.type}_${i.module_name}`;if(c.debug(`getFieldInfo: _isZForItem=${i._isZForItem}`),c.debug(`getFieldInfo: _arrayName=${i._arrayName}`),h.has(m))return c.warn(`getFieldInfo: 無限ループを検出、処理をスキップ: ${m}`),[];h.add(m);try{let g="";if(i._isZForItem){const k=i._parentType,S=i._parentModuleName;c.debug(`getFieldInfo: z-for-itemのparent情報 - type: ${k}, module: ${S}`),k&&S?g=y(k,S):(c.debug("getFieldInfo: 親情報なし、コンポーネント自体を使用"),g=y(i.type,i.module_name))}else g=y(i.type,i.module_name);if(!g)return[];if(c.debug(`getFieldInfo: component.id=${i.id}, type=${i.type}, module=${i.module_name}`),c.debug(`getFieldInfo: _isZForItem=${i._isZForItem}`),i._isZForItem){const k=i._arrayName;if(c.debug(`getFieldInfo: z-for配列要素を検出, arrayName=${k}`),c.debug("getFieldInfo: componentプロパティ:",Object.keys(i)),k){c.debug("getFieldInfo: 元のテンプレート:",g.substring(0,300));const S=_(g,k);S?(g=S,c.debug("getFieldInfo: z-for内テンプレート抽出完了:",g)):c.warn(`getFieldInfo: z-for内テンプレートの抽出に失敗: arrayName=${k}`)}}else c.debug("getFieldInfo: 通常のコンポーネント処理");const b=[],u=g.match(/\(\$([^:]+):(.*?)\)/g)||[],v=[];if(g.includes("z-for=")){const k=/<(\w+)[^>]*z-for="([^"]+)"[^>]*>/g;let S;for(;(S=k.exec(g))!==null;){const V=S[2],F=S.index;if(c.debug(`z-for検出: ${V}, 現在の配列: ${i._arrayName}`),i._isZForItem&&V!==i._arrayName){let X=0,O=F,L=F;for(;L<g.length;){if(g.substring(L,L+4)==="<div")X++;else if(g.substring(L,L+6)==="</div>"&&(X--,X===0)){O=L+6;break}L++}if(X===0){const G=g.substring(F,O).match(/\(\$([^:]+):(.*?)\)/g);G&&G.forEach(ne=>{const de=ne.match(/\(\$([^:]+):(.*?)\)/);if(de){const pe=de[1].replace("?","");v.push(pe)}}),c.debug(`子z-for除外: ${V} のフィールドを除外リストに追加`)}}}}v.length>0&&c.debug("z-for配列内のフィールドを除外:",v);let D;return i._isZForItem?D=u.filter(k=>{const S=k.match(/\(\$([^:]+):(.*?)\)/);if(S){const V=S[1].replace("?",""),F=!v.includes(V);return F?c.debug(`z-for配列アイテム編集: フィールド ${V} を表示`):c.debug(`z-for配列アイテム編集: フィールド ${V} を除外（子z-forフィールド）`),F}return!1}):D=u.filter(k=>{const S=k.match(/\(\$([^:]+):(.*?)\)/);if(S){const V=S[1].replace("?","");let F=!1,X=!1;const O=new RegExp(`\\(\\$${V.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}[?:]`,"g"),L=/<[^>]*z-for="[^"]*"[^>]*>[\s\S]*?<\/[^>]*>/g;let U;for(;(U=L.exec(g))!==null;){const G=U[0];if(O.test(G)){F=!0;break}}if(F){const G=g.replace(L,"");O.lastIndex=0,O.test(G)&&(X=!0)}return F&&!X?(c.debug(`getFieldInfo: ${V} をz-for内専用フィールドとして除外`),!1):(c.debug(`getFieldInfo: ${V} を表示対象に含める`),!0)}return!0}),D.forEach(k=>{const S=k.match(/\(\$([^:]+):(.*?)\)/);if(S){const[,V,F]=S,X=V.includes("?"),O=V.replace("?","");if(F.includes("|")){let L=F.split("|"),U=!1;if((F.includes("||")||F.startsWith("|")||F.endsWith("|"))&&(U=!0),L=L.filter(G=>G.trim()!==""),U&&L.unshift("指定なし"),X){const G=L.length>0?[L[0]]:[],ne={type:"checkbox",paramName:O,propKey:O,options:L,defaultValue:G,label:`${O} (チェックボックス)`};b.push(ne)}else{const G=L[0]||"",ne={type:"radio",paramName:O,propKey:O,options:L,defaultValue:G,label:`${O} (ラジオボタン)`};b.push(ne)}}else if(F.includes(",")){const L=F.split(",").map(U=>U.trim()).filter(U=>U!=="");if(X){const U=L.length>0?[L[0]]:[],G={type:"select-multiple",paramName:O,propKey:O,options:L,defaultValue:U,label:`${O} (セレクトボックス・複数選択)`};b.push(G)}else{const U=L[0]||"",G={type:"select",paramName:O,propKey:O,options:L,defaultValue:U,label:`${O} (セレクトボックス)`};b.push(G)}}else{const L={type:"text",paramName:O,propKey:O,options:[],defaultValue:F,label:`${O} (テキストボックス)`};b.push(L)}}}),c.debug(`getFieldInfo: 抽出されたフィールド数=${b.length}`,b.map(k=>({paramName:k.paramName,type:k.type}))),b}catch(g){return c.error(`getFieldInfo: エラーが発生しました: ${m}`,g),[]}finally{h.delete(m)}},w=(i,m)=>{try{const g=y(i.type,i.module_name);if(!g)return!1;let b=g;if(i._isZForItem){const S=i._arrayName,V=_(g,S);V&&(b=V)}const u=new RegExp(`\\{\\$${m}:[^}]*\\}`),v=new RegExp(`\\(\\$${m}:[^)]*\\)`),D=new RegExp(`\\(\\$${m}\\?:[^)]*\\)`),k=u.test(b)||v.test(b)||D.test(b);if(!k&&!i._isZForItem){const S=/<[^>]*z-for="[^"]*"[^>]*>[\s\S]*?<\/[^>]*>/g;let V;for(;(V=S.exec(g))!==null;){const F=V[0];if(c.debug(`isTemplateField: z-forブロック検査中 - ${m}`,F.substring(0,100)),u.test(F)||v.test(F)||D.test(F))return c.success(`isTemplateField: ${m} はz-for内で使用されているためメイン編集パネルから除外`),!0}c.debug(`isTemplateField: ${m} - z-for内での使用検出結果: false`),c.debug("isTemplateField: テンプレート内容 (最初200文字):",g.substring(0,200))}return k}catch(g){return c.warn(`isTemplateField error for ${m}:`,g),!1}},N=(i,m)=>!!(["content","nested_parts"].includes(i)||Array.isArray(m)||typeof m=="object"&&m!==null);return{findComponentByPath:r,getParentContainer:o,parseHierarchyPath:n,stringifyHierarchyPath:s,findComponentRecursively:f,getTemplate:y,generateUniqueId:C,getFieldInfo:A,isTemplateField:w,shouldExcludeField:N,shouldShowBasicField:(i,m,g)=>{if(i==="id"||i==="type"||i==="module_name")return!1;const b=y(g.type,g.module_name);if(b&&b.includes("z-for=")){const u=/<[^>]*z-for="[^"]*"[^>]*>[\s\S]*?<\/[^>]*>/g;let v,D=!1,k=!1;const S=new RegExp(`\\(\\$${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}[?:]`,"g");for(;(v=u.exec(b))!==null;){const V=v[0];if(S.test(V)){D=!0;break}}if(D){const V=b.replace(u,"");S.lastIndex=0,S.test(V)&&(k=!0)}if(D&&!k)return!1}return g._isZForItem||Cr.includes(i)||N(i,m)||w(g,i)||m===""||m===null||m===void 0||typeof m=="string"&&m.trim()===""||typeof m=="number"&&m===0?!1:typeof m=="string"&&m.trim()!==""||typeof m=="number"&&m!==0||typeof m=="boolean"},shouldShowArrayField:(i,m,g)=>{const b=`${g.id}_${g.type}_${g.module_name}_array_${i}`;if(h.has(b))return c.warn(`shouldShowArrayField: 無限ループを検出、処理をスキップ: ${b}`),!1;h.add(b);try{if(c.debug(`shouldShowArrayField開始: key=${i}, component: ${g.id} (${g.type}/${g.module_name})`,{key:i,value:m,componentId:g.id}),us.includes(String(i)))return c.debug(`shouldShowArrayField: ${i} はシステム内部フィールドのため除外`),!1;if(g._isZForItem&&Cr.includes(String(i)))return c.debug(`shouldShowArrayField: ${i} はz-forシステムフィールドのため除外`),!1;if(w(g,i))return c.debug(`shouldShowArrayField: ${i} はテンプレート記法フィールドのため除外`),!1;const u=y(g.type,g.module_name);if(u){if(c.debug("shouldShowArrayField: テンプレート取得成功:",u.substring(0,200)),new RegExp(`z-for="${i}"`).test(u))return c.success(`shouldShowArrayField: ${i}はz-for記法で使用されているため編集パネルでは非表示（プレビュー側で編集）`),Array.isArray(m)||(c.debug(`shouldShowArrayField: ${i}は配列でないが、記法で使用されているため空配列で初期化`),g[i]=[]),!1;c.debug(`shouldShowArrayField: ${i}は配列記法で使用されていない`)}else c.debug("shouldShowArrayField: テンプレート取得失敗");return Array.isArray(m)||c.debug(`shouldShowArrayField: ${i}は配列でなく、記法でも使用されていない`),!1}catch(u){return c.error(`shouldShowArrayField: エラーが発生しました: ${b}`,u),!1}finally{h.delete(b)}},shouldShowArrayItemField:(i,m,g,b,u)=>i==="id"||Array.isArray(m)||typeof m=="object"&&m!==null||m===""||m===null||m===void 0||typeof m=="string"&&m.trim()===""||typeof m=="number"&&m===0?!1:(y(g.type,g.module_name),typeof m=="string"&&m.trim()!==""||typeof m=="number"&&m!==0||typeof m=="boolean"),getInputType:i=>i.includes("url")||i.includes("src")?"url":i.includes("email")?"email":i.includes("number")||i.includes("count")?"number":"text",updateCheckboxValue:(i,m,g,b)=>{i[m]||(i[m]=[]);const u=i[m];b?u.includes(g)||u.push(g):i[m]=u.filter(v=>v!==g)},isCheckboxChecked:(i,m,g)=>{const b=i[m];return Array.isArray(b)&&b.includes(g)},addArrayItem:(i,m)=>{i[m]||(i[m]=[]);const g={id:`${m}_${Date.now()}`},b=i[m];if(b.length>0){const u=b[0];Object.keys(u).forEach(v=>{if(v!=="id"){const D=u[v],k=typeof D=="string"?"":D;g[v]=k}})}b.push(g)},removeArrayItem:(i,m,g)=>{const b=i[m];b&&b.length>g&&b.splice(g,1)},createNewComponent:(i,m)=>et(()=>{if(!i||!m)throw new Error("partType または module が指定されていません");if(!m.title||!m.body)throw new Error("module.title または module.body が無効です");const g=C();c.debug(`createNewComponent開始: partType=${i}, module=${m.title}`);const b={id:g,type:i,module_name:m.title},u=m.body;c.debug("createNewComponent テンプレート:",u.substring(0,300));const v=u.match(/\{\$([^:}]+):([^}]+)\}/g);v&&v.forEach(V=>{const F=V.match(/\{\$([^:}]+):([^}]+)\}/);if(F){const[,X,O]=F;X!=="input"&&(b[X]=String(O))}});const D=u.match(/\(\$([^:?]+):(.*?)\)/g);D&&D.forEach(V=>{const F=V.match(/\(\$([^:?]+):(.*?)\)/);if(F){const[,X,O]=F,L=O.split("|").filter(U=>U.trim()!=="");L.length>0&&(b[X]=String(L[0]))}});const k=u.match(/\(\$([^:?]+)\?:(.*?)\)/g);k&&k.forEach(V=>{const F=V.match(/\(\$([^:?]+)\?:(.*?)\)/);if(F){const[,X,O]=F,L=O.split("|").filter(U=>U.trim()!=="");b[X]=L.length>0?[L[0]]:[]}});const S=u.match(/z-for="([^"]+)"/g);return S?(c.debug("createNewComponent: z-for記法発見:",S),S.forEach(V=>{const F=V.match(/z-for="([^"]+)"/);if(F){const[,X]=F;b[X]?c.debug(`createNewComponent: z-for配列 ${X} は既に初期化済み`):(c.debug(`createNewComponent: z-for配列 ${X} を空配列で初期化`),b[X]=[])}})):c.debug("createNewComponent: z-for記法が見つかりませんでした"),c.debug("createNewComponent完了: newComponent=",b),b},tt,`コンポーネント作成エラー: ${i}/${m?.title}`,ue.COMPONENT)||{id:C(),type:i||"unknown",module_name:m?.title||"unknown"},createArrayItem:i=>{const m={id:C()},g=i.match(/\{\$([^:}]+):([^}]+)\}/g);g&&g.forEach(u=>{const v=u.match(/\{\$([^:}]+):([^}]+)\}/);if(v){const[,D,k]=v;m[D]=String(k)}});const b=i.match(/\(\$([^:?]+):(.*?)\)/g);return b&&b.forEach(u=>{const v=u.match(/\(\$([^:?]+):(.*?)\)/);if(v){const[,D,k]=v,S=k.split("|").filter(V=>V.trim()!=="");S.length>0&&(m[D]=String(S[0]))}}),m},getArrayItemFieldInfo:(i,m)=>{const g=y(i.type,i.module_name);if(!g)return[];const b=[];let u="";const v=_(g,m);return v&&(u=v),u&&(u.match(/\(\$([^:]+):(.*?)\)/g)||[]).forEach(k=>{const S=k.match(/\(\$([^:]+):(.*?)\)/);if(S){const[,V,F]=S,X=V.includes("?"),O=V.replace("?","");if(F.includes("|")){let L=F.split("|"),U=!1;if((F.includes("||")||F.startsWith("|")||F.endsWith("|"))&&(U=!0),L=L.filter(G=>G.trim()!==""),U&&L.unshift("指定なし"),X){const G=L.length>0?[L[0]]:[],ne={type:"checkbox",paramName:O,propKey:O,options:L,defaultValue:G,label:`${O} (チェックボックス)`};b.push(ne)}else{const G=L[0]||"",ne={type:"radio",paramName:O,propKey:O,options:L,defaultValue:G,label:`${O} (ラジオボタン)`};b.push(ne)}}else if(F.includes(",")){const L=F.split(",").map(U=>U.trim()).filter(U=>U!=="");if(X){const U=L.length>0?[L[0]]:[],G={type:"select-multiple",paramName:O,propKey:O,options:L,defaultValue:U,label:`${O} (セレクトボックス・複数選択)`};b.push(G)}else{const U=L[0]||"",G={type:"select",paramName:O,propKey:O,options:L,defaultValue:U,label:`${O} (セレクトボックス)`};b.push(G)}}else{const L={type:"text",paramName:O,propKey:O,options:[],defaultValue:F,label:`${O} (テキストボックス)`};b.push(L)}}}),b}}}const gs={class:"zero-code-content-sidebar"},fs={key:0,class:"zero-code-editable-component"},hs={class:"zero-code-component-info"},ys={class:"zero-code-component-type"},bs={class:"zero-code-component-module"},_s={class:"zero-code-component-id"},$s={class:"zero-code-fields"},Es={class:"zero-code-field-label"},ws={key:0,class:"zero-code-text-group"},zs=["value","onInput"],vs={key:1,class:"zero-code-radio-group"},Cs=["id","value","name","checked","onChange"],As=["for"],Ns={key:2,class:"zero-code-checkbox-group"},ks=["id","checked","onChange"],Ps=["for"],Ss={key:3,class:"zero-code-select-group"},Is=["value","onChange"],Ds=["value"],Ts={key:4,class:"zero-code-select-multiple-group"},Vs=["value","onChange"],Bs=["value","selected"],Ms={key:0,class:"zero-code-field-group"},Fs=["for"],xs=["id","value","type","readonly","onInput"],Ls=e.defineComponent({__name:"EditorPanel",props:{showEditor:{type:Boolean},selectedComponent:{type:[Object,null]},getFieldInfo:{type:Function},shouldShowBasicField:{type:Function},shouldShowArrayField:{type:Function},shouldShowArrayItemField:{type:Function},getInputType:{type:Function},isCheckboxChecked:{type:Function},partsData:{type:Array},modalContainer:{default:"body",type:String}},emits:["close","update:value","update:array-item","update:checkbox","add:array-item","remove:array-item","reorder:array-item"],setup(t,{emit:r}){const o=t;e.computed(()=>!o.modalContainer||o.modalContainer==="body"?!0:typeof document<"u");const n=e.computed(()=>!o.modalContainer||o.modalContainer==="body"?"body":typeof document<"u"&&document.querySelector(o.modalContainer)?o.modalContainer:"body"),s=r,f=()=>{s("close")},y=(I,d)=>{s("update:value",I,d)},h=()=>{if(!o.selectedComponent)return;o.getFieldInfo(o.selectedComponent).forEach(d=>{d.defaultValue&&!o.selectedComponent[d.propKey]&&((d.type==="checkbox"||d.type==="select-multiple")&&Array.isArray(d.defaultValue)?y(d.propKey,[...d.defaultValue]):y(d.propKey,d.defaultValue))})};e.watch(()=>o.selectedComponent,I=>{I&&h()},{immediate:!0});const _=(I,d,a,l)=>{if(!o.selectedComponent)return;const p=o.selectedComponent[I];if(!Array.isArray(p))return;const E={...p[d],[a]:l};s("update:array-item",I,d,E)},C=(I,d,a)=>{s("update:checkbox",I,d,a)},A=(I,d)=>{I&&s("add:array-item",d)},w=(I,d,a)=>{I&&s("remove:array-item",d,a)},N=(I,d,a)=>{if(!o.selectedComponent)return;const l=o.selectedComponent[I];if(!Array.isArray(l))return;const p=[...l],[E]=p.splice(d,1);p.splice(a,0,E),o.selectedComponent[I]=p,c.debug(`📋 配列並べ替え完了: ${I}[${d}] → [${a}]`),s("reorder:array-item",I,d,a)},z=I=>{if(!o.selectedComponent)return{};const d={};if(o.partsData){const p=no(o.partsData).getArrayItemFieldInfo(o.selectedComponent,I);if(p.forEach(E=>{d[E.propKey]={label:E.label,type:E.type,options:E.options,defaultValue:E.defaultValue}}),p.length>0)return d}const a=o.selectedComponent[I];if(Array.isArray(a)&&a.length>0){const l=a[0];typeof l=="object"&&l!==null&&Object.keys(l).forEach(p=>{p!=="id"&&(l[p],d[p]={label:p.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),type:p.includes("desc")||p.includes("content")?"textarea":"text"})})}return Object.keys(d).length===0?{title:{label:"タイトル",type:"text"},content:{label:"内容",type:"textarea"}}:d},T=I=>I.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()).concat(" 一覧"),B=I=>{let d=I;return I.endsWith("s")&&(d=I.slice(0,-1)),d.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())};return(I,d)=>(e.openBlock(),e.createBlock(e.Teleport,{to:n.value},[I.showEditor&&I.selectedComponent?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-overlay",onClick:f},[e.createElementVNode("div",{class:"zero-code-sidebar",onClick:d[0]||(d[0]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",{class:"zero-code-header"},[e.createElementVNode("div",{class:"zero-code-header-buttons"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-close-button",onClick:f},"✖️")])]),e.createElementVNode("div",gs,[I.selectedComponent?(e.openBlock(),e.createElementBlock("div",fs,[e.createElementVNode("div",hs,[e.createElementVNode("span",ys,e.toDisplayString(I.selectedComponent.type),1),e.createElementVNode("span",bs,e.toDisplayString(I.selectedComponent.module_name),1),e.createElementVNode("span",_s,"ID: "+e.toDisplayString(I.selectedComponent.id),1)]),e.createElementVNode("div",$s,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.getFieldInfo(I.selectedComponent),a=>(e.openBlock(),e.createElementBlock("div",{key:a.propKey,class:"zero-code-template-field"},[e.createElementVNode("label",Es,e.toDisplayString(a.label)+":",1),a.type==="text"?(e.openBlock(),e.createElementBlock("div",ws,[e.createElementVNode("input",{value:I.selectedComponent[a.propKey]||a.defaultValue,type:"text",class:"zero-code-field-input",onInput:l=>{const p=l.target;y(a.propKey,p.value)}},null,40,zs)])):e.createCommentVNode("",!0),a.type==="radio"?(e.openBlock(),e.createElementBlock("div",vs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-radio-item"},[e.createElementVNode("input",{id:`${I.selectedComponent.id}_${a.propKey}_${l}`,value:l,type:"radio",name:`${I.selectedComponent.id}_${a.propKey}`,class:"zero-code-radio-input",checked:I.selectedComponent[a.propKey]===l||l==="指定なし"&&!I.selectedComponent[a.propKey],onChange:p=>y(a.propKey,l==="指定なし"?"":l)},null,40,Cs),e.createElementVNode("label",{for:`${I.selectedComponent.id}_${a.propKey}_${l}`,class:"zero-code-radio-label"},e.toDisplayString(l),9,As)]))),128))])):e.createCommentVNode("",!0),a.type==="checkbox"?(e.openBlock(),e.createElementBlock("div",Ns,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-checkbox-item"},[e.createElementVNode("input",{id:`${I.selectedComponent.id}_${a.propKey}_${l}`,checked:I.isCheckboxChecked(I.selectedComponent,a.propKey,l)||Array.isArray(a.defaultValue)&&a.defaultValue.includes(l)&&!I.selectedComponent[a.propKey],type:"checkbox",class:"zero-code-checkbox-input",onChange:p=>{const E=p.target;C(a.propKey,l,E.checked)}},null,40,ks),e.createElementVNode("label",{for:`${I.selectedComponent.id}_${a.propKey}_${l}`,class:"zero-code-checkbox-label"},e.toDisplayString(l),9,Ps)]))),128))])):e.createCommentVNode("",!0),a.type==="select"?(e.openBlock(),e.createElementBlock("div",Ss,[e.createElementVNode("select",{value:I.selectedComponent[a.propKey]||a.defaultValue,class:"zero-code-field-input zero-code-select-input",onChange:l=>{const p=l.target;y(a.propKey,p.value)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l),9,Ds))),128))],40,Is)])):e.createCommentVNode("",!0),a.type==="select-multiple"?(e.openBlock(),e.createElementBlock("div",Ts,[e.createElementVNode("select",{value:I.selectedComponent[a.propKey]||a.defaultValue,multiple:"",class:"zero-code-field-input zero-code-select-multiple",onChange:l=>{const p=l.target,E=Array.from(p.selectedOptions).map(P=>P.value);y(a.propKey,E)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l,selected:Array.isArray(I.selectedComponent[a.propKey])&&I.selectedComponent[a.propKey].includes(l)},e.toDisplayString(l),9,Bs))),128))],40,Vs)])):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.selectedComponent,(a,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:String(l)},[I.shouldShowBasicField(String(l),a,I.selectedComponent)?(e.openBlock(),e.createElementBlock("div",Ms,[e.createElementVNode("label",{for:`${I.selectedComponent.id}_${String(l)}`},e.toDisplayString(l)+":",9,Fs),e.createElementVNode("input",{id:`${I.selectedComponent.id}_${String(l)}`,value:a,type:I.getInputType(String(l)),class:"zero-code-field-input",readonly:String(l)==="id",onInput:p=>{const E=p.target;y(String(l),E.value)}},null,40,xs)])):e.createCommentVNode("",!0)],64))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(I.selectedComponent,(a,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:String(l)},[I.shouldShowArrayField(String(l),a,I.selectedComponent)?(e.openBlock(),e.createBlock(ds,{key:0,"component-id":I.selectedComponent.id,"array-key":String(l),items:Array.isArray(a)?a:[],fields:z(String(l)),label:T(String(l)),"item-label":B(String(l)),onAdd:()=>A(I.selectedComponent,String(l)),onRemove:p=>w(I.selectedComponent,String(l),p),onReorder:(p,E)=>N(String(l),p,E),onUpdate:(p,E,P)=>_(String(l),p,E,P)},null,8,["component-id","array-key","items","fields","label","item-label","onAdd","onRemove","onReorder","onUpdate"])):e.createCommentVNode("",!0)],64))),128))])])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)],8,["to"]))}}),Os={class:"zero-code-tab-content"},Rs=e.defineComponent({__name:"EditorMainPanel",props:{dataTab:{type:String},editablePageData:{type:Array},localParts:{type:Array},localCommonParts:{type:Array},localIndividualParts:{type:Array},parts:{type:Array},commonImages:{type:Array},individualImages:{type:Array},showPartSelector:{type:Boolean},showNestedPartSelector:{type:Boolean},showEditor:{type:Boolean},selectedComponent:{type:[Object,null]},renderComponentWithNested:{type:Function},getFieldInfo:{type:Function},shouldShowBasicField:{type:Function},shouldShowArrayField:{type:Function},shouldShowArrayItemField:{type:Function},getInputType:{type:Function},isCheckboxChecked:{type:Function},partsData:{type:Array},isTextEditing:{type:Boolean}},emits:["update:data-tab","add-part","edit-part","delete-part","reorder-parts","close-part-selector","select-part","close-nested-part-selector","select-nested-part","close-editor","update-editor-value","add-array-item","remove-array-item","update-array-item","update-checkbox"],setup(t,{emit:r}){const o=t,n=Math.random().toString(36).substr(2,9);return e.onMounted(async()=>{await e.nextTick();const s=`.modal-container-${n}`;document.querySelector(s)}),e.watch(()=>o.editablePageData,s=>{},{deep:!0}),(s,f)=>(e.openBlock(),e.createElementBlock("div",Os,[e.createVNode(ma,{"model-value":s.dataTab,"page-data":s.editablePageData,parts:s.localParts&&s.localParts.length>0?s.localParts:s.parts||[],"common-parts":s.localCommonParts,"individual-parts":s.localIndividualParts,"common-images":s.commonImages,"individual-images":s.individualImages,"render-component-with-nested":s.renderComponentWithNested,"is-text-editing":s.isTextEditing,"onUpdate:modelValue":f[0]||(f[0]=y=>s.$emit("update:data-tab",y)),onAddPart:f[1]||(f[1]=y=>s.$emit("add-part",y)),onEditPart:f[2]||(f[2]=y=>s.$emit("edit-part",y)),onDeletePart:f[3]||(f[3]=y=>s.$emit("delete-part",y)),onReorderParts:f[4]||(f[4]=y=>s.$emit("reorder-parts",y))},null,8,["model-value","page-data","parts","common-parts","individual-parts","common-images","individual-images","render-component-with-nested","is-text-editing"]),s.showPartSelector?(e.openBlock(),e.createBlock(zr,{key:0,parts:s.localParts&&s.localParts.length>0?s.localParts:s.parts||[],"modal-container":`.modal-container-${e.unref(n)}`,onClose:f[5]||(f[5]=y=>s.$emit("close-part-selector")),onSelectPart:f[6]||(f[6]=(y,h)=>s.$emit("select-part",y,h))},null,8,["parts","modal-container"])):e.createCommentVNode("",!0),s.showNestedPartSelector?(e.openBlock(),e.createBlock(zr,{key:1,parts:s.localParts&&s.localParts.length>0?s.localParts:s.parts||[],"is-nested":!0,"modal-container":`.modal-container-${e.unref(n)}`,onClose:f[7]||(f[7]=y=>s.$emit("close-nested-part-selector")),onSelectPart:f[8]||(f[8]=(y,h)=>s.$emit("select-nested-part",y,h))},null,8,["parts","modal-container"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(`modal-container-${e.unref(n)}`),style:{position:"relative","z-index":"9999"}},null,2),(e.openBlock(),e.createBlock(Ls,{key:2,"show-editor":s.showEditor,"selected-component":s.selectedComponent,"get-field-info":s.getFieldInfo,"should-show-basic-field":s.shouldShowBasicField,"should-show-array-field":s.shouldShowArrayField,"should-show-array-item-field":s.shouldShowArrayItemField,"get-input-type":s.getInputType,"is-checkbox-checked":s.isCheckboxChecked,"modal-container":`.modal-container-${e.unref(n)}`,onClose:f[9]||(f[9]=y=>s.$emit("close-editor")),"onUpdate:value":f[10]||(f[10]=(y,h)=>s.$emit("update-editor-value",y,h)),"onAdd:arrayItem":f[11]||(f[11]=y=>s.$emit("add-array-item",y)),"onRemove:arrayItem":f[12]||(f[12]=(y,h)=>s.$emit("remove-array-item",y,h)),"onUpdate:arrayItem":f[13]||(f[13]=y=>s.$emit("update-array-item",y)),"onUpdate:checkbox":f[14]||(f[14]=y=>s.$emit("update-checkbox",y))},null,8,["show-editor","selected-component","get-field-info","should-show-basic-field","should-show-array-field","should-show-array-item-field","get-input-type","is-checkbox-checked","modal-container"]))]))}}),Hs={class:"zero-code-data-display"},Zs={class:"zero-code-data-tabs"},js={class:"zero-code-form-group"},Us={class:"zero-code-form-group"},Ws=["value"],qs={class:"zero-code-data-content"},Ks={key:0,class:"zero-code-rendered-content"},Xs={class:"zero-code-component-header"},Ys={class:"zero-code-component-info-header"},Js={class:"zero-code-component-type"},Gs={class:"zero-code-component-id"},Qs={class:"zero-code-rendered-component"},el={class:"zero-code-component-header"},tl={class:"zero-code-component-info-header"},ol={class:"zero-code-component-module"},rl={class:"zero-code-header-actions"},nl=["onClick"],al=["onClick"],sl=["innerHTML"],ll={key:1,class:"zero-code-no-parts"},Ar=e.defineComponent({__name:"PartsManager",props:{parts:{type:Array},renderPartPreview:{type:Function}},emits:["edit-part","delete-part","search","filter"],setup(t,{emit:r}){const o=t,n=r,s=e.ref(""),f=e.ref(""),y=e.computed(()=>Array.from(new Set(o.parts.map(A=>A.type)))),h=e.computed(()=>{let A=[...o.parts];if(f.value&&(A=A.filter(w=>w.type===f.value)),s.value){const w=s.value.toLowerCase();A=A.map(N=>({...N,module:N.module.filter(z=>z.title.toLowerCase().includes(w)||z.body.toLowerCase().includes(w))})).filter(N=>N.module.length>0)}return A}),_=()=>{n("search",s.value)},C=()=>{n("filter",f.value)};return(A,w)=>(e.openBlock(),e.createElementBlock("div",Hs,[w[4]||(w[4]=e.createElementVNode("div",{class:"zero-code-component-header"},[e.createElementVNode("h4",null,"パーツ管理")],-1)),e.createElementVNode("div",Zs,[e.createElementVNode("div",js,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":w[0]||(w[0]=N=>s.value=N),placeholder:"パーツ名で検索...",class:"zero-code-form-input",onInput:_},null,544),[[e.vModelText,s.value]])]),e.createElementVNode("div",Us,[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":w[1]||(w[1]=N=>f.value=N),class:"zero-code-form-select",onChange:C},[w[2]||(w[2]=e.createElementVNode("option",{value:""},"すべてのType",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,N=>(e.openBlock(),e.createElementBlock("option",{key:N,value:N},e.toDisplayString(N),9,Ws))),128))],544),[[e.vModelSelect,f.value]])])]),e.createElementVNode("div",qs,[Array.isArray(h.value)&&h.value.length>0?(e.openBlock(),e.createElementBlock("div",Ks,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,(N,z)=>(e.openBlock(),e.createElementBlock("div",{key:z,class:"zero-code-data-section"},[e.createElementVNode("div",Xs,[e.createElementVNode("div",Ys,[e.createElementVNode("span",Js,e.toDisplayString(N.type),1)]),e.createElementVNode("span",Gs,e.toDisplayString(N.module.length)+"個のパーツ",1)]),e.createElementVNode("div",Qs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.module,(T,B)=>(e.openBlock(),e.createElementBlock("div",{key:B,class:"zero-code-draggable-item"},[e.createElementVNode("div",el,[e.createElementVNode("div",tl,[e.createElementVNode("span",ol,e.toDisplayString(T.title),1)]),e.createElementVNode("div",rl,[e.createElementVNode("button",{class:"zero-code-edit-btn",onClick:I=>A.$emit("edit-part",{type:N.type,module:T})}," 編集 ",8,nl),e.createElementVNode("button",{class:"zero-code-delete-btn",onClick:I=>A.$emit("delete-part",{type:N.type,title:T.title})}," 削除 ",8,al)])]),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:o.renderPartPreview(T.body)},null,8,sl)]))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",ll,w[3]||(w[3]=[e.createElementVNode("p",null,"登録されたパーツがありません。",-1)])))])]))}}),il={class:"zero-code-modal-header"},dl={class:"zero-code-modal-title"},cl={class:"zero-code-title-main"},pl={class:"zero-code-modal-subtitle"},ml={class:"zero-code-modal-body"},ul={class:"zero-code-form-layout"},gl={class:"zero-code-form-section"},fl={key:0,class:"zero-code-form-group"},hl={class:"zero-code-type-input-group"},yl=["value"],bl={key:1,class:"zero-code-form-group"},_l={class:"zero-code-form-group"},$l={class:"zero-code-body-editor-container"},El={class:"zero-code-preview-section"},wl={class:"zero-code-preview-container"},zl=["innerHTML"],vl={class:"zero-code-modal-footer"},Cl={class:"zero-code-modal-actions"},Al=["disabled"],Nl=e.defineComponent({__name:"PartRegistrationModal",props:{isEditing:{type:Boolean,default:!1},existingTypes:{type:Array},partCategory:{default:"common",type:String},editingPart:{default:null,type:[Object,null]},initialData:{default:()=>({type:"",title:"",body:""}),type:Object},renderPartPreview:{type:Function}},emits:["close","save"],setup(t,{emit:r}){const o=t,n=r,s=()=>o.isEditing&&o.editingPart?{type:o.editingPart.type,title:o.editingPart.module.title,body:o.editingPart.module.body}:{type:o.initialData.type,title:o.initialData.title,body:o.initialData.body},f=e.ref(s()),y=e.computed(()=>(o.isEditing||f.value.type.trim()!==""&&f.value.title.trim()!=="")&&f.value.body.trim()!==""),h=()=>{},_=()=>{y.value&&n("save",{type:f.value.type,title:f.value.title,body:f.value.body,category:o.partCategory||"common"})};return(C,A)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:A[7]||(A[7]=w=>C.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-part-modal",onClick:A[6]||(A[6]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",il,[e.createElementVNode("div",dl,[e.createElementVNode("div",cl,[e.createElementVNode("h3",null,e.toDisplayString(C.isEditing?"パーツ編集":"新規パーツ登録"),1),e.createElementVNode("span",{class:e.normalizeClass(["zero-code-badge",C.partCategory])},e.toDisplayString(C.partCategory==="common"?"共通パーツ":"個別パーツ"),3)]),e.createElementVNode("p",pl,e.toDisplayString(C.isEditing?"パーツの内容を編集できます":"新しいパーツを作成します"),1)]),e.createElementVNode("button",{class:"zero-code-modal-close-btn",onClick:A[0]||(A[0]=w=>C.$emit("close"))},A[8]||(A[8]=[e.createElementVNode("span",null,"✖️",-1)]))]),e.createElementVNode("div",ml,[e.createElementVNode("div",ul,[e.createElementVNode("div",gl,[C.isEditing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",fl,[A[10]||(A[10]=e.createElementVNode("label",{for:"part-type",class:"zero-code-form-label"},"Type",-1)),e.createElementVNode("div",hl,[e.withDirectives(e.createElementVNode("select",{id:"part-type","onUpdate:modelValue":A[1]||(A[1]=w=>f.value.type=w),class:"zero-code-form-select"},[A[9]||(A[9]=e.createElementVNode("option",{value:""},"新しいTypeを選択",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.existingTypes,w=>(e.openBlock(),e.createElementBlock("option",{key:w,value:w},e.toDisplayString(w),9,yl))),128))],512),[[e.vModelSelect,f.value.type]]),!f.value.type||!C.existingTypes.includes(f.value.type)?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":A[2]||(A[2]=w=>f.value.type=w),placeholder:"新しいType名を入力",class:"zero-code-form-input"},null,512)),[[e.vModelText,f.value.type]]):e.createCommentVNode("",!0)])])),C.isEditing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",bl,[A[11]||(A[11]=e.createElementVNode("label",{for:"part-title",class:"zero-code-form-label"},"Title",-1)),e.withDirectives(e.createElementVNode("input",{id:"part-title","onUpdate:modelValue":A[3]||(A[3]=w=>f.value.title=w),placeholder:"パーツのタイトルを入力",class:"zero-code-form-input"},null,512),[[e.vModelText,f.value.title]])])),e.createElementVNode("div",_l,[A[12]||(A[12]=e.createElementVNode("label",{for:"part-body",class:"zero-code-form-label"},"HTML Template",-1)),e.createElementVNode("div",$l,[e.withDirectives(e.createElementVNode("textarea",{id:"part-body","onUpdate:modelValue":A[4]||(A[4]=w=>f.value.body=w),class:"zero-code-body-editor",placeholder:"HTMLソースを直接編集してください...",onInput:h},null,544),[[e.vModelText,f.value.body]])])])]),e.createElementVNode("div",El,[A[13]||(A[13]=e.createElementVNode("div",{class:"zero-code-preview-header"},[e.createElementVNode("h4",null,"プレビュー"),e.createElementVNode("span",{class:"zero-code-preview-info"},"リアルタイムで表示を確認")],-1)),e.createElementVNode("div",wl,[e.createElementVNode("div",{class:"zero-code-preview-content",innerHTML:C.renderPartPreview(f.value.body)},null,8,zl)])])])]),e.createElementVNode("div",vl,[e.createElementVNode("div",Cl,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:A[5]||(A[5]=w=>C.$emit("close"))}," キャンセル "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",disabled:!y.value,onClick:_},e.toDisplayString(C.isEditing?"更新":"登録"),9,Al)])])])]))}}),kl={class:"zero-code-tab-content"},Pl={class:"zero-code-data-tabs"},Sl={class:"zero-code-tab-buttons"},Il=["onClick"],Dl={class:"zero-code-parts-content"},Tl={key:0,class:"zero-code-parts-section"},Vl={class:"zero-code-section-header"},Bl={key:1,class:"zero-code-parts-section"},Ml={class:"zero-code-section-header"},Fl={key:2,class:"zero-code-parts-section"},xl={class:"zero-code-data-display-section"},Ll={class:"zero-code-parts-sub-tabs"},Ol={class:"zero-code-parts-sub-content"},Rl={key:0,class:"zero-code-parts-sub-section"},Hl={key:0},Zl={class:"zero-code-data-display-pre"},jl={key:1},Ul={key:1,class:"zero-code-parts-sub-section"},Wl={key:0},ql={class:"zero-code-data-display-pre"},Kl={key:1},Xl=e.defineComponent({__name:"PartsManagementPanel",props:{localParts:{type:Array},localCommonParts:{type:Array},localIndividualParts:{type:Array},showPartRegistration:{type:Boolean},existingPartTypes:{type:Array},editingPart:{type:null},renderPartPreview:{type:Function}},emits:["update-parts","edit-part","delete-part","show-registration","close-registration","save-part"],setup(t,{emit:r}){const o=t,n=r,s=e.ref("common"),f=e.ref("common"),y=e.ref("common"),h=["common","individual","data"],_=d=>({common:"共通パーツ",individual:"個別パーツ",data:"データ表示"})[d],C=e.computed(()=>o.localCommonParts&&o.localCommonParts.length>0?o.localCommonParts:o.localParts.map(d=>({...d,module:d.module.filter(a=>{const l=a;return!l.category||l.category==="common"})})).filter(d=>d.module.length>0)),A=e.computed(()=>o.localIndividualParts&&o.localIndividualParts.length>0?o.localIndividualParts:o.localParts.map(d=>({...d,module:d.module.filter(a=>a.category==="individual")})).filter(d=>d.module.length>0)),w=d=>{f.value=d,n("show-registration")},N=()=>{n("close-registration")},z=d=>{const a=d.module;f.value=a.category||"common",n("edit-part",d)},T=d=>{n("delete-part",d)},B=d=>{const a={...d,category:f.value};n("save-part",a)},I=d=>{const a=(l,p=0)=>{const E="  ".repeat(p),P="  ".repeat(p+1);if(Array.isArray(l))return l.length===0?"[]":`[
${l.map(i=>P+a(i,p+1)).join(`,
`)}
${E}]`;if(typeof l=="object"&&l!==null){const $=Object.entries(l);return $.length===0?"{}":`{
${$.map(([m,g])=>{let b;if(typeof g=="string"){const u=g.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if(u.includes(`
`)){const v=u.split(`
`);b=v.map((k,S)=>S===0?`\`${k}`:S===v.length-1?`${P}${k}\``:`${P}${k}`).join(`
`)}else b=`"${u}"`}else b=a(g,p+1);return`${P}"${m}": ${b}`}).join(`,
`)}
${E}}`}return typeof l=="string"?`"${l.replace(/"/g,'\\"')}"`:JSON.stringify(l)};return a(d)};return(d,a)=>(e.openBlock(),e.createElementBlock("div",kl,[e.createElementVNode("div",Pl,[e.createElementVNode("div",Sl,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(h,l=>e.createElementVNode("button",{key:l,class:e.normalizeClass(["zero-code-data-tab-button",{active:s.value===l}]),onClick:p=>s.value=l},e.toDisplayString(_(l)),11,Il)),64))])]),e.createElementVNode("div",Dl,[s.value==="common"?(e.openBlock(),e.createElementBlock("div",Tl,[e.createElementVNode("div",Vl,[e.createElementVNode("h4",null,"共通パーツ ("+e.toDisplayString(C.value.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-add-part-btn",onClick:a[0]||(a[0]=l=>w("common"))}," ＋ 共通パーツ登録 ")]),e.createVNode(Ar,{parts:C.value,"render-part-preview":d.renderPartPreview,onEditPart:z,onDeletePart:T},null,8,["parts","render-part-preview"])])):e.createCommentVNode("",!0),s.value==="individual"?(e.openBlock(),e.createElementBlock("div",Bl,[e.createElementVNode("div",Ml,[e.createElementVNode("h4",null,"個別パーツ ("+e.toDisplayString(A.value.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-add-part-btn",onClick:a[1]||(a[1]=l=>w("individual"))}," ＋ 個別パーツ登録 ")]),e.createVNode(Ar,{parts:A.value,"render-part-preview":d.renderPartPreview,onEditPart:z,onDeletePart:T},null,8,["parts","render-part-preview"])])):e.createCommentVNode("",!0),s.value==="data"?(e.openBlock(),e.createElementBlock("div",Fl,[e.createElementVNode("div",xl,[e.createElementVNode("div",Ll,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:y.value==="common"}]),onClick:a[2]||(a[2]=l=>y.value="common")}," 共通Partsデータ ",2),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:y.value==="individual"}]),onClick:a[3]||(a[3]=l=>y.value="individual")}," 個別Partsデータ ",2)]),e.createElementVNode("div",Ol,[y.value==="common"?(e.openBlock(),e.createElementBlock("div",Rl,[C.value&&C.value.length>0?(e.openBlock(),e.createElementBlock("div",Hl,[e.createElementVNode("pre",Zl,e.toDisplayString(I(C.value)),1)])):(e.openBlock(),e.createElementBlock("div",jl,a[4]||(a[4]=[e.createElementVNode("p",null,"共通パーツデータがありません",-1)])))])):e.createCommentVNode("",!0),y.value==="individual"?(e.openBlock(),e.createElementBlock("div",Ul,[A.value&&A.value.length>0?(e.openBlock(),e.createElementBlock("div",Wl,[e.createElementVNode("pre",ql,e.toDisplayString(I(A.value)),1)])):(e.openBlock(),e.createElementBlock("div",Kl,a[5]||(a[5]=[e.createElementVNode("p",null,"個別パーツデータがありません",-1)])))])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)]),d.showPartRegistration?(e.openBlock(),e.createBlock(Nl,{key:0,"existing-types":d.existingPartTypes,"render-part-preview":d.renderPartPreview,"editing-part":d.editingPart,"is-editing":!!d.editingPart,"part-category":f.value,onClose:N,onSave:B},null,8,["existing-types","render-part-preview","editing-part","is-editing","part-category"])):e.createCommentVNode("",!0)]))}});function Q(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}let Ft,Xe;function Yl(t,r){Ft=t,Xe=r}function Po(t,r){t.querySelectorAll("[z-if]").forEach(n=>{const s=n.getAttribute("z-if");s&&(r[s]?n.removeAttribute("z-if"):n.remove())})}function Jl(t,r){const o=t.querySelectorAll("[z-for-wrapper]");o.length>0&&o.forEach(n=>{const s=n.getAttribute("z-for-wrapper");if(s){const f=r[s];!Array.isArray(f)||f.length,n.removeAttribute("z-for-wrapper")}})}function Nr(t,r){return`
    <div class="zero-code-add-array-item-button-container">
      <button class="zero-code-add-array-item-button" onclick="window.addArrayItem('${Q(t)}', '${Q(r)}')">
        <span class="zero-code-plus-icon">＋</span>
        <span class="zero-code-button-text">${r}を追加</span>
      </button>
    </div>
  `}function Gl(t,r,o){return`
    <div class="zero-code-z-for-controls" data-component-id="${t}" data-array-name="${r}" data-index="${o}">
      <div class="zero-code-z-for-controls-inner">
        <button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${Q(t)}', '${Q(r)}', ${o})" title="上に追加">
          <span class="zero-code-control-icon">＋</span>
        </button>
        <span class="zero-code-z-for-drag-handle"
              draggable="true"
              onDragStart="window.handleZForDragStart(event, '${Q(t)}', '${Q(r)}', ${o})"
              style="cursor: grab;"
              title="ドラッグして並び替え">⠿</span>
        <button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${Q(t)}', '${Q(r)}', ${o})" title="編集">
          <span class="zero-code-control-icon">✎</span>
        </button>
        <button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${Q(t)}', '${Q(r)}', ${o})" title="削除">
          <span class="zero-code-control-icon">✕</span>
        </button>
      </div>
    </div>
  `}function kr(t,r,o,n,s){const f=t.querySelectorAll("[z-for]");f.length>0&&(f.forEach(h=>{const _=h.getAttribute("z-for");if(_){const C=r[_];if(Array.isArray(C)&&C.length>0){const A=s(r.type,r.module_name),w=new RegExp(`<(\\w+)[^>]*z-for="${_}"[^>]*>`),N=A.match(w),z=N?A.indexOf(N[0]):-1;if(z!==-1&&N){const T=N[1];let B=0,I=z;for(let l=z;l<A.length;l++)if(A.substring(l,l+T.length+1)===`<${T}`)B++;else if(A.substring(l,l+T.length+3)===`</${T}>`&&(B--,B===0)){I=l+T.length+3;break}const d=A.substring(z,I),a=[d];if(a&&a[0]){let l="";const p=d.match(new RegExp(`<${T}([^>]*z-for="[^"]*"[^>]*)>`));let E="";p&&p[1]&&(E=p[1].replace(/\s*z-for="[^"]*"\s*/,"").trim());const P=d.indexOf(">")+1,$=d.lastIndexOf(`</${T}>`),i=d.substring(P,$).trim();if(i){const m=i;C.forEach((u,v)=>{let D=m;const k=`<div class="zero-code-z-for-controls" data-component-id="${Q(r.id)}" data-array-name="${Q(_)}" data-index="${v}">
<div class="zero-code-z-for-controls-inner">
<button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(_)}', ${v})" title="上に追加">
<span class="zero-code-control-icon">＋</span>
</button>
<span class="zero-code-z-for-drag-handle" draggable="true" onDragStart="window.handleZForDragStart(event, '${Q(r.id)}', '${Q(_)}', ${v})" title="ドラッグして並び替え">⠿</span>
<button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${Q(r.id)}', '${Q(_)}', ${v})" title="編集">
<span class="zero-code-control-icon">✎</span>
</button>
<button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${Q(r.id)}', '${Q(_)}', ${v})" title="削除">
<span class="zero-code-control-icon">✕</span>
</button>
</div>
</div>`;if(Ft&&(D=Ft(D,u,r,A,_)),Xe&&(D=Xe(D,u)),D.includes("z-if")||D.includes("z-slot")||D.includes("z-for")){const de=new DOMParser().parseFromString(`<div>${D}</div>`,"text/html"),pe=`${r.id}_${_}_${v}`;let Ce=r;if(typeof window<"u"&&window.getLatestComponentData){const Pe=window.getLatestComponentData(r.id);Pe&&(Ce=Pe)}const De={...Ce,...u,type:Ce.type,module_name:Ce.module_name,id:pe};Po(de,De),de.querySelectorAll("[z-slot]").forEach(Pe=>{const Ae=Pe.getAttribute("z-slot");if(Ae&&De[Ae]){const Fe=De[Ae];if(Array.isArray(Fe)&&Fe.length>0){let _e='<div class="zero-code-z-for-nested-parts">';Fe.forEach((mt,bt)=>{const Bo=`${r.id}.${_}[${v}].${Ae}`;_e+=`
                            <div class="zero-code-add-nested-part-button-container">
                              <button class="zero-code-add-position-part-button" onclick="event.stopPropagation(); window.openNestedPartSelector('${Q(Bo)}', ${bt})">
                                <span class="zero-code-plus-icon">＋</span>
                                <span class="zero-code-button-text">上にパーツを追加</span>
                              </button>
                            </div>
                          `;const At=n(mt,s,o+2),at=`${r.id}.${_}[${v}].${Ae}[${bt}]`,io=o+2;_e+=`
                            <div class="zero-code-nested-component zero-code-nested-depth-${io} zero-code-z-for-nested-part" 
                                 draggable="true"
                                 data-component-id="${mt.id}" 
                                 data-path="${at}" 
                                 data-parent-path="${r.id}.${_}[${v}].${Ae}"
                                 data-index="${bt}"
                                 data-nested-path="${at}"
                                 data-slot-name="${Ae}"
                                 data-part-index="${bt}"
                                 ondragstart="window.handleNestedPartDragStart && window.handleNestedPartDragStart(event)"
                                 ondragend="window.handleNestedPartDragEnd && window.handleNestedPartDragEnd(event)"
                                 class="zero-code-nested-component"
                                 onmousedown="this.style.cursor = 'grabbing'"
                                 onmouseup="this.style.cursor = 'grab'">
                              <div class="zero-code-component-header zero-code-nested-header">
                                <!-- ドラッグハンドル（視覚的インジケーター） -->
                                <div class="zero-code-drag-handle-nested" title="ドラッグして並び替え">
                                  ⠿
                                </div>
                                <div class="zero-code-component-meta">
                                  <span class="zero-code-component-type">${mt.type}</span>
                                  <span class="zero-code-component-module">${mt.module_name}</span>
                                </div>
                                <div class="zero-code-header-actions">
                                  <button 
                                    class="zero-code-collapse-btn"
                                    onclick="window.toggleNestedCollapse('${Q(at)}')"
                                    title="折りたたみ切り替え"
                                    id="collapse-btn-${Q(at)}"
                                  >
                                    －
                                  </button>
                                  <button class="zero-code-edit-button" onclick="window.openNestedEditor('${Q(at)}')">編集</button>
                                  <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${Q(at)}')">削除</button>
                                </div>
                              </div>
                              <div class="zero-code-nested-component-content" 
                                   id="nested-content-${Q(at)}"
                                   ondragover="window.handleNestedPartDragOver && window.handleNestedPartDragOver(event)"
                                   ondrop="window.handleNestedPartDrop && window.handleNestedPartDrop(event)"
                                   data-slot-name="${Ae}" 
                                   data-part-index="${bt}" 
                                   data-parent-path="${r.id}.${_}[${v}].${Ae}">${At}</div>
                            </div>
                          `});const he=`${r.id}.${_}[${v}].${Ae}`;_e+=`
                          <div class="zero-code-add-nested-part-button-container">
                            <button class="zero-code-add-position-part-button" onclick="event.stopPropagation(); window.openNestedPartSelector('${Q(he)}', ${Fe.length})">
                              <span class="zero-code-plus-icon">＋</span>
                              <span class="zero-code-button-text">下にパーツを追加</span>
                            </button>
                          </div>
                        `,_e+="</div>";const xe=Pe.innerHTML,Ye=document.createElement("div");Ye.innerHTML=xe,Ye.querySelectorAll('[class*="zero-code-"]').forEach(mt=>mt.remove());const Ot=Ye.innerHTML.trim();Pe.innerHTML=Ot+_e}else{const _e=`${r.id}.${_}[${v}].${Ae}`,he=Pe.innerHTML,xe=document.createElement("div");xe.innerHTML=he,xe.querySelectorAll('[class*="zero-code-"]').forEach(Ot=>Ot.remove());const ye=xe.innerHTML.trim();Pe.innerHTML=ye+`
                          <div class="zero-code-z-for-empty-slot">
                            スロット "${Ae}" は空です
                            <div class="zero-code-add-nested-part-button-container">
                              <button class="zero-code-add-nested-part-button" onclick="event.stopPropagation(); window.openNestedPartSelector('${Q(_e)}', 0)">
                                <span class="zero-code-plus-icon">＋</span>
                                <span class="zero-code-button-text">パーツを追加</span>
                              </button>
                            </div>
                          </div>
                        `}Pe.removeAttribute("z-slot")}else if(Ae){const Fe=`${r.id}.${_}[${v}].${Ae}`,_e=Pe.innerHTML,he=document.createElement("div");he.innerHTML=_e,he.querySelectorAll('[class*="zero-code-"]').forEach(ye=>ye.remove());const Ye=he.innerHTML.trim();Pe.innerHTML=Ye+`
                        <div class="zero-code-z-for-empty-slot">
                          スロット "${Ae}" にデータがありません
                          <div class="zero-code-add-nested-part-button-container">
                            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(Fe)}', 0)">
                              <span class="zero-code-plus-icon">＋</span>
                              <span class="zero-code-button-text">パーツを追加</span>
                            </button>
                          </div>
                        </div>
                      `,Pe.removeAttribute("z-slot")}}),de.querySelectorAll("[z-for]").length>0&&kr(de,De,o+1,n,s),D=de.body.innerHTML.replace(/^<div>|<\/div>$/g,"")}let S=E;S.includes("($")&&Xe&&(S=Xe(S,u));let V="",F=S,X="";if(S){const de=S.match(/class="([^"]*)"/);de&&(V=de[1]);const pe=S.match(/style="([^"]*)"/);pe&&(X=pe[1]),F=S.replace(/\s*class="[^"]*"\s*/,"").replace(/\s*style="[^"]*"\s*/,"").trim()}const O=`${V?V+" ":""}zero-code-z-for-item-wrapper`,L=X?`${X}; cursor: grab;`:"cursor: grab;";let G=[`class="${O}"`,'draggable="true"',`data-component-id="${Q(r.id)}"`,`data-array-name="${Q(_)}"`,`data-item-index="${v}"`,`ondragstart="window.handleZForDragStart && window.handleZForDragStart(event, '${Q(r.id)}', '${Q(_)}', ${v})"`,'ondragend="window.handleZForDragEnd && window.handleZForDragEnd(event)"','ondragover="window.handleZForArrayItemDragOver && window.handleZForArrayItemDragOver(event)"','ondrop="window.handleZForArrayItemDrop && window.handleZForArrayItemDrop(event)"',`style="${L}"`,`onmousedown="this.style.cursor = 'grabbing'"`,`onmouseup="this.style.cursor = 'grab'"`].join(" ");F&&(G+=` ${F}`);const ne=`<div ${G}>
${k}
${D}
</div>`;l+=ne});const g=`<div class="zero-code-z-for-add-last-button">
<button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(_)}', ${C.length})" title="最後に追加">
<span class="zero-code-control-icon">＋</span>
</button>
</div>`;l+=g;const b=h.parentNode;if(b){const u=document.createElement("div");u.innerHTML=l;const v=document.createDocumentFragment();for(;u.firstChild;)v.appendChild(u.firstChild);b.replaceChild(v,h)}else h.outerHTML=l}}}}else{const A=`<div class="zero-code-z-for-empty-array">
<div class="zero-code-z-for-empty-message">
<p class="zero-code-empty-text">${_}はまだ追加されていません</p>
<button class="zero-code-z-for-btn zero-code-z-for-add-first-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(_)}', 0)" title="最初の要素を追加">
<span class="zero-code-control-icon">＋</span>
<span class="zero-code-button-text">最初の${_}を追加</span>
</button>
</div>
</div>`;h.innerHTML=A,h.removeAttribute("z-for")}}}),t.querySelectorAll("[z-for-wrapper]").forEach(h=>{h.removeAttribute("z-for-wrapper")}))}function Ql(t,r,o){let n=t;const s=/<(\w+)([^>]*z-for="([^"]*)"[^>]*)\s*\/>/g;let f;for(;(f=s.exec(t))!==null;){const[_,C,A,w]=f,N=r[w];if(Array.isArray(N)&&N.length>0){let z="";N.forEach((B,I)=>{let d=A.replace(/\s*z-for="[^"]*"\s*/,"").trim();d.includes("($")&&Xe&&(d=Xe(d,B)),Object.keys(B).forEach(l=>{if(l!=="id"){const p=B[l];if(typeof p=="string"){const E=new RegExp(`\\{\\$${l}:[^}]*\\}`,"g");d=d.replace(E,p)}}});const a=`
          <div class="zero-code-z-for-item-wrapper" 
               data-component-id="${r.id}"
               data-array-name="${w}"
               data-item-index="${I}">
            ${Gl(r.id,w,I)}
            <${C}${d?" "+d:""} />
          </div>
        `;z+=a});const T=`
        <div class="zero-code-z-for-add-last-button">
          <button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${r.id}', '${w}', ${N.length})" title="最後に追加">
            <span class="zero-code-control-icon">＋</span>
          </button>
        </div>
      `;z+=T,n=n.replace(_,z)}else n=n.replace(_,Nr(r.id,w))}const y=/<(\w+)([^>]*z-for="([^"]*)"[^>]*)>([\s\S]*?)<\/\1>/g;let h;for(;(h=y.exec(t))!==null;){const[_,C,A,w,N]=h,z=r[w];if(Array.isArray(z)&&z.length>0,Array.isArray(z)&&z.length>0){let T="";z.forEach((I,d)=>{let a=N;if(`${Q(r.id)}${Q(w)}${d}`,Ft&&(a=Ft(a,I,r,t,w)),Xe&&(a=Xe(a,I)),a.includes("z-if")||a.includes("z-slot")||a.includes("z-for")){const u=new DOMParser().parseFromString(`<div>${a}</div>`,"text/html"),v=`${r.id}_${w}_0`;let D=r;if(typeof window<"u"&&window.getLatestComponentData){const V=window.getLatestComponentData(r.id);V&&(D=V)}const k={...I,type:D.type,module_name:D.module_name,id:v};Po(u,k),u.querySelectorAll("[z-slot]").forEach(V=>{const F=V.getAttribute("z-slot");if(F&&k[F]){const X=k[F];if(Array.isArray(X)&&X.length>0){let O='<div class="zero-code-z-for-nested-parts">';X.forEach((pe,Ce)=>{const De=`${r.id}.${w}[0].${F}`;O+=`
                    <div class="zero-code-add-nested-part-button-container">
                      <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${Q(De)}', ${Ce})">
                        <span class="zero-code-plus-icon">＋</span>
                        <span class="zero-code-button-text">上にパーツを追加</span>
                      </button>
                    </div>
                  `;let ke=pe.content||pe.title||pe.name||"(内容なし)";const pt=`${r.id}.${w}[0].${F}[${Ce}]`;O+=`
                    <div class="zero-code-z-for-nested-part">
                      <div class="zero-code-z-for-part-header">
                        <small>${pe.type||"unknown"} (ID: ${pe.id}) [z-for内]</small>
                        <div class="zero-code-z-for-part-actions">
                          <button class="zero-code-edit-button" onclick="window.openNestedEditor('${Q(pt)}')">編集</button>
                          <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${Q(pt)}')">削除</button>
                        </div>
                      </div>
                      <div>${ke}</div>
                    </div>
                  `});const L=`${r.id}.${w}[0].${F}`;O+=`
                  <div class="zero-code-add-nested-part-button-container">
                    <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(L)}', ${X.length})">
                      <span class="zero-code-plus-icon">＋</span>
                      <span class="zero-code-button-text">ネストパーツを追加</span>
                    </button>
                  </div>
                `,O+="</div>";const U=V.innerHTML,G=document.createElement("div");G.innerHTML=U,G.querySelectorAll('[class*="zero-code-"]').forEach(pe=>pe.remove());const de=G.innerHTML.trim();V.innerHTML=de+O}else{const O=V.innerHTML,L=document.createElement("div");L.innerHTML=O,L.querySelectorAll('[class*="zero-code-"]').forEach(ne=>ne.remove());const G=L.innerHTML.trim();V.innerHTML=G+`
                  <div class="zero-code-z-for-empty-slot">
                    スロット "${F}" は空です
                    <div class="zero-code-add-nested-part-button-container">
                      <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(r.id)}', 0)">
                        <span class="zero-code-plus-icon">＋</span>
                        <span class="zero-code-button-text">ネストパーツを追加</span>
                      </button>
                    </div>
                  </div>
                `}V.removeAttribute("z-slot")}else if(F){const X=V.innerHTML,O=document.createElement("div");O.innerHTML=X,O.querySelectorAll('[class*="zero-code-"]').forEach(G=>G.remove());const U=O.innerHTML.trim();V.innerHTML=U+`
                <div class="zero-code-z-for-empty-slot">
                  スロット "${F}" にデータがありません
                  <div class="zero-code-add-nested-part-button-container">
                    <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(r.id)}', 0)">
                      <span class="zero-code-plus-icon">＋</span>
                      <span class="zero-code-button-text">ネストパーツを追加</span>
                    </button>
                  </div>
                </div>
              `,V.removeAttribute("z-slot")}}),a=u.body.innerHTML.replace(/^<div>|<\/div>$/g,"")}let l=A.replace(/\s*z-for="[^"]*"\s*/,"").trim();l.includes("($")&&Xe&&(l=Xe(l,I));let p="",E="",P=l;if(l){const u=l.match(/class="([^"]*)"/);u&&(p=u[1]);const v=l.match(/style="([^"]*)"/);v&&(E=v[1]),P=l.replace(/\s*class="[^"]*"\s*/,"").replace(/\s*style="[^"]*"\s*/,"").trim()}const $=`${p?p+" ":""}zero-code-z-for-item-wrapper`,i=E?`${E}; cursor: grab;`:"cursor: grab;",m=`
          <div class="zero-code-z-for-controls" data-component-id="${r.id}" data-array-name="${w}" data-index="${d}">
            <div class="zero-code-z-for-controls-inner">
              <button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(w)}', ${d})" title="上に追加">
                <span class="zero-code-control-icon">＋</span>
              </button>
              <span class="zero-code-z-for-drag-handle"
                    draggable="true"
                    onDragStart="window.handleZForDragStart(event, '${Q(r.id)}', '${Q(w)}', ${d})"
                    style="cursor: grab;"
                    title="ドラッグして並び替え">⠿</span>
              <button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${Q(r.id)}', '${Q(w)}', ${d})" title="編集">
                <span class="control-icon">✎</span>
              </button>
              <button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${Q(r.id)}', '${Q(w)}', ${d})" title="削除">
                <span class="control-icon">✕</span>
              </button>
            </div>
          </div>
        `;let g=`class="${$}" 
               draggable="true"
               data-component-id="${r.id}"
               data-array-name="${w}"
               data-item-index="${d}"
               ondragstart="window.handleZForDragStart && window.handleZForDragStart(event, '${r.id}', '${w}', ${d})"
               ondragend="window.handleZForDragEnd && window.handleZForDragEnd(event)"
               ondragover="window.handleZForArrayItemDragOver && window.handleZForArrayItemDragOver(event)"
               ondrop="window.handleZForArrayItemDrop && window.handleZForArrayItemDrop(event)"
               style="${i}"
               onmousedown="this.style.cursor = 'grabbing'"
               onmouseup="this.style.cursor = 'grab'"`;P&&(g+=` ${P}`);const b=`
          <div ${g}>
            ${m}
            ${a}
          </div>
        `;T+=b});const B=`
        <div class="zero-code-z-for-add-last-button">
          <button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${r.id}', '${w}', ${z.length})" title="最後に追加">
            <span class="zero-code-control-icon">＋</span>
          </button>
        </div>
      `;T+=B,n=n.replace(_,T)}else n=n.replace(_,Nr(r.id,w))}return n}function ei(t,r,o,n,s){t.querySelectorAll("[z-slot]").forEach(y=>{const h=y.getAttribute("z-slot");if(h){const _=r[h],C=Array.isArray(_)?_:[];if(C.length===0){const A=y.innerHTML,w=document.createElement("div");w.innerHTML=A,w.querySelectorAll('[class*="zero-code-"]').forEach(T=>T.remove());const z=w.innerHTML.trim();y.innerHTML=z+`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${r.id}', 0)">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">ネストパーツを追加</span>
            </button>
          </div>
        `}else{let A="";C.forEach((B,I)=>{const d=B.id,a=r.id,l=o+1;A+=`
            <div class="zero-code-add-nested-part-button-container">
              <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${Q(a)}', ${I})">
                <span class="zero-code-plus-icon">＋</span>
                <span class="zero-code-button-text">上にパーツを追加（${l}階層目）</span>
              </button>
            </div>
          `,A+=`
            <div class="nested-component nested-depth-${l} draggable-nested" 
                 draggable="true" 
                 data-component-id="${B.id}" 
                 data-path="${d}" 
                 data-parent-path="${a}"
                 data-index="${I}"
                 class="zero-code-nested-component">
              <div class="zero-code-component-header zero-code-nested-header">
                <!-- ドラッグハンドル -->
                <div class="zero-code-drag-handle-nested">
                  ⠿
                </div>
                <div class="zero-code-component-meta">
                  <span class="zero-code-component-type">${B.type}</span>
                  <span class="zero-code-component-module">${B.module_name}</span>
                </div>
                <div class="zero-code-header-actions">
                  <button 
                    class="zero-code-collapse-btn"
                    onclick="window.toggleNestedCollapse('${d}')"
                    title="折りたたみ切り替え"
                    id="collapse-btn-${d}"
                  >
                    －
                  </button>
                  <button class="zero-code-edit-button" onclick="window.openNestedEditor('${d}')">編集</button>
                  <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${d}')">削除</button>
                </div>
              </div>
              <div class="zero-code-nested-component-content" id="nested-content-${d}">
                ${n(B,s,l)}
              </div>
            </div>
          `}),A+=`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${Q(r.id)}', ${C.length})">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">下にパーツを追加（${o+1}階層目）</span>
            </button>
          </div>
        `;const w=y.innerHTML,N=document.createElement("div");N.innerHTML=w,N.querySelectorAll('[class*="zero-code-"]').forEach(B=>B.remove());const T=N.innerHTML.trim();y.innerHTML=T+A}y.removeAttribute("z-slot"),c.success(`z-slot属性を除去: ${h}`)}})}const ti=[/v-[a-zA-Z-]+(?::[a-zA-Z-\.]+)?="[^"]*"/g,/@[a-zA-Z-]+(?:\.[a-zA-Z-]+)*="[^"]*"/g,/:[a-zA-Z-]+(?:\.[a-zA-Z-]+)*="[^"]*"/g,/v-slot:[a-zA-Z-]+="[^"]*"/g,/#[a-zA-Z-]+="[^"]*"/g],oi=[/\{\{[^}]+\}\}/g,/v-text="[^"]*"/g,/v-html="[^"]*"/g];function ri(t){return et(()=>{const r=new Map,o=new Map;let n=t;return c.debug("Vue.jsディレクティブ保護開始",{htmlLength:t.length}),ti.forEach((s,f)=>{n=n.replace(s,y=>{const h=`__VUE_DIR_${f}_${r.size}__`;return r.set(h,y),c.debug(`ディレクティブ保護: ${y} → ${h}`),h})}),oi.forEach((s,f)=>{n=n.replace(s,y=>{const h=`__VUE_INT_${f}_${o.size}__`;return o.set(h,y),c.debug(`補間記法保護: ${y} → ${h}`),h})}),c.success("Vue.jsディレクティブ保護完了",{directiveCount:r.size,interpolationCount:o.size,resultLength:n.length}),{html:n,directives:r,interpolations:o}},tt,"Vue.jsディレクティブ保護中にエラーが発生しました",ue.TEMPLATE)||{html:t,directives:new Map,interpolations:new Map}}function Pr(t,r){return et(()=>{let o=t;return c.debug("Vue.jsディレクティブ復元開始",{directiveCount:r.directives.size,interpolationCount:r.interpolations.size}),r.directives.forEach((n,s)=>{o=o.replace(new RegExp(s,"g"),n),c.debug(`ディレクティブ復元: ${s} → ${n}`)}),r.interpolations.forEach((n,s)=>{o=o.replace(new RegExp(s,"g"),n),c.debug(`補間記法復元: ${s} → ${n}`)}),c.success("Vue.jsディレクティブ復元完了",{resultLength:o.length}),o},tt,"Vue.jsディレクティブ復元中にエラーが発生しました",ue.TEMPLATE)||t}function ni(t){return et(()=>{const r=ri(t),n=new DOMParser().parseFromString(r.html,"text/html");return c.debug("安全DOMパース完了",{originalLength:t.length,protectedLength:r.html.length,parsedElementCount:n.body.children.length}),{doc:n,preservation:r}},tt,"安全DOMパース中にエラーが発生しました",ue.TEMPLATE)||{doc:new DOMParser().parseFromString("<div></div>","text/html"),preservation:{html:t,directives:new Map,interpolations:new Map}}}function xt(t){return t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," "):""}function ao(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}function ai(t){if(!t)return t;let r=t.replace(/(<br\s*\/?>)+$/gi,"");return r=r.replace(/\s+$/,""),r}function si(t,r,o){return et(()=>{c.debug("統合テンプレート処理開始",{componentId:r.id,htmlLength:t.length});let n=t;return n=n.replace(/(\(\$[^:)]+\?:[^)]*\)|\(\$[^:)]+:[^)]*\)|\{\$[^:}]+:[^}]*\})/g,s=>s.includes("?:")?li(s,r):s.startsWith("(")&&s.includes(":")?ii(s,r):s.startsWith("{")&&s.includes(":")?di(s,r,o):s),c.success("統合テンプレート処理完了",{componentId:r.id,resultLength:n.length}),n},tt,`統合テンプレート処理中にエラーが発生しました (componentId: ${r.id})`,ue.TEMPLATE)||t}function li(t,r){const o=t.match(/\(\$([^:?]+)\?:([^)]*)\)/);if(!o)return t;const[,n,s]=o,f=s.split("|"),y=r[n];return Array.isArray(y)?y.join(" "):y&&f.includes(String(y))?String(y):f[0]||""}function ii(t,r){const o=t.match(/\(\$([^:]+):([^)]*)\)/);if(!o)return t;const[,n,s]=o,f=s.split("|"),y=r[n];return y&&f.includes(String(y))?String(y):f[0]||""}function di(t,r,o){const n=t.match(/\{\$([^:]+):([^}]*)\}/);if(!n)return t;const[,s,f]=n,y=r[s],h=xt(y?String(y):f);return ci(o,s)?`<div class="tiptap-content" data-component-id="${r.id}" data-param-name="${s}">${h}</div>`:h}function ci(t,r){const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`\\{\\$${o}:[^}]*\\}`,"g");let s;for(;(s=n.exec(t))!==null;){const f=s.index,y=t.substring(0,f),h=y.lastIndexOf("<"),_=y.lastIndexOf(">");if(h>_)continue;const C=[];if([/<(pre|code)[^>]*>[\s\S]*?<\/(pre|code)>/gi,/<div[^>]*class="[^"]*code-block[^"]*"[^>]*>[\s\S]*?<\/div>/gi].forEach(T=>{T.lastIndex=0;let B;for(;(B=T.exec(t))!==null;)C.push({start:B.index,end:B.index+B[0].length})}),!C.some(T=>f>=T.start&&f<=T.end))return!0}return!1}const so=new Map;function pi(t,r,o){const n=`${t}:${r}`;if(so.has(n))return so.get(n);const s=o(t,r);return so.set(n,s),s}function mi(){so.clear(),c.debug("テンプレートキャッシュをクリアしました")}const Sr=new DOMParser,yt=new Map,ui=50;function gi(t){return et(()=>{if(yt.has(t)){const o=yt.get(t);if(o)return c.debug("DOMParser: キャッシュからヒット"),o.cloneNode(!0)}const r=Sr.parseFromString(t,"text/html");if(yt.size>=ui){const o=yt.keys().next().value;o&&yt.delete(o)}return yt.set(t,r.cloneNode(!0)),c.debug("DOMParser: 新規パース＆キャッシュ保存"),r},tt,"HTML解析中にエラーが発生しました",ue.TEMPLATE)||Sr.parseFromString("<div></div>","text/html")}function fi(t,r,o,n=1){return et(()=>{c.debug("最適化z-directive処理開始",{componentId:r.id,currentDepth:n});let s=t;return s=hi(s,r),s=yi(s,r,o),s=bi(s,r,n,o),c.success("最適化z-directive処理完了",{componentId:r.id,resultLength:s.length}),s},tt,`z-directive処理中にエラーが発生しました (componentId: ${r.id})`,ue.TEMPLATE)||t}function hi(t,r){return t.replace(/<([^>]*z-if="([^"]*)"[^>]*)>([\\s\\S]*?)<\/[^>]*>/g,(o,n,s,f)=>{if(!r[s])return c.debug(`z-if要素を非表示: ${s}`),"";const h=n.replace(/\s*z-if="[^"]*"\s*/," ").trim();return c.debug(`z-if要素を表示: ${s}`),`<div ${h}>${f}</div>`})}function yi(t,r,o){return t.replace(/<(\w+)([^>]*z-for="([^"]*)"[^>]*)>([\s\S]*?)<\/\1>/g,(n,s,f,y,h)=>{const _=r[y];return c.debug(`z-for処理: ${y}`,{length:Array.isArray(_)?_.length:"not array"}),!Array.isArray(_)||_.length===0?`
          <div class="add-array-item-button-container">
            <button class="add-array-item-button" onclick="window.addArrayItem('${r.id}', '${y}')">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">${y}を追加</span>
            </button>
          </div>
        `:_.map(A=>{let w=h;return Object.keys(A).forEach(N=>{if(N!=="id"){const z=A[N];if(typeof z=="string")[new RegExp(`\\{\\$${N}:([^}]+)\\}`,"g"),new RegExp(`\\(\\$${N}:([^)]+)\\)`,"g")].forEach(B=>{w=w.replace(B,z)});else if(Array.isArray(z)){const T=new RegExp(`\\(\\$${N}\\?:([^)]+)\\)`,"g");w=w.replace(T,z.join(" "))}}}),w}).join("")})}function bi(t,r,o,n){const s=gi(t),f=s.querySelectorAll("[z-slot]");return c.debug(`z-slot要素発見: ${f.length}個`),f.forEach(y=>{const h=y.getAttribute("z-slot");if(h){const _=r[h],C=Array.isArray(_)?_:[];if(C.length===0){const A=y.innerHTML;y.innerHTML=A+`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${ao(r.id)}', 0)">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">ネストパーツを追加</span>
            </button>
          </div>
        `}else{const A=C.map((N,z)=>{const T=o+1,B=Math.max(0,T-1)*20;return`
            <div class="nested-component nested-depth-${T}" style="margin-left: ${B}px;">
              <div class="component-header">
                <span class="component-type">${N.type}</span>
                <span class="component-module">${N.module_name}</span>
                <button onclick="window.openNestedEditor('${N.id}')">編集</button>
                <button onclick="window.deleteNestedPart('${N.id}')">削除</button>
              </div>
            </div>
          `}).join(""),w=y.innerHTML;y.innerHTML=w+A}y.removeAttribute("z-slot")}}),s.body.innerHTML}function _i(){yt.clear(),c.debug("DOMキャッシュをクリアしました")}function So(){const t=e.ref(null);let r=!1;const o=($,i)=>{const m=`\\{\\$${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}:[^}]*\\}`,g=new RegExp(m,"g");let b;for(;(b=g.exec($))!==null;){const u=b.index,v=$.substring(0,u),D=v.lastIndexOf("<"),k=v.lastIndexOf(">");if(D>k)continue;const S=[];if([/<(pre|code)[^>]*>[\s\S]*?<\/(pre|code)>/gi,/<div[^>]*class="[^"]*code-block[^"]*"[^>]*>[\s\S]*?<\/div>/gi].forEach(L=>{L.lastIndex=0;let U;for(;(U=L.exec($))!==null;)S.push({start:U.index,end:U.index+U[0].length})}),!S.some(L=>u>=L.start&&u<=L.end))return!0}return!1},n=($,i,m)=>$.replace(/\{\$([^:]+):(.*?)\}/g,(g,b,u)=>{const v=String(i[b]||u),D=xt(v);return o(m,b)?b==="content"?`<div class="zero-code-rich-editable-text block-editable" data-component-id="${i.id}" data-param="${b}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${i.id}', '${b}', this.innerHTML, this);">${D}</div>`:`<span class="zero-code-rich-editable-text inline-editable" data-component-id="${i.id}" data-param="${b}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${i.id}', '${b}', this.innerHTML, this);">${D}</span>`:D}),s=($,i,m,g,b)=>$.replace(/\{\$([^:]+):(.*?)\}/g,(u,v,D)=>{const k=String(i[v]||D),S=xt(k);if(o(g,v)){const X=m[b].indexOf(i),O=`${m.id}_${b}_${X}_${v}`;return v==="content"?`<div class="zero-code-rich-editable-text array-item-text block-editable" data-component-id="${O}" data-param="${v}" data-array-name="${b}" data-item-index="${X}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${O}', '${v}', this.innerHTML, this);">${S}</div>`:`<span class="zero-code-rich-editable-text array-item-text inline-editable" data-component-id="${O}" data-param="${v}" data-array-name="${b}" data-item-index="${X}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${O}', '${v}', this.innerHTML, this);">${S}</span>`}return S}),f=($,i)=>{let m=$.replace(/\(\$([^:?]+)\?:(.*?)\)/g,(g,b,u)=>{const v=i[b];return Array.isArray(v)?v.join(" "):u.split("|").filter(k=>k.trim())[0]||""});return m=m.replace(/\(\$([^:?]+):(.*?)\)/g,(g,b,u)=>{if(i[b]){let k=i[b];return k==="指定無し"&&(k=""),Array.isArray(k)?k.join(" "):String(k)}const v=b;if(i[v]){let k=i[v];return k==="指定無し"&&(k=""),Array.isArray(k)?k.join(" "):String(k)}return u.split("|").filter(k=>k.trim())[0]||""}),m},y=($,i)=>$.replace(/\(\$([^:?]+):(.*?)\)/g,(m,g,b)=>{let u=i[g];return u==="指定無し"&&(u=""),Array.isArray(u)?u.join(" "):u?String(u):b.split("|").filter(D=>D.trim())[0]||""}),h=($,i)=>$.replace(/\(\$([^:?]+)\?:(.*?)\)/g,(m,g,b)=>{const u=i[g];return Array.isArray(u)?u.join(" "):String(u||"")}),_=($,i,m,g)=>{const b=m($.type,$.module_name);if(!b)return`<div>テンプレートが見つかりません: ${$.type}/${$.module_name}</div>`;let u=b;return u=y(u,$),u=h(u,$),u=n(u,$,b),u=N(u,$,m,i,1),u},C=($,i,m=0)=>{const g=i($.type,$.module_name);if(!g)return`<div>テンプレートが見つかりません: ${$.type}/${$.module_name}</div>`;let b=g;return b=y(b,$),b=h(b,$),b=n(b,$,g),b=N(b,$,i,m,1),b},A=($,i,m,g)=>{const b=i($.type,$.module_name);if(!b)return`<div>テンプレートが見つかりません: ${$.type}/${$.module_name}</div>`;let u=b;return u=y(u,$),u=h(u,$),u=n(u,$,b),u=N(u,$,i,0,m),u},w=($,i=[],m,g)=>{if(!$||$.length===0)return`
        <div class="zero-code-add-nested-part-button-container">
          <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${ao(m(i))}', 0)">
            <span class="zero-code-plus-icon">＋</span>
            <span class="zero-code-button-text">ネストパーツを追加（${i.length+1}階層目）</span>
          </button>
        </div>
      `;let b="";return $.forEach((u,v)=>{const D=[...i,v],k=m(D),S=D.length;b+=`
        <div class="zero-code-add-nested-part-button-container">
          <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${ao(m(i))}', ${v})">
            <span class="zero-code-plus-icon">＋</span>
            <span class="zero-code-button-text">上にパーツを追加（${i.length+1}階層目）</span>
          </button>
        </div>
      `,b+=`
        <div class="zero-code-nested-component zero-code-nested-depth-${S} zero-code-draggable-nested" 
             draggable="true" 
             data-component-id="${u.id}" 
             data-path="${k}" 
             data-parent-path="${m(i)}"
             data-index="${v}"
>
          <div class="zero-code-component-header zero-code-nested-header">
            <!-- ドラッグハンドル -->
            <div class="zero-code-drag-handle-nested">
              ⠿
            </div>
            <div class="zero-code-component-meta">
              <span class="zero-code-component-type">${u.type}</span>
              <span class="zero-code-component-module">${u.module_name}</span>
            </div>
            <div class="zero-code-header-actions">
              <button 
                class="zero-code-collapse-btn"
                onclick="window.toggleNestedCollapse('${k}')"
                title="折りたたみ切り替え"
                id="collapse-btn-${k}"
              >
                －
              </button>
              <button class="zero-code-edit-button" onclick="window.openNestedEditor('${k}')">編集</button>
              <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${k}')">削除</button>
            </div>
          </div>
          <div class="zero-code-nested-component-content" id="nested-content-${k}">
            ${g?C(u,g):`<div>テンプレートが見つかりません: ${u.type}/${u.module_name}</div>`}
          </div>
          <script>
            // 折りたたみ状態の初期化
            if (typeof window !== 'undefined' && window.isNestedCollapsed) {
              setTimeout(() => {
                const isCollapsed = window.isNestedCollapsed('${k}')
                const contentElement = document.getElementById('nested-content-${k}')
                const buttonElement = document.getElementById('collapse-btn-${k}')
                
                if (contentElement && buttonElement) {
                  if (isCollapsed) {
                    contentElement.style.display = 'none'
                    buttonElement.textContent = '＋'
                    buttonElement.setAttribute('title', '展開')
                  } else {
                    contentElement.style.display = 'block'
                    buttonElement.textContent = '－'
                    buttonElement.setAttribute('title', '折りたたみ')
                  }
                }
              }, 0)
            }
          <\/script>
        </div>
      `,u.nested_parts&&Array.isArray(u.nested_parts)&&u.nested_parts.length>0&&(b+=w(u.nested_parts,D,m,g))}),b+=`
      <div class="zero-code-add-nested-part-button-container">
        <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${ao(m(i))}', ${$.length})">
          <span class="zero-code-plus-icon">＋</span>
          <span class="zero-code-button-text">下にパーツを追加（${i.length+1}階層目）</span>
        </button>
      </div>
    `,b},N=($,i,m,g=0,b=1)=>et(()=>{r||(Yl(s,f),r=!0);const{doc:u,preservation:v}=ni($),D=(O,L,U)=>A(O,L,U);Po(u,i),Jl(u,i),kr(u,i,b,D,m);const k=v.html.match(/z-for="[^"]*"/g),S=u.querySelectorAll("[z-for]");if(!(k&&k.length>0&&S.length===0)){if(S.length>0){const O=Ql(v.html,i);if(O!==v.html)return Pr(O,v)}}ei(u,i,b,D,m),u.querySelectorAll("img").forEach(O=>{O.classList.add("zero-code-editable-image")});const F=u.body.innerHTML;return Pr(F,v)},tt,`Z-Directive処理中にエラーが発生しました (componentId: ${i.id})`,ue.TEMPLATE)||$,z=($,i)=>{const m=i($.type,$.module_name);return m?m.includes("@slot($nested_parts)@"):!1},T=($,i,m={})=>et(()=>{if(m&&m.isPreviewMode===!0){const u={maxRecursionDepth:m.maxRecursionDepth,isPreviewMode:!0};return B($,i,u)}const g=pi($.type,$.module_name,i);if(!g)return`<div>テンプレートが見つかりません: ${$.type}/${$.module_name}</div>`;let b=si(g,$,g);return b=fi(b,$,i,1),b},tt,`最適化レンダリング中にエラーが発生しました (componentId: ${$.id})`,ue.TEMPLATE)||`<div>レンダリングエラー: ${$.id}</div>`,B=($,i,m={})=>{let g=$;if(typeof window<"u"&&window.getLatestComponentData){const D=window.getLatestComponentData($.id);D&&(g=D)}const b=i($.type,$.module_name);if(!b)return"";let u=b,v=m.maxRecursionDepth;return v||(v=p(b)),m.isPreviewMode?(u=y(u,g),u=h(u,g),u=a(u,g),u=l(u,g),u=d(u)):(u=E(u,g,i,0,v),u=y(u,g),u=h(u,g),u=a(u,g),u=d(u)),u},I=($,i,m)=>{const b=new globalThis.DOMParser().parseFromString($,"text/html");return b.querySelectorAll("[z-if]").forEach(k=>{const S=k.getAttribute("z-if");S&&(i[S]?k.removeAttribute("z-if"):k.remove())}),b.querySelectorAll("[z-for-wrapper]").forEach(k=>{const S=k.getAttribute("z-for-wrapper");if(S){const V=i[S];!Array.isArray(V)||V.length===0?k.remove():k.removeAttribute("z-for-wrapper")}}),b.querySelectorAll("[z-slot]").forEach(k=>{const S=k.getAttribute("z-slot");if(S)if(i[S]&&Array.isArray(i[S])){const F=i[S].map(X=>B(X,m,options)).join("");k.outerHTML=F}else k.remove()}),options.isPreviewMode||b.querySelectorAll("img").forEach(S=>{S.classList.add("zero-code-editable-image")}),b.body.innerHTML},d=$=>{let i=$.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#x27;/g,"'");const g=new DOMParser().parseFromString(i,"text/html"),b=["zero-code-z-for-item-wrapper","zero-code-field-wrapper","zero-code-array-item","zero-code-nested-array","field-editor","tiptap-content","zero-code-z-for-controls","zero-code-z-for-controls-inner","zero-code-z-for-btn","zero-code-z-for-add-btn","zero-code-z-for-edit-btn","zero-code-z-for-delete-btn","zero-code-z-for-drag-handle","zero-code-nested-part","zero-code-add-nested-part-button-container","zero-code-add-nested-part-button","zero-code-rich-editable-text","inline-editable","zero-code-editable-image"];[".zero-code-z-for-controls",".zero-code-add-nested-part-button-container",".zero-code-z-for-add-last-button",'[onclick*="ZForArrayItem"]','[onclick*="NestedPartSelector"]','[onclick*="NestedEditor"]','[onclick*="addZForArrayItem"]','[onclick*="editZForArrayItem"]','[onclick*="removeZForArrayItem"]','[onclick*="startRichTextEdit"]',".zero-code-rich-editable-text",".inline-editable","span[data-component-id]",'span[onclick*="startRichTextEdit"]'].forEach(S=>{g.querySelectorAll(S).forEach(F=>{F.tagName.toLowerCase()==="span"?F.outerHTML=F.innerHTML:F.remove()})});const v=g.querySelectorAll("*");return v.forEach(S=>{const V=S.classList;b.forEach(F=>{V.contains(F)&&V.remove(F)}),Array.from(V).forEach(F=>{F.includes("zero-code")&&V.remove(F)}),S.className===""&&S.removeAttribute("class")}),v.forEach(S=>{Array.from(S.attributes).forEach(V=>{(V.name.startsWith("data-component-id")||V.name.startsWith("data-field-")||V.name.startsWith("data-param-")||V.name.startsWith("data-edit-")||V.name.includes("contenteditable")||V.name==="onclick"||V.name==="draggable")&&S.removeAttribute(V.name)})}),g.querySelectorAll("span").forEach(S=>{(S.hasAttribute("data-component-id")||S.hasAttribute("onclick")||S.classList.contains("zero-code-rich-editable-text")||S.classList.contains("inline-editable"))&&(S.outerHTML=S.innerHTML)}),g.querySelectorAll("img").forEach(S=>{const V=S.getAttribute("alt");if(V&&V.includes("<")&&V.includes(">")){const F=V.replace(/<[^>]*>/g,"").replace(/&[^;]+;/g,"").trim();S.setAttribute("alt",F||"ロゴ")}}),g.body.innerHTML},a=($,i)=>$.replace(/\{\$([^:]+):(.*?)\}/g,(m,g,b)=>{const u=String(i[g]||b);return xt(u)}),l=($,i)=>{const g=new globalThis.DOMParser().parseFromString($,"text/html");return g.querySelectorAll("[z-for]").forEach(u=>{const v=u.getAttribute("z-for");if(!v)return;const D=i[v];if(!Array.isArray(D)||D.length===0){u.remove();return}let k="";D.forEach(S=>{let V=u.outerHTML;V=V.replace(/\s*z-for="[^"]*"/g,""),Object.keys(S).forEach(F=>{const X=new RegExp(`\\(\\$${F}:([^)]+)\\)`,"g");V=V.replace(X,S[F]||"$1")}),k+=V}),u.outerHTML=k}),g.body.innerHTML},p=$=>{const m=new globalThis.DOMParser().parseFromString(`<root>${$}</root>`,"text/html"),g=(v,D=0)=>{let k=D;for(const S of Array.from(v.children)){let V=D;S.hasAttribute("z-for")&&(V+=1);const F=g(S,V);k=Math.max(k,F)}return k},b=m.body.querySelector("root");if(!b)return 3;const u=g(b);return Math.max(u+2,3)},E=($,i,m,g=0,b)=>{const v=new globalThis.DOMParser().parseFromString($,"text/html");if(v.querySelectorAll("[z-if]").forEach(L=>{const U=L.getAttribute("z-if");U&&(i[U]?L.removeAttribute("z-if"):L.remove())}),v.querySelectorAll("[z-for-wrapper]").forEach(L=>{const U=L.getAttribute("z-for-wrapper");if(U){const G=i[U];!Array.isArray(G)||G.length===0?L.remove():L.removeAttribute("z-for-wrapper")}}),g===0&&!b){const L=m(i.type,i.module_name);b=p(L)}const S=b??5;if(g>=S)return I($,i,m);let V=!0,F=0;for(;V&&F<3;)V=!1,F++,Array.from(v.querySelectorAll("[z-for]")).forEach(U=>{const G=U.getAttribute("z-for");if(!U.hasAttribute("data-zfor-processed")&&G){let ne=i;if(typeof window<"u"&&window.getLatestComponentData){const pe=i.id.split("_")[0]+"_"+i.id.split("_")[1]+"_"+i.id.split("_")[2]+"_"+i.id.split("_")[3],Ce=window.getLatestComponentData(pe);Ce&&(ne=Ce)}let de=i[G];if(!de&&ne[G]&&(de=ne[G]),!de&&G==="items"&&typeof window<"u"&&window.getLatestComponentData){const pe=i.id.includes("_categories_")?i.id.split("_categories_")[0]:i.id.split("_")[0]+"_"+i.id.split("_")[1]+"_"+i.id.split("_")[2]+"_"+i.id.split("_")[3],Ce=window.getLatestComponentData(pe);if(Ce&&Ce.categories){const De=i.id.match(/_categories_(\d+)/);if(De){const ke=parseInt(De[1]);Ce.categories[ke]&&Ce.categories[ke].items&&(de=Ce.categories[ke].items)}}}if(Array.isArray(de)&&de.length>0){U.setAttribute("data-zfor-processed","true");const pe=m(i.type,i.module_name),Ce=new RegExp(`<(\\w+)[^>]*z-for="${G}"[^>]*>`),De=pe.match(Ce),ke=De?pe.indexOf(De[0]):-1;let pt=U.innerHTML;if(ke!==-1&&De){const Fe=De[0].match(/<(\w+)/),_e=Fe?Fe[1]:"div";let he=0,xe=ke;for(let ye=ke;ye<pe.length;ye++)if(pe.substring(ye,ye+_e.length+1)===`<${_e}`)he++;else if(pe.substring(ye,ye+_e.length+3)===`</${_e}>`&&(he--,he===0)){xe=ye+_e.length+3;break}pt=pe.substring(ke,xe).replace(/\s+z-for="[^"]*"/,"")}const Pe=de.map((Fe,_e)=>{let he=pt;const xe={...i,...Fe,type:i.type,module_name:i.module_name,id:`${i.id}_${G}_${_e}`};if(typeof window<"u"&&window.getLatestComponentData){const Ye=i.id.includes("_categories_")?i.id.split("_categories_")[0]:i.id.includes("_items_")?i.id.split("_items_")[0]:i.id.split("_")[0]+"_"+i.id.split("_")[1]+"_"+i.id.split("_")[2]+"_"+i.id.split("_")[3],ye=window.getLatestComponentData(Ye);ye&&G==="categories"&&ye.categories&&ye.categories[_e]&&Object.assign(xe,ye.categories[_e])}return he=E(he,xe,m,g+1,S),he=y(he,Fe),he=h(he,Fe),he=a(he,xe),he}).join("");U.outerHTML=Pe,V=!0;const Ae=new DOMParser().parseFromString(v.body.innerHTML,"text/html");v.body.innerHTML=Ae.body.innerHTML}else U.remove()}});return v.querySelectorAll("[z-slot]").forEach(L=>{const U=L.getAttribute("z-slot");if(U)if(i[U]&&Array.isArray(i[U])){const ne=i[U].map(de=>B(de,m,options)).join("");L.outerHTML=ne}else L.remove()}),v.querySelectorAll("img").forEach(L=>{L.classList.add("zero-code-editable-image")}),v.body.innerHTML};return{editingText:t,shouldApplyTiptap:o,processTextReplacementWithTemplate:n,processArrayItemTextReplacement:s,processArrayItemParameterReplacement:f,processSelectionSyntax:y,processConditionalClassSyntax:h,processZDirectives:N,renderComponentWithNested:_,renderComponentWithoutSlot:C,renderNestedComponentWithDepth:A,renderNestedComponentsWithUI:w,hasNestedSlot:z,renderComponentOptimized:T,clearAllCaches:()=>{mi(),_i()}}}function Lt(){return{getImageSrc:s=>s.fileData?.base64&&s.fileData.base64.trim()!==""?`data:${s.fileData.type||s.type||"image/jpeg"};base64,${s.fileData.base64}`:s.url||"",isImageUpdated:s=>!!(s.fileData?.base64&&s.fileData.base64.trim()!==""),getImageAlt:s=>s.alt||s.name||"画像",updateImageData:(s,f,y)=>({...s,fileData:{...s.fileData,base64:y,type:f.type,size:f.size},type:f.type,size:f.size,uploadedAt:new Date().toISOString()})}}const $i={class:"zero-code-page-preview"},Ei={class:"zero-code-page-preview-content"},wi=["innerHTML"],zi=e.defineComponent({__name:"PagePreview",props:{pageData:{type:Array},parts:{type:Array},commonImages:{type:Array},individualImages:{type:Array}},setup(t){const r=t,o=So(),{getImageSrc:n}=Lt(),s=e.computed(()=>[...r.commonImages,...r.individualImages]),f=C=>{if(!C||s.value.length===0)return C;let A=C;return A=A.replace(/<img([^>]*?)src=["']([^"']+)["']([^>]*?)>/gi,(w,N,z,T)=>{const B=s.value.find(I=>!!(I.id===z||I.url===z||I.name===z||z.endsWith("/"+I.name)||I.url.endsWith(z)||z.split("/").pop()===I.name));if(B){const I=n(B);return`<img${N}src="${I}"${T}>`}return w}),A},y=(C,A)=>{if(!Array.isArray(r.parts))return"";const w=r.parts.find(z=>z.type===C);if(!w)return"";const N=w.module.find(z=>z.title===A);return N?N.body:""},h=e.computed(()=>{if(!Array.isArray(r.pageData)||r.pageData.length===0)return'<div class="zero-code-no-content">ページにコンテンツがありません</div>';let C='<div class="zero-code-page-container">';return r.pageData.forEach(A=>{const w=_(A);!w||w.trim()===""?C+=`<div class="zero-code-error-component">テンプレートが見つかりません: ${A.type}/${A.module_name}</div>`:C+=w}),C+="</div>",C}),_=C=>{const A=o.renderComponentOptimized(C,y,{isPreviewMode:!0});return f(A)};return(C,A)=>(e.openBlock(),e.createElementBlock("div",$i,[e.createElementVNode("div",Ei,[e.createElementVNode("div",{innerHTML:h.value},null,8,wi)])]))}}),vi={class:"zero-code-tab-content"},Ci={class:"zero-code-data-tabs"},Ai={class:"zero-code-tab-buttons"},Ni=["onClick"],ki={class:"zero-code-preview-content"},Pi={key:0,class:"zero-code-preview-section"},Si={key:1,class:"zero-code-preview-section"},Ii={class:"zero-code-html-source"},Di={class:"zero-code-html-source-pre"},Ti=e.defineComponent({__name:"PreviewPanel",props:{editablePageData:{type:Array},localParts:{type:Array},parts:{type:Array},commonImages:{type:Array},individualImages:{type:Array}},setup(t){const r=t,o=So(),n=e.ref("preview"),s=e.ref(0),f=["preview","source"],y=w=>({preview:"プレビュー表示",source:"HTMLソース"})[w],h=(w,N)=>{const z=r.localParts&&r.localParts.length>0?r.localParts:r.parts||[];if(!Array.isArray(z))return"";const T=z.find(I=>I.type===w);if(!T)return"";const B=T.module.find(I=>I.title===N);return B?B.body:""},_=w=>o.renderComponentOptimized(w,h,{isPreviewMode:!0}),C=e.computed(()=>{if(!Array.isArray(r.editablePageData)||r.editablePageData.length===0)return'<div class="zero-code-no-content">ページにコンテンツがありません</div>';let w='<div class="zero-code-page-container">';return r.editablePageData.forEach(N=>{const z=_(N);!z||z.trim()===""?w+=`<div class="zero-code-error-component">テンプレートが見つかりません: ${N.type}/${N.module_name}</div>`:w+=z}),w+="</div>",w}),A=w=>{if(!w)return"";try{const T=new globalThis.DOMParser().parseFromString(`<root>${w}</root>`,"text/html").body.firstChild;if(!T)return w;const B=new Set(["img","br","hr","input","meta","link","area","base","col","embed","source","track","wbr"]),I=new Set(["span","a","strong","em","u","mark","code","small","sub","sup","i","b"]),d=(l,p=0,E=!1)=>{const P=l.tagName.toLowerCase(),$=E?"":"  ".repeat(p),i=B.has(P),m=I.has(P);let g=`<${P}`;for(let S=0;S<l.attributes.length;S++){const V=l.attributes[S];g+=` ${V.name}="${V.value}"`}g+=">";let b=$+g;if(i)return b;let u=!1,v=!1;const D=[];let k="";for(let S=0;S<l.childNodes.length;S++){const V=l.childNodes[S];if(V.nodeType===1){u=!0;const X=d(V,p+1,m||E);D.push(X)}else if(V.nodeType===3){const F=V.textContent?.replace(/\s+/g," ").trim();F&&(v=!0,k+=F)}}return u&&v?m||E?b+=k+D.join(""):(b+=k+`
`+D.join(`
`),D.length>0&&(b+=`
`+$)):u?m||E?b+=D.join(""):(b+=`
`+D.join(`
`),D.length>0&&(b+=`
`+$)):v&&(b+=k),b+=`</${P}>`,b};let a="";for(let l=0;l<T.childNodes.length;l++){const p=T.childNodes[l];p.nodeType===1&&(a+=d(p)+`
`)}return a.replace(/\n{3,}/g,`

`).replace(/\n\s*\n\s*</g,`
<`).trim()}catch{return w.replace(/>\s*</g,`>
<`).split(`
`).filter(z=>z.trim()).map((z,T,B)=>{const I=z.trim();if(!I)return"";let d=0;for(let a=0;a<T;a++){const l=B[a].trim();l.match(/<[^\/!][^>]*[^\/]>$/)&&d++,l.match(/<\/[^>]+>$/)&&d--}return I.startsWith("</")&&d--,"  ".repeat(Math.max(0,d))+I}).join(`
`)}};return e.watch(()=>r.editablePageData,()=>{s.value++},{deep:!0,immediate:!0}),(w,N)=>(e.openBlock(),e.createElementBlock("div",vi,[e.createElementVNode("div",Ci,[e.createElementVNode("div",Ai,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(f,z=>e.createElementVNode("button",{key:z,class:e.normalizeClass(["zero-code-data-tab-button",{active:n.value===z}]),onClick:T=>n.value=z},e.toDisplayString(y(z)),11,Ni)),64))])]),e.createElementVNode("div",ki,[n.value==="preview"?(e.openBlock(),e.createElementBlock("div",Pi,[(e.openBlock(),e.createBlock(zi,{key:s.value,"page-data":w.editablePageData,parts:w.localParts&&w.localParts.length>0?w.localParts:w.parts||[],"common-images":w.commonImages,"individual-images":w.individualImages},null,8,["page-data","parts","common-images","individual-images"]))])):e.createCommentVNode("",!0),n.value==="source"?(e.openBlock(),e.createElementBlock("div",Si,[e.createElementVNode("div",Ii,[N[0]||(N[0]=e.createElementVNode("div",{class:"zero-code-source-header"},[e.createElementVNode("p",{class:"zero-code-source-description"},"パーツごとに改行・インデントされたHTMLソース")],-1)),e.createElementVNode("pre",Di,[e.createElementVNode("code",null,e.toDisplayString(A(C.value)),1)])])])):e.createCommentVNode("",!0)])]))}}),Vi={class:"zero-code-modal-header"},Bi={class:"zero-code-modal-body"},Mi={class:"zero-code-img-file-input-section"},Fi={key:0,class:"zero-code-img-file-info"},xi={class:"zero-code-img-file-preview"},Li=["src"],Oi={class:"zero-code-img-file-details"},Ri={class:"zero-code-form-section"},Hi={class:"zero-code-form-group"},Zi=["disabled"],ji={class:"zero-code-form-group"},Ui=["disabled"],Wi={key:0,class:"zero-code-form-group"},qi=["disabled"],Ki={class:"zero-code-modal-footer"},Xi=["disabled"],Yi=e.defineComponent({__name:"ImageUploadModal",props:{category:{type:String},componentId:{type:String}},emits:["close","upload"],setup(t,{emit:r}){const o=t,n=r,s=e.ref(null),f=e.ref(""),y=e.ref(""),h=e.ref(""),_=e.ref(o.componentId||""),C=e.computed(()=>s.value&&y.value.trim()&&h.value.trim()),A=a=>{const l=a.target;l.files&&l.files[0]&&N(l.files[0])},w=a=>{a.preventDefault(),a.dataTransfer&&a.dataTransfer.files[0]&&N(a.dataTransfer.files[0])},N=a=>{s.value=a,y.value=a.name.replace(/\.[^/.]+$/,""),h.value=a.name,f.value&&URL.revokeObjectURL(f.value),f.value=URL.createObjectURL(a)},z=a=>new Promise((l,p)=>{const E=new FileReader;E.readAsDataURL(a),E.onload=()=>l(E.result),E.onerror=P=>p(P)}),T=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),B=a=>{if(a===0)return"0 Bytes";const l=1024,p=["Bytes","KB","MB","GB"],E=Math.floor(Math.log(a)/Math.log(l));return parseFloat((a/Math.pow(l,E)).toFixed(2))+" "+p[E]},I=async()=>{if(!(!s.value||!C.value))try{const a=await z(s.value),l=a.split(",")[1]||a,p={id:T(),name:y.value,originalName:s.value.name,url:`/img/${y.value}`,alt:h.value,size:s.value.size,type:s.value.type,uploadedAt:new Date().toISOString(),category:o.category,componentId:o.category==="individual"?_.value:void 0,fileData:{base64:l}};n("upload",p)}catch{alert("画像のアップロードに失敗しました。")}},d=()=>{f.value&&URL.revokeObjectURL(f.value)};return e.onUnmounted(d),(a,l)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:l[8]||(l[8]=p=>a.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:l[7]||(l[7]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Vi,[e.createElementVNode("h4",null,"画像アップロード（"+e.toDisplayString(a.category==="common"?"共通":"個別")+"）",1),e.createElementVNode("button",{class:"zero-code-img-close-btn",onClick:l[0]||(l[0]=p=>a.$emit("close"))},"×")]),e.createElementVNode("div",Bi,[e.createElementVNode("div",Mi,[l[9]||(l[9]=e.createElementVNode("label",{for:"file-input",class:"zero-code-img-file-input-label"},[e.createElementVNode("div",{class:"zero-code-img-file-input-area"},[e.createElementVNode("span",{class:"zero-code-img-file-input-text"},"クリックしてファイルを選択"),e.createElementVNode("span",{class:"zero-code-img-file-input-hint"},"またはドラッグ&ドロップ")])],-1)),e.createElementVNode("input",{id:"file-input",type:"file",accept:"image/*",style:{display:"none"},onChange:A,onDrop:w,onDragover:l[1]||(l[1]=e.withModifiers(()=>{},["prevent"])),onDragenter:l[2]||(l[2]=e.withModifiers(()=>{},["prevent"]))},null,32)]),s.value?(e.openBlock(),e.createElementBlock("div",Fi,[e.createElementVNode("div",xi,[e.createElementVNode("img",{src:f.value,alt:"プレビュー"},null,8,Li)]),e.createElementVNode("div",Oi,[e.createElementVNode("p",null,[l[10]||(l[10]=e.createElementVNode("strong",null,"ファイル名:",-1)),e.createTextVNode(" "+e.toDisplayString(s.value.name),1)]),e.createElementVNode("p",null,[l[11]||(l[11]=e.createElementVNode("strong",null,"サイズ:",-1)),e.createTextVNode(" "+e.toDisplayString(B(s.value.size)),1)]),e.createElementVNode("p",null,[l[12]||(l[12]=e.createElementVNode("strong",null,"タイプ:",-1)),e.createTextVNode(" "+e.toDisplayString(s.value.type),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ri,[e.createElementVNode("div",Hi,[l[13]||(l[13]=e.createElementVNode("label",{for:"image-name"},"保存名:",-1)),e.withDirectives(e.createElementVNode("input",{id:"image-name","onUpdate:modelValue":l[3]||(l[3]=p=>y.value=p),type:"text",placeholder:"画像の保存名を入力",disabled:!s.value},null,8,Zi),[[e.vModelText,y.value]])]),e.createElementVNode("div",ji,[l[14]||(l[14]=e.createElementVNode("label",{for:"image-alt"},"alt属性:",-1)),e.withDirectives(e.createElementVNode("input",{id:"image-alt","onUpdate:modelValue":l[4]||(l[4]=p=>h.value=p),type:"text",placeholder:"画像の説明を入力",disabled:!s.value},null,8,Ui),[[e.vModelText,h.value]])]),a.category==="individual"?(e.openBlock(),e.createElementBlock("div",Wi,[l[15]||(l[15]=e.createElementVNode("label",{for:"component-id"},"コンポーネントID:",-1)),e.withDirectives(e.createElementVNode("input",{id:"component-id","onUpdate:modelValue":l[5]||(l[5]=p=>_.value=p),type:"text",placeholder:"コンポーネントIDを入力",disabled:!s.value},null,8,qi),[[e.vModelText,_.value]])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",Ki,[e.createElementVNode("button",{class:"zero-code-img-btn zero-code-img-btn-secondary",onClick:l[6]||(l[6]=p=>a.$emit("close"))},"キャンセル"),e.createElementVNode("button",{class:"zero-code-img-btn zero-code-img-btn-primary",disabled:!C.value,onClick:I}," アップロード ",8,Xi)])])]))}}),Ji={class:"zero-code-modal-header"},Gi={class:"zero-code-modal-body"},Qi={class:"zero-code-img-detail-preview"},ed=["src","alt"],td={key:0,class:"zero-code-img-updated-badge"},od={class:"zero-code-form-section"},rd={class:"zero-code-form-group"},nd={class:"zero-code-form-group"},ad={key:0,class:"zero-code-form-group"},sd={class:"zero-code-img-detail-info"},ld={class:"zero-code-img-detail-info-group"},id={class:"zero-code-img-detail-info-group"},dd={class:"zero-code-img-detail-info-group"},cd={class:"zero-code-img-detail-info-group"},pd={class:"zero-code-img-detail-info-group"},md={class:"zero-code-img-detail-url-group"},ud={class:"zero-code-modal-footer"},gd={class:"zero-code-modal-footer-right"},fd=e.defineComponent({__name:"ImageDetailModal",props:{image:{type:Object}},emits:["close","delete","replace"],setup(t,{emit:r}){const o=t,n=r,s=e.reactive({...o.image}),f=e.ref(null),{getImageSrc:y,getImageAlt:h,isImageUpdated:_,updateImageData:C}=Lt(),A=e.computed(()=>y(s)),w=e.computed(()=>h(s)),N=()=>{confirm("この画像を削除しますか？この操作は取り消せません。")&&n("delete",s.id)},z=()=>{f.value&&f.value.click()},T=async l=>{const p=l.target;if(!p.files||!p.files[0])return;const E=p.files[0];if(!confirm(`画像を "${E.name}" に差し替えますか？この操作は取り消せません。`)){p.value="";return}try{const P=await B(E),$=C(s,E,P.split(",")[1]);Object.assign(s,$),n("replace",s.id,$)}catch{alert("画像の差し替えに失敗しました。")}finally{p.value=""}},B=l=>new Promise((p,E)=>{const P=new FileReader;P.readAsDataURL(l),P.onload=()=>p(P.result),P.onerror=$=>E($)}),I=async l=>{try{await navigator.clipboard.writeText(l),alert("URLをクリップボードにコピーしました")}catch{const E=document.createElement("textarea");E.value=l,document.body.appendChild(E),E.select(),document.execCommand("copy"),document.body.removeChild(E),alert("URLをクリップボードにコピーしました")}},d=l=>{if(!l||isNaN(l))return"サイズ不明";if(l===0)return"0 Bytes";const p=1024,E=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(l)/Math.log(p));return parseFloat((l/Math.pow(p,P)).toFixed(2))+" "+E[P]},a=l=>{if(!l)return"日時不明";const p=new Date(l);return isNaN(p.getTime())?"日時不明":p.toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return(l,p)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:p[8]||(p[8]=E=>l.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:p[7]||(p[7]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Ji,[p[9]||(p[9]=e.createElementVNode("h4",null,"画像詳細",-1)),e.createElementVNode("button",{class:"zero-code-close-button",onClick:p[0]||(p[0]=E=>l.$emit("close"))},"✖️")]),e.createElementVNode("div",Gi,[e.createElementVNode("div",Qi,[e.createElementVNode("img",{src:A.value,alt:w.value},null,8,ed),e.unref(_)(s)?(e.openBlock(),e.createElementBlock("div",td," 差し替え済み ")):e.createCommentVNode("",!0)]),e.createElementVNode("div",od,[e.createElementVNode("div",rd,[p[10]||(p[10]=e.createElementVNode("label",{for:"detail-image-name"},"ファイル名:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-image-name","onUpdate:modelValue":p[1]||(p[1]=E=>s.name=E),type:"text",readonly:""},null,512),[[e.vModelText,s.name]])]),e.createElementVNode("div",nd,[p[11]||(p[11]=e.createElementVNode("label",{for:"detail-image-alt"},"alt属性:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-image-alt","onUpdate:modelValue":p[2]||(p[2]=E=>s.alt=E),type:"text",readonly:""},null,512),[[e.vModelText,s.alt]])]),s.componentId?(e.openBlock(),e.createElementBlock("div",ad,[p[12]||(p[12]=e.createElementVNode("label",{for:"detail-component-id"},"コンポーネントID:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-component-id","onUpdate:modelValue":p[3]||(p[3]=E=>s.componentId=E),type:"text",readonly:""},null,512),[[e.vModelText,s.componentId]])])):e.createCommentVNode("",!0),e.createElementVNode("div",sd,[e.createElementVNode("div",ld,[p[13]||(p[13]=e.createElementVNode("label",null,"カテゴリ:",-1)),e.createElementVNode("span",{class:e.normalizeClass(["zero-code-img-detail-category",s.category])},e.toDisplayString(s.category==="common"?"共通画像":"個別画像"),3)]),e.createElementVNode("div",id,[p[14]||(p[14]=e.createElementVNode("label",null,"ファイルサイズ:",-1)),e.createElementVNode("span",null,e.toDisplayString(d(s.fileData?.size||s.size||0)),1)]),e.createElementVNode("div",dd,[p[15]||(p[15]=e.createElementVNode("label",null,"ファイルタイプ:",-1)),e.createElementVNode("span",null,e.toDisplayString(s.fileData?.type||s.type||"不明"),1)]),e.createElementVNode("div",cd,[p[16]||(p[16]=e.createElementVNode("label",null,"アップロード日時:",-1)),e.createElementVNode("span",null,e.toDisplayString(a(s.uploadedAt)),1)]),e.createElementVNode("div",pd,[p[17]||(p[17]=e.createElementVNode("label",null,"画像URL:",-1)),e.createElementVNode("div",md,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":p[4]||(p[4]=E=>s.url=E),type:"text",readonly:"",class:"zero-code-img-detail-url-input"},null,512),[[e.vModelText,s.url]]),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary zero-code-copy-btn",title:"URLをコピー",onClick:p[5]||(p[5]=E=>I(s.url))}," 📋 ")])])])])]),e.createElementVNode("div",ud,[e.createElementVNode("div",{class:"zero-code-modal-footer-left"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-danger",onClick:N}," 削除 "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",onClick:z}," 差し替え ")]),e.createElementVNode("div",gd,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:p[6]||(p[6]=E=>l.$emit("close"))}," 閉じる ")]),e.createElementVNode("input",{ref_key:"fileInputRef",ref:f,type:"file",accept:"image/*",style:{display:"none"},onChange:T},null,544)])])]))}}),hd={class:"zero-code-tab-content"},yd={class:"zero-code-data-tabs"},bd={class:"zero-code-tab-buttons"},_d=["onClick"],$d={class:"zero-code-image-content"},Ed={key:0,class:"zero-code-image-section"},wd={class:"zero-code-section-header"},zd={class:"zero-code-img-grid"},vd=["onClick"],Cd=["src","alt"],Ad={key:0,class:"zero-code-img-updated-badge"},Nd={class:"zero-code-img-info"},kd={class:"zero-code-img-name"},Pd={class:"zero-code-img-size"},Sd=["onClick"],Id={key:0,class:"zero-code-empty-state"},Dd={key:1,class:"zero-code-image-section"},Td={class:"zero-code-section-header"},Vd={class:"zero-code-img-grid"},Bd=["onClick"],Md=["src","alt"],Fd={key:0,class:"zero-code-img-updated-badge"},xd={class:"zero-code-img-info"},Ld={class:"zero-code-img-name"},Od={class:"zero-code-img-size"},Rd=["onClick"],Hd={key:0,class:"zero-code-empty-state"},Zd={key:2,class:"zero-code-image-section"},jd={class:"zero-code-data-display-section"},Ud={class:"zero-code-parts-sub-tabs"},Wd={class:"zero-code-parts-sub-content"},qd={key:0,class:"zero-code-parts-sub-section"},Kd={key:0},Xd={class:"zero-code-data-display-pre"},Yd={key:1},Jd={key:1,class:"zero-code-parts-sub-section"},Gd={key:0},Qd={class:"zero-code-data-display-pre"},ec={key:1},tc={class:"zero-code-image-stats"},oc=e.defineComponent({__name:"ImageManagementPanel",props:{commonImages:{type:Array},individualImages:{type:Array}},emits:["updateCommonImages","updateIndividualImages","sendCommonImagesData","sendIndividualImagesData"],setup(t,{emit:r}){const o=t,n=r,{getImageSrc:s,getImageAlt:f,isImageUpdated:y}=Lt(),h=e.ref("common"),_=e.ref("common"),C=e.ref(!1),A=e.ref(!1),w=e.ref("common"),N=e.ref(null),z=e.computed(()=>o.commonImages.length+o.individualImages.length),T=["common","individual","data"],B=g=>({common:"共通画像",individual:"個別画像",data:"データ表示"})[g],I=g=>{if(!g||isNaN(g))return"サイズ不明";if(g===0)return"0 Bytes";const b=1024,u=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(g)/Math.log(b));return parseFloat((g/Math.pow(b,v)).toFixed(2))+" "+u[v]},d=g=>{w.value=g,C.value=!0},a=()=>{C.value=!1},l=g=>{N.value=g,A.value=!0},p=()=>{A.value=!1,N.value=null},E=g=>{if(w.value==="common"){const b=[...o.commonImages,g];n("updateCommonImages",b)}else{const b=[...o.individualImages,g];n("updateIndividualImages",b)}a()},P=g=>{const b=(u,v=0)=>{const D="  ".repeat(v),k="  ".repeat(v+1);if(Array.isArray(u))return u.length===0?"[]":`[
${u.map(V=>k+b(V,v+1)).join(`,
`)}
${D}]`;if(typeof u=="object"&&u!==null){const S=Object.entries(u);return S.length===0?"{}":`{
${S.map(([F,X])=>{let O;if(typeof X=="string"){const L=X.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if(L.includes(`
`)){const U=L.split(`
`);O=U.map((ne,de)=>de===0?`\`${ne}`:de===U.length-1?`${k}${ne}\``:`${k}${ne}`).join(`
`)}else O=`"${L}"`}else O=b(X,v+1);return`${k}"${F}": ${O}`}).join(`,
`)}
${D}}`}return typeof u=="string"?`"${u.replace(/"/g,'\\"')}"`:JSON.stringify(u)};return b(g)},$=g=>{if(!N.value)return;if(N.value.category==="common"){const u=o.commonImages.filter(v=>v.id!==g);n("updateCommonImages",u)}else{const u=o.individualImages.filter(v=>v.id!==g);n("updateIndividualImages",u)}p()},i=(g,b)=>{if(b.category==="common"){const v=o.commonImages.map(D=>D.id===g?b:D);n("updateCommonImages",v)}else{const v=o.individualImages.map(D=>D.id===g?b:D);n("updateIndividualImages",v)}p()},m=(g,b)=>{if(confirm("この画像を削除しますか？"))if(b==="common"){const u=o.commonImages.filter(v=>v.id!==g);n("updateCommonImages",u)}else{const u=o.individualImages.filter(v=>v.id!==g);n("updateIndividualImages",u)}};return(g,b)=>(e.openBlock(),e.createElementBlock("div",hd,[e.createElementVNode("div",yd,[e.createElementVNode("div",bd,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(T,u=>e.createElementVNode("button",{key:u,class:e.normalizeClass(["zero-code-data-tab-button",{active:h.value===u}]),onClick:v=>h.value=u},e.toDisplayString(B(u)),11,_d)),64))])]),e.createElementVNode("div",$d,[h.value==="common"?(e.openBlock(),e.createElementBlock("div",Ed,[e.createElementVNode("div",wd,[e.createElementVNode("h4",null,"共通画像 ("+e.toDisplayString(g.commonImages.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-img-upload-btn common",onClick:b[0]||(b[0]=u=>d("common"))}," 共通画像をアップロード ")]),e.createElementVNode("div",zd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.commonImages,u=>(e.openBlock(),e.createElementBlock("div",{key:u.id,class:"zero-code-img-item",onClick:v=>l(u)},[e.createElementVNode("img",{src:e.unref(s)(u),alt:e.unref(f)(u)},null,8,Cd),e.unref(y)(u)?(e.openBlock(),e.createElementBlock("div",Ad," 差し替え済み ")):e.createCommentVNode("",!0),e.createElementVNode("div",Nd,[e.createElementVNode("p",kd,e.toDisplayString(u.name),1),e.createElementVNode("p",Pd,e.toDisplayString(I(u.fileData?.size||u.size||0)),1)]),e.createElementVNode("button",{class:"zero-code-img-delete-btn",onClick:e.withModifiers(v=>m(u.id,"common"),["stop"])}," 削除 ",8,Sd)],8,vd))),128))]),g.commonImages.length===0?(e.openBlock(),e.createElementBlock("div",Id,b[4]||(b[4]=[e.createElementVNode("p",null,"共通画像が登録されていません。",-1)]))):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),h.value==="individual"?(e.openBlock(),e.createElementBlock("div",Dd,[e.createElementVNode("div",Td,[e.createElementVNode("h4",null,"個別画像 ("+e.toDisplayString(g.individualImages.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-img-upload-btn individual",onClick:b[1]||(b[1]=u=>d("individual"))}," 個別画像をアップロード ")]),e.createElementVNode("div",Vd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.individualImages,u=>(e.openBlock(),e.createElementBlock("div",{key:u.id,class:"zero-code-img-item",onClick:v=>l(u)},[e.createElementVNode("img",{src:e.unref(s)(u),alt:e.unref(f)(u)},null,8,Md),e.unref(y)(u)?(e.openBlock(),e.createElementBlock("div",Fd," 差し替え済み ")):e.createCommentVNode("",!0),e.createElementVNode("div",xd,[e.createElementVNode("p",Ld,e.toDisplayString(u.name),1),e.createElementVNode("p",Od,e.toDisplayString(I(u.fileData?.size||u.size||0)),1)]),e.createElementVNode("button",{class:"zero-code-img-delete-btn",onClick:e.withModifiers(v=>m(u.id,"individual"),["stop"])}," 削除 ",8,Rd)],8,Bd))),128))]),g.individualImages.length===0?(e.openBlock(),e.createElementBlock("div",Hd,b[5]||(b[5]=[e.createElementVNode("p",null,"個別画像が登録されていません。",-1)]))):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),h.value==="data"?(e.openBlock(),e.createElementBlock("div",Zd,[e.createElementVNode("div",jd,[e.createElementVNode("div",Ud,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:_.value==="common"}]),onClick:b[2]||(b[2]=u=>_.value="common")}," 共通画像データ ",2),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:_.value==="individual"}]),onClick:b[3]||(b[3]=u=>_.value="individual")}," 個別画像データ ",2)]),e.createElementVNode("div",Wd,[_.value==="common"?(e.openBlock(),e.createElementBlock("div",qd,[g.commonImages&&g.commonImages.length>0?(e.openBlock(),e.createElementBlock("div",Kd,[e.createElementVNode("pre",Xd,e.toDisplayString(P(g.commonImages)),1)])):(e.openBlock(),e.createElementBlock("div",Yd,b[6]||(b[6]=[e.createElementVNode("p",null,"共通画像データがありません",-1)])))])):e.createCommentVNode("",!0),_.value==="individual"?(e.openBlock(),e.createElementBlock("div",Jd,[g.individualImages&&g.individualImages.length>0?(e.openBlock(),e.createElementBlock("div",Gd,[e.createElementVNode("pre",Qd,e.toDisplayString(P(g.individualImages)),1)])):(e.openBlock(),e.createElementBlock("div",ec,b[7]||(b[7]=[e.createElementVNode("p",null,"個別画像データがありません",-1)])))])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",tc,[b[8]||(b[8]=e.createElementVNode("strong",null,"画像情報:",-1)),e.createTextVNode(" 共通画像: "+e.toDisplayString(g.commonImages.length)+"件, 個別画像: "+e.toDisplayString(g.individualImages.length)+"件, 合計: "+e.toDisplayString(z.value)+"件 ",1)]),C.value?(e.openBlock(),e.createBlock(Yi,{key:0,category:w.value,onClose:a,onUpload:E},null,8,["category"])):e.createCommentVNode("",!0),A.value&&N.value?(e.openBlock(),e.createBlock(fd,{key:1,image:N.value,onClose:p,onDelete:$,onReplace:i},null,8,["image"])):e.createCommentVNode("",!0)]))}});function rc(){const t=e.ref("editor"),r=_=>{t.value!==_&&(c.info(`🔄 タブ切り替え: ${t.value} → ${_}`),t.value=_)};return{activeTab:t,availableTabs:["editor","parts","preview","images"],switchToTab:r,isActiveTab:_=>t.value===_,showEditor:()=>{r("editor")},showPartsManager:()=>{r("parts")},showPreview:()=>{r("preview")},showImageManager:()=>{r("images")}}}function nc(t,r){const o=e.reactive({editablePageData:[],localParts:[],localCommonParts:[],localIndividualParts:[],activeTab:"editor",dataTab:"rendered",showEditor:!1,showPartSelector:!1,showNestedPartSelector:!1,selectedComponent:null,selectedComponentIndex:null,editingText:null,insertPosition:0,nestedInsertPath:"",nestedInsertPosition:0});e.watch(()=>t.page,_=>{Array.isArray(_)&&_.length>0&&(o.editablePageData=[..._])},{immediate:!0,deep:!0}),e.watch(()=>t.parts,_=>{Array.isArray(_)&&(o.localParts=[..._])},{immediate:!0,deep:!0});const n={currentComponentIndex:e.computed(()=>o.selectedComponentIndex===null?-1:typeof o.selectedComponentIndex=="number"?o.selectedComponentIndex:parseInt(o.selectedComponentIndex.toString())),pageDataLength:e.computed(()=>o.editablePageData.length),hasSelectedComponent:e.computed(()=>o.selectedComponent!==null),isEditing:e.computed(()=>o.showEditor&&o.selectedComponent!==null),isTiptapEditing:e.computed(()=>o.editingText!==null)},s={switchToTab:_=>{o.activeTab=_,_==="editor"&&(o.dataTab="rendered")},setDataTab:_=>{o.dataTab=_}},f={openEditor:(_,C)=>{o.selectedComponent=_,o.selectedComponentIndex=C,o.showEditor=!0},closeEditor:()=>{r.emit("editorClosed",{componentId:o.selectedComponent?.id,componentIndex:o.selectedComponentIndex}),o.showEditor=!1,o.selectedComponent=null,o.selectedComponentIndex=null},openPartSelector:_=>{o.insertPosition=_,o.showPartSelector=!0},closePartSelector:()=>{o.showPartSelector=!1},openNestedPartSelector:(_,C)=>{o.nestedInsertPath=_,o.nestedInsertPosition=C,o.showNestedPartSelector=!0},closeNestedPartSelector:()=>{o.showNestedPartSelector=!1}},y={startTiptapEdit:(_,C,A=[],w=0,N,z)=>{o.editingText={componentId:_,paramName:C,hierarchyPath:A,depth:w,arrayName:N,itemIndex:z}},stopTiptapEdit:()=>{o.editingText=null}},h=()=>{o.editablePageData=Array.isArray(t.page)?[...t.page]:[],o.localParts=Array.isArray(t.parts)?[...t.parts]:[],o.localCommonParts=Array.isArray(t.commonParts)?[...t.commonParts]:[],o.localIndividualParts=Array.isArray(t.individualParts)?[...t.individualParts]:[]};return e.watch(()=>t.page,_=>{Array.isArray(_)&&(o.editablePageData=[..._])},{deep:!0,immediate:!0}),e.watch(()=>t.parts,_=>{Array.isArray(_)&&(o.localParts=[..._])},{deep:!0,immediate:!0}),e.watch(()=>t.commonParts,_=>{Array.isArray(_)&&(o.localCommonParts=[..._])},{deep:!0,immediate:!0}),e.watch(()=>t.individualParts,_=>{Array.isArray(_)&&(o.localIndividualParts=[..._])},{deep:!0,immediate:!0}),h(),{...e.toRefs(o),...n,...s,...f,...y,initializeData:h}}function ac(){const t=h=>h.includes("url")||h.includes("src")||h.includes("link")?"url":h.includes("email")?"email":h.includes("number")||h.includes("count")?"number":h.includes("date")?"date":h.includes("time")?"time":h.includes("password")?"password":h.includes("tel")||h.includes("phone")?"tel":"text";return{getInputType:t,formatFileSize:h=>{if(h===0)return"0 Bytes";const _=1024,C=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(h)/Math.log(_));return parseFloat((h/Math.pow(_,A)).toFixed(2))+" "+C[A]},component:{findComponentByPath:(h,_)=>{let C=h,A=null;for(let w=0;w<_.length;w++){const N=_[w];if(N>=0&&N<C.length)A=C[N],w<_.length-1&&(C=A.nested_parts||[]);else return null}return A},createNewComponent:(h,_)=>({id:`comp_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:h,module_name:_,nested_parts:[]}),deleteComponent:(h,_)=>h.filter((C,A)=>A!==_),duplicateComponent:h=>{const _=`comp_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;return{...JSON.parse(JSON.stringify(h)),id:_}},addArrayItem:(h,_)=>{h[_]||(h[_]=[]);const C=h[_],A={id:`item_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};C.push(A)},removeArrayItem:(h,_,C)=>{const A=h[_];Array.isArray(A)&&C>=0&&C<A.length&&A.splice(C,1)}},template:{getTemplate:(h,_,C)=>{const A=C.find(N=>N.type===h);return A&&A.module.find(N=>N.title===_)?.body||""},extractFields:h=>{const _=[];return[/\{\$([^:}]+):/g,/\(\$([^:}]+):/g,/\(\$([^?}]+)\?:/g].forEach(A=>{let w;for(;(w=A.exec(h))!==null;){const N=w[1];_.includes(N)||_.push(N)}}),_},extractSlots:h=>[]},array:{addArrayItem:(h,_)=>[...h,_],removeArrayItem:(h,_)=>h.filter((C,A)=>A!==_),updateArrayItem:(h,_,C)=>h.map((A,w)=>w===_?C:A),moveArrayItem:(h,_,C)=>{const A=[...h],[w]=A.splice(_,1);return A.splice(C,0,w),A}},field:{getFieldValue:(h,_)=>h[_]||"",setFieldValue:(h,_,C)=>({...h,[_]:C}),validateField:(h,_)=>{switch(t(h)){case"email":return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_);case"url":try{return new URL(_),!0}catch{return!1}case"number":return!isNaN(Number(_));default:return!0}}},string:{stringifyHierarchyPath:h=>h.join("."),parseHierarchyPath:h=>{if(!h||typeof h!="string")return c.warn("Invalid pathString provided:",h),[];try{const _=h.split("."),C=[];for(const A of _){const w=A.trim();if(w==="")continue;const N=parseInt(w,10);if(!isNaN(N)&&N>=0)C.push(N);else return c.error(`Invalid path component: "${A}" in pathString: "${h}"`),[]}return C}catch(_){return c.error("Error parsing hierarchy path:",h,_),[]}},camelToKebab:h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kebabToCamel:h=>h.replace(/-([a-z])/g,(_,C)=>C.toUpperCase())}}}function sc(){let t=null;const r=p=>{if(!p||typeof p!="string"||p.trim()==="")return"<p></p>";const E=["p","strong","em","u","s","a","span","br"],P=["href","target","style"],$=document.createElement("div");$.innerHTML=p;const i=g=>{const b=g.tagName.toLowerCase();if(!E.includes(b)){const u=g.parentNode;if(u){for(;g.firstChild;)u.insertBefore(g.firstChild,g);u.removeChild(g)}return}Array.from(g.attributes).forEach(u=>{P.includes(u.name.toLowerCase())||g.removeAttribute(u.name)}),Array.from(g.children).forEach(u=>{i(u)})};Array.from($.children).forEach(g=>{i(g)});let m=$.innerHTML;return m=m.replace(/<p>\s*<\/p>/g,"<p><br></p>").replace(/<p>\s*<br>\s*<\/p>/g,"<p><br></p>").replace(/(<\w+>)\s*(<\/\w+>)/g,"$1<br>$2"),m.includes("<")||(m=`<p>${m}</p>`),(!m||m.trim()==="")&&(m="<p><br></p>"),m},o=()=>{const p=window.getSelection();if(!p||p.rangeCount===0)return{selection:null,range:null};const E=p.getRangeAt(0);return t?.contains(E.commonAncestorContainer)?{selection:p,range:E}:{selection:null,range:null}},n=(p,E)=>{const P=document.createElement(p);return E&&Object.entries(E).forEach(([$,i])=>{P.setAttribute($,i)}),P},s=(p,E)=>{try{p.surroundContents(E)}catch{const P=p.extractContents();E.appendChild(P),p.insertNode(E)}},f=(p,E,P)=>{const $=n(E,P);s(p,$)},y=(p,E)=>{const P=document.createElement("span");Object.assign(P.style,E),s(p,P)},h=(p,E)=>{if(!p.collapsed)return;const P=document.createTextNode("テキスト");p.insertNode(P),p.selectNodeContents(P),E.removeAllRanges(),E.addRange(p)},_=p=>{const{selection:E,range:P}=o();if(!E||!P)return;let $=P.commonAncestorContainer;$.nodeType===Node.TEXT_NODE&&($=$.parentElement||$);const i=$.closest("p");if(i){const m={left:"left",center:"center",right:"right"};i.style.textAlign=m[p]}},C=(p,E)=>{if(!t){c.warn("Editor element not found");return}t.focus();const{selection:P,range:$}=o();if(!P||!$){c.warn("Invalid selection");return}h($,P);const i={bold:()=>f($,"strong"),italic:()=>f($,"em"),underline:()=>f($,"u"),strikeThrough:()=>f($,"s"),justifyLeft:()=>_("left"),justifyCenter:()=>_("center"),justifyRight:()=>_("right"),createLink:()=>E&&f($,"a",{href:E,target:"_blank"}),backColor:()=>E&&y($,{backgroundColor:E})};try{const m=i[p];m?m():c.warn(`Unknown style: ${p}`)}catch(m){c.error(`Failed to apply style ${p}:`,m);try{document.execCommand(p,!1,E)}catch(g){c.error("Fallback command failed:",g)}}},A=(p,E)=>{if(!t)return;t.focus();const P=window.getSelection();if(P?.rangeCount&&t.contains(P.getRangeAt(0).commonAncestorContainer)){const $=P.getRangeAt(0);P.removeAllRanges(),P.addRange($)}C(p,E)},w={toggleBold:()=>A("bold"),toggleItalic:()=>A("italic"),toggleUnderline:()=>A("underline"),toggleStrike:()=>A("strikeThrough"),alignLeft:()=>A("justifyLeft"),alignCenter:()=>A("justifyCenter"),alignRight:()=>A("justifyRight"),setLink:()=>{const p=window.prompt("URLを入力してください:");p&&A("createLink",p)},isActive:p=>{if(!t)return!1;const E=window.getSelection();if(!E?.rangeCount)return!1;const P=E.getRangeAt(0);return t.contains(P.commonAncestorContainer)?{bold:()=>N("strong"),italic:()=>N("em"),underline:()=>N("u"),strike:()=>N("s")}[p]?.()??!1:!1}},N=p=>{const{selection:E,range:P}=o();if(!E||!P)return!1;let $=P.commonAncestorContainer;for($.nodeType===window.Node.TEXT_NODE&&($=$.parentElement||$);$&&$!==t;){if($.nodeType===window.Node.ELEMENT_NODE&&$.tagName.toLowerCase()===p.toLowerCase())return!0;$=$.parentElement}return!1},z=()=>`
    border: 2px solid #3b82f6;
    border-radius: 8px;
    padding: 12px 16px;
    min-height: 60px;
    background: white;
    outline: none;
    line-height: 1.6;
    color: #1f2937;
    font-size: 14px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    transition: all 0.2s ease;
  `,T=p=>{Object.entries({"data-gramm":"false",spellcheck:"false",autocomplete:"off",autocorrect:"off",autocapitalize:"off"}).forEach(([P,$])=>{p.setAttribute(P,$)})},B=(p,E)=>{let P=null,$=null;p.addEventListener("focus",()=>{p.style.borderColor="#3b82f6",p.style.boxShadow="0 0 0 3px rgba(59,130,246,0.1), 0 1px 3px rgba(0,0,0,0.1)"}),p.addEventListener("blur",()=>{p.style.borderColor="#3b82f6",p.style.boxShadow="0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)"}),p.addEventListener("keydown",m=>{if(m.key==="Enter"&&!m.shiftKey){m.preventDefault();const g=window.getSelection();if(!g?.rangeCount)return;const b=g.getRangeAt(0),u=b.startContainer;let v=null;if(u.nodeType===window.Node.TEXT_NODE?v=u.parentElement?.closest("p")||null:u.nodeType===window.Node.ELEMENT_NODE&&(v=u.closest("p")||null),v){const D=document.createElement("p");D.innerHTML="<br>",v.insertAdjacentElement("afterend",D);const k=document.createRange();k.setStart(D,0),k.setEnd(D,0),g.removeAllRanges(),g.addRange(k)}else{const D=document.createElement("p");D.innerHTML="<br>",b.deleteContents(),b.insertNode(D);const k=document.createRange();k.setStart(D,0),k.setEnd(D,0),g.removeAllRanges(),g.addRange(k)}p.dispatchEvent(new Event("input",{bubbles:!0}))}}),p.addEventListener("input",()=>{P&&window.clearTimeout(P),P=window.setTimeout(()=>{const m=r(p.innerHTML);if(m!==p.innerHTML){const g=window.getSelection();let b=null;if(g&&g.rangeCount>0&&(b=g.getRangeAt(0).cloneRange()),p.innerHTML=m,b&&g)try{g.removeAllRanges(),g.addRange(b)}catch{const v=document.createRange();v.selectNodeContents(p),v.collapse(!1),g.removeAllRanges(),g.addRange(v)}}E?.(p.innerHTML)},300)}),p.addEventListener("selectionchange",()=>{try{p.dispatchEvent(new CustomEvent("selectionchange"))}catch(m){c.warn("Selection change error:",m)}});const i=new globalThis.MutationObserver(()=>{$&&window.clearTimeout($),$=window.setTimeout(()=>{E?.(p.innerHTML)},100)});return i.observe(p,{childList:!0,subtree:!0,characterData:!0}),{saveTimeout:P,updateTimeout:$,observer:i}},I=(p,E,P)=>{const $=E.querySelector(".simple-editor-content");$&&$.remove();const i=document.createElement("div");i.className="simple-editor-content",i.contentEditable="true";const m=r(p);i.innerHTML=m,i.style.cssText=z(),T(i);const{saveTimeout:g,updateTimeout:b,observer:u}=B(i,P);return E.appendChild(i),t=i,{element:i,getHTML:()=>i.innerHTML,setContent:v=>i.innerHTML=v,destroy:()=>{window.clearTimeout(g),window.clearTimeout(b),u.disconnect(),i.remove(),t=null},isActive:v=>w.isActive(v),isInitialized:!0,isDestroyed:!1,isFocused:!1,chain:()=>({focus:()=>({toggleMark:v=>({run:()=>{({bold:w.toggleBold,italic:w.toggleItalic,underline:w.toggleUnderline,strike:w.toggleStrike})[v]?.()}}),setTextAlign:v=>({run:()=>{({left:w.alignLeft,center:w.alignCenter,right:w.alignRight})[v]?.()}})})})}},d=(p,E,P)=>{try{return E.innerHTML="",I(p,E,P)}catch($){throw c.error("Editor init error:",$),$}},a=()=>{if(t)try{t.remove(),t=null}catch(p){c.error("Editor destroy error:",p)}},l=()=>!!t;return e.onBeforeUnmount(()=>a()),{initEditor:d,destroyEditor:a,getEditor:()=>t,isEditorReady:l}}var lc=Object.defineProperty,ic=(t,r,o)=>r in t?lc(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,dc=(t,r,o)=>ic(t,r+"",o);function Io(t,r,o=100){const n=new Map;return(...s)=>{const f=r?r(...s):JSON.stringify(s);if(n.has(f))return c.debug("メモ化キャッシュヒット:",f),n.get(f);const y=t(...s);if(n.size>=o){const h=n.keys().next().value;h&&n.delete(h)}return n.set(f,y),c.debug("メモ化キャッシュ保存:",f),y}}const lo={findComponent:Io((t,r)=>{for(const o of t){if(o.id===r)return o;if(o.nested_parts){const n=lo.findComponent(o.nested_parts,r);if(n)return n}}return null},(t,r)=>`${r}_${t.length}_${t.map(o=>o.id).join("_")}`,50),getComponentPath:Io((t,r,o=[])=>{for(let n=0;n<t.length;n++){const s=t[n],f=[...o,n];if(s.id===r)return f;if(s.nested_parts){const y=lo.getComponentPath(s.nested_parts,r,f);if(y)return y}}return null},(t,r,o)=>`path_${r}_${t.length}_${o?.join("_")||""}`,30),getComponentDepth:Io((t,r,o=0)=>{for(const n of t){if(n.id===r)return o;if(n.nested_parts){const s=lo.getComponentDepth(n.nested_parts,r,o+1);if(s>=0)return s}}return-1},(t,r,o=0)=>`depth_${r}_${o}_${t.length}`,30)};function cc(t,r){let o=null;return(...n)=>{o&&clearTimeout(o),o=setTimeout(()=>{t(...n),o=null},r)}}class pc{constructor(){dc(this,"caches",new Map)}getCache(r){return this.caches.has(r)||this.caches.set(r,new Map),this.caches.get(r)}clearCache(r){this.caches.has(r)&&(this.caches.get(r).clear(),c.debug(`キャッシュクリア: ${r}`))}clearAllCaches(){this.caches.forEach((r,o)=>{r.clear(),c.debug(`キャッシュクリア: ${o}`)}),c.debug("全キャッシュクリア完了")}getCacheStats(){const r={};return this.caches.forEach((o,n)=>{r[n]=o.size}),r}}new pc;function mc(t,r){const o=performance.now(),n=t(),f=performance.now()-o;return f>100?c.warn(`⚠️ 重い処理を検出: ${r} (${f.toFixed(2)}ms)`):c.debug(`⚡ パフォーマンス: ${r} (${f.toFixed(2)}ms)`),n}var uc=Object.defineProperty,gc=(t,r,o)=>r in t?uc(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,Ir=(t,r,o)=>gc(t,typeof r!="symbol"?r+"":r,o);class Dr{constructor(){Ir(this,"events",new Map),Ir(this,"isEnabled",!0)}on(r,o){this.events.has(r)||this.events.set(r,new Set);const n=this.events.get(r);return n.add(o),()=>{n.delete(o)}}emit(r,o){if(!this.isEnabled){c.warn(`EventBus: 無効化されているため ${r} イベントを無視`);return}const n=this.events.get(r);if(!n||n.size===0){c.warn(`EventBus: ${r} イベントのリスナーが見つかりません`);return}const s=[];n.forEach(f=>{try{const y=f(o);y instanceof Promise&&s.push(y)}catch(y){c.error(`EventBus: ${r} イベントリスナーでエラー`,y)}}),s.length>0&&Promise.allSettled(s).then(f=>{f.forEach((y,h)=>{y.status==="rejected"&&c.error(`EventBus: ${r} 非同期リスナー[${h}]でエラー`,y.reason)})})}off(r){this.events.delete(r)}clear(){this.events.clear()}disable(){this.isEnabled=!1}enable(){this.isEnabled=!0}getListenerCount(r){if(r)return this.events.get(r)?.size||0;let o=0;return this.events.forEach(n=>{o+=n.size}),o}}const Re=new Dr,fc={addArrayItem:(t,r)=>{Re.emit("addArrayItem",{componentId:t,arrayKey:r})},addZForArrayItem:(t,r,o)=>{Re.emit("addZForArrayItem",{componentId:t,arrayName:r,insertIndex:o})},removeZForArrayItem:(t,r,o)=>{Re.emit("removeZForArrayItem",{componentId:t,arrayName:r,index:o})},reorderZForArrayItem:(t,r,o,n)=>{Re.emit("reorderZForArrayItem",{componentId:t,arrayName:r,fromIndex:o,toIndex:n})},editZForArrayItem:(t,r,o)=>{Re.emit("editZForArrayItem",{componentId:t,arrayName:r,index:o})},deleteNestedPart:t=>{Re.emit("deleteNestedPart",{pathString:t})},openNestedEditor:t=>{Re.emit("openNestedEditor",{pathString:t})},openNestedPartSelector:(t,r)=>{Re.emit("openNestedPartSelector",{pathString:t,position:r})},startRichTextEdit:(t,r,o)=>Re.emit("startRichTextEdit",{componentId:t,paramName:r,currentValue:o}),selectImage:(t,r)=>{Re.emit("selectImage",{componentId:t,paramName:r})},uploadImage:(t,r,o)=>{Re.emit("uploadImage",{file:t,category:r,componentId:o})}};function hc(t,r,o){const n=t.includes("[DEBUG]"),s=/\d+/.test(t),f=t.replace(/\[DEBUG\]|\d+/g,"").trim();if(r.toLowerCase().includes("url")||r.toLowerCase().includes("image")||r.toLowerCase().includes("icon")||t.startsWith("/")||t.includes(".jpg")||t.includes(".png")||t.includes(".gif")||t.includes(".svg"))return t;let y;return r==="name"&&t.includes("ネスト")?y=`新しいネスト項目${o}`:r==="title"&&t.includes("アイテム")?y=`新しいアイテム${o}`:s?y=`${f}${o}`:y=t.startsWith("新しい")?`${t}${o}`:`新しい${r}${o}`,n&&(y+=" [DEBUG]"),y}function yc(t,r){const o=new Dr,n=nc(t,o),s=ac(),f=So(),y=sc();o.on("addZForArrayItem",({componentId:d,arrayName:a,insertIndex:l})=>{try{const p=d.split("_");let E,P=null;const $=h(n.editablePageData.value,d),i=$&&$.id===d;if(p.length>=3&&/^\d+$/.test(p[p.length-1])&&!i){const u=parseInt(p[p.length-1]);let v="",D="";const k=`_${u}`,S=d.slice(0,-k.length),V=p.slice(0,4).join("_");if(S.startsWith(V+"_"))D=V,v=S.slice(V.length+1);else{const O=S.lastIndexOf("_");O!==-1&&(v=S.slice(O+1),D=S.slice(0,O))}if(!v){const O=d.match(/^(.+)_([^_]+_[^_]+)_(\d+)$/);O?(D=O[1],v=O[2]):(D=p.slice(0,-2).join("_"),v=p[p.length-2])}const F=D,X=h(n.editablePageData.value,D);if(X)if(X[v]&&X[v][u])P=X[v][u],P&&!Array.isArray(P[a])&&(P[a]=[]),E=P?P[a]:void 0;else throw new Error(`Parent array or index not found: ${v}[${u}]`);else throw new Error(`Parent component not found: ${D}`)}else P=$||h(n.editablePageData.value,d),P&&(Array.isArray(P[a])||(P[a]=[]),E=P[a]);if(!P||!E)throw new Error(`Target component or array not found: ${d}`);const m=n.localParts.value&&n.localParts.value.length>0?n.localParts.value:[],b={id:no(m).generateUniqueId()};if(E&&E.length>0){const u=E[0];Object.keys(u).forEach(v=>{if(v!=="id"&&!b[v]){const D=u[v];typeof D=="string"?b[v]=hc(D,v,E.length+1):Array.isArray(D)?b[v]=[]:typeof D=="number"?b[v]=D===0?0:Math.floor(Math.random()*100)+1:typeof D=="boolean"?b[v]=!1:b[v]=D}})}else{const u=a.replace(/_/g,"");b.name=`新しい${u}${(E?.length||0)+1}`}E.splice(l,0,b),r("update:page",n.editablePageData.value)}catch(p){alert(`エラーが発生しました: ${p instanceof Error?p.message:String(p)}`)}}),o.on("reorderZForArrayItem",({componentId:d,arrayName:a,fromIndex:l,toIndex:p})=>{try{const E=d.split("_");let P,$=null;const i=h(n.editablePageData.value,d),m=i&&i.id===d;if(E.length>=3&&/^\d+$/.test(E[E.length-1])&&!m){const b=parseInt(E[E.length-1]);let u="",v="";const D=`_${b}`,k=d.slice(0,-D.length),S=E.slice(0,4).join("_");if(k.startsWith(S+"_"))v=S,u=k.slice(S.length+1);else{const F=k.lastIndexOf("_");F!==-1&&(u=k.slice(F+1),v=k.slice(0,F))}if(!u){const F=d.match(/^(.+)_([^_]+_[^_]+)_(\d+)$/);F?(v=F[1],u=F[2]):(v=E.slice(0,-2).join("_"),u=E[E.length-2])}const V=h(n.editablePageData.value,v);if(V&&V[u]&&V[u][b])$=V[u][b],$&&!Array.isArray($[a])&&($[a]=[]),P=$?$[a]:void 0;else throw new Error(`Parent array or index not found for reorder: ${u}[${b}]`)}else $=i||h(n.editablePageData.value,d),$&&(Array.isArray($[a])||($[a]=[]),P=$[a]);if(!$||!P)throw new Error(`Target component or array not found for reorder: ${d}`);const[g]=P.splice(l,1);P.splice(p,0,g),r("update:page",n.editablePageData.value)}catch(E){alert(`並べ替えでエラーが発生しました: ${E instanceof Error?E.message:String(E)}`)}});const h=(d,a)=>mc(()=>lo.findComponent(d,a),`findComponent(${a})`),_=cc(d=>{r("update:page",d),c.debug("💾 ページデータ更新をemit")},100),C=(d,a)=>{const l=()=>{d._isZForItem&&delete d._isZForItem,d._parentComponentId&&delete d._parentComponentId,d._arrayName&&delete d._arrayName,d._arrayIndex&&delete d._arrayIndex,d.module_name&&delete d.module_name,c.debug("🧹 z-for配列アイテムのメタデータクリーンアップ完了:",{editorId:a,cleanedProperties:["_isZForItem","_parentComponentId","_arrayName","_arrayIndex","module_name"]})},p=()=>{l(),o.off("editorClosed")};o.on("editorClosed",p),c.debug("🔧 z-for配列アイテム編集クリーンアップ処理を設定:",{editorId:a,hasMetadata:{_isZForItem:!!d._isZForItem,_parentComponentId:!!d._parentComponentId,_arrayName:!!d._arrayName,_arrayIndex:!!d._arrayIndex}})},A=(d,a,l)=>{c.debug(`🔍 updateNestedComponent: 検索開始 - targetId: ${a}, components数: ${d.length}`);for(let p=0;p<d.length;p++){const E=d[p];if(c.debug(`🔍 チェック中: ${E.id} === ${a} ?`),E.id===a)return c.debug(`✅ コンポーネント発見 - 更新実行: ${a}`),c.debug("🔍 更新前:",E),c.debug("🔍 更新後:",l),d[p]=l,!0;if(E.nested_parts&&Array.isArray(E.nested_parts)&&(c.debug(`🔍 nested_parts内を検索: ${E.id}`),A(E.nested_parts,a,l)))return!0;for(const[P,$]of Object.entries(E))if(Array.isArray($)&&P!=="nested_parts"){c.debug(`🔍 配列プロパティ検索: ${E.id}.${P}`);for(const i of $)if(i&&typeof i=="object"){for(const[m,g]of Object.entries(i))if(Array.isArray(g)&&(c.debug(`🔍 スロット検索: ${E.id}.${P}[].${m}`),A(g,a,l)))return!0}}}return c.debug(`❌ コンポーネントが見つかりませんでした: ${a}`),!1},w=(d,a)=>{for(let l=0;l<d.length;l++){if(d[l].id===a)return d.splice(l,1),!0;if(d[l].nested_parts&&Array.isArray(d[l].nested_parts)&&w(d[l].nested_parts,a))return!0;for(const[p,E]of Object.entries(d[l]))if(Array.isArray(E)&&p!=="nested_parts"){for(const P of E)if(P&&typeof P=="object"){for(const[$,i]of Object.entries(P))if(Array.isArray(i)&&w(i,a))return!0}}}return!1},N={addPart:(d,a)=>{c.debug("🔧 addPart呼び出し:",{part:d,position:a,currentPageData:n.editablePageData.value});const l=[...n.editablePageData.value];l.splice(a,0,d),n.editablePageData.value=l,c.debug("🔧 新しいページデータ:",l),r("update:page",l)},deletePart:d=>{if(window.confirm("このパーツを削除しますか？")){const a=s.component.deleteComponent(n.editablePageData.value,d);n.editablePageData.value=a,r("update:page",a)}},duplicatePart:d=>{const a=n.editablePageData.value[d];if(a){const l=s.component.duplicateComponent(a),p=[...n.editablePageData.value];p.splice(d+1,0,l),n.editablePageData.value=p,r("update:page",p)}},reorderParts:d=>{n.editablePageData.value=d,r("update:page",d)},movePart:(d,a)=>{const l=[...n.editablePageData.value],[p]=l.splice(d,1);l.splice(a,0,p),n.editablePageData.value=l,r("update:page",l)},reorderNestedParts:(d,a)=>{const l=s.string.parseHierarchyPath(d),p=JSON.parse(JSON.stringify(n.editablePageData.value)),E=s.component.findComponentByPath(p,l);E?(E.nested_parts=[...a],n.editablePageData.value=p,r("update:page",p)):c.error("❌ 親コンポーネントが見つかりません:",{pathString:d,path:l})},moveNestedPart:(d,a,l)=>{const p=s.string.parseHierarchyPath(d),E=JSON.parse(JSON.stringify(n.editablePageData.value)),P=s.component.findComponentByPath(E,p);if(P?.nested_parts&&P.nested_parts.length>Math.max(a,l)){const $=[...P.nested_parts];if(a>=0&&a<$.length&&l>=0&&l<$.length&&a!==l){const[i]=$.splice(a,1);$.splice(l,0,i),P.nested_parts=$,n.editablePageData.value=E,r("update:page",E)}else c.error("❌ 無効なインデックス:",{fromIndex:a,toIndex:l,arrayLength:$.length})}else c.error("❌ 親コンポーネントまたはnested_partsが見つかりません:",{pathString:d,path:p})},moveNestedPartBetweenLevels:(d,a,l,p)=>{const E=s.string.parseHierarchyPath(d),P=s.string.parseHierarchyPath(l),$=[...n.editablePageData.value],i=s.component.findComponentByPath($,E);if(!i?.nested_parts)return;const[m]=i.nested_parts.splice(a,1),g=s.component.findComponentByPath($,P);g&&(g.nested_parts||(g.nested_parts=[]),g.nested_parts.splice(p,0,m),n.editablePageData.value=$,r("update:page",$))},moveNestedPartById:(d,a,l)=>{c.debug(`🔧 moveNestedPartById: 親ID=${d}, ${a} → ${l}`);const p=JSON.parse(JSON.stringify(n.editablePageData.value)),E=h(p,d);if(E?.nested_parts&&E.nested_parts.length>Math.max(a,l)){const P=[...E.nested_parts];if(a>=0&&a<P.length&&l>=0&&l<P.length&&a!==l){const[$]=P.splice(a,1);P.splice(l,0,$),E.nested_parts=P,n.editablePageData.value=p,r("update:page",p),c.debug(`  - ✅ 並べ替え成功: ${$.id} を位置 ${l} に移動`)}else c.error("❌ 無効なインデックス:",{fromIndex:a,toIndex:l,arrayLength:P.length})}else c.error("❌ 親コンポーネントまたはnested_partsが見つかりません:",{parentComponentId:d})},moveNestedPartBetweenLevelsById:(d,a,l,p)=>{c.debug(`🔧 moveNestedPartBetweenLevelsById: ${d}[${a}] → ${l}[${p}]`);const E=JSON.parse(JSON.stringify(n.editablePageData.value)),P=h(E,d);if(!P?.nested_parts){c.error("❌ ソース親コンポーネントが見つかりません:",d);return}const[$]=P.nested_parts.splice(a,1),i=h(E,l);if(!i){c.error("❌ ターゲット親コンポーネントが見つかりません:",l);return}i.nested_parts||(i.nested_parts=[]),i.nested_parts.splice(p,0,$),n.editablePageData.value=E,r("update:page",E),c.debug(`  - ✅ 階層間移動成功: ${$.id} を ${l} の位置 ${p} に移動`)},moveZForNestedPart:(d,a,l)=>{c.debug(`🔥🔧 moveZForNestedPart: パス=${d}, ${a} → ${l}`);const p=d.match(/^(\w+)\.(\w+)\[(\d+)\]\.(\w+)$/);if(c.debug("🔥 パス解析結果:",{parentPath:d,pathMatch:p}),!p){c.error("❌ 無効なz-forネストパーツパス:",d);return}const[,E,P,$,i]=p,m=parseInt($);c.debug("🔥 解析済み情報:",{componentId:E,arrayName:P,arrayIndex:m,slotName:i});const g=JSON.parse(JSON.stringify(n.editablePageData.value)),b=h(g,E);if(c.debug("🔥 コンポーネント検索結果:",b),!b){c.error("❌ コンポーネントが見つかりません:",E);return}const u=b[P];if(c.debug("🔥 z-for配列:",{arrayName:P,array:u,isArray:Array.isArray(u),length:u?.length}),!Array.isArray(u)||m>=u.length){c.error("❌ 配列が見つかりません:",{arrayName:P,arrayIndex:m,arrayLength:u?.length});return}const v=u[m];if(c.debug("🔥 配列アイテム:",{arrayIndex:m,arrayItem:v}),!v||!v[i]||!Array.isArray(v[i])){c.error("❌ ネストパーツ配列が見つかりません:",{slotName:i,arrayItem:v,slot:v?.[i]});return}const D=v[i];if(c.debug("🔥 ネストパーツ配列:",{slotName:i,nestedParts:D,length:D.length}),a<0||a>=D.length||l<0||l>=D.length){c.error("❌ 無効なインデックス:",{fromIndex:a,toIndex:l,arrayLength:D.length});return}if(a===l){c.debug("📍 同じ位置のため移動なし");return}c.debug("🔥 並べ替え前:",D.map(S=>S.id));const[k]=D.splice(a,1);D.splice(l,0,k),c.debug("🔥 並べ替え後:",D.map(S=>S.id)),n.editablePageData.value=g,r("update:page",g),c.debug(`✅ z-for内ネストパーツ並べ替え成功: ${k.id} を位置 ${l} に移動`)},openEditor:d=>{const a=n.editablePageData.value[d];a&&n.openEditor(a,d)},saveComponent:d=>{const a=n.selectedComponentIndex.value;if(c.debug("🐛 saveComponent デバッグ:",{selectedIndex:a,selectedIndexType:typeof a,updatedComponentId:d.id,updatedComponentData:d,isZForItem:d._isZForItem}),d._isZForItem){c.debug("🔍 z-for配列アイテム保存開始");const l=d._parentComponentId,p=d._parentArrayName,E=d._parentIndex,P=d._arrayName,$=d._arrayIndex;c.debug("🔍 z-for保存パラメータ:",{parentComponentId:l,parentArrayName:p,parentIndex:E,arrayName:P,arrayIndex:$});const i=JSON.parse(JSON.stringify(n.editablePageData.value));if(l&&p&&E!==void 0){const m=h(i,l);if(m&&Array.isArray(m[p])){const g=m[p];if(E>=0&&E<g.length){const b=g[E];if(b[P]&&Array.isArray(b[P])){const u=b[P];if($>=0&&$<u.length){const{_isZForItem:v,_parentComponentId:D,_parentArrayName:k,_parentIndex:S,_arrayName:V,_arrayIndex:F,_parentType:X,_parentModuleName:O,type:L,module_name:U,...G}=d;u[$]={...u[$],...G},n.editablePageData.value=i,r("update:page",i),c.debug(`✅ ネストz-for配列アイテム保存完了 - ${p}[${E}].${P}[${$}]`)}else c.error(`❌ 子配列インデックス範囲外: ${$}`)}else c.error(`❌ 子配列が見つからない: ${P}`)}else c.error(`❌ 親配列インデックス範囲外: ${E}`)}else c.error(`❌ 親コンポーネントまたは親配列が見つからない: ${l}.${p}`)}else{const m=h(i,l);if(m&&Array.isArray(m[P])){const g=m[P];if($>=0&&$<g.length){const{_isZForItem:b,_parentComponentId:u,_arrayName:v,_arrayIndex:D,_zForTemplate:k,...S}=d;g[$]={...g[$],...S},n.editablePageData.value=i,r("update:page",i),c.debug(`✅ z-for配列アイテム保存完了 - ${P}[${$}]`)}else c.error(`❌ z-for配列インデックス範囲外: ${$}`)}else c.error(`❌ z-for親コンポーネントまたは配列が見つからない: ${l}.${P}`)}n.closeEditor();return}if(typeof a=="number"&&a>=0){const l=[...n.editablePageData.value];l[a]=d,n.editablePageData.value=l,r("update:page",l),c.debug(`✅ メインコンポーネント保存完了 - ID: ${d.id}`)}else if(typeof a=="string"){c.debug(`🔍 ネストコンポーネント保存開始 - 検索対象ID: ${a}`);const l=JSON.parse(JSON.stringify(n.editablePageData.value));c.debug("🔍 保存前のPageData:",JSON.stringify(l,null,2));const p=A(l,a,d);c.debug(`🔍 updateNestedComponent結果: ${p}`),c.debug("🔍 保存後のPageData:",JSON.stringify(l,null,2)),p?(n.editablePageData.value=l,r("update:page",l),c.debug(`✅ ネストコンポーネント保存完了 - ID: ${d.id}, パス: ${a}`)):c.error(`❌ ネストコンポーネント保存失敗 - ID: ${d.id}, パス: ${a}`)}else c.error(`❌ 無効なselectedIndex: ${a} (type: ${typeof a})`);n.closeEditor()},addNestedPart:(d,a,l)=>{c.debug(`🔧 addNestedPart: 親ID=${d}, 位置=${a}, 新コンポーネント=${l.id}`);const p=JSON.parse(JSON.stringify(n.editablePageData.value)),E=/^(.+)\.(.+)\[(\d+)\]\.(.+)$/,P=d.match(E);c.debug(`🔍 パス解析: ${d} -> zForMatch:`,P);let $=!1;if(P){const[,i,m,g,b]=P;c.debug("z-for内ネストパーツ追加:",{parentId:i,arrayName:m,arrayIndex:g,slotName:b,position:a});const u=h(p,i);if(u)if(c.debug(`✅ 親コンポーネント発見: ${u.id}`),c.debug(`🔍 配列チェック: ${m} ->`,u[m]),u[m]&&Array.isArray(u[m])){const v=u[m][parseInt(g)];c.debug(`🔍 配列アイテム[${g}]:`,v),v?(v[b]||(v[b]=[],c.debug(`🆕 スロット初期化: ${b}`)),c.debug(`🔍 スロット[${b}]現在の内容:`,v[b]),v[b].splice(a,0,l),c.debug(`✅ z-for内パーツ追加成功: ${l.id} -> スロット内容:`,v[b]),$=!0):c.debug(`❌ 配列アイテムが見つかりません: インデックス${g}`)}else c.debug(`❌ 配列が見つかりません: ${m}`);else c.debug(`❌ 親コンポーネントが見つかりません: ${i}`)}else{const i=h(p,d);i&&(i.nested_parts||(i.nested_parts=[]),i.nested_parts.splice(a,0,l),c.debug(`  - ✅ パーツ追加成功: ${l.id} を ${d} の位置 ${a} に追加`),c.debug("  - 追加後のnested_parts:",i.nested_parts.map(m=>m.id)),$=!0)}$?(n.editablePageData.value=p,r("update:page",p)):c.debug(`  - ❌ 親コンポーネントが見つかりません: ${d}`)},deleteNestedPart:d=>{if(window.confirm("このネストパーツを削除しますか？")){const a=JSON.parse(JSON.stringify(n.editablePageData.value)),l=/^(.+)\.(.+)\[(\d+)\]\.(.+)\[(\d+)\]$/,p=d.match(l);let E=!1;if(p){const[,P,$,i,m,g]=p;c.debug("z-for内ネストパーツ削除:",{parentId:P,arrayName:$,arrayIndex:i,slotName:m,partIndex:g});const b=h(a,P);if(b)if(c.debug(`✅ 削除対象の親コンポーネント発見: ${b.id}`),b[$]&&Array.isArray(b[$])){const u=b[$][parseInt(i)];u&&u[m]&&Array.isArray(u[m])?(c.debug(`🗑️ z-for内パーツ削除実行: ${m}[${g}]`),u[m].splice(parseInt(g),1),E=!0):c.debug(`❌ スロットまたはパーツが見つかりません: ${m}`)}else c.debug(`❌ 配列が見つかりません: ${$}`);else c.debug(`❌ 削除対象の親コンポーネントが見つかりません: ${P}`)}else E=w(a,d);E?(n.editablePageData.value=a,r("update:page",a)):c.debug(`❌ Component not found for deletion: ${d}`)}},startTiptapEdit:(d,a,l=[],p=0)=>{n.startTiptapEdit(d,a,l,p)},startSimpleTiptapEdit:(d,a)=>{n.startTiptapEdit(d,a,[],0)},stopTiptapEdit:()=>{n.stopTiptapEdit()},sendPageData:()=>{_(n.editablePageData.value)},sendCommonPartsData:()=>{r("update:commonParts",n.localCommonParts.value)},sendIndividualPartsData:()=>{r("update:individualParts",n.localIndividualParts.value)},addArrayItem:(d,a)=>{s.component.addArrayItem(d,a),_(n.editablePageData.value)},removeArrayItem:(d,a,l)=>{s.component.removeArrayItem(d,a,l),_(n.editablePageData.value)},resetPageData:()=>{n.editablePageData.value=Array.isArray(t.page)?[...t.page]:[],r("update:page",n.editablePageData.value)},resetPartsData:()=>{n.localParts.value=Array.isArray(t.parts)?[...t.parts]:[],r("update:parts",n.localParts.value)}},z={currentComponent:e.computed(()=>n.selectedComponent.value),currentTemplate:e.computed(()=>{const d=n.selectedComponent.value;return d?s.template.getTemplate(d.type,d.module_name,n.localParts.value):""}),currentFields:e.computed(()=>{const d=z.currentTemplate.value;return s.template.extractFields(d)}),currentSlots:e.computed(()=>{const d=z.currentTemplate.value;return s.template.extractSlots(d)}),renderComponent:d=>f.renderComponentWithoutSlot(d,(a,l)=>s.template.getTemplate(a,l,n.localParts.value)),renderPartPreview:d=>{if(!d)return"";try{let a=d;return a=a.replace(/\{\$([^:]+):([^}]*)\}/g,(l,p,E)=>E&&E.trim()?E:{title:"サンプルタイトル",text:"サンプルテキスト",content:"サンプルコンテンツ",heading:"見出し",description:"説明文",label:"ラベル",source:"情報源",tooltip:"ツールチップ"}[p]||`[${p}]`),a=a.replace(/\(\$([^:]+):([^)]+)\)/g,(l,p,E)=>E.split("|").filter($=>$.trim())[0]||""),a=a.replace(/\(\$([^:?]+)\?:([^)]*)\)/g,(l,p,E)=>E||""),a=a.replace(/z-slot="[^"]*"/g,""),a=a.replace(/z-for="[^"]*"/g,""),a=a.replace(/z-for-wrapper="[^"]*"/g,""),a}catch(a){return c.error("プレビューレンダリングエラー:",a),d}}},T=()=>{o.on("addArrayItem",({componentId:d,arrayKey:a})=>{try{if(c.debug(`EventBus: addArrayItem - componentId=${d}, arrayKey=${a}`),!d||!a)throw new Error("componentId または arrayKey が指定されていません");const l=h(n.editablePageData.value,d);if(!l)throw new Error(`Component not found: ${d}`);c.success(`Component found: ${l.id}, adding array item to ${a}`);const p=n.localParts.value&&n.localParts.value.length>0?n.localParts.value:[];p.length>0?no(p).addArrayItem(l,a):N.addArrayItem(l,a),r("update:page",n.editablePageData.value)}catch(l){c.error(`配列アイテム追加エラー: ${l}`,{componentId:d,arrayKey:a})}}),o.on("removeZForArrayItem",({componentId:d,arrayName:a,index:l})=>{try{c.debug(`EventBus: removeZForArrayItem - componentId=${d}, arrayName=${a}, index=${l}`),c.debug("🔥 DELETE - componentId:",d);const p=d.split("_");c.debug("🔥 DELETE - componentId parts:",p);let E;const P=h(n.editablePageData.value,d),$=P&&P.id===d;if(p.length>=3&&/^\d+$/.test(p[p.length-1])&&!$){const i=p.slice(0,-2).join("_"),m=p[p.length-2],g=p[p.length-1];c.debug("🔥 DELETE - ネスト形式検出:",{baseParentId:i,parentArrayName:m,parentIndex:g}),c.debug("ネストz-forアイテム削除:",{baseParentId:i,parentArrayName:m,parentIndex:g});let b=i,u=m;if(!h(n.editablePageData.value,i)){const k=[];for(let S=0;S<i.length;S++)i[S]==="_"&&k.push(S);if(k.length>=1){const S=k[k.length-1];b=i.substring(0,S),u=`${i.substring(S+1)}_${m}`,c.debug("🔥 DELETE - ネストz-for IDを修正:",{originalBaseParentId:i,realComponentId:b,realArrayPath:u,parentIndex:g})}}const D=h(n.editablePageData.value,b);if(D&&Array.isArray(D[u])){const k=D[u][parseInt(g)];c.debug("🔥 DELETE - Parent item:",k),c.debug("🔥 DELETE - Parent item target array name:",a),c.debug("🔥 DELETE - Parent item target array:",k?k[a]:void 0),k&&Array.isArray(k[a])&&(E=k[a])}}else{c.debug("🔥 DELETE - 通常形式検出:",d);const i=P||h(n.editablePageData.value,d);i&&Array.isArray(i[a])&&(E=i[a])}if(!E||l<0||l>=E.length)throw new Error(`Invalid target array or index: ${a}[${l}]`);E.splice(l,1),c.success(`z-for配列アイテム削除完了: ${a}[${l}]`),r("update:page",n.editablePageData.value)}catch(p){c.error(`z-for配列アイテム削除エラー: ${p}`,{componentId:d,arrayName:a,index:l})}}),o.on("editZForArrayItem",({componentId:d,arrayName:a,index:l})=>{try{c.debug(`EventBus: editZForArrayItem - componentId=${d}, arrayName=${a}, index=${l}`),c.debug("🔥 EDIT - componentId:",d);const p=d.split("_");c.debug("🔥 REORDER - componentId parts:",p);let E;const P=h(n.editablePageData.value,d),$=P&&P.id===d;if(p.length>=3&&/^\d+$/.test(p[p.length-1])&&!$){const i=p.slice(0,-2).join("_"),m=p[p.length-2],g=p[p.length-1];c.debug("🔥 REORDER - ネスト形式検出:",{baseParentId:i,parentArrayName:m,parentIndex:g}),c.debug("ネストz-forアイテム並び替え:",{baseParentId:i,parentArrayName:m,parentIndex:g});let b=i,u=m;if(!h(n.editablePageData.value,i)){const k=[];for(let S=0;S<i.length;S++)i[S]==="_"&&k.push(S);if(k.length>=1){const S=k[k.length-1];b=i.substring(0,S),u=`${i.substring(S+1)}_${m}`,c.debug("🔥 REORDER - ネストz-for IDを修正:",{originalBaseParentId:i,realComponentId:b,realArrayPath:u,parentIndex:g})}}const D=h(n.editablePageData.value,b);if(c.debug("🔥 Parent component found:",D?D.id:null),D&&Array.isArray(D[u])){const k=D[u][parseInt(g)];c.debug("🔥 Parent item:",k),c.debug("🔥 Parent item target array name:",a),c.debug("🔥 Parent item target array:",k?k[a]:void 0),k&&Array.isArray(k[a])&&(E=k[a])}}else{c.debug("🔥 REORDER - 通常形式検出:",d);const i=P||h(n.editablePageData.value,d);i&&Array.isArray(i[a])&&(E=i[a])}if(E&&l>=0&&l<E.length){const i=E[l];c.info(`z-for配列アイテム編集開始: ${d}.${a}[${l}]`,i)}else throw c.error("🔥 Invalid array or index:",{arrayName:a,index:l,arrayLength:E?.length}),new Error(`Invalid array or index: ${a}[${l}]`)}catch(p){c.error(`z-for配列アイテム編集エラー: ${p}`,{componentId:d,arrayName:a,index:l})}}),o.on("editZForArrayItem",({componentId:d,arrayName:a,index:l})=>{try{c.debug(`EventBus: editZForArrayItem - componentId=${d}, arrayName=${a}, index=${l}`);const p=h(n.editablePageData.value,d),E=a,P=l;if(!p){const b=d.split("_");c.debug("🔥 EDIT - componentId parts:",b);const u=h(n.editablePageData.value,d),v=u&&u.id===d;if(b.length>=3&&/^\d+$/.test(b[b.length-1])&&!v){const D=b.slice(0,-2).join("_"),k=b[b.length-2],S=b[b.length-1];c.debug("🔥 EDIT - ネスト形式検出:",{baseParentId:D,parentArrayName:k,parentIndex:S}),c.debug("ネストz-forアイテム編集:",{baseParentId:D,parentArrayName:k,parentIndex:S});let V=D,F=k;if(!h(n.editablePageData.value,D)){const L=[];for(let U=0;U<D.length;U++)D[U]==="_"&&L.push(U);if(L.length>=1){const U=L[L.length-1];V=D.substring(0,U),F=`${D.substring(U+1)}_${k}`,c.debug("🔥 EDIT - ネストz-for IDを修正:",{originalBaseParentId:D,realComponentId:V,realArrayPath:F,parentIndex:S})}}const O=h(n.editablePageData.value,V);if(O){const L=O[F];if(Array.isArray(L)&&Number(S)<L.length){const U=L[Number(S)];if(U[a]){const G=U[a];if(Array.isArray(G)&&l<G.length){const ne=G[l];ne._isZForItem=!0,ne._arrayName=a,ne._arrayIndex=l,ne._parentType=O.type,ne._parentModuleName=O.module_name,ne._parentComponentId=D,ne._parentArrayName=k,ne._parentIndex=Number(S);const de=ne.type,pe=ne.module_name;ne.type="z-for-item",ne.module_name=O.module_name,c.debug("子z-for配列アイテム編集:",{parentComponent:O.id,parentArrayName:k,parentIndex:Number(S),childArrayName:a,childIndex:l,childItem:ne}),n.openEditor(ne,`${d}_${a}_${l}`),C(ne,`${d}_${a}_${l}`);return}}}}}}if(!p)throw new Error(`Component not found: ${d}`);const $=p,i=$[a];if(!Array.isArray(i)||l<0||l>=i.length)throw new Error(`Invalid array or index: ${a}[${l}]`);const m=i[l];c.debug("🔍 z-for配列アイテム詳細:",{componentId:d,arrayName:a,index:l,item:m,itemKeys:Object.keys(m),itemType:m.type,itemModuleName:m.module_name,itemId:m.id,parentType:$.type,parentModuleName:$.module_name});const g={...m,id:`${d}_${a}_${l}`,type:m.type||$.type,module_name:m.module_name||$.module_name,_isZForItem:!0,_parentComponentId:d,_arrayName:a,_arrayIndex:l,_zForTemplate:null};c.debug("🔍 作成されたtempComponent:",{tempComponentId:g.id,tempComponentType:g.type,tempComponentModuleName:g.module_name,allKeys:Object.keys(g)}),c.debug("z-for配列アイテム編集: コンポーネント検索結果",{componentId:d,componentFound:!!$,componentType:$.type,componentModuleName:$.module_name,arrayName:a,arrayLength:i.length,index:l,itemKeys:Object.keys(m),tempComponentId:g.id}),n.openEditor(g,`${d}_${a}_${l}`),c.success(`z-for配列アイテム編集開始: ${a}[${l}]`)}catch(p){c.error(`z-for配列アイテム編集エラー: ${p}`,{componentId:d,arrayName:a,index:l})}}),o.on("deleteNestedPart",({pathString:d})=>{c.debug(`EventBus: deleteNestedPart - path=${d}`),N.deleteNestedPart(d)}),o.on("openNestedEditor",({pathString:d})=>{if(c.debug(`EventBus: openNestedEditor - path=${d}`),!d||typeof d!="string"){c.error("Invalid pathString:",d);return}const a=/^(.+)\.(.+)\[(\d+)\]\.(.+)\[(\d+)\]$/,l=d.match(a);let p=null;if(l){const[,E,P,$,i,m]=l;c.debug("z-for内パス解析:",{parentId:E,arrayName:P,arrayIndex:$,slotName:i,partIndex:m});const g=h(n.editablePageData.value,E);if(g&&g[P]&&Array.isArray(g[P])){const b=g[P][parseInt($)];b&&b[i]&&Array.isArray(b[i])&&(p=b[i][parseInt(m)],c.debug("z-for内ネストパーツを発見:",p))}}else p=h(n.editablePageData.value,d);p?(c.debug("Found component:",{id:p.id,type:p.type,module:p.module_name}),n.openEditor(p,d)):c.error(`Component not found with ID: ${d}`)}),o.on("openNestedPartSelector",({pathString:d,position:a})=>{c.debug(`EventBus: openNestedPartSelector - path=${d}, position=${a}`),n.openNestedPartSelector(d,a)})},B=d=>{["startTiptapEdit","stopTiptapEdit","openPartSelector","openNestedPartSelector","openNestedEditor","deleteNestedPart","addArrayItem","addZForArrayItem","removeZForArrayItem","reorderZForArrayItem","editZForArrayItem","handleZForDragStart","handleZForDragEnd","handleZForArrayItemDragOver","handleZForArrayItemDrop"].forEach($=>{delete window[$]});const l=`inst_${Math.random().toString(36).substr(2,9)}`,p={addArrayItem:($,i)=>{o.emit("addArrayItem",{componentId:$,arrayKey:i})},addZForArrayItem:($,i,m)=>{o.emit("addZForArrayItem",{componentId:$,arrayName:i,insertIndex:m})},removeZForArrayItem:($,i,m)=>{o.emit("removeZForArrayItem",{componentId:$,arrayName:i,index:m})},reorderZForArrayItem:($,i,m,g)=>{o.emit("reorderZForArrayItem",{componentId:$,arrayName:i,fromIndex:m,toIndex:g})},editZForArrayItem:($,i,m)=>{o.emit("editZForArrayItem",{componentId:$,arrayName:i,index:m})},deleteNestedPart:$=>{o.emit("deleteNestedPart",{pathString:$})},openNestedEditor:$=>{o.emit("openNestedEditor",{pathString:$})},openNestedPartSelector:($,i)=>{o.emit("openNestedPartSelector",{pathString:$,position:i})}};window[`startTiptapEdit_${l}`]=d||N.startSimpleTiptapEdit,window[`stopTiptapEdit_${l}`]=N.stopTiptapEdit,window[`openPartSelector_${l}`]=$=>n.openPartSelector($),window[`openNestedPartSelector_${l}`]=p.openNestedPartSelector,window[`openNestedEditor_${l}`]=p.openNestedEditor,window[`deleteNestedPart_${l}`]=p.deleteNestedPart,window[`addArrayItem_${l}`]=p.addArrayItem,window.startTiptapEdit=d||N.startSimpleTiptapEdit,window.stopTiptapEdit=N.stopTiptapEdit,window.openPartSelector=$=>n.openPartSelector($),window.openNestedPartSelector=p.openNestedPartSelector,window.openNestedEditor=p.openNestedEditor,window.deleteNestedPart=p.deleteNestedPart,window.addArrayItem=p.addArrayItem,window.addZForArrayItem=p.addZForArrayItem,window.removeZForArrayItem=p.removeZForArrayItem,window.reorderZForArrayItem=p.reorderZForArrayItem,window.editZForArrayItem=p.editZForArrayItem;let E=null,P=null;window.handleZForDragStart=($,i,m,g)=>{const b=$.target;if(c.debug("🔥 z-for drag start called",{target:b,componentId:i,arrayName:m,index:g}),b.tagName==="BUTTON"||b.tagName==="A"||b.closest("button, a")){c.debug("🔥 z-for: クリック可能要素からのドラッグをブロック"),$.preventDefault();return}$.stopPropagation(),E={componentId:i,arrayName:m,index:g},c.debug("🔥 z-for dragged item set:",E);const u=b.closest(".zero-code-z-for-item-wrapper");u?(c.debug("🔥 z-for item wrapper found:",u),u.style.opacity="0.5",u.style.transform="scale(0.95)",u.classList.add("dragging")):(c.debug("🔥 z-for item wrapper not found, using target"),b.style.opacity="0.5"),$.dataTransfer.effectAllowed="move",$.dataTransfer.setData("text/html",b.outerHTML),c.debug("z-for drag start",{componentId:i,arrayName:m,index:g})},window.handleZForDragEnd=$=>{const i=$.target,m=i.closest(".zero-code-z-for-item-wrapper");m?(m.style.opacity="1",m.style.transform="scale(1)",m.classList.remove("dragging")):i.style.opacity="1",document.querySelectorAll(".z-for-item-wrapper.drag-over").forEach(g=>{g.classList.remove("drag-over")}),setTimeout(()=>{E=null,c.debug("z-for drag end - draggedItem reset")},50),c.debug("z-for drag end")},window.handleZForArrayItemDragOver=$=>{$.preventDefault(),$.dataTransfer.dropEffect="move";const m=$.currentTarget.closest(".zero-code-z-for-item-wrapper");m&&!m.classList.contains("dragging")&&(document.querySelectorAll(".z-for-item-wrapper.drag-over").forEach(g=>{g.classList.remove("drag-over")}),m.classList.add("drag-over"))},window.handleZForArrayItemDrop=$=>{$.preventDefault(),$.stopPropagation();const i=$.currentTarget;c.debug("🔥 handleZForArrayItemDrop called",{target:i,draggedItem:E});const m=i.closest(".zero-code-z-for-item-wrapper");if(m&&m.classList.remove("drag-over"),!E){c.error("🔥 No dragged item found in drop handler"),c.warn("No dragged item found");return}c.debug("🔥 Dragged item found:",E);const g=m?.getAttribute("data-component-id")||i.getAttribute("data-component-id"),b=m?.getAttribute("data-array-name")||i.getAttribute("data-array-name"),u=m?.getAttribute("data-item-index")||i.getAttribute("data-item-index"),v=parseInt(u||"0");E.componentId===g&&E.arrayName===b&&E.index!==v&&(c.debug("🔥 z-for reorder executing:",{componentId:E.componentId,arrayName:E.arrayName,fromIndex:E.index,toIndex:v}),fc.reorderZForArrayItem(E.componentId,E.arrayName,E.index,v),c.debug("🔥 z-for reorder completed"),c.success("z-for array item reordered",{from:E.index,to:v})),E=null},window.handleNestedPartDragStart=$=>{c.debug("🔥 handleNestedPartDragStart called",$.target);const i=$.target;if(i.tagName==="BUTTON"||i.tagName==="A"||i.closest("button, a")){c.debug("🔥 クリック可能要素からのドラッグをブロック"),$.preventDefault();return}const m=i.closest(".z-for-nested-part");if(m){const g=m.getAttribute("data-nested-path"),b=m.getAttribute("data-slot-name"),u=m.getAttribute("data-part-index");c.debug("🔥 z-forネストパーツドラッグ情報:",{nestedPath:g,slotName:b,partIndex:u}),g&&b&&u!==null&&(P={path:g,slotName:b,index:parseInt(u)},m.classList.add("dragging"),m.style.opacity="0.5",c.debug("🔥 draggingクラス追加:",m),$.dataTransfer.effectAllowed="move",$.dataTransfer.setData("text/html",m.outerHTML),c.debug("🔥 z-for nested part drag start",P),c.debug("z-for nested part drag start",P))}else c.debug("🔥 z-for内ネストパーツではない:",i.classList.toString())},window.handleNestedPartDragEnd=$=>{const m=$.target.closest(".z-for-nested-part");m&&(m.classList.remove("dragging"),m.style.opacity="1"),document.querySelectorAll(".z-for-nested-part.drag-over").forEach(g=>{g.classList.remove("drag-over")}),P=null,c.debug("z-for nested part drag end")},window.handleNestedPartDragOver=$=>{$.preventDefault(),$.dataTransfer.dropEffect="move";const m=$.currentTarget.closest(".z-for-nested-part");m&&!m.classList.contains("dragging")&&(document.querySelectorAll(".z-for-nested-part.drag-over").forEach(g=>{g.classList.remove("drag-over")}),m.classList.add("drag-over"))},window.handleNestedPartDrop=$=>{c.debug("🔥 handleNestedPartDrop called",$.currentTarget),$.preventDefault();const i=$.currentTarget,m=i.closest(".z-for-nested-part")||i.closest(".nested-component");if(m&&m.classList.remove("drag-over"),!P){c.debug("🔥 No dragged nested part found"),c.warn("No dragged nested part found");return}const g=i.getAttribute("data-slot-name"),b=i.getAttribute("data-part-index");if(c.debug("🔥 ドロップ先情報:",{dropSlotName:g,dropPartIndex:b,draggedNestedPart:P}),g&&b!==null){const u=parseInt(b);if(g===P.slotName){const v=P.path.match(/^(.+\.\w+\[\d+\]\.\w+)\[\d+\]$/);if(c.debug("🔥 パス解析:",{path:P.path,pathMatch:v}),v){const D=v[1];c.debug("🔥 並べ替え実行:",{parentPath:D,fromIndex:P.index,toIndex:u}),c.debug("z-for nested part reorder",{parentPath:D,fromIndex:P.index,toIndex:u}),N.moveZForNestedPart(D,P.index,u)}}else c.debug("🔥 異なるスロット間の移動は未サポート:",{dropSlotName:g,draggedSlotName:P.slotName})}else c.debug("🔥 ドロップ先の情報が不完全:",{dropSlotName:g,dropPartIndex:b});P=null},c.debug("グローバル関数を安全に公開完了")},I=()=>{c.debug("useZeroCode クリーンアップ実行")};return{state:{editablePageData:n.editablePageData,localParts:n.localParts,localCommonParts:n.localCommonParts,localIndividualParts:n.localIndividualParts,activeTab:n.activeTab,dataTab:n.dataTab,showEditor:n.showEditor,showPartSelector:n.showPartSelector,showNestedPartSelector:n.showNestedPartSelector,selectedComponent:n.selectedComponent,selectedComponentIndex:n.selectedComponentIndex,editingText:n.editingText,insertPosition:n.insertPosition,nestedInsertPath:n.nestedInsertPath,nestedInsertPosition:n.nestedInsertPosition},computed:{currentComponentIndex:n.currentComponentIndex,pageDataLength:n.pageDataLength,hasSelectedComponent:n.hasSelectedComponent,isEditing:n.isEditing,isTiptapEditing:n.isTiptapEditing,...z},actions:N,utils:s,templateProcessor:f,simpleEditor:y,switchToTab:n.switchToTab,setDataTab:n.setDataTab,openEditor:n.openEditor,closeEditor:n.closeEditor,openPartSelector:n.openPartSelector,closePartSelector:n.closePartSelector,openNestedPartSelector:n.openNestedPartSelector,closeNestedPartSelector:n.closeNestedPartSelector,setupEventListeners:T,exposeGlobalFunctions:B,cleanup:I}}const Tr={parts:{common:[{type:"title",description:"タイトル系のコンポーネント",module:[{title:"title_1_1",category:"common",description:"メインタイトル（z-for、z-slot対応版）",tags:["title","z-for","z-slot","nested"],body:`
<div class="m_titleA ($state:s_state1|s_state2) ($variant:s_state3|s_state4|)">
  <h1 class="m_titleA__title">{$title:メインタイトルテキスト}</h1>
  <div class="m_titleA__label ($label_state?:s_state5|s_state6|s_state7)">{$label:ラベルテキスト}</div>
  <div z-slot="nested_parts" class="m_titleA__contents"></div>
  <div><img src="($image_url:/img/hero_image.jpg)" alt="($image_alt:画像の説明テキスト)"></div>
  <div class="m_titleA__card" z-for-wrapper="cards">
    <div z-for="cards" class="m_titleA__cardList ($card_state:s_state1|s_state2)">
      <div>{$card_title:カードアイテム1}</div>
      <div>{$card_desc:カードアイテム2}</div>
      <div z-slot="nested_parts"></div>
    </div>
  </div>
  <div class="m_titleA__category ($category:news,blog,event,product,service)">
    <span>カテゴリ選択</span>
  </div>
  <div class="m_titleA__tags ($tags?:important,featured,popular,trending,new)">
    <span>タグ選択（複数）</span>
  </div>
</div>`},{title:"title_1_2",category:"common",description:"シンプルタイトル",tags:["title","simple"],body:`
<div class="m_titleB">
  <h2 class="m_titleB__title">{$title:サブタイトルテキスト}</h2>
  <p class="m_titleB__subtitle">{$subtitle:サブタイトル説明文}</p>
</div>`}]},{type:"hero",description:"ヒーロー系のコンポーネント",module:[{title:"hero_1_1",category:"common",description:"メインヒーロー（配列カード対応）",tags:["hero","z-for","cards"],body:`
<div class="m_heroA ($layout:full|contained) ($theme:light|dark)">
  <div class="m_heroA__background">
    <img src="($bg_image:/img/hero_image.jpg)" alt="($bg_alt:ヒーロー背景画像)">
  </div>
  <div class="m_heroA__content">
    <h1 class="m_heroA__title">{$title:ヒーローメインタイトル}</h1>
    <p class="m_heroA__description">{$description:ヒーロー説明文がここに入ります}</p>
    <div class="m_heroA__actions">
      <a href="($cta_url:#)" class="m_heroA__cta ($cta_style:primary|secondary)">{$cta_text:今すぐ始める}</a>
    </div>
  </div>
  <div class="m_heroA__features" z-for-wrapper="features">
    <div z-for="features" class="m_heroA__feature">
      <div class="m_heroA__feature-icon">
        <img src="($icon_url:/img/placeholder.jpg)" alt="($icon_alt:アイコン)">
      </div>
      <h3>{$feature_title:機能タイトル}</h3>
      <p>{$feature_description:機能の説明文}</p>
    </div>
  </div>
</div>`}]},{type:"content",description:"コンテンツ系のコンポーネント",module:[{title:"content_1_1",category:"common",description:"基本コンテンツブロック",tags:["content","text","simple"],body:`
<div class="m_contentA ($alignment:left|center|right) ($size:small|medium|large)">
  <div class="m_contentA__header">
    <h2 class="m_contentA__title">{$title:コンテンツタイトル}</h2>
    <p class="m_contentA__subtitle">{$subtitle:サブタイトル}</p>
  </div>
  <div class="m_contentA__body">
    <p class="m_contentA__text">{$content:ここにメインコンテンツが入ります。リッチテキスト編集に対応しています。}</p>
    <div class="m_contentA__image ($image_position:top|bottom|left|right)">
      <img src="($image_url:/img/placeholder.jpg)" alt="($image_alt:コンテンツ画像)">
    </div>
  </div>
  <div z-slot="nested_parts" class="m_contentA__nested"></div>
</div>`}]}],individual:[{type:"button",description:"ボタン系のコンポーネント",module:[{title:"button_1_1",category:"individual",description:"基本ボタン",tags:["button","cta","action"],body:`
<div class="m_buttonA">
  <a href="($url:#)" class="m_buttonA__link ($style:primary|secondary|outline) ($size:small|medium|large)">
    {$text:ボタンテキスト}
  </a>
</div>`},{title:"button_1_2",category:"individual",description:"アイコン付きボタン",tags:["button","icon","cta"],body:`
<div class="m_buttonB">
  <button class="m_buttonB__button ($variant:filled|outline|text) ($color:primary|secondary|success|warning|error)">
    <span class="m_buttonB__icon ($icon_position:left|right)">
      <img src="($icon_url:/img/placeholder.jpg)" alt="($icon_alt:アイコン)">
    </span>
    <span class="m_buttonB__text">{$text:アイコンボタン}</span>
  </button>
</div>`}]},{type:"card",description:"カード系のコンポーネント",module:[{title:"card_1_1",category:"individual",description:"基本カード（配列対応）",tags:["card","z-for","list"],body:`
<div class="m_cardA ($layout:grid|list) ($columns:1|2|3|4)">
  <div class="m_cardA__container" z-for-wrapper="items">
    <div z-for="items" class="m_cardA__item ($card_style:flat|elevated|outline)">
      <div class="m_cardA__image">
        <img src="($image_url:/img/placeholder.jpg)" alt="($image_alt:カード画像)">
      </div>
      <div class="m_cardA__content">
        <h3 class="m_cardA__title">{$title:カードタイトル}</h3>
        <p class="m_cardA__description">{$description:カードの説明文がここに入ります}</p>
        <div class="m_cardA__meta">
          <span class="m_cardA__category ($category:news|blog|product)">{$category_label:カテゴリ}</span>
          <time class="m_cardA__date">{$date:2024-01-01}</time>
        </div>
      </div>
      <div class="m_cardA__actions">
        <a href="($link_url:#)" class="m_cardA__link">{$link_text:詳細を見る}</a>
      </div>
    </div>
  </div>
</div>`}]},{type:"form",description:"フォーム系のコンポーネント",module:[{title:"form_1_1",category:"individual",description:"基本フォーム",tags:["form","contact","input"],body:`
<div class="m_formA ($layout:vertical|horizontal) ($style:modern|classic)">
  <form class="m_formA__form">
    <div class="m_formA__header">
      <h2 class="m_formA__title">{$title:お問い合わせフォーム}</h2>
      <p class="m_formA__description">{$description:ご質問やお問い合わせがございましたら、以下のフォームよりお送りください。}</p>
    </div>
    <div class="m_formA__fields" z-for-wrapper="fields">
      <div z-for="fields" class="m_formA__field ($field_type:text|email|tel|textarea|select)">
        <label class="m_formA__label">{$label:フィールドラベル}</label>
        <input type="($input_type:text|email|tel)" class="m_formA__input ($required?:required)" placeholder="($placeholder:入力してください)">
        <span class="m_formA__help">{$help_text:補助テキスト}</span>
      </div>
    </div>
    <div class="m_formA__actions">
      <button type="submit" class="m_formA__submit ($submit_style:primary|secondary)">{$submit_text:送信する}</button>
    </div>
  </form>
</div>`}]}]},pages:[{id:"default-page",title:"デフォルトページ",description:"Vue CMS エディターのサンプルページ",components:[{id:"hero-1",type:"hero",module_name:"hero_1_1",title:"Vue CMS エディターへようこそ",description:"直感的で強力なコンテンツ管理システムです。ドラッグ&ドロップでページを作成し、リアルタイムでプレビューできます。",bg_image:"/img/hero_image.jpg",bg_alt:"Vue CMS ヒーロー画像",layout:"full",theme:"light",cta_text:"今すぐ始める",cta_url:"#get-started",cta_style:"primary",features:[{id:"feature-1",feature_title:"簡単操作",feature_description:"ドラッグ&ドロップで直感的にページを作成",icon_url:"/img/placeholder.jpg",icon_alt:"簡単操作アイコン"},{id:"feature-2",feature_title:"リアルタイムプレビュー",feature_description:"編集内容をリアルタイムで確認できます",icon_url:"/img/placeholder.jpg",icon_alt:"プレビューアイコン"},{id:"feature-3",feature_title:"Web Components",feature_description:"どこでも使える再利用可能なコンポーネント",icon_url:"/img/placeholder.jpg",icon_alt:"コンポーネントアイコン"}]},{id:"title-1",type:"title",module_name:"title_1_1",title:"主な機能",label:"Features",state:"s_state1",variant:"s_state3",label_state:["s_state5","s_state6"],image_url:"/img/banner.jpg",image_alt:"機能紹介画像",category:"product",tags:["featured","popular"],cards:[{id:"card-1",card_title:"テンプレート記法",card_desc:"{$param:default} 形式でテキストを編集",card_state:"s_state1"},{id:"card-2",card_title:"選択記法",card_desc:"($param:option1|option2) 形式で選択肢を提供",card_state:"s_state2"},{id:"card-3",card_title:"配列記法",card_desc:"z-for で繰り返し要素を管理",card_state:"s_state1"}],nested_parts:[{id:"content-1",type:"content",module_name:"content_1_1",title:"ネストされたコンテンツ",subtitle:"z-slot 機能のデモンストレーション",content:"このコンテンツは title コンポーネントの中にネストされています。z-slot 記法を使用することで、柔軟な構造を作ることができます。",alignment:"center",size:"medium",image_url:"/img/team.jpg",image_alt:"チーム画像",image_position:"right"}]},{id:"card-section-1",type:"card",module_name:"card_1_1",layout:"grid",columns:"3",items:[{id:"item-1",title:"はじめての方へ",description:"Vue CMS エディターの基本的な使い方を学びましょう",image_url:"/img/product1.jpg",image_alt:"チュートリアル画像",category:"blog",category_label:"ブログ",date:"2024-01-15",link_text:"チュートリアルを見る",link_url:"/tutorial",card_style:"elevated"},{id:"item-2",title:"アドバンス機能",description:"上級者向けの機能と使用方法について詳しく解説",image_url:"/img/background.jpg",image_alt:"アドバンス機能画像",category:"product",category_label:"製品",date:"2024-01-20",link_text:"詳細を見る",link_url:"/advanced",card_style:"elevated"},{id:"item-3",title:"コミュニティ",description:"ユーザーコミュニティに参加して情報交換をしましょう",image_url:"/img/logo.png",image_alt:"コミュニティ画像",category:"news",category_label:"ニュース",date:"2024-01-25",link_text:"参加する",link_url:"/community",card_style:"elevated"}]}]}],images:{common:[{id:"hero-bg",name:"hero_image.jpg",url:"/img/hero_image.jpg",alt:"ヒーロー背景画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:256e3}},{id:"logo",name:"logo.png",url:"/img/logo.png",alt:"Vue CMS ロゴ",category:"common",fileData:{base64:"",type:"image/png",size:48e3}},{id:"banner",name:"banner.jpg",url:"/img/banner.jpg",alt:"バナー画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:128e3}},{id:"background",name:"background.jpg",url:"/img/background.jpg",alt:"背景画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:512e3}},{id:"team",name:"team.jpg",url:"/img/team.jpg",alt:"チーム画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:196e3}},{id:"placeholder",name:"placeholder.jpg",url:"/img/placeholder.jpg",alt:"プレースホルダー画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:32e3}}],individual:[{id:"product-1",name:"product1.jpg",url:"/img/product1.jpg",alt:"製品画像1",category:"individual",fileData:{base64:"",type:"image/jpeg",size:86e3}}]}},Vr=[{type:"basic_list",description:"基本的なz-for内z-slotパターン",module:[{title:"item",category:"test",body:`
          <div class="category-item">
            <h3>{$title:アイテムタイトル}</h3>
            <p>{$description:アイテムの説明}</p>
            <div z-for="items" class="($item_class:item-wrapper|highlight-item|normal-item)">
              <div class="product-card">
                <h4>{$name:商品名}</h4>
                <p>{$price:価格}</p>
                <div class="slot-content" z-slot="details">
                  <!-- 商品詳細スロット -->
                </div>
              </div>
            </div>
          </div>
        `,description:"基本的なリストアイテムパーツ",tags:["z-for","z-slot","basic"]}]},{type:"nested_list",description:"ネストしたz-for内z-slotパターン",module:[{title:"category",category:"test",body:`
          <div class="nested-list">
            <h2>{$category_name:カテゴリー名}</h2>
            <div z-for="categories" class="category-wrapper">
              <h3>{$cat_title:サブカテゴリー}</h3>
              <div z-for="products" class="product-list">
                <div class="product-card">
                  <h4>{$product_name:商品名}</h4>
                  <span>{$product_price:価格}</span>
                  <div class="slot-content" z-slot="product_details">
                    <!-- 商品詳細スロット -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,description:"ネストしたカテゴリーパーツ",tags:["z-for","z-slot","nested"]}]},{type:"multi_slot",description:"複数スロットパターン",module:[{title:"container",category:"test",body:`
          <div class="multi-slot-container">
            <h2>{$container_title:コンテナタイトル}</h2>
            <div z-for="sections" class="section-item">
              <div class="section-header">
                <h3>{$section_title:セクションタイトル}</h3>
                <div z-slot="header_parts" class="header-slot">
                  <!-- ヘッダースロット -->
                </div>
              </div>
              <div class="section-content">
                <p>{$section_content:セクション内容}</p>
                <div z-slot="content_parts" class="content-slot">
                  <!-- コンテンツスロット -->
                </div>
              </div>
              <div class="section-footer">
                <div z-slot="footer_parts" class="footer-slot">
                  <!-- フッタースロット -->
                </div>
              </div>
            </div>
          </div>
        `,description:"複数スロットコンテナパーツ",tags:["z-for","z-slot","multiple"]}]},{type:"conditional",description:"条件付きz-slotパターン",module:[{title:"faq",category:"test",body:`
          <div class="faq-container">
            <h2>{$faq_title:FAQタイトル}</h2>
            <div z-for="questions" class="faq-item">
              <h3>{$question:質問}</h3>
              <p>{$answer:回答}</p>
              <div z-if="has_details" class="details-section">
                <div z-slot="additional_info" class="slot-content">
                  <!-- 追加情報スロット（条件付き） -->
                </div>
              </div>
            </div>
          </div>
        `,description:"条件付きFAQパーツ",tags:["z-for","z-slot","conditional","z-if"]}]},{type:"empty",description:"空スロットパターン",module:[{title:"list",category:"test",body:`
          <div class="empty-slot-container">
            <h2>{$list_title:リストタイトル}</h2>
            <div z-for="empty_items" class="empty-item">
              <h3>{$item_title:アイテム}</h3>
              <div z-slot="empty_slot" class="slot-content">
                <!-- 初期状態で空のスロット -->
              </div>
            </div>
          </div>
        `,description:"空スロットリストパーツ",tags:["z-for","z-slot","empty"]}]},{type:"dynamic",description:"動的スロット名パターン",module:[{title:"mixed",category:"test",body:`
          <div class="dynamic-slot-container">
            <h2>{$container_title:動的スロットコンテナ}</h2>
            <div z-for="mixed_items" class="mixed-item">
              <h3>{$item_name:アイテム名} - Type: {$item_type:タイプ}</h3>
              <div z-if="type_a" z-slot="slot_type_a" class="slot-content">
                <!-- タイプAスロット -->
              </div>
              <div z-if="type_b" z-slot="slot_type_b" class="slot-content">
                <!-- タイプBスロット -->
              </div>
              <div z-if="type_c" z-slot="slot_type_c" class="slot-content">
                <!-- タイプCスロット -->
              </div>
            </div>
          </div>
        `,description:"動的スロットパーツ",tags:["z-for","z-slot","dynamic","conditional"]}]},{type:"parts",description:"テスト用共通パーツ",module:[{title:"text",category:"common",body:'<p class="text-part">{$text:テキストパーツ}</p>',description:"テキストパーツ",tags:["common","text"]},{title:"button",category:"common",body:'<button class="btn-part ($btn_style:primary|secondary|danger)">{$btn_text:ボタン}</button>',description:"ボタンパーツ",tags:["common","button"]},{title:"image",category:"common",body:'<img src="{$img_src:https://via.placeholder.com/150}" alt="{$img_alt:画像}" class="img-part">',description:"画像パーツ",tags:["common","image"]},{title:"link",category:"common",body:'<a href="{$link_url:#}" class="link-part">{$link_text:リンク}</a>',description:"リンクパーツ",tags:["common","link"]},{title:"badge",category:"common",body:'<span class="badge ($badge_color:blue|green|red|yellow)">{$badge_text:バッジ}</span>',description:"バッジパーツ",tags:["common","badge"]},{title:"card",category:"common",body:`
          <div class="card-part">
            <h4>{$card_title:カードタイトル}</h4>
            <p>{$card_content:カード内容}</p>
          </div>
        `,description:"カードパーツ",tags:["common","card"]}]}],bc=[{id:"zfor-zslot-tests",title:"z-for & z-slot テストページ",description:"z-for内でz-slotを使用する様々なパターンのテスト",components:[{id:"test_basic_zfor_zslot",type:"basic_list",module_name:"item",title:"基本リスト",description:"z-for内の各アイテムにz-slotがある基本パターン",item_class:"normal-item",items:[{id:"item_001",name:"アイテム1",price:"¥1,000",details:[{id:"detail_001",type:"parts",module_name:"text",text:"このアイテムの詳細説明です"},{id:"detail_002",type:"parts",module_name:"button",btn_text:"詳細を見る",btn_style:"primary"}]},{id:"item_002",name:"アイテム2",price:"¥2,000",details:[{id:"detail_003",type:"parts",module_name:"badge",badge_text:"新商品",badge_color:"green"}]},{id:"item_003",name:"アイテム3",price:"¥3,000",details:[]}]},{id:"test_nested_zfor_zslot",type:"nested_list",module_name:"category",category_name:"商品カタログ",categories:[{id:"cat_001",cat_title:"電化製品",products:[{id:"prod_001",product_name:"ノートPC",product_price:"¥98,000",product_details:[{id:"pd_001",type:"parts",module_name:"text",text:"高性能ノートパソコン"}]},{id:"prod_002",product_name:"タブレット",product_price:"¥45,000",product_details:[{id:"pd_002",type:"parts",module_name:"badge",badge_text:"セール中",badge_color:"red"}]}]},{id:"cat_002",cat_title:"家具",products:[{id:"prod_003",product_name:"デスク",product_price:"¥25,000",product_details:[]}]}]},{id:"test_multiple_zslot",type:"multi_slot",module_name:"container",container_title:"複数スロットテスト",sections:[{id:"sec_001",section_title:"セクション1",section_content:"これはセクション1の内容です",header_parts:[{id:"hp_001",type:"parts",module_name:"badge",badge_text:"ヘッダー",badge_color:"blue"}],content_parts:[{id:"cp_001",type:"parts",module_name:"text",text:"コンテンツエリアのテキスト"},{id:"cp_002",type:"parts",module_name:"button",btn_text:"アクション",btn_style:"secondary"}],footer_parts:[{id:"fp_001",type:"parts",module_name:"link",link_text:"フッターリンク",link_url:"#footer"}]},{id:"sec_002",section_title:"セクション2",section_content:"これはセクション2の内容です",header_parts:[],content_parts:[{id:"cp_003",type:"parts",module_name:"card",card_title:"カード",card_content:"カードコンテンツ"}],footer_parts:[]}]},{id:"test_conditional_zslot",type:"conditional",module_name:"faq",faq_title:"よくある質問",questions:[{id:"q_001",question:"配送料はいくらですか？",answer:"全国一律500円です。",has_details:!0,additional_info:[{id:"ai_001",type:"parts",module_name:"text",text:"10,000円以上のご購入で送料無料"},{id:"ai_002",type:"parts",module_name:"badge",badge_text:"期間限定",badge_color:"yellow"}]},{id:"q_002",question:"返品は可能ですか？",answer:"商品到着後7日以内であれば可能です。",has_details:!1,additional_info:[]},{id:"q_003",question:"支払い方法は？",answer:"クレジットカード、銀行振込、代金引換が利用可能です。",has_details:!0,additional_info:[{id:"ai_003",type:"parts",module_name:"link",link_text:"詳しい支払い方法",link_url:"#payment"}]}]},{id:"test_empty_zslot",type:"empty",module_name:"list",list_title:"空スロットテスト",empty_items:[{id:"empty_001",item_title:"空のアイテム1",empty_slot:[]},{id:"empty_002",item_title:"空のアイテム2",empty_slot:[]},{id:"empty_003",item_title:"空のアイテム3",empty_slot:[]}]},{id:"test_dynamic_zslot",type:"dynamic",module_name:"mixed",container_title:"動的スロットテスト",mixed_items:[{id:"mix_001",item_name:"タイプA アイテム",item_type:"A",type_a:!0,type_b:!1,type_c:!1,slot_type_a:[{id:"sta_001",type:"parts",module_name:"text",text:"タイプA専用コンテンツ"}],slot_type_b:[],slot_type_c:[]},{id:"mix_002",item_name:"タイプB アイテム",item_type:"B",type_a:!1,type_b:!0,type_c:!1,slot_type_a:[],slot_type_b:[{id:"stb_001",type:"parts",module_name:"button",btn_text:"タイプB ボタン",btn_style:"danger"}],slot_type_c:[]},{id:"mix_003",item_name:"タイプC アイテム",item_type:"C",type_a:!1,type_b:!1,type_c:!0,slot_type_a:[],slot_type_b:[],slot_type_c:[{id:"stc_001",type:"parts",module_name:"badge",badge_text:"タイプC",badge_color:"green"},{id:"stc_002",type:"parts",module_name:"link",link_text:"タイプCリンク",link_url:"#type-c"}]}]}]}],_c={parts:{common:Vr.filter(t=>t.type==="parts"||t.module.some(r=>r.category==="common")),individual:Vr.filter(t=>t.type!=="parts"&&!t.module.some(r=>r.category==="common"))},pages:bc,images:{common:[],individual:[]}},Br=e.ref({environment:"development",enableMockData:!0,defaultDataSet:"samples"}),ct=e.ref(Tr),Do=e.ref(!1),To=e.ref(null);function $c(){const t=C=>{Br.value.environment=C,c.info(`🌍 データ環境を ${C} に設定しました`)},r=async(C="samples")=>{Do.value=!0,To.value=null;try{if(C==="samples")ct.value=Tr;else if(C==="tests"||C==="zfor-zslot")ct.value=_c;else throw new Error(`未知のデータセット: ${C}`);return!0}catch(A){const w=A instanceof Error?A.message:"データ読み込みエラー";return To.value=w,c.error(`❌ データ読み込み失敗: ${w}`),!1}finally{Do.value=!1}},o=e.computed(()=>ct.value.parts),n=e.computed(()=>ct.value.pages),s=e.computed(()=>ct.value.images),f=e.computed(()=>[...ct.value.parts.common,...ct.value.parts.individual]),y=e.computed(()=>ct.value.pages[0]?.components||[]),h=e.readonly({isLoading:Do,loadError:To,config:e.readonly(Br)});return{parts:o,pages:n,images:s,combinedParts:f,defaultPageData:y,state:h,setEnvironment:t,loadData:r,initialize:async()=>{await r("samples")}}}const Ec={class:"zero-code-tab-navigation"},wc=["onClick"],zc=e.defineComponent({__name:"TabNavigation",props:{activeTab:{type:String}},emits:["update:active-tab"],setup(t){const r=["editor","preview","parts","images"],o=n=>({editor:"エディタ",preview:"ページプレビュー",parts:"パーツ管理",images:"画像管理"})[n];return(n,s)=>(e.openBlock(),e.createElementBlock("div",Ec,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(r,f=>e.createElementVNode("button",{key:f,class:e.normalizeClass(["zero-code-tab-button",{active:n.activeTab===f}]),onClick:y=>n.$emit("update:active-tab",f)},e.toDisplayString(o(f)),11,wc)),64))]))}});function vc(){const t=e.ref([]),r=e.computed(()=>t.value.length>0),o=(h,_=ue.UNKNOWN,C)=>{const A={id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:_,message:h instanceof Error?h.message:h,details:h instanceof Error?h.stack:void 0,timestamp:new Date,context:C};t.value.push(A),setTimeout(()=>{s(A.id)},1e4)},n=()=>{t.value=[]},s=h=>{const _=t.value.findIndex(C=>C.id===h);_!==-1&&t.value.splice(_,1)};return{errors:t,hasErrors:r,handleError:o,clearErrors:n,clearError:s,getErrorsByType:h=>t.value.filter(_=>_.type===h),showErrorNotification:(h,_=ue.UNKNOWN)=>{o(h,_)}}}const Cc={class:"zero-code-error-boundary"},Ac={key:0,class:"zero-code-error-notifications"},Nc={class:"zero-code-error-content"},kc={class:"zero-code-error-message"},Pc={class:"zero-code-error-icon"},Sc={class:"zero-code-error-text"},Ic=["onClick"],Dc={key:0,class:"zero-code-error-details"},Tc={class:"zero-code-error-details-pre"},Vc={class:"zero-code-error-boundary-content"},Bc=e.defineComponent({__name:"ErrorBoundary",props:{showDetails:{type:Boolean,default:!1}},setup(t){const{errors:r,hasErrors:o,clearError:n}=vc(),s=y=>{switch(y){case ue.NETWORK_ERROR:return"error-network";case ue.VALIDATION_ERROR:return"error-validation";case ue.PERMISSION_ERROR:return"error-permission";case ue.COMPONENT_ERROR:return"error-component";case ue.IMAGE_LOAD_FAILED:return"error-image";case ue.TEMPLATE_PARSE_ERROR:return"error-template";default:return"error-unknown"}},f=y=>{switch(y){case ue.NETWORK_ERROR:return"🌐";case ue.VALIDATION_ERROR:return"⚠️";case ue.PERMISSION_ERROR:return"🔒";case ue.COMPONENT_ERROR:return"🧩";case ue.IMAGE_LOAD_FAILED:return"🖼️";case ue.TEMPLATE_PARSE_ERROR:return"📄";default:return"❌"}};return(y,h)=>(e.openBlock(),e.createElementBlock("div",Cc,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",Ac,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),_=>(e.openBlock(),e.createElementBlock("div",{key:_.id,class:e.normalizeClass(["zero-code-error-notification",s(_.type)])},[e.createElementVNode("div",Nc,[e.createElementVNode("div",kc,[e.createElementVNode("span",Pc,e.toDisplayString(f(_.type)),1),e.createElementVNode("span",Sc,e.toDisplayString(_.message),1)]),e.createElementVNode("button",{class:"zero-code-error-close",title:"エラーを閉じる",onClick:C=>e.unref(n)(_.id)}," × ",8,Ic)]),_.details&&y.showDetails?(e.openBlock(),e.createElementBlock("div",Dc,[e.createElementVNode("pre",Tc,e.toDisplayString(_.details),1)])):e.createCommentVNode("",!0)],2))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",Vc,[e.renderSlot(y.$slots,"default")])]))}}),Mc={class:"zero-code-toolbar-content"},Fc={class:"zero-code-toolbar-section"},xc={key:0,class:"zero-code-toolbar-separator"},Lc=["title","disabled","onClick"],Oc={class:"zero-code-toolbar-section"},Rc=e.defineComponent({__name:"RichTextToolbar",props:{show:{type:Boolean},position:{type:Object},actions:{type:Array},editingState:{type:null},isEditing:{type:Boolean}},emits:["executeCommand","save","cancel"],setup(t,{emit:r}){const o=t;e.onMounted(()=>{c.debug("🔧 RichTextToolbar mounted")}),e.watch(()=>o.show,h=>{c.debug("🔧 RichTextToolbar show changed:",h)},{immediate:!0}),e.watch(()=>o.position,h=>{c.debug("🔧 RichTextToolbar position changed:",h)},{deep:!0,immediate:!0}),e.watch(()=>o.actions,h=>{c.debug("🔧 RichTextToolbar actions changed:",h?.length||0)},{immediate:!0});const n=r,s=h=>{c.debug("🔧 ツールバーコマンド実行:",h),n("executeCommand",h)},f=()=>{n("save")},y=()=>{n("cancel")};return(h,_)=>h.show?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-rich-text-toolbar",style:e.normalizeStyle({top:h.position.top+"px",left:h.position.left+"px"})},[e.createElementVNode("div",Mc,[e.createElementVNode("div",Fc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.actions,(C,A)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[C&&C.name==="separator"?(e.openBlock(),e.createElementBlock("div",xc)):C?(e.openBlock(),e.createElementBlock("button",{key:1,class:e.normalizeClass(["zero-code-toolbar-btn",{active:C.active,disabled:!h.isEditing}]),title:C.title||"",disabled:!h.isEditing,tabindex:"-1",onClick:w=>s(C.command||""),onMousedown:_[0]||(_[0]=e.withModifiers(()=>{},["prevent","stop"]))},e.toDisplayString(C.icon||""),43,Lc)):e.createCommentVNode("",!0)],64))),128))]),_[3]||(_[3]=e.createElementVNode("div",{class:"zero-code-toolbar-separator"},null,-1)),e.createElementVNode("div",Oc,[e.createElementVNode("button",{class:"zero-code-toolbar-btn zero-code-save-btn",title:"保存 (Ctrl+S)",tabindex:"-1",onClick:f,onMousedown:_[1]||(_[1]=e.withModifiers(()=>{},["prevent","stop"]))}," ✓ ",32),e.createElementVNode("button",{class:"zero-code-toolbar-btn zero-code-cancel-btn",title:"キャンセル (Esc)",tabindex:"-1",onClick:y,onMousedown:_[2]||(_[2]=e.withModifiers(()=>{},["prevent","stop"]))}," ✕ ",32)])])],4)):e.createCommentVNode("",!0)}}),Hc={class:"zero-code-tab-navigation"},Zc={class:"zero-code-search-section"},jc={class:"zero-code-modal-body"},Uc={key:0,class:"zero-code-empty-state"},Wc={key:1,class:"zero-code-image-grid"},qc=["title","onClick"],Kc={class:"zero-code-image-preview"},Xc=["src","alt","onError"],Yc={key:0,class:"zero-code-img-updated-badge"},Jc={key:1,class:"zero-code-selection-indicator"},Gc={class:"zero-code-image-info"},Qc={class:"zero-code-image-name"},ep={class:"zero-code-image-alt"},tp={key:0,class:"zero-code-image-preview-section"},op={class:"zero-code-selected-preview"},rp=["src","alt"],np={class:"zero-code-selected-info"},ap={class:"zero-code-info-item"},sp={class:"zero-code-info-item"},lp={class:"zero-code-info-item"},ip={key:0,class:"zero-code-info-item"},dp={class:"zero-code-modal-footer"},cp=["disabled"],pp=e.defineComponent({__name:"ImageSelectorModal",props:{visible:{type:Boolean},commonImages:{default:()=>[],type:Array},individualImages:{default:()=>[],type:Array},currentValue:{type:String}},emits:["close","select"],setup(t,{emit:r}){const o=t,n=r,{getImageSrc:s,getImageAlt:f,isImageUpdated:y}=Lt(),h=e.ref("common"),_=e.ref(""),C=e.ref(null),A=e.computed(()=>h.value==="common"?o.commonImages||[]:o.individualImages||[]),w=e.computed(()=>{const d=_.value.toLowerCase();return d?A.value.filter(a=>a.name.toLowerCase().includes(d)||a.alt&&a.alt.toLowerCase().includes(d)||a.url.toLowerCase().includes(d)):A.value}),N=()=>{n("close")},z=d=>{C.value?.id===d.id?C.value=null:C.value=d},T=()=>{C.value=null},B=()=>{if(C.value){if(!!(C.value.fileData?.base64&&C.value.fileData.base64.trim()!=="")){const a=s(C.value),l=f(C.value);n("select",a,l)}else n("select",C.value.url,C.value.alt||"");N()}},I=(d,a)=>{const l=d.target;l.src="/img/placeholder.jpg"};return e.watch(()=>o.visible,d=>{if(d){if(o.currentValue){const l=[...o.commonImages||[],...o.individualImages||[]].find(p=>p.url===o.currentValue);l&&(C.value=l,h.value=l.category)}_.value=""}else C.value=null}),e.watch(h,()=>{C.value=null}),(d,a)=>d.visible?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-modal-overlay",onClick:N},[e.createElementVNode("div",{class:"zero-code-modal-content zero-code-image-selector-modal",onClick:a[3]||(a[3]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",{class:"zero-code-modal-header"},[a[4]||(a[4]=e.createElementVNode("h3",{class:"zero-code-modal-title"},"画像を選択",-1)),e.createElementVNode("button",{class:"zero-code-close-button",title:"閉じる",onClick:N}," ✕ ")]),e.createElementVNode("div",Hc,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-tab-button",{active:h.value==="common"}]),onClick:a[0]||(a[0]=l=>h.value="common")}," 共通画像 ("+e.toDisplayString((d.commonImages||[]).length)+") ",3),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-tab-button",{active:h.value==="individual"}]),onClick:a[1]||(a[1]=l=>h.value="individual")}," 個別画像 ("+e.toDisplayString((d.individualImages||[]).length)+") ",3)]),e.createElementVNode("div",Zc,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>_.value=l),type:"text",placeholder:"画像を検索...",class:"zero-code-search-input"},null,512),[[e.vModelText,_.value]])]),e.createElementVNode("div",jc,[w.value.length===0?(e.openBlock(),e.createElementBlock("div",Uc,a[5]||(a[5]=[e.createElementVNode("p",null,"該当する画像がありません",-1)]))):(e.openBlock(),e.createElementBlock("div",Wc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value,l=>(e.openBlock(),e.createElementBlock("div",{key:l.id,class:e.normalizeClass(["zero-code-image-item",{selected:C.value?.id===l.id}]),title:C.value?.id===l.id?"クリックで選択解除":"クリックで選択",onClick:p=>z(l)},[e.createElementVNode("div",Kc,[e.createElementVNode("img",{src:e.unref(s)(l),alt:e.unref(f)(l),loading:"lazy",onError:p=>I(p)},null,40,Xc),e.unref(y)(l)?(e.openBlock(),e.createElementBlock("div",Yc," 差し替え済み ")):e.createCommentVNode("",!0),C.value?.id===l.id?(e.openBlock(),e.createElementBlock("div",Jc,a[6]||(a[6]=[e.createElementVNode("span",{class:"zero-code-check-icon"},"✓",-1)]))):e.createCommentVNode("",!0)]),e.createElementVNode("div",Gc,[e.createElementVNode("div",Qc,e.toDisplayString(l.name),1),e.createElementVNode("div",ep,e.toDisplayString(l.alt),1)])],10,qc))),128))]))]),C.value?(e.openBlock(),e.createElementBlock("div",tp,[e.createElementVNode("div",{class:"zero-code-preview-header"},[a[8]||(a[8]=e.createElementVNode("h4",{class:"zero-code-preview-title"},"選択中の画像",-1)),e.createElementVNode("button",{class:"zero-code-clear-selection-btn",title:"選択を解除",onClick:T},a[7]||(a[7]=[e.createElementVNode("span",{class:"zero-code-clear-icon"},"✕",-1),e.createTextVNode(" 選択解除 ")]))]),e.createElementVNode("div",op,[e.createElementVNode("img",{src:e.unref(s)(C.value),alt:e.unref(f)(C.value)},null,8,rp),e.createElementVNode("div",np,[e.createElementVNode("div",ap,[a[9]||(a[9]=e.createElementVNode("label",{class:"zero-code-info-label"},"ファイル名",-1)),e.createElementVNode("strong",null,e.toDisplayString(C.value.name),1)]),e.createElementVNode("div",sp,[a[10]||(a[10]=e.createElementVNode("label",{class:"zero-code-info-label"},"説明",-1)),e.createElementVNode("p",null,e.toDisplayString(C.value.alt||"説明なし"),1)]),e.createElementVNode("div",lp,[a[11]||(a[11]=e.createElementVNode("label",{class:"zero-code-info-label"},"URL",-1)),e.createElementVNode("code",null,e.toDisplayString(C.value.url),1)]),e.unref(y)(C.value)?(e.openBlock(),e.createElementBlock("div",ip,a[12]||(a[12]=[e.createElementVNode("label",{class:"zero-code-info-label"},"状態",-1),e.createElementVNode("span",{class:"zero-code-status-badge"},"差し替え済み",-1)]))):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),e.createElementVNode("div",dp,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:N}," キャンセル "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",disabled:!C.value,onClick:B},e.toDisplayString(C.value&&e.unref(y)(C.value)?"差し替え画像を適用":"選択した画像を適用"),9,cp)])])])):e.createCommentVNode("",!0)}}),mp={class:"zero-code-editor-content"},up={class:"zero-code-button-section"},gp={key:0,class:"zero-code-data-display-area"},fp={class:"zero-code-data-display-header"},hp={class:"zero-code-data-display-content"},yp={class:"zero-code-data-display-pre"},bp=e.defineComponent({__name:"ZeroCode.ce",props:{parts:{default:()=>[],type:Array},commonParts:{default:()=>[],type:Array},individualParts:{default:()=>[],type:Array},page:{default:()=>[],type:Array},commonImages:{default:()=>[],type:Array},individualImages:{default:()=>[],type:Array}},emits:["update:parts","update:commonParts","update:individualParts","update:page","update:commonImages","update:individualImages"],setup(t,{expose:r,emit:o}){const n=t,s=o,f=e.ref(`zero-code-${Math.random().toString(36).substr(2,9)}`),y=$c(),{getImageSrc:h}=Lt(),_=e.computed(()=>[...Te.value,...Ve.value]),C=M=>{if(!M)return M;const x=_.value;if(x.length===0)return M;let R=M;return R=R.replace(/<img([^>]*?)src=["']([^"']+)["']([^>]*?)>/gi,(Z,W,J,K)=>{const q=x.find(H=>!!(H.id===J||H.url===J||H.name===J||J.endsWith("/"+H.name)||H.url.endsWith(J)||J.split("/").pop()===H.name));if(q){const H=h(q);return`<img${W}src="${H}"${K}>`}return Z}),R},A=M=>{const x=Te.value.findIndex(Z=>Z.id===M);if(x!==-1){const Z=[...Te.value];Z[x]={...Z[x],fileData:{...Z[x].fileData,base64:""}},xr(Z);return}const R=Ve.value.findIndex(Z=>Z.id===M);if(R!==-1){const Z=[...Ve.value];Z[R]={...Z[R],fileData:{...Z[R].fileData,base64:""}},Lr(Z)}};e.onMounted(async()=>{try{process.env.NODE_ENV==="development"||process.env.LOAD_SAMPLE_DATA==="true"?(c.info("🚀 開発モード：サンプルデータを読み込み中..."),await y.initialize(),y.combinedParts.value&&y.combinedParts.value.length>0?(T.value=y.combinedParts.value,c.success(`✅ パーツデータ設定完了 (${y.combinedParts.value.length}件)`)):c.warn("⚠️ パーツデータが見つかりません"),y.defaultPageData.value&&y.defaultPageData.value.length>0?(z.value=y.defaultPageData.value,c.success(`✅ ページデータ設定完了 (${y.defaultPageData.value.length}件)`)):c.warn("⚠️ ページデータが見つかりません"),y.images.value?(Te.value=y.images.value.common,Ve.value=y.images.value.individual,c.success(`✅ 画像データ設定完了 (共通:${y.images.value.common.length}件, 個別:${y.images.value.individual.length}件)`)):c.warn("⚠️ 画像データが見つかりません"),c.success("✅ データローダー初期化完了")):(c.info("🏭 本番モード：外部データ待機中（内部サンプルデータは読み込みません）"),T.value=[],z.value=[],Te.value=[],Ve.value=[],c.success("✅ 本番モード初期化完了（空の状態）")),e.nextTick(()=>{const x=new CustomEvent("zero-code-initialized",{detail:{partsCount:T.value?.length||0,pageCount:z.value?.length||0}});document.dispatchEvent(x),c.debug("🎉 zero-code-initialized イベントを発火")})}catch(M){c.error("❌ データローダー初期化失敗:",M)}});const w=yc(n,s),N=w.state.selectedComponent;w.state.selectedComponentIndex;const z=w.state.editablePageData,T=w.state.localParts,B=w.state.dataTab,I=e.ref(!1),d=e.ref({top:0,left:0}),a=e.ref(null),l=e.ref(""),p=e.ref(""),E=e.ref(""),P=e.computed(()=>a.value!==null),$=e.ref(!1),i=e.ref(""),m=e.ref(null),g=e.ref(""),b=e.reactive({showToolbar:e.computed(()=>I.value),position:e.computed(()=>d.value),actions:[{name:"bold",icon:"B",title:"太字",command:"bold"},{name:"italic",icon:"I",title:"斜体",command:"italic"},{name:"underline",icon:"U",title:"下線",command:"underline"},{name:"separator"},{name:"link",icon:"🔗",title:"リンク",command:"link"}],editingState:{},executeCommand:M=>{c.debug("リッチテキストコマンド実行:",M),u(M)},stopEdit:M=>{c.debug("リッチテキスト編集終了:",M),D(M)}}),u=M=>{if(a.value){c.debug("🔧 書式設定コマンド実行:",M);try{if(M==="link"){const x=prompt("リンクのURLを入力してください:","https://");if(x&&x.trim()){const R=document.execCommand("createLink",!1,x);c.debug("🔧 リンク作成:",R?"成功":"失敗")}}else{const x=document.execCommand(M,!1,void 0);c.debug("🔧 書式設定:",M,x?"成功":"失敗")}c.debug("🔧 データ更新をスキップ（選択範囲保護）")}catch(x){c.error("🚨 execCommandエラー:",x)}}},v=()=>{if(!a.value||!p.value||!E.value)return;const M=a.value.innerHTML,x=ai(M),R=Z=>{const J=(K=>{const q=K.split("_");if(q.length<4)return null;const H=q[q.length-1],Y=q[q.length-2];if(!/^\d+$/.test(Y))return null;const ee=["outer_items","inner_items","items","categories","tags","list"];for(const me of ee){const se=`_${me}_${Y}_${H}`;if(K.endsWith(se))return{parentId:K.slice(0,-se.length),arrayName:me,arrayIndex:parseInt(Y),paramName:H}}return null})(p.value);if(J){const{parentId:K,arrayName:q,arrayIndex:H,paramName:Y}=J,ee=(se,ae)=>{for(const ce of se){if(ce.id===ae&&Array.isArray(ce[q]))return ce[q][H];if(ce.nested_parts&&Array.isArray(ce.nested_parts)){const $e=ee(ce.nested_parts,ae);if($e)return $e}for(const[$e,Ee]of Object.entries(ce))if(Array.isArray(Ee)&&$e!=="nested_parts")for(let Se=0;Se<Ee.length;Se++){const we=Ee[Se];if(we&&typeof we=="object"){if(`${ce.id}_${$e}_${Se}`===ae&&Array.isArray(we[q]))return we[q][H];for(const[Ue,Le]of Object.entries(we))if(Array.isArray(Le)){const Rt=ee(Le,ae);if(Rt)return Rt}}}}return null},me=ee(Z,K);return me&&typeof me=="object"?(me[Y]=x,!0):!1}for(const K of Z){if(K.id===p.value)return K[E.value]=x,!0;if(K.nested_parts&&Array.isArray(K.nested_parts)&&(c.debug(`🔍 nested_parts内を検索: ${K.id}`),R(K.nested_parts)))return!0;for(const[q,H]of Object.entries(K))if(Array.isArray(H)&&q!=="nested_parts"){c.debug(`🔍 配列プロパティ検索: ${K.id}.${q}`);for(const Y of H)if(Y&&typeof Y=="object"){if(Y.id===p.value)return Y[E.value]=x,c.debug("🔧 配列内コンポーネント更新完了:",Y),!0;for(const[ee,me]of Object.entries(Y))if(Array.isArray(me)&&(c.debug(`🔍 スロット検索: ${K.id}.${q}[].${ee}`),R(me)))return!0}}}return c.debug(`❌ コンポーネントが見つかりませんでした: ${p.value}`),!1};R(z.value)&&(a.value&&M!==x&&(a.value.innerHTML=x),e.nextTick(()=>{const Z=JSON.parse(JSON.stringify(z.value));z.value=Z,e.triggerRef(z),e.nextTick(()=>{s("update:page",z.value)})}))},D=M=>{a.value&&(c.debug("🔧 編集終了:",M?"保存":"キャンセル"),M?(v(),c.debug("🔧 最終保存完了")):(a.value.innerHTML=l.value,c.debug("🔧 変更を破棄しました")),a.value.contentEditable="false",a.value.classList.remove("editing"),a.value.style.userSelect="",a.value.style.webkitUserSelect="",c.debug("🔧 編集終了、スタイルクリーンアップ完了"),c.debug("🔧 編集モード終了処理完了"),a.value._cleanup&&(a.value._cleanup(),delete a.value._cleanup),a.value=null,l.value="",p.value="",E.value="",I.value=!1,c.debug("🔧 ツールバーを非表示にしました"))},k=M=>{w.actions.openEditor(M)},S=()=>{w.closeEditor()},V=M=>{w.actions.deletePart(M)},F=M=>{w.actions.reorderParts(M)},X=()=>{const M=document.querySelector(`.${f.value}`);if(!M)return;let x=null,R=null;const Z=q=>{const H=q,Y=H.target;if(Y.classList.contains("draggable-nested")){if(a.value){c.debug("🔧 テキスト編集中のためネストパーツドラッグを無効化"),H.preventDefault();return}if(Y.classList.contains("z-for-nested-part")){c.debug("🔧 z-for内ネストパーツ - z-for専用ハンドラーに委譲");return}x=Y;const ee=Y.dataset.componentId||"",me=Y.dataset.path||"",se=Y.dataset.parentPath||"",ae=parseInt(Y.dataset.index||"0");R={componentId:ee,path:me,parentPath:se,index:ae},H.dataTransfer&&(H.dataTransfer.effectAllowed="move",H.dataTransfer.setData("text/plain","nested-component")),Y.style.opacity="0.5",c.debug("🔧 ネストパーツドラッグ開始:",R)}},W=q=>{const H=q;H.preventDefault(),H.dataTransfer&&(H.dataTransfer.dropEffect="move")},J=q=>{const H=q;if(H.preventDefault(),!x||!R)return;const ee=H.target.closest(".draggable-nested");if(ee&&ee!==x){const me=ee.dataset.parentPath||"",se=parseInt(ee.dataset.index||"0");c.debug("🔧 ネストパーツドロップ:",{draggedParentPath:R.parentPath,draggedIndex:R.index,targetParentPath:me,targetIndex:se}),R.parentPath===me?(c.debug("🔧 同じ親内での並べ替え実行"),w.actions.moveNestedPartById(R.parentPath,R.index,se)):c.debug("🔧 異なる親間の移動は未対応")}x&&(x.style.opacity="1"),x=null,R=null},K=q=>{const H=q.target;H.classList.contains("draggable-nested")&&(H.style.opacity="1"),x=null,R=null};return M.addEventListener("dragstart",Z),M.addEventListener("dragover",W),M.addEventListener("drop",J),M.addEventListener("dragend",K),c.debug("🔧 ネストパーツドラッグ&ドロップリスナー設定完了"),()=>{M.removeEventListener("dragstart",Z),M.removeEventListener("dragover",W),M.removeEventListener("drop",J),M.removeEventListener("dragend",K),c.debug("🔧 ネストパーツドラッグ&ドロップリスナー削除完了")}},O=e.ref(null),L=e.ref(""),U=e.ref(""),G=M=>{let x=null,R="";switch(M){case"page":x=z.value,R="Pageデータ";break;case"commonParts":x=w.state.localCommonParts.value,(!x||x.length===0)&&(x=T.value?.map(Z=>({...Z,module:Z.module?.filter(W=>!W.category||W.category==="common")})).filter(Z=>Z.module&&Z.module.length>0)||[]),(!x||x.length===0)&&(x=n.parts?.map(Z=>({...Z,module:Z.module?.filter(W=>!W.category||W.category==="common")})).filter(Z=>Z.module&&Z.module.length>0)||[]),R="共通Partsデータ";break;case"individualParts":x=w.state.localIndividualParts.value,(!x||x.length===0)&&(x=T.value?.map(Z=>({...Z,module:Z.module?.filter(W=>W.category==="individual")})).filter(Z=>Z.module&&Z.module.length>0)||[]),(!x||x.length===0)&&(x=n.parts?.map(Z=>({...Z,module:Z.module?.filter(W=>W.category==="individual")})).filter(Z=>Z.module&&Z.module.length>0)||[]),R="個別Partsデータ";break;case"commonImages":x=Te.value,R="共通画像データ";break;case"individualImages":x=Ve.value,R="個別画像データ";break;default:return}O.value=x,L.value=R,U.value=M},ne=()=>{O.value=null,L.value="",U.value=""},de=e.computed(()=>O.value?JSON.stringify(O.value,null,2):""),pe=async()=>{try{await navigator.clipboard.writeText(de.value),alert("データをクリップボードにコピーしました")}catch{alert("クリップボードのコピーに失敗しました")}},Ce=()=>{if(U.value){switch(U.value){case"page":w.actions.sendPageData();break;case"commonParts":w.actions.sendCommonPartsData();break;case"individualParts":w.actions.sendIndividualPartsData();break;case"commonImages":Or();break;case"individualImages":Rr();break}alert(`${L.value}を送信しました`)}},De=()=>{w.actions.resetPageData()},ke=e.ref(null),pt=e.computed(()=>{const M=new Set;return T.value&&T.value.forEach(x=>{x.type&&M.add(x.type)}),Array.from(M)}),Pe=e.ref(new Map),Ae=(M,x)=>{M.id.includes("div_nested_zfor");let R=x;R===void 0&&(R=z.value.findIndex(se=>se.id===M.id),R===-1&&(R=0));const Z=z.value[R]||M;Object.keys(Z).filter(se=>Array.isArray(Z[se]));const W=(se,ae="")=>{const ce=[];for(const[$e,Ee]of Object.entries(se))if(Array.isArray(Ee)){const Se=ae?`${ae}.${$e}`:$e,we=`${Se}:${Ee.length}:${JSON.stringify(Ee.map((Be,Ue)=>({i:Ue,id:Be?.id||Be?.name||`item_${Ue}`,...Object.fromEntries(Object.entries(Be||{}).slice(0,3))})))}`;ce.push(we),Ee.forEach((Be,Ue)=>{if(Be&&typeof Be=="object"){const Le=W(Be,`${Se}[${Ue}]`);ce.push(...Le)}})}return ce},K=W(Z).join("|"),q=`${Z.id}-${R}`;Pe.value.get(q)!==K&&(Pe.value.set(q,K),Object.keys(Z).filter(ae=>Array.isArray(Z[ae])).forEach(ae=>{Z[ae].length>0}));const ee=w.templateProcessor.renderComponentWithNested(Z,R,(se,ae)=>w.utils.template.getTemplate(se,ae,T.value),(se,ae,ce,$e)=>w.templateProcessor.renderNestedComponentsWithUI(se,ae,Ee=>Ee.join("-"),$e||((Ee,Se)=>w.utils.template.getTemplate(Ee,Se,T.value))));return Z.id,C(ee)},Fe=M=>{s("update:parts",M)},_e=M=>{ke.value=M,At.value=!0},he=M=>{const{type:x,title:R}=M;if(confirm(`パーツ「${R}」を削除しますか？`)){const Z=J=>J.map(K=>K.type===x?{...K,module:K.module.filter(q=>q.title!==R)}:K).filter(K=>K.module.length>0),W=Z(T.value);if(T.value=W,s("update:parts",W),w.state.localCommonParts.value.length>0){const J=Z(w.state.localCommonParts.value);w.state.localCommonParts.value=J,s("update:commonParts",J)}if(w.state.localIndividualParts.value.length>0){const J=Z(w.state.localIndividualParts.value);w.state.localIndividualParts.value=J,s("update:individualParts",J)}}},xe=M=>{const x=typeof M=="string"?M:M.body||"",R=w.computed.renderPartPreview(x);return C(R)},Ye=M=>{const{type:x,title:R,body:Z,category:W="common"}=M,J=[...T.value];let K=J.find(H=>H.type===x);K||(K={type:x,module:[]},J.push(K));const q={title:R,body:Z,category:W};if(ke.value){const H=K.module.findIndex(Y=>Y.title===ke.value.module.title);H!==-1&&(K.module[H]=q)}else K.module.push(q);T.value=J,s("update:parts",J),Fr()},{activeTab:ye,switchToTab:Ot}=rc(),mt=M=>{Ot(M),w.switchToTab(M)},bt=w.state.showPartSelector,Bo=w.state.showNestedPartSelector,At=e.ref(!1),at=M=>{w.openPartSelector(M)},io=()=>{w.closePartSelector()},Mr=()=>{w.closeNestedPartSelector()},_p=()=>{At.value=!0},Fr=()=>{At.value=!1,ke.value=null},$p=w.state.showEditor,Te=e.ref([]),Ve=e.ref([]),xr=M=>{Te.value=M,s("update:commonImages",M)},Lr=M=>{Ve.value=M,s("update:individualImages",M)},Or=()=>{s("update:commonImages",Te.value)},Rr=()=>{s("update:individualImages",Ve.value)},Mo=wr(),Ep=(M,x,R)=>{c.debug("🔧 selectPart呼び出し:",{type:M,module:x,index:R,insertPosition:w.state.insertPosition.value});const Z=ut.value.createNewComponent(M,x),W=R!==void 0?R:w.state.insertPosition.value;c.debug("🔧 新しいコンポーネント作成:",Z),c.debug("🔧 挿入位置:",W),w.actions.addPart(Z,W),io()},wp=(M,x)=>{const R=w.state.nestedInsertPath.value,Z=w.state.nestedInsertPosition.value,W=ut.value.createNewComponent(M,x);w.actions.addNestedPart(R,Z,W),Mr()},ut=e.computed(()=>{const M=T.value&&T.value.length>0?T.value:n.parts||[];return c.debug("componentUtils更新: parts length:",M.length),no(M)}),zp=M=>ut.value.getFieldInfo(M),vp=(M,x,R)=>ut.value.shouldShowBasicField(M,x,R),Cp=(M,x,R)=>ut.value.shouldShowArrayField(M,x,R),Ap=(M,x,R,Z,W)=>ut.value.shouldShowArrayItemField(M,x,R,Z,W),Np=M=>ut.value.getInputType(M),kp=(M,x,R)=>ut.value.isCheckboxChecked(M,x,R),Pp=(M,x)=>{const R=N.value;if(R){if(R[M]=x,R._isZForItem){const Z=R._parentComponentId,W=R._arrayName,J=R._arrayIndex;c.debug(`🔄 z-for配列アイテムリアルタイム更新: ${Z}.${W}[${J}].${M} = ${x}`);const K=(H,Y)=>{for(const ee of H){if(ee.id===Y)return ee;if(ee.nested_parts&&Array.isArray(ee.nested_parts)){const me=K(ee.nested_parts,Y);if(me)return me}for(const[me,se]of Object.entries(ee))if(Array.isArray(se)&&me!=="nested_parts"){for(const ae of se)if(ae&&typeof ae=="object"){for(const[ce,$e]of Object.entries(ae))if(Array.isArray($e)){const Ee=K($e,Y);if(Ee)return Ee}}}}return null},q=K(z.value,Z);if(q&&Array.isArray(q[W])){const H=q[W];J>=0&&J<H.length&&(H[J][M]=x,c.debug(`✅ z-for配列アイテム更新完了: ${Z}.${W}[${J}].${M}`))}}s("update:page",z.value)}};e.watch(()=>n.commonImages,M=>{Array.isArray(M)&&(Te.value=JSON.parse(JSON.stringify(M)))},{immediate:!0}),e.watch(()=>n.individualImages,M=>{Array.isArray(M)&&(Ve.value=JSON.parse(JSON.stringify(M)))},{immediate:!0});let Fo=null;e.watch(()=>z.value,()=>{Fo&&e.nextTick(()=>{Fo()})},{deep:!0});const Sp=(M,x,R)=>{m.value=M,g.value=x,i.value=R,$.value=!0},Hr=()=>{$.value=!1,m.value=null,g.value="",i.value=""},Ip=(M,x)=>{if(m.value&&g.value){let R=M,Z=null;M.startsWith("data:")?(Z=[...Te.value,...Ve.value].find(K=>h(K)===M),Z&&(R=Z.url)):Z=[...Te.value,...Ve.value].find(K=>K.url===M),Z&&!M.startsWith("data:")&&Z.fileData?.base64&&Z.fileData.base64.trim()!==""&&A(Z.id),m.value[g.value]=R;const W=g.value.replace(/url$/i,"alt").replace(/image$/i,"alt");W!==g.value&&m.value[W]!==void 0&&(m.value[W]=x),s("update:page",z.value),e.nextTick(()=>{e.triggerRef(z),T.value&&e.triggerRef(T)}),c.debug("🖼️ 画像選択完了:",R)}Hr()},Zr=M=>{if(!a.value||!I.value)return;const x=M.target,R=document.querySelector(`.${f.value}`);!R||!R.contains(x)||x.closest(".zero-code-rich-text-toolbar")||x===a.value||a.value.contains(x)||(c.debug("🔧 編集外エリアクリック、自動保存してツールバー非表示"),D(!0))};let xo=null,co=null;return e.onMounted(async()=>{c.debug("🔧 ZeroCode初期化開始"),document.addEventListener("click",Zr),c.debug("🔧 グローバルクリックリスナー追加完了");const M=()=>{c.debug("🖼️ 浮遊編集ボタン追加処理開始");const W=document.querySelector(`.${f.value}`);if(!W)return;const J=W.querySelectorAll("img");c.debug("🖼️ 検出された画像数:",J.length),J.forEach(K=>{const q=K;if(q.hasAttribute("data-edit-button-id")||!q.classList.contains("zero-code-editable-image"))return;const H=z.value?.[0];if(H)try{const Y=q.getBoundingClientRect();c.debug("🔍 画像位置情報:",{src:q.src.substring(q.src.lastIndexOf("/")+1),rect:{top:Y.top,left:Y.left,right:Y.right,bottom:Y.bottom,width:Y.width,height:Y.height},scrollY:window.scrollY,scrollX:window.scrollX});const ee=document.createElement("button");ee.innerHTML="✏️",ee.className="zero-code-image-floating-button";const me=Y.top+8,se=Y.right-32;c.debug("🔍 ボタン計算位置:",{buttonTop:me,buttonLeft:se}),ee.style.cssText=`
              position: fixed !important;
              top: ${me}px !important;
              left: ${se}px !important;
              width: 28px !important;
              height: 28px !important;
              background: #3b82f6 !important;
              color: #ffffff !important;
              border: 2px solid #ffffff !important;
              border-radius: 50% !important;
              font-size: 12px !important;
              cursor: pointer !important;
              box-shadow: 0 3px 12px rgba(59, 130, 246, 0.4), 0 1px 4px rgba(0, 0, 0, 0.2) !important;
              z-index: 1000 !important;
              opacity: 0 !important;
              font-family: inherit !important;
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              pointer-events: auto !important;
            `,q.setAttribute("data-edit-button-id",`edit-btn-${Date.now()}`),ee.setAttribute("data-target-image",q.getAttribute("data-edit-button-id"));const ae=()=>{ee.style.opacity="1"},ce=()=>{ee.style.opacity="0"};q.addEventListener("mouseenter",ae),q.addEventListener("mouseleave",ce),ee.addEventListener("mouseenter",ae),ee.addEventListener("mouseleave",ce);const $e=()=>{if(document.body.contains(q)){const Ee=q.getBoundingClientRect(),Se=Ee.top+8,we=Ee.right-32;ee.style.top=`${Se}px`,ee.style.left=`${we}px`}else ee.remove()};window.addEventListener("scroll",$e),window.addEventListener("resize",$e),ee.addEventListener("click",Ee=>{if(Ee.preventDefault(),Ee.stopPropagation(),c.debug("🖼️ 浮遊編集ボタンクリック"),H){const Se=Object.keys(H).filter(we=>we.toLowerCase().includes("url")||we.toLowerCase().includes("image")||we.toLowerCase().includes("icon"));if(c.debug("🔍 コンポーネントデータ:",H),c.debug("🔍 画像フィールド一覧:",Se),c.debug("🔍 各フィールドの値:",Se.reduce((we,Be)=>(we[Be]=H[Be],we),{})),Se.length>0){let we=Se[0];const Be=q.src;c.debug("🔍 クリックされた画像のsrc:",Be);for(const Ue of Se){const Le=H[Ue];if(c.debug(`🔍 フィールド ${Ue} の値をチェック:`,Le),Le&&typeof Le=="string"){const Rt=[...Te.value||[],...Ve.value||[]];let Lo=null;if(Rt.length>0&&(Lo=Rt.find(Je=>!!(Je.id===Le||Je.url===Le||Je.name===Le||Le.endsWith("/"+Je.name)||Je.url.endsWith(Le)||Le.split("/").pop()===Je.name))),Lo)try{const Je=h(Lo);if(c.debug(`🔍 ${Ue}フィールドの解決されたsrc:`,Je),Je===Be){c.debug(`✅ 一致発見! フィールド: ${Ue}`),we=Ue;break}}catch(Je){c.debug("🔍 画像解決エラー:",Je)}if(Le===Be){c.debug(`✅ 直接一致発見! フィールド: ${Ue}`),we=Ue;break}}}c.debug("🖼️ 特定されたフィールド:",we,"クリックされた画像:",Be),Sp(H,we,q.src)}else c.debug("🔍 画像フィールドが見つかりません")}else c.debug("🔍 テスト用クリック - コンポーネントなし")}),document.body.appendChild(ee),c.debug("🖼️ 浮遊編集ボタン追加完了")}catch(Y){c.error("🚨 画像ボタン追加エラー:",Y)}})};Fo=M,setTimeout(()=>{c.debug("🔍 5秒後の画像ボタン追加実行"),M()},5e3),e.nextTick(()=>{c.debug("🔍 nextTick後の浮遊ボタン追加実行"),M()});const x=new MutationObserver(()=>{M()}),R=document.querySelector(`.${f.value}`);R&&x.observe(R,{childList:!0,subtree:!0});const Z=co;co=W=>{x.disconnect(),Z&&Z(W)},c.debug("🔧 画像編集ボタン追加処理完了"),c.debug("🔧 イベントリスナー設定中..."),w.setupEventListeners(),c.debug("🔧 EventBusリスナー登録中..."),Re.on("reorderZForArrayItem",({componentId:W,arrayName:J,fromIndex:K,toIndex:q})=>{c.debug("🔄 z-for並び替えイベント受信:",{componentId:W,arrayName:J,fromIndex:K,toIndex:q});const H=z.value.find(ee=>ee.id===W);if(!H){c.warn("対象コンポーネントが見つかりません:",{componentId:W,arrayName:J,availableIds:z.value.map(ee=>ee.id)});return}let Y=null;if(H.arrayFields&&(Y=H.arrayFields[J]),!Y&&H[J]&&(Y=H[J]),!Y||!Array.isArray(Y)){c.warn("指定された配列フィールドが見つからないか、配列ではありません:",{componentId:W,arrayName:J,foundDirectly:!!H[J],foundInArrayFields:!!(H.arrayFields&&H.arrayFields[J]),itemType:typeof Y});return}if(K>=0&&q>=0&&K<Y.length&&q<Y.length){const[ee]=Y.splice(K,1);Y.splice(q,0,ee),c.debug("✅ z-for並び替え完了:",{arrayName:J,from:K,to:q})}else c.warn("無効な並び替えインデックス:",{fromIndex:K,toIndex:q,arrayLength:Y.length})}),c.debug("🔧 グローバル関数公開中..."),w.exposeGlobalFunctions((W,J)=>{c.debug("🔧 Tiptap編集開始:",{componentId:W,paramName:J}),I.value=!0,w.actions.startTiptapEdit(W,J,[],0)}),typeof window<"u"&&(window.testAddImageButtons=()=>{c.debug("🔍 手動テスト：画像ボタン追加実行"),M()},window.testImageInfo=()=>{const W=document.querySelector(`.${f.value}`);if(!W)return;const J=W.querySelectorAll("img");c.debug("🔍 手動テスト：全画像数",J.length),J.forEach((q,H)=>{const Y=q.getBoundingClientRect();c.debug(`🔍 画像${H}:`,{src:q.src.substring(q.src.lastIndexOf("/")+1),parent:q.parentElement?.tagName,hasDataId:!!q.closest("[data-component-id]"),visible:Y.width>0&&Y.height>0,rect:{top:Y.top,left:Y.left,width:Y.width,height:Y.height}})});const K=document.querySelectorAll(".zero-code-image-floating-button");c.debug("🔍 現在の浮遊ボタン数:",K.length)}),typeof window<"u"&&(window.getLatestComponentData=W=>{const J=z.value.find(H=>H.id===W);if(J)return J;const K=/^(.+?)_([^_]+_[^_]+)_(\d+)$/,q=W.match(K);if(q){const[,H,Y,ee]=q,me=parseInt(ee,10),se=z.value.find(ae=>ae.id===H);if(se&&Array.isArray(se[Y])&&se[Y][me]){const ae=se[Y][me];return{...se,...ae,type:se.type,module_name:se.module_name,id:W}}}return null}),window.toggleNestedCollapse=W=>{c.debug("🔧 ネストパーツ折りたたみ切り替え:",W),Mo.toggleCollapse(W),e.nextTick(()=>{const J=document.getElementById(`nested-content-${W}`),K=document.querySelector(`[onclick="window.toggleNestedCollapse('${W}')"]`);J&&K&&(Mo.isCollapsed(W)?(J.style.display="none",K.textContent="＋",K.setAttribute("title","展開")):(J.style.display="block",K.textContent="－",K.setAttribute("title","折りたたみ")))})},window.isNestedCollapsed=W=>Mo.isCollapsed(W),window.reorderZForArrayItem=(W,J,K,q)=>{c.debug("🔄 reorderZForArrayItem グローバル関数呼び出し:",{componentId:W,arrayName:J,fromIndex:K,toIndex:q}),Re.emit("reorderZForArrayItem",{componentId:W,arrayName:J,fromIndex:K,toIndex:q})},xo=X()||null,window.startRichTextEdit=async(W,J,K,q)=>{c.debug("🔧 リッチテキスト編集開始:",{componentId:W,paramName:J,currentValue:K});const H=q||window.event?.target;if(a.value===H){c.debug("🔧 既に編集中の要素、スキップ");return}if(H){a.value&&(c.debug("🔧 前回の編集セッションを終了"),D(!1)),c.debug("🔧 事前設定開始"),a.value=H,l.value=H.innerHTML,p.value=W,E.value=J,await e.nextTick(),H.contentEditable="true",c.debug("🔧 contentEditable設定完了:",H.contentEditable),H.style.userSelect="text",H.style.webkitUserSelect="text",c.debug("🔧 user-select設定完了:",H.style.userSelect),H.classList.add("editing"),c.debug("🔧 editingクラス追加完了"),c.debug("🔧 編集モード設定完了");const Y=ae=>{const ce=ae.relatedTarget;if(ce&&ce.closest(".zero-code-rich-text-toolbar")){c.debug("🔧 ツールバーへのフォーカス移動、編集継続");return}c.debug("🔧 フォーカス喪失、自動保存とツールバー非表示"),setTimeout(()=>{a.value===H&&D(!0)},150)};H.addEventListener("blur",Y),c.debug("🔧 イベントリスナー追加完了"),H._cleanup=()=>{H.removeEventListener("blur",Y),c.debug("🔧 イベントリスナークリーンアップ完了")},c.debug("🔧 ツールバー位置計算開始");const ee=H.getBoundingClientRect(),me=window.pageYOffset||document.documentElement.scrollTop,se=window.pageXOffset||document.documentElement.scrollLeft;d.value={top:ee.top+me-80,left:ee.left+se},c.debug("🔧 ツールバー位置設定完了:",d.value),c.debug("🔧 ツールバー表示開始"),I.value=!0,c.debug("🔧 リッチテキスト編集開始完了（ツールバー付き）"),await e.nextTick(),setTimeout(()=>{if(H&&a.value===H){H.focus();const ae=document.createRange(),ce=window.getSelection();if(ce&&H.childNodes.length>0){const $e=H.childNodes[H.childNodes.length-1];$e.nodeType===Node.TEXT_NODE?ae.setStart($e,$e.textContent?.length||0):ae.setStartAfter($e),ae.collapse(!0),ce.removeAllRanges(),ce.addRange(ae),c.debug("🔧 カーソルを末尾に移動完了")}else ce&&(ae.selectNodeContents(H),ae.collapse(!1),ce.removeAllRanges(),ce.addRange(ae),c.debug("🔧 空要素の末尾にカーソル設定完了"));c.debug("🔧 遅延フォーカス完了、テキスト選択準備完了（末尾から開始）")}},10)}},c.debug("localParts.value:",T.value),c.debug("props.parts:",n.parts),c.debug("🔧 グローバル関数確認:"),c.debug("  openNestedPartSelector:",typeof window.openNestedPartSelector),c.debug("  openNestedEditor:",typeof window.openNestedEditor),c.debug("✅ ZeroCode初期化完了")}),r({parts:e.computed(()=>T.value&&T.value.length>0?T.value:n.parts||[]),page:e.computed(()=>z.value||[])}),e.onUnmounted(()=>{c.debug("🔧 ZeroCode破棄処理開始"),document.removeEventListener("click",Zr),co&&document.removeEventListener("click",co);const M=document.querySelector(`.${f.value}`);(M?M.querySelectorAll(".zero-code-image-floating-button"):[]).forEach(R=>R.remove()),xo&&xo(),Re.off("reorderZForArrayItem"),c.debug("🔧 ZeroCode破棄処理完了")}),(M,x)=>(e.openBlock(),e.createBlock(Bc,null,{default:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(`zero-code editor-container ${f.value}`)},[e.createVNode(zc,{"active-tab":e.unref(ye)||"editor","onUpdate:activeTab":mt},null,8,["active-tab"]),e.createVNode(Rc,{show:I.value,position:d.value,actions:b.actions,"editing-state":b.editingState,"is-editing":I.value,onExecuteCommand:b.executeCommand,onSave:x[0]||(x[0]=R=>b.stopEdit(!0)),onCancel:x[1]||(x[1]=R=>b.stopEdit(!1))},null,8,["show","position","actions","editing-state","is-editing","onExecuteCommand"]),e.createElementVNode("div",mp,[e.unref(ye)==="editor"?(e.openBlock(),e.createBlock(Rs,{key:0,"data-tab":e.unref(B),"editable-page-data":e.unref(z),"local-parts":e.unref(T),"local-common-parts":e.unref(w).state.localCommonParts.value,"local-individual-parts":e.unref(w).state.localIndividualParts.value,parts:n.parts||[],"common-images":Te.value,"individual-images":Ve.value,"show-part-selector":e.unref(bt),"show-nested-part-selector":e.unref(Bo),"show-editor":e.unref($p),"selected-component":e.unref(N),"render-component-with-nested":Ae,"get-field-info":zp,"should-show-basic-field":vp,"should-show-array-field":Cp,"should-show-array-item-field":Ap,"get-input-type":Np,"is-checkbox-checked":kp,"parts-data":e.unref(T)&&e.unref(T).length>0?e.unref(T):n.parts||[],"is-text-editing":P.value,"onUpdate:dataTab":x[2]||(x[2]=R=>B.value=R),onAddPart:at,onEditPart:k,onDeletePart:V,onReorderParts:F,onClosePartSelector:io,onSelectPart:Ep,onCloseNestedPartSelector:Mr,onSelectNestedPart:wp,onCloseEditor:S,onUpdateEditorValue:Pp},null,8,["data-tab","editable-page-data","local-parts","local-common-parts","local-individual-parts","parts","common-images","individual-images","show-part-selector","show-nested-part-selector","show-editor","selected-component","parts-data","is-text-editing"])):e.createCommentVNode("",!0),e.unref(ye)==="parts"?(e.openBlock(),e.createBlock(Xl,{key:1,"local-parts":e.unref(T),"local-common-parts":e.unref(w).state.localCommonParts.value,"local-individual-parts":e.unref(w).state.localIndividualParts.value,"show-part-registration":At.value,"existing-part-types":pt.value,"editing-part":ke.value,"render-part-preview":xe,onUpdateParts:Fe,onShowRegistration:_p,onEditPart:_e,onDeletePart:he,onCloseRegistration:Fr,onSavePart:Ye},null,8,["local-parts","local-common-parts","local-individual-parts","show-part-registration","existing-part-types","editing-part"])):e.createCommentVNode("",!0),e.unref(ye)==="preview"?(e.openBlock(),e.createBlock(Ti,{key:2,"editable-page-data":e.unref(z),"local-parts":e.unref(T),parts:n.parts||[],"common-images":Te.value,"individual-images":Ve.value},null,8,["editable-page-data","local-parts","parts","common-images","individual-images"])):e.createCommentVNode("",!0),e.unref(ye)==="images"?(e.openBlock(),e.createBlock(oc,{key:3,"common-images":Te.value,"individual-images":Ve.value,onUpdateCommonImages:xr,onUpdateIndividualImages:Lr,onSendCommonImagesData:Or,onSendIndividualImagesData:Rr},null,8,["common-images","individual-images"])):e.createCommentVNode("",!0)]),e.createElementVNode("div",up,[e.createElementVNode("button",{class:"zero-code-send-btn zero-code-page-btn",onClick:x[3]||(x[3]=R=>G("page"))},"Pageデータを表示"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-common-parts-btn",onClick:x[4]||(x[4]=R=>G("commonParts"))},"共通Partsデータを表示"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-individual-parts-btn",onClick:x[5]||(x[5]=R=>G("individualParts"))},"個別Partsデータを表示"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-common-images-btn",onClick:x[6]||(x[6]=R=>G("commonImages"))}," 共通画像データを表示 "),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-individual-images-btn",onClick:x[7]||(x[7]=R=>G("individualImages"))}," 個別画像データを表示 "),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-reset-btn",onClick:De},"リセット")]),O.value?(e.openBlock(),e.createElementBlock("div",gp,[e.createElementVNode("div",fp,[e.createElementVNode("h4",null,e.toDisplayString(L.value),1),e.createElementVNode("button",{class:"zero-code-close-button",onClick:ne},"✕")]),e.createElementVNode("div",hp,[e.createElementVNode("pre",yp,e.toDisplayString(de.value),1)]),e.createElementVNode("div",{class:"zero-code-data-display-footer"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:pe},"クリップボードにコピー"),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",onClick:Ce},"このデータを送信")])])):e.createCommentVNode("",!0),e.createVNode(pp,{visible:$.value,"common-images":Te.value,"individual-images":Ve.value,"current-value":i.value,onClose:Hr,onSelect:Ip},null,8,["visible","common-images","individual-images","current-value"])],2)]),_:1}))}}),Vo=e.defineCustomElement(bp,{shadowRoot:!1});customElements.define("zero-code",Vo),st.ZeroCode=Vo,st.default=Vo,Object.defineProperties(st,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
