(function(Le,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(Le=typeof globalThis<"u"?globalThis:Le||self,e(Le.VueCMSEditor={},Le.Vue))})(this,function(Le,e){"use strict";var Ap=Object.defineProperty;var Np=(Le,e,d)=>e in Le?Ap(Le,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):Le[e]=d;var Ht=(Le,e,d)=>Np(Le,typeof e!="symbol"?e+"":e,d);const d={debug:(t,...r)=>{},info:(t,...r)=>{},warn:(t,...r)=>{console.warn(`⚠️ ${t}`,...r)},error:(t,...r)=>{console.error(`❌ ${t}`,...r)},success:(t,...r)=>{},process:(t,...r)=>{},time:t=>{},timeEnd:t=>{},group:t=>{},groupEnd:()=>{}};var jr=Object.defineProperty,Zt=Object.getOwnPropertySymbols,Ro=Object.prototype.hasOwnProperty,Ho=Object.prototype.propertyIsEnumerable,Zo=(t,r,o)=>r in t?jr(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,$t=(t,r)=>{for(var o in r||(r={}))Ro.call(r,o)&&Zo(t,o,r[o]);if(Zt)for(var o of Zt(r))Ho.call(r,o)&&Zo(t,o,r[o]);return t},jo=(t,r)=>{var o={};for(var n in t)Ro.call(t,n)&&r.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&Zt)for(var n of Zt(t))r.indexOf(n)<0&&Ho.call(t,n)&&(o[n]=t[n]);return o};const Uo="[vue-draggable-plus]: ";function Ur(t){console.warn(Uo+t)}function Wr(t){console.error(Uo+t)}function Wo(t,r,o){return o>=0&&o<t.length&&t.splice(o,0,t.splice(r,1)[0]),t}function qr(t){return t.replace(/-(\w)/g,(r,o)=>o?o.toUpperCase():"")}function Gr(t){return Object.keys(t).reduce((r,o)=>(typeof t[o]<"u"&&(r[qr(o)]=t[o]),r),{})}function qo(t,r){return Array.isArray(t)&&t.splice(r,1),t}function Go(t,r,o){return Array.isArray(t)&&t.splice(r,0,o),t}function Kr(t){return typeof t>"u"}function Jr(t){return typeof t=="string"}function Ko(t,r,o){const n=t.children[o];t.insertBefore(r,n)}function mo(t){t.parentNode&&t.parentNode.removeChild(t)}function Xr(t,r=document){var o;let n=null;return typeof r?.querySelector=="function"?n=(o=r?.querySelector)==null?void 0:o.call(r,t):n=document.querySelector(t),n||Ur(`Element not found: ${t}`),n}function Yr(t,r,o=null){return function(...n){return t.apply(o,n),r.apply(o,n)}}function Qr(t,r){const o=$t({},t);return Object.keys(r).forEach(n=>{o[n]?o[n]=Yr(t[n],r[n]):o[n]=r[n]}),o}function en(t){return t instanceof HTMLElement}function Jo(t,r){Object.keys(t).forEach(o=>{r(o,t[o])})}function tn(t){return t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97)}const on=Object.assign;/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Xo(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),o.push.apply(o,n)}return o}function Ye(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?Xo(Object(o),!0).forEach(function(n){rn(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Xo(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function jt(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jt=function(r){return typeof r}:jt=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},jt(t)}function rn(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function rt(){return rt=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},rt.apply(this,arguments)}function nn(t,r){if(t==null)return{};var o={},n=Object.keys(t),s,f;for(f=0;f<n.length;f++)s=n[f],!(r.indexOf(s)>=0)&&(o[s]=t[s]);return o}function an(t,r){if(t==null)return{};var o=nn(t,r),n,s;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(t);for(s=0;s<f.length;s++)n=f[s],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var sn="1.15.2";function nt(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var at=nt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Nt=nt(/Edge/i),Yo=nt(/firefox/i),kt=nt(/safari/i)&&!nt(/chrome/i)&&!nt(/android/i),Qo=nt(/iP(ad|od|hone)/i),er=nt(/chrome/i)&&nt(/android/i),tr={capture:!1,passive:!1};function ie(t,r,o){t.addEventListener(r,o,!at&&tr)}function le(t,r,o){t.removeEventListener(r,o,!at&&tr)}function Ut(t,r){if(r){if(r[0]===">"&&(r=r.substring(1)),t)try{if(t.matches)return t.matches(r);if(t.msMatchesSelector)return t.msMatchesSelector(r);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(r)}catch{return!1}return!1}}function ln(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function We(t,r,o,n){if(t){o=o||document;do{if(r!=null&&(r[0]===">"?t.parentNode===o&&Ut(t,r):Ut(t,r))||n&&t===o)return t;if(t===o)break}while(t=ln(t))}return null}var or=/\s+/g;function Re(t,r,o){if(t&&r)if(t.classList)t.classList[o?"add":"remove"](r);else{var n=(" "+t.className+" ").replace(or," ").replace(" "+r+" "," ");t.className=(n+(o?" "+r:"")).replace(or," ")}}function te(t,r,o){var n=t&&t.style;if(n){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(o=t.currentStyle),r===void 0?o:o[r];!(r in n)&&r.indexOf("webkit")===-1&&(r="-webkit-"+r),n[r]=o+(typeof o=="string"?"":"px")}}function _t(t,r){var o="";if(typeof t=="string")o=t;else do{var n=te(t,"transform");n&&n!=="none"&&(o=n+" "+o)}while(!r&&(t=t.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(o)}function rr(t,r,o){if(t){var n=t.getElementsByTagName(r),s=0,f=n.length;if(o)for(;s<f;s++)o(n[s],s);return n}return[]}function Qe(){var t=document.scrollingElement;return t||document.documentElement}function we(t,r,o,n,s){if(!(!t.getBoundingClientRect&&t!==window)){var f,y,h,b,A,N,w;if(t!==window&&t.parentNode&&t!==Qe()?(f=t.getBoundingClientRect(),y=f.top,h=f.left,b=f.bottom,A=f.right,N=f.height,w=f.width):(y=0,h=0,b=window.innerHeight,A=window.innerWidth,N=window.innerHeight,w=window.innerWidth),(r||o)&&t!==window&&(s=s||t.parentNode,!at))do if(s&&s.getBoundingClientRect&&(te(s,"transform")!=="none"||o&&te(s,"position")!=="static")){var k=s.getBoundingClientRect();y-=k.top+parseInt(te(s,"border-top-width")),h-=k.left+parseInt(te(s,"border-left-width")),b=y+f.height,A=h+f.width;break}while(s=s.parentNode);if(n&&t!==window){var v=_t(s||t),S=v&&v.a,B=v&&v.d;v&&(y/=B,h/=S,w/=S,N/=B,b=y+N,A=h+w)}return{top:y,left:h,bottom:b,right:A,width:w,height:N}}}function nr(t,r,o){for(var n=lt(t,!0),s=we(t)[r];n;){var f=we(n)[o],y=void 0;if(y=s>=f,!y)return n;if(n===Qe())break;n=lt(n,!1)}return!1}function Et(t,r,o,n){for(var s=0,f=0,y=t.children;f<y.length;){if(y[f].style.display!=="none"&&y[f]!==oe.ghost&&(n||y[f]!==oe.dragged)&&We(y[f],o.draggable,t,!1)){if(s===r)return y[f];s++}f++}return null}function uo(t,r){for(var o=t.lastElementChild;o&&(o===oe.ghost||te(o,"display")==="none"||r&&!Ut(o,r));)o=o.previousElementSibling;return o||null}function Ue(t,r){var o=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==oe.clone&&(!r||Ut(t,r))&&o++;return o}function ar(t){var r=0,o=0,n=Qe();if(t)do{var s=_t(t),f=s.a,y=s.d;r+=t.scrollLeft*f,o+=t.scrollTop*y}while(t!==n&&(t=t.parentNode));return[r,o]}function dn(t,r){for(var o in t)if(t.hasOwnProperty(o)){for(var n in r)if(r.hasOwnProperty(n)&&r[n]===t[o][n])return Number(o)}return-1}function lt(t,r){if(!t||!t.getBoundingClientRect)return Qe();var o=t,n=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var s=te(o);if(o.clientWidth<o.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return Qe();if(n||r)return o;n=!0}}while(o=o.parentNode);return Qe()}function cn(t,r){if(t&&r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t}function go(t,r){return Math.round(t.top)===Math.round(r.top)&&Math.round(t.left)===Math.round(r.left)&&Math.round(t.height)===Math.round(r.height)&&Math.round(t.width)===Math.round(r.width)}var Pt;function sr(t,r){return function(){if(!Pt){var o=arguments,n=this;o.length===1?t.call(n,o[0]):t.apply(n,o),Pt=setTimeout(function(){Pt=void 0},r)}}}function pn(){clearTimeout(Pt),Pt=void 0}function lr(t,r,o){t.scrollLeft+=r,t.scrollTop+=o}function ir(t){var r=window.Polymer,o=window.jQuery||window.Zepto;return r&&r.dom?r.dom(t).cloneNode(!0):o?o(t).clone(!0)[0]:t.cloneNode(!0)}function dr(t,r,o){var n={};return Array.from(t.children).forEach(function(s){var f,y,h,b;if(!(!We(s,r.draggable,t,!1)||s.animated||s===o)){var A=we(s);n.left=Math.min((f=n.left)!==null&&f!==void 0?f:1/0,A.left),n.top=Math.min((y=n.top)!==null&&y!==void 0?y:1/0,A.top),n.right=Math.max((h=n.right)!==null&&h!==void 0?h:-1/0,A.right),n.bottom=Math.max((b=n.bottom)!==null&&b!==void 0?b:-1/0,A.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var He="Sortable"+new Date().getTime();function mn(){var t=[],r;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(n){if(!(te(n,"display")==="none"||n===oe.ghost)){t.push({target:n,rect:we(n)});var s=Ye({},t[t.length-1].rect);if(n.thisAnimationDuration){var f=_t(n,!0);f&&(s.top-=f.f,s.left-=f.e)}n.fromRect=s}})}},addAnimationState:function(o){t.push(o)},removeAnimationState:function(o){t.splice(dn(t,{target:o}),1)},animateAll:function(o){var n=this;if(!this.options.animation){clearTimeout(r),typeof o=="function"&&o();return}var s=!1,f=0;t.forEach(function(y){var h=0,b=y.target,A=b.fromRect,N=we(b),w=b.prevFromRect,k=b.prevToRect,v=y.rect,S=_t(b,!0);S&&(N.top-=S.f,N.left-=S.e),b.toRect=N,b.thisAnimationDuration&&go(w,N)&&!go(A,N)&&(v.top-N.top)/(v.left-N.left)===(A.top-N.top)/(A.left-N.left)&&(h=gn(v,w,k,n.options)),go(N,A)||(b.prevFromRect=A,b.prevToRect=N,h||(h=n.options.animation),n.animate(b,v,N,h)),h&&(s=!0,f=Math.max(f,h),clearTimeout(b.animationResetTimer),b.animationResetTimer=setTimeout(function(){b.animationTime=0,b.prevFromRect=null,b.fromRect=null,b.prevToRect=null,b.thisAnimationDuration=null},h),b.thisAnimationDuration=h)}),clearTimeout(r),s?r=setTimeout(function(){typeof o=="function"&&o()},f):typeof o=="function"&&o(),t=[]},animate:function(o,n,s,f){if(f){te(o,"transition",""),te(o,"transform","");var y=_t(this.el),h=y&&y.a,b=y&&y.d,A=(n.left-s.left)/(h||1),N=(n.top-s.top)/(b||1);o.animatingX=!!A,o.animatingY=!!N,te(o,"transform","translate3d("+A+"px,"+N+"px,0)"),this.forRepaintDummy=un(o),te(o,"transition","transform "+f+"ms"+(this.options.easing?" "+this.options.easing:"")),te(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){te(o,"transition",""),te(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},f)}}}}function un(t){return t.offsetWidth}function gn(t,r,o,n){return Math.sqrt(Math.pow(r.top-t.top,2)+Math.pow(r.left-t.left,2))/Math.sqrt(Math.pow(r.top-o.top,2)+Math.pow(r.left-o.left,2))*n.animation}var zt=[],fo={initializeByDefault:!0},Dt={mount:function(t){for(var r in fo)fo.hasOwnProperty(r)&&!(r in t)&&(t[r]=fo[r]);zt.forEach(function(o){if(o.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),zt.push(t)},pluginEvent:function(t,r,o){var n=this;this.eventCanceled=!1,o.cancel=function(){n.eventCanceled=!0};var s=t+"Global";zt.forEach(function(f){r[f.pluginName]&&(r[f.pluginName][s]&&r[f.pluginName][s](Ye({sortable:r},o)),r.options[f.pluginName]&&r[f.pluginName][t]&&r[f.pluginName][t](Ye({sortable:r},o)))})},initializePlugins:function(t,r,o,n){zt.forEach(function(y){var h=y.pluginName;if(!(!t.options[h]&&!y.initializeByDefault)){var b=new y(t,r,t.options);b.sortable=t,b.options=t.options,t[h]=b,rt(o,b.defaults)}});for(var s in t.options)if(t.options.hasOwnProperty(s)){var f=this.modifyOption(t,s,t.options[s]);typeof f<"u"&&(t.options[s]=f)}},getEventProperties:function(t,r){var o={};return zt.forEach(function(n){typeof n.eventProperties=="function"&&rt(o,n.eventProperties.call(r[n.pluginName],t))}),o},modifyOption:function(t,r,o){var n;return zt.forEach(function(s){t[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[r]=="function"&&(n=s.optionListeners[r].call(t[s.pluginName],o))}),n}};function fn(t){var r=t.sortable,o=t.rootEl,n=t.name,s=t.targetEl,f=t.cloneEl,y=t.toEl,h=t.fromEl,b=t.oldIndex,A=t.newIndex,N=t.oldDraggableIndex,w=t.newDraggableIndex,k=t.originalEvent,v=t.putSortable,S=t.extraEventProperties;if(r=r||o&&o[He],!!r){var B,D=r.options,i="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!at&&!Nt?B=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(B=document.createEvent("Event"),B.initEvent(n,!0,!0)),B.to=y||o,B.from=h||o,B.item=s||o,B.clone=f,B.oldIndex=b,B.newIndex=A,B.oldDraggableIndex=N,B.newDraggableIndex=w,B.originalEvent=k,B.pullMode=v?v.lastPutMode:void 0;var a=Ye(Ye({},S),Dt.getEventProperties(n,r));for(var l in a)B[l]=a[l];o&&o.dispatchEvent(B),D[i]&&D[i].call(r,B)}}var hn=["evt"],xe=function(t,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=o.evt,s=an(o,hn);Dt.pluginEvent.bind(oe)(t,r,Ye({dragEl:j,parentEl:be,ghostEl:ne,rootEl:fe,nextEl:ut,lastDownEl:Wt,cloneEl:ye,cloneHidden:it,dragStarted:St,putSortable:Ae,activeSortable:oe.active,originalEvent:n,oldIndex:wt,oldDraggableIndex:It,newIndex:Ze,newDraggableIndex:dt,hideGhostForTarget:hr,unhideGhostForTarget:yr,cloneNowHidden:function(){it=!0},cloneNowShown:function(){it=!1},dispatchSortableEvent:function(f){Ve({sortable:r,name:f,originalEvent:n})}},s))};function Ve(t){fn(Ye({putSortable:Ae,cloneEl:ye,targetEl:j,rootEl:fe,oldIndex:wt,oldDraggableIndex:It,newIndex:Ze,newDraggableIndex:dt},t))}var j,be,ne,fe,ut,Wt,ye,it,wt,Ze,It,dt,qt,Ae,vt=!1,Gt=!1,Kt=[],gt,qe,ho,yo,cr,pr,St,Ct,Tt,Vt=!1,Jt=!1,Xt,Ie,bo=[],$o=!1,Yt=[],Qt=typeof document<"u",eo=Qo,mr=Nt||at?"cssFloat":"float",yn=Qt&&!er&&!Qo&&"draggable"in document.createElement("div"),ur=function(){if(Qt){if(at)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),gr=function(t,r){var o=te(t),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),s=Et(t,0,r),f=Et(t,1,r),y=s&&te(s),h=f&&te(f),b=y&&parseInt(y.marginLeft)+parseInt(y.marginRight)+we(s).width,A=h&&parseInt(h.marginLeft)+parseInt(h.marginRight)+we(f).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&y.float&&y.float!=="none"){var N=y.float==="left"?"left":"right";return f&&(h.clear==="both"||h.clear===N)?"vertical":"horizontal"}return s&&(y.display==="block"||y.display==="flex"||y.display==="table"||y.display==="grid"||b>=n&&o[mr]==="none"||f&&o[mr]==="none"&&b+A>n)?"vertical":"horizontal"},bn=function(t,r,o){var n=o?t.left:t.top,s=o?t.right:t.bottom,f=o?t.width:t.height,y=o?r.left:r.top,h=o?r.right:r.bottom,b=o?r.width:r.height;return n===y||s===h||n+f/2===y+b/2},$n=function(t,r){var o;return Kt.some(function(n){var s=n[He].options.emptyInsertThreshold;if(!(!s||uo(n))){var f=we(n),y=t>=f.left-s&&t<=f.right+s,h=r>=f.top-s&&r<=f.bottom+s;if(y&&h)return o=n}}),o},fr=function(t){function r(s,f){return function(y,h,b,A){var N=y.options.group.name&&h.options.group.name&&y.options.group.name===h.options.group.name;if(s==null&&(f||N))return!0;if(s==null||s===!1)return!1;if(f&&s==="clone")return s;if(typeof s=="function")return r(s(y,h,b,A),f)(y,h,b,A);var w=(f?y:h).options.group.name;return s===!0||typeof s=="string"&&s===w||s.join&&s.indexOf(w)>-1}}var o={},n=t.group;(!n||jt(n)!="object")&&(n={name:n}),o.name=n.name,o.checkPull=r(n.pull,!0),o.checkPut=r(n.put),o.revertClone=n.revertClone,t.group=o},hr=function(){!ur&&ne&&te(ne,"display","none")},yr=function(){!ur&&ne&&te(ne,"display","")};Qt&&!er&&document.addEventListener("click",function(t){if(Gt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Gt=!1,!1},!0);var ft=function(t){if(j){t=t.touches?t.touches[0]:t;var r=$n(t.clientX,t.clientY);if(r){var o={};for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);o.target=o.rootEl=r,o.preventDefault=void 0,o.stopPropagation=void 0,r[He]._onDragOver(o)}}},_n=function(t){j&&j.parentNode[He]._isOutsideThisEl(t.target)};function oe(t,r){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=r=rt({},r),t[He]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return gr(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(f,y){f.setData("Text",y.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:oe.supportPointer!==!1&&"PointerEvent"in window&&!kt,emptyInsertThreshold:5};Dt.initializePlugins(this,t,o);for(var n in o)!(n in r)&&(r[n]=o[n]);fr(r);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=r.forceFallback?!1:yn,this.nativeDraggable&&(this.options.touchStartThreshold=1),r.supportPointer?ie(t,"pointerdown",this._onTapStart):(ie(t,"mousedown",this._onTapStart),ie(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(ie(t,"dragover",this),ie(t,"dragenter",this)),Kt.push(this.el),r.store&&r.store.get&&this.sort(r.store.get(this)||[]),rt(this,mn())}oe.prototype={constructor:oe,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(Ct=null)},_getDirection:function(t,r){return typeof this.options.direction=="function"?this.options.direction.call(this,t,r,j):this.options.direction},_onTapStart:function(t){if(t.cancelable){var r=this,o=this.el,n=this.options,s=n.preventOnFilter,f=t.type,y=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,h=(y||t).target,b=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||h,A=n.filter;if(kn(o),!j&&!(/mousedown|pointerdown/.test(f)&&t.button!==0||n.disabled)&&!b.isContentEditable&&!(!this.nativeDraggable&&kt&&h&&h.tagName.toUpperCase()==="SELECT")&&(h=We(h,n.draggable,o,!1),!(h&&h.animated)&&Wt!==h)){if(wt=Ue(h),It=Ue(h,n.draggable),typeof A=="function"){if(A.call(this,t,h,this)){Ve({sortable:r,rootEl:b,name:"filter",targetEl:h,toEl:o,fromEl:o}),xe("filter",r,{evt:t}),s&&t.cancelable&&t.preventDefault();return}}else if(A&&(A=A.split(",").some(function(N){if(N=We(b,N.trim(),o,!1),N)return Ve({sortable:r,rootEl:N,name:"filter",targetEl:h,fromEl:o,toEl:o}),xe("filter",r,{evt:t}),!0}),A)){s&&t.cancelable&&t.preventDefault();return}n.handle&&!We(b,n.handle,o,!1)||this._prepareDragStart(t,y,h)}}},_prepareDragStart:function(t,r,o){var n=this,s=n.el,f=n.options,y=s.ownerDocument,h;if(o&&!j&&o.parentNode===s){var b=we(o);if(fe=s,j=o,be=j.parentNode,ut=j.nextSibling,Wt=o,qt=f.group,oe.dragged=j,gt={target:j,clientX:(r||t).clientX,clientY:(r||t).clientY},cr=gt.clientX-b.left,pr=gt.clientY-b.top,this._lastX=(r||t).clientX,this._lastY=(r||t).clientY,j.style["will-change"]="all",h=function(){if(xe("delayEnded",n,{evt:t}),oe.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Yo&&n.nativeDraggable&&(j.draggable=!0),n._triggerDragStart(t,r),Ve({sortable:n,name:"choose",originalEvent:t}),Re(j,f.chosenClass,!0)},f.ignore.split(",").forEach(function(A){rr(j,A.trim(),_o)}),ie(y,"dragover",ft),ie(y,"mousemove",ft),ie(y,"touchmove",ft),ie(y,"mouseup",n._onDrop),ie(y,"touchend",n._onDrop),ie(y,"touchcancel",n._onDrop),Yo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,j.draggable=!0),xe("delayStart",this,{evt:t}),f.delay&&(!f.delayOnTouchOnly||r)&&(!this.nativeDraggable||!(Nt||at))){if(oe.eventCanceled){this._onDrop();return}ie(y,"mouseup",n._disableDelayedDrag),ie(y,"touchend",n._disableDelayedDrag),ie(y,"touchcancel",n._disableDelayedDrag),ie(y,"mousemove",n._delayedDragTouchMoveHandler),ie(y,"touchmove",n._delayedDragTouchMoveHandler),f.supportPointer&&ie(y,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(h,f.delay)}else h()}},_delayedDragTouchMoveHandler:function(t){var r=t.touches?t.touches[0]:t;Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){j&&_o(j),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;le(t,"mouseup",this._disableDelayedDrag),le(t,"touchend",this._disableDelayedDrag),le(t,"touchcancel",this._disableDelayedDrag),le(t,"mousemove",this._delayedDragTouchMoveHandler),le(t,"touchmove",this._delayedDragTouchMoveHandler),le(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,r){r=r||t.pointerType=="touch"&&t,!this.nativeDraggable||r?this.options.supportPointer?ie(document,"pointermove",this._onTouchMove):r?ie(document,"touchmove",this._onTouchMove):ie(document,"mousemove",this._onTouchMove):(ie(j,"dragend",this),ie(fe,"dragstart",this._onDragStart));try{document.selection?oo(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,r){if(vt=!1,fe&&j){xe("dragStarted",this,{evt:r}),this.nativeDraggable&&ie(document,"dragover",_n);var o=this.options;!t&&Re(j,o.dragClass,!1),Re(j,o.ghostClass,!0),oe.active=this,t&&this._appendGhost(),Ve({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){if(qe){this._lastX=qe.clientX,this._lastY=qe.clientY,hr();for(var t=document.elementFromPoint(qe.clientX,qe.clientY),r=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(qe.clientX,qe.clientY),t!==r);)r=t;if(j.parentNode[He]._isOutsideThisEl(t),r)do{if(r[He]){var o=void 0;if(o=r[He]._onDragOver({clientX:qe.clientX,clientY:qe.clientY,target:t,rootEl:r}),o&&!this.options.dragoverBubble)break}t=r}while(r=r.parentNode);yr()}},_onTouchMove:function(t){if(gt){var r=this.options,o=r.fallbackTolerance,n=r.fallbackOffset,s=t.touches?t.touches[0]:t,f=ne&&_t(ne,!0),y=ne&&f&&f.a,h=ne&&f&&f.d,b=eo&&Ie&&ar(Ie),A=(s.clientX-gt.clientX+n.x)/(y||1)+(b?b[0]-bo[0]:0)/(y||1),N=(s.clientY-gt.clientY+n.y)/(h||1)+(b?b[1]-bo[1]:0)/(h||1);if(!oe.active&&!vt){if(o&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<o)return;this._onDragStart(t,!0)}if(ne){f?(f.e+=A-(ho||0),f.f+=N-(yo||0)):f={a:1,b:0,c:0,d:1,e:A,f:N};var w="matrix(".concat(f.a,",").concat(f.b,",").concat(f.c,",").concat(f.d,",").concat(f.e,",").concat(f.f,")");te(ne,"webkitTransform",w),te(ne,"mozTransform",w),te(ne,"msTransform",w),te(ne,"transform",w),ho=A,yo=N,qe=s}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!ne){var t=this.options.fallbackOnBody?document.body:fe,r=we(j,!0,eo,!0,t),o=this.options;if(eo){for(Ie=t;te(Ie,"position")==="static"&&te(Ie,"transform")==="none"&&Ie!==document;)Ie=Ie.parentNode;Ie!==document.body&&Ie!==document.documentElement?(Ie===document&&(Ie=Qe()),r.top+=Ie.scrollTop,r.left+=Ie.scrollLeft):Ie=Qe(),bo=ar(Ie)}ne=j.cloneNode(!0),Re(ne,o.ghostClass,!1),Re(ne,o.fallbackClass,!0),Re(ne,o.dragClass,!0),te(ne,"transition",""),te(ne,"transform",""),te(ne,"box-sizing","border-box"),te(ne,"margin",0),te(ne,"top",r.top),te(ne,"left",r.left),te(ne,"width",r.width),te(ne,"height",r.height),te(ne,"opacity","0.8"),te(ne,"position",eo?"absolute":"fixed"),te(ne,"zIndex","100000"),te(ne,"pointerEvents","none"),oe.ghost=ne,t.appendChild(ne),te(ne,"transform-origin",cr/parseInt(ne.style.width)*100+"% "+pr/parseInt(ne.style.height)*100+"%")}},_onDragStart:function(t,r){var o=this,n=t.dataTransfer,s=o.options;if(xe("dragStart",this,{evt:t}),oe.eventCanceled){this._onDrop();return}xe("setupClone",this),oe.eventCanceled||(ye=ir(j),ye.removeAttribute("id"),ye.draggable=!1,ye.style["will-change"]="",this._hideClone(),Re(ye,this.options.chosenClass,!1),oe.clone=ye),o.cloneId=oo(function(){xe("clone",o),!oe.eventCanceled&&(o.options.removeCloneOnHide||fe.insertBefore(ye,j),o._hideClone(),Ve({sortable:o,name:"clone"}))}),!r&&Re(j,s.dragClass,!0),r?(Gt=!0,o._loopId=setInterval(o._emulateDragOver,50)):(le(document,"mouseup",o._onDrop),le(document,"touchend",o._onDrop),le(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(o,n,j)),ie(document,"drop",o),te(j,"transform","translateZ(0)")),vt=!0,o._dragStartId=oo(o._dragStarted.bind(o,r,t)),ie(document,"selectstart",o),St=!0,kt&&te(document.body,"user-select","none")},_onDragOver:function(t){var r=this.el,o=t.target,n,s,f,y=this.options,h=y.group,b=oe.active,A=qt===h,N=y.sort,w=Ae||b,k,v=this,S=!1;if($o)return;function B(V,L){xe(V,v,Ye({evt:t,isOwner:A,axis:k?"vertical":"horizontal",revert:f,dragRect:n,targetRect:s,canSort:N,fromSortable:w,target:o,completed:i,onMove:function(U,M){return to(fe,r,j,n,U,we(U),t,M)},changed:a},L))}function D(){B("dragOverAnimationCapture"),v.captureAnimationState(),v!==w&&w.captureAnimationState()}function i(V){return B("dragOverCompleted",{insertion:V}),V&&(A?b._hideClone():b._showClone(v),v!==w&&(Re(j,Ae?Ae.options.ghostClass:b.options.ghostClass,!1),Re(j,y.ghostClass,!0)),Ae!==v&&v!==oe.active?Ae=v:v===oe.active&&Ae&&(Ae=null),w===v&&(v._ignoreWhileAnimating=o),v.animateAll(function(){B("dragOverAnimationComplete"),v._ignoreWhileAnimating=null}),v!==w&&(w.animateAll(),w._ignoreWhileAnimating=null)),(o===j&&!j.animated||o===r&&!o.animated)&&(Ct=null),!y.dragoverBubble&&!t.rootEl&&o!==document&&(j.parentNode[He]._isOutsideThisEl(t.target),!V&&ft(t)),!y.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),S=!0}function a(){Ze=Ue(j),dt=Ue(j,y.draggable),Ve({sortable:v,name:"change",toEl:r,newIndex:Ze,newDraggableIndex:dt,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),o=We(o,y.draggable,r,!0),B("dragOver"),oe.eventCanceled)return S;if(j.contains(t.target)||o.animated&&o.animatingX&&o.animatingY||v._ignoreWhileAnimating===o)return i(!1);if(Gt=!1,b&&!y.disabled&&(A?N||(f=be!==fe):Ae===this||(this.lastPutMode=qt.checkPull(this,b,j,t))&&h.checkPut(this,b,j,t))){if(k=this._getDirection(t,o)==="vertical",n=we(j),B("dragOverValid"),oe.eventCanceled)return S;if(f)return be=fe,D(),this._hideClone(),B("revert"),oe.eventCanceled||(ut?fe.insertBefore(j,ut):fe.appendChild(j)),i(!0);var l=uo(r,y.draggable);if(!l||vn(t,k,this)&&!l.animated){if(l===j)return i(!1);if(l&&r===t.target&&(o=l),o&&(s=we(o)),to(fe,r,j,n,o,s,t,!!o)!==!1)return D(),l&&l.nextSibling?r.insertBefore(j,l.nextSibling):r.appendChild(j),be=r,a(),i(!0)}else if(l&&wn(t,k,this)){var p=Et(r,0,y,!0);if(p===j)return i(!1);if(o=p,s=we(o),to(fe,r,j,n,o,s,t,!1)!==!1)return D(),r.insertBefore(j,p),be=r,a(),i(!0)}else if(o.parentNode===r){s=we(o);var z=0,E,_=j.parentNode!==r,c=!bn(j.animated&&j.toRect||n,o.animated&&o.toRect||s,k),u=k?"top":"left",m=nr(o,"top","top")||nr(j,"top","top"),g=m?m.scrollTop:void 0;Ct!==o&&(E=s[u],Vt=!1,Jt=!c&&y.invertSwap||_),z=Cn(t,o,s,k,c?1:y.swapThreshold,y.invertedSwapThreshold==null?y.swapThreshold:y.invertedSwapThreshold,Jt,Ct===o);var $;if(z!==0){var C=Ue(j);do C-=z,$=be.children[C];while($&&(te($,"display")==="none"||$===ne))}if(z===0||$===o)return i(!1);Ct=o,Tt=z;var P=o.nextElementSibling,I=!1;I=z===1;var T=to(fe,r,j,n,o,s,t,I);if(T!==!1)return(T===1||T===-1)&&(I=T===1),$o=!0,setTimeout(zn,30),D(),I&&!P?r.appendChild(j):o.parentNode.insertBefore(j,I?P:o),m&&lr(m,0,g-m.scrollTop),be=j.parentNode,E!==void 0&&!Jt&&(Xt=Math.abs(E-we(o)[u])),a(),i(!0)}if(r.contains(j))return i(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){le(document,"mousemove",this._onTouchMove),le(document,"touchmove",this._onTouchMove),le(document,"pointermove",this._onTouchMove),le(document,"dragover",ft),le(document,"mousemove",ft),le(document,"touchmove",ft)},_offUpEvents:function(){var t=this.el.ownerDocument;le(t,"mouseup",this._onDrop),le(t,"touchend",this._onDrop),le(t,"pointerup",this._onDrop),le(t,"touchcancel",this._onDrop),le(document,"selectstart",this)},_onDrop:function(t){var r=this.el,o=this.options;if(Ze=Ue(j),dt=Ue(j,o.draggable),xe("drop",this,{evt:t}),be=j&&j.parentNode,Ze=Ue(j),dt=Ue(j,o.draggable),oe.eventCanceled){this._nulling();return}vt=!1,Jt=!1,Vt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Eo(this.cloneId),Eo(this._dragStartId),this.nativeDraggable&&(le(document,"drop",this),le(r,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),kt&&te(document.body,"user-select",""),te(j,"transform",""),t&&(St&&(t.cancelable&&t.preventDefault(),!o.dropBubble&&t.stopPropagation()),ne&&ne.parentNode&&ne.parentNode.removeChild(ne),(fe===be||Ae&&Ae.lastPutMode!=="clone")&&ye&&ye.parentNode&&ye.parentNode.removeChild(ye),j&&(this.nativeDraggable&&le(j,"dragend",this),_o(j),j.style["will-change"]="",St&&!vt&&Re(j,Ae?Ae.options.ghostClass:this.options.ghostClass,!1),Re(j,this.options.chosenClass,!1),Ve({sortable:this,name:"unchoose",toEl:be,newIndex:null,newDraggableIndex:null,originalEvent:t}),fe!==be?(Ze>=0&&(Ve({rootEl:be,name:"add",toEl:be,fromEl:fe,originalEvent:t}),Ve({sortable:this,name:"remove",toEl:be,originalEvent:t}),Ve({rootEl:be,name:"sort",toEl:be,fromEl:fe,originalEvent:t}),Ve({sortable:this,name:"sort",toEl:be,originalEvent:t})),Ae&&Ae.save()):Ze!==wt&&Ze>=0&&(Ve({sortable:this,name:"update",toEl:be,originalEvent:t}),Ve({sortable:this,name:"sort",toEl:be,originalEvent:t})),oe.active&&((Ze==null||Ze===-1)&&(Ze=wt,dt=It),Ve({sortable:this,name:"end",toEl:be,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){xe("nulling",this),fe=j=be=ne=ut=ye=Wt=it=gt=qe=St=Ze=dt=wt=It=Ct=Tt=Ae=qt=oe.dragged=oe.ghost=oe.clone=oe.active=null,Yt.forEach(function(t){t.checked=!0}),Yt.length=ho=yo=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":j&&(this._onDragOver(t),En(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],r,o=this.el.children,n=0,s=o.length,f=this.options;n<s;n++)r=o[n],We(r,f.draggable,this.el,!1)&&t.push(r.getAttribute(f.dataIdAttr)||Nn(r));return t},sort:function(t,r){var o={},n=this.el;this.toArray().forEach(function(s,f){var y=n.children[f];We(y,this.options.draggable,n,!1)&&(o[s]=y)},this),r&&this.captureAnimationState(),t.forEach(function(s){o[s]&&(n.removeChild(o[s]),n.appendChild(o[s]))}),r&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,r){return We(t,r||this.options.draggable,this.el,!1)},option:function(t,r){var o=this.options;if(r===void 0)return o[t];var n=Dt.modifyOption(this,t,r);typeof n<"u"?o[t]=n:o[t]=r,t==="group"&&fr(o)},destroy:function(){xe("destroy",this);var t=this.el;t[He]=null,le(t,"mousedown",this._onTapStart),le(t,"touchstart",this._onTapStart),le(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(le(t,"dragover",this),le(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(r){r.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Kt.splice(Kt.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!it){if(xe("hideClone",this),oe.eventCanceled)return;te(ye,"display","none"),this.options.removeCloneOnHide&&ye.parentNode&&ye.parentNode.removeChild(ye),it=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(it){if(xe("showClone",this),oe.eventCanceled)return;j.parentNode==fe&&!this.options.group.revertClone?fe.insertBefore(ye,j):ut?fe.insertBefore(ye,ut):fe.appendChild(ye),this.options.group.revertClone&&this.animate(j,ye),te(ye,"display",""),it=!1}}};function En(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function to(t,r,o,n,s,f,y,h){var b,A=t[He],N=A.options.onMove,w;return window.CustomEvent&&!at&&!Nt?b=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(b=document.createEvent("Event"),b.initEvent("move",!0,!0)),b.to=r,b.from=t,b.dragged=o,b.draggedRect=n,b.related=s||r,b.relatedRect=f||we(r),b.willInsertAfter=h,b.originalEvent=y,t.dispatchEvent(b),N&&(w=N.call(A,b,y)),w}function _o(t){t.draggable=!1}function zn(){$o=!1}function wn(t,r,o){var n=we(Et(o.el,0,o.options,!0)),s=dr(o.el,o.options,ne),f=10;return r?t.clientX<s.left-f||t.clientY<n.top&&t.clientX<n.right:t.clientY<s.top-f||t.clientY<n.bottom&&t.clientX<n.left}function vn(t,r,o){var n=we(uo(o.el,o.options.draggable)),s=dr(o.el,o.options,ne),f=10;return r?t.clientX>s.right+f||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>s.bottom+f||t.clientX>n.right&&t.clientY>n.top}function Cn(t,r,o,n,s,f,y,h){var b=n?t.clientY:t.clientX,A=n?o.height:o.width,N=n?o.top:o.left,w=n?o.bottom:o.right,k=!1;if(!y){if(h&&Xt<A*s){if(!Vt&&(Tt===1?b>N+A*f/2:b<w-A*f/2)&&(Vt=!0),Vt)k=!0;else if(Tt===1?b<N+Xt:b>w-Xt)return-Tt}else if(b>N+A*(1-s)/2&&b<w-A*(1-s)/2)return An(r)}return k=k||y,k&&(b<N+A*f/2||b>w-A*f/2)?b>N+A/2?1:-1:0}function An(t){return Ue(j)<Ue(t)?1:-1}function Nn(t){for(var r=t.tagName+t.className+t.src+t.href+t.textContent,o=r.length,n=0;o--;)n+=r.charCodeAt(o);return n.toString(36)}function kn(t){Yt.length=0;for(var r=t.getElementsByTagName("input"),o=r.length;o--;){var n=r[o];n.checked&&Yt.push(n)}}function oo(t){return setTimeout(t,0)}function Eo(t){return clearTimeout(t)}Qt&&ie(document,"touchmove",function(t){(oe.active||vt)&&t.cancelable&&t.preventDefault()}),oe.utils={on:ie,off:le,css:te,find:rr,is:function(t,r){return!!We(t,r,t,!1)},extend:cn,throttle:sr,closest:We,toggleClass:Re,clone:ir,index:Ue,nextTick:oo,cancelNextTick:Eo,detectDirection:gr,getChild:Et},oe.get=function(t){return t[He]},oe.mount=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];r[0].constructor===Array&&(r=r[0]),r.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(oe.utils=Ye(Ye({},oe.utils),n.utils)),Dt.mount(n)})},oe.create=function(t,r){return new oe(t,r)},oe.version=sn;var ve=[],Bt,zo,wo=!1,vo,Co,ro,Ft;function Pn(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this))}return t.prototype={dragStarted:function(r){var o=r.originalEvent;this.sortable.nativeDraggable?ie(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ie(document,"pointermove",this._handleFallbackAutoScroll):o.touches?ie(document,"touchmove",this._handleFallbackAutoScroll):ie(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(r){var o=r.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?le(document,"dragover",this._handleAutoScroll):(le(document,"pointermove",this._handleFallbackAutoScroll),le(document,"touchmove",this._handleFallbackAutoScroll),le(document,"mousemove",this._handleFallbackAutoScroll)),br(),no(),pn()},nulling:function(){ro=zo=Bt=wo=Ft=vo=Co=null,ve.length=0},_handleFallbackAutoScroll:function(r){this._handleAutoScroll(r,!0)},_handleAutoScroll:function(r,o){var n=this,s=(r.touches?r.touches[0]:r).clientX,f=(r.touches?r.touches[0]:r).clientY,y=document.elementFromPoint(s,f);if(ro=r,o||this.options.forceAutoScrollFallback||Nt||at||kt){Ao(r,this.options,y,o);var h=lt(y,!0);wo&&(!Ft||s!==vo||f!==Co)&&(Ft&&br(),Ft=setInterval(function(){var b=lt(document.elementFromPoint(s,f),!0);b!==h&&(h=b,no()),Ao(r,n.options,b,o)},10),vo=s,Co=f)}else{if(!this.options.bubbleScroll||lt(y,!0)===Qe()){no();return}Ao(r,this.options,lt(y,!1),!1)}}},rt(t,{pluginName:"scroll",initializeByDefault:!0})}function no(){ve.forEach(function(t){clearInterval(t.pid)}),ve=[]}function br(){clearInterval(Ft)}var Ao=sr(function(t,r,o,n){if(r.scroll){var s=(t.touches?t.touches[0]:t).clientX,f=(t.touches?t.touches[0]:t).clientY,y=r.scrollSensitivity,h=r.scrollSpeed,b=Qe(),A=!1,N;zo!==o&&(zo=o,no(),Bt=r.scroll,N=r.scrollFn,Bt===!0&&(Bt=lt(o,!0)));var w=0,k=Bt;do{var v=k,S=we(v),B=S.top,D=S.bottom,i=S.left,a=S.right,l=S.width,p=S.height,z=void 0,E=void 0,_=v.scrollWidth,c=v.scrollHeight,u=te(v),m=v.scrollLeft,g=v.scrollTop;v===b?(z=l<_&&(u.overflowX==="auto"||u.overflowX==="scroll"||u.overflowX==="visible"),E=p<c&&(u.overflowY==="auto"||u.overflowY==="scroll"||u.overflowY==="visible")):(z=l<_&&(u.overflowX==="auto"||u.overflowX==="scroll"),E=p<c&&(u.overflowY==="auto"||u.overflowY==="scroll"));var $=z&&(Math.abs(a-s)<=y&&m+l<_)-(Math.abs(i-s)<=y&&!!m),C=E&&(Math.abs(D-f)<=y&&g+p<c)-(Math.abs(B-f)<=y&&!!g);if(!ve[w])for(var P=0;P<=w;P++)ve[P]||(ve[P]={});(ve[w].vx!=$||ve[w].vy!=C||ve[w].el!==v)&&(ve[w].el=v,ve[w].vx=$,ve[w].vy=C,clearInterval(ve[w].pid),($!=0||C!=0)&&(A=!0,ve[w].pid=setInterval(function(){n&&this.layer===0&&oe.active._onTouchMove(ro);var I=ve[this.layer].vy?ve[this.layer].vy*h:0,T=ve[this.layer].vx?ve[this.layer].vx*h:0;typeof N=="function"&&N.call(oe.dragged.parentNode[He],T,I,t,ro,ve[this.layer].el)!=="continue"||lr(ve[this.layer].el,T,I)}.bind({layer:w}),24))),w++}while(r.bubbleScroll&&k!==b&&(k=lt(k,!1)));wo=A}},30),$r=function(t){var r=t.originalEvent,o=t.putSortable,n=t.dragEl,s=t.activeSortable,f=t.dispatchSortableEvent,y=t.hideGhostForTarget,h=t.unhideGhostForTarget;if(r){var b=o||s;y();var A=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:r,N=document.elementFromPoint(A.clientX,A.clientY);h(),b&&!b.el.contains(N)&&(f("spill"),this.onSpill({dragEl:n,putSortable:o}))}};function No(){}No.prototype={startIndex:null,dragStart:function(t){var r=t.oldDraggableIndex;this.startIndex=r},onSpill:function(t){var r=t.dragEl,o=t.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var n=Et(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(r,n):this.sortable.el.appendChild(r),this.sortable.animateAll(),o&&o.animateAll()},drop:$r},rt(No,{pluginName:"revertOnSpill"});function ko(){}ko.prototype={onSpill:function(t){var r=t.dragEl,o=t.putSortable,n=o||this.sortable;n.captureAnimationState(),r.parentNode&&r.parentNode.removeChild(r),n.animateAll()},drop:$r},rt(ko,{pluginName:"removeOnSpill"}),oe.mount(new Pn),oe.mount(ko,No);function Dn(t){return t==null?t:JSON.parse(JSON.stringify(t))}function In(t){e.getCurrentInstance()&&e.onUnmounted(t)}function Sn(t){e.getCurrentInstance()?e.onMounted(t):e.nextTick(t)}let _r=null,Er=null;function zr(t=null,r=null){_r=t,Er=r}function Tn(){return{data:_r,clonedData:Er}}const wr=Symbol("cloneElement");function Vn(...t){var r,o;const n=(r=e.getCurrentInstance())==null?void 0:r.proxy;let s=null;const f=t[0];let[,y,h]=t;Array.isArray(e.unref(y))||(h=y,y=null);let b=null;const{immediate:A=!0,clone:N=Dn,customUpdate:w}=(o=e.unref(h))!=null?o:{};function k(c){var u;const{from:m,oldIndex:g,item:$}=c;s=Array.from(m.childNodes);const C=e.unref((u=e.unref(y))==null?void 0:u[g]),P=N(C);zr(C,P),$[wr]=P}function v(c){const u=c.item[wr];if(!Kr(u)){if(mo(c.item),e.isRef(y)){const m=[...e.unref(y)];y.value=Go(m,c.newDraggableIndex,u);return}Go(e.unref(y),c.newDraggableIndex,u)}}function S(c){const{from:u,item:m,oldIndex:g,oldDraggableIndex:$,pullMode:C,clone:P}=c;if(Ko(u,m,g),C==="clone"){mo(P);return}if(e.isRef(y)){const I=[...e.unref(y)];y.value=qo(I,$);return}qo(e.unref(y),$)}function B(c){if(w){w(c);return}const{from:u,item:m,oldIndex:g,oldDraggableIndex:$,newDraggableIndex:C}=c;if(mo(m),Ko(u,m,g),e.isRef(y)){const P=[...e.unref(y)];y.value=Wo(P,$,C);return}Wo(e.unref(y),$,C)}function D(c){const{newIndex:u,oldIndex:m,from:g,to:$}=c;let C=null;const P=u===m&&g===$;try{if(P){let I=null;s?.some((T,V)=>{if(I&&s?.length!==$.childNodes.length)return g.insertBefore(I,T.nextSibling),!0;const L=$.childNodes[V];I=$?.replaceChild(T,L)})}}catch(I){C=I}finally{s=null}e.nextTick(()=>{if(zr(),C)throw C})}const i={onUpdate:B,onStart:k,onAdd:v,onRemove:S,onEnd:D};function a(c){const u=e.unref(f);return c||(c=Jr(u)?Xr(u,n?.$el):u),c&&!en(c)&&(c=c.$el),c||Wr("Root element not found"),c}function l(){var c;const u=(c=e.unref(h))!=null?c:{},{immediate:m,clone:g}=u,$=jo(u,["immediate","clone"]);return Jo($,(C,P)=>{tn(C)&&($[C]=(I,...T)=>{const V=Tn();return on(I,V),P(I,...T)})}),Qr(y===null?{}:i,$)}const p=c=>{c=a(c),b&&z.destroy(),b=new oe(c,l())};e.watch(()=>h,()=>{b&&Jo(l(),(c,u)=>{b?.option(c,u)})},{deep:!0});const z={option:(c,u)=>b?.option(c,u),destroy:()=>{b?.destroy(),b=null},save:()=>b?.save(),toArray:()=>b?.toArray(),closest:(...c)=>b?.closest(...c)},E=()=>z?.option("disabled",!0),_=()=>z?.option("disabled",!1);return Sn(()=>{A&&p()}),In(z.destroy),$t({start:p,pause:E,resume:_},z)}const Po=["update","start","add","remove","choose","unchoose","end","sort","filter","clone","move","change"],Bn=["clone","animation","ghostClass","group","sort","disabled","store","handle","draggable","swapThreshold","invertSwap","invertedSwapThreshold","removeCloneOnHide","direction","chosenClass","dragClass","ignore","filter","preventOnFilter","easing","setData","dropBubble","dragoverBubble","dataIdAttr","delay","delayOnTouchOnly","touchStartThreshold","forceFallback","fallbackClass","fallbackOnBody","fallbackTolerance","fallbackOffset","supportPointer","emptyInsertThreshold","scroll","forceAutoScrollFallback","scrollSensitivity","scrollSpeed","bubbleScroll","modelValue","tag","target","customUpdate",...Po.map(t=>`on${t.replace(/^\S/,r=>r.toUpperCase())}`)],Fn=e.defineComponent({name:"VueDraggable",model:{prop:"modelValue",event:"update:modelValue"},props:Bn,emits:["update:modelValue",...Po],setup(t,{slots:r,emit:o,expose:n,attrs:s}){const f=Po.reduce((N,w)=>{const k=`on${w.replace(/^\S/,v=>v.toUpperCase())}`;return N[k]=(...v)=>o(w,...v),N},{}),y=e.computed(()=>{const N=e.toRefs(t),{modelValue:w}=N,k=jo(N,["modelValue"]),v=Object.entries(k).reduce((S,[B,D])=>{const i=e.unref(D);return i!==void 0&&(S[B]=i),S},{});return $t($t({},f),Gr($t($t({},s),v)))}),h=e.computed({get:()=>t.modelValue,set:N=>o("update:modelValue",N)}),b=e.ref(),A=e.reactive(Vn(t.target||b,h,y));return n(A),()=>{var N;return e.h(t.tag||"div",{ref:b},(N=r?.default)==null?void 0:N.call(r,A))}}});function vr(){const t=e.ref(new Set),r="zero-code-collapsed-items",o=()=>{try{t.value=new Set,d.debug("初期表示：すべて展開状態で開始")}catch(k){d.error("初期化に失敗:",k),t.value=new Set}},n=()=>{try{const k=Array.from(t.value);localStorage.setItem(r,JSON.stringify(k)),d.debug("折りたたみ状態を保存:",k.length,"アイテム")}catch(k){d.error("折りたたみ状態の保存に失敗:",k)}},s=k=>t.value.has(k),f=k=>{const v=new Set(t.value);v.has(k)?(v.delete(k),d.debug(`アイテム展開: ${k}`)):(v.add(k),d.debug(`アイテム折りたたみ: ${k}`)),t.value=v},y=k=>{if(!t.value.has(k)){const v=new Set(t.value);v.add(k),t.value=v,d.debug(`アイテム折りたたみ: ${k}`)}},h=k=>{if(t.value.has(k)){const v=new Set(t.value);v.delete(k),t.value=v,d.debug(`アイテム展開: ${k}`)}},b=()=>{const k=t.value.size;t.value=new Set,d.debug(`すべてのアイテムを展開: ${k}アイテム`)},A=k=>{t.value=new Set(k),d.debug(`すべてのアイテムを折りたたみ: ${k.length}アイテム`)},N=e.computed(()=>t.value.size),w=k=>k-t.value.size;return e.watch(()=>t.value,()=>{n()},{deep:!0}),o(),{collapsedItems:e.computed(()=>t.value),collapsedCount:N,isCollapsed:s,toggleCollapse:f,collapseItem:y,expandItem:h,expandAll:b,collapseAll:A,getExpandedCount:w,loadCollapsedState:o,saveCollapsedState:n}}const Mn={class:"zero-code-data-display"},Ln={class:"zero-code-data-tabs"},xn={class:"zero-code-tab-buttons"},On=["onClick"],Rn={key:0,class:"zero-code-collapse-controls"},Hn={class:"zero-code-collapse-stats"},Zn=["disabled"],jn=["disabled"],Un={class:"zero-code-data-content"},Wn={key:0,class:"zero-code-data-section"},qn={key:0,class:"zero-code-rendered-content"},Gn={class:"zero-code-add-part-button-container"},Kn={class:"zero-code-component-header"},Jn={class:"zero-code-component-meta"},Xn={class:"zero-code-component-type"},Yn={class:"zero-code-component-module"},Qn={class:"zero-code-header-actions"},ea=["title","onClick"],ta=["onClick"],oa=["onClick"],ra=["innerHTML"],na={class:"zero-code-add-part-button-container"},aa=["onClick"],sa={key:1,class:"zero-code-no-data"},la={class:"zero-code-empty-state"},ia={class:"zero-code-add-part-button-container"},da={key:1,class:"zero-code-data-section"},ca={class:"zero-code-data-display-section"},pa={class:"zero-code-parts-sub-content"},ma={class:"zero-code-parts-sub-section"},ua={class:"zero-code-data-display-pre"},ga=e.defineComponent({__name:"DataDisplay",props:{modelValue:{type:String},pageData:{type:Array},parts:{type:Array},commonParts:{type:Array},individualParts:{type:Array},commonImages:{type:Array},individualImages:{type:Array},renderComponentWithNested:{type:Function},isTextEditing:{type:Boolean}},emits:["update:modelValue","add-part","edit-part","delete-part","reorder-parts"],setup(t,{emit:r}){const o=t,n=r,s=e.computed({get:()=>o.pageData,set:i=>{n("reorder-parts",i)}}),f=()=>{d.debug("ドラッグ開始")},y=()=>{d.debug("ドラッグ終了")},{isCollapsed:h,toggleCollapse:b,collapsedCount:A,expandAll:N,collapseAll:w}=vr(),k=()=>{const i=o.pageData.map((a,l)=>a.id||`component-${l}`);w(i)},v=["rendered","page"],S=i=>({rendered:"レンダリング結果",source:"HTMLソース",page:"データ表示"})[i],B=e.computed(()=>D(o.pageData)),D=i=>{const a=(l,p=0)=>{const z="  ".repeat(p),E="  ".repeat(p+1);if(Array.isArray(l))return l.length===0?"[]":`[
${l.map(c=>E+a(c,p+1)).join(`,
`)}
${z}]`;if(typeof l=="object"&&l!==null){const _=Object.entries(l);return _.length===0?"{}":`{
${_.map(([u,m])=>{let g;if(typeof m=="string"){const $=m.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if($.includes(`
`)){const C=$.split(`
`);g=C.map((I,T)=>T===0?`\`${I}`:T===C.length-1?`${E}${I}\``:`${E}${I}`).join(`
`)}else g=`"${$}"`}else g=a(m,p+1);return`${E}"${u}": ${g}`}).join(`,
`)}
${z}}`}return typeof l=="string"?`"${l.replace(/"/g,'\\"')}"`:JSON.stringify(l)};return a(i)};return(i,a)=>(e.openBlock(),e.createElementBlock("div",Mn,[e.createElementVNode("div",Ln,[e.createElementVNode("div",xn,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(v,l=>e.createElementVNode("button",{key:l,class:e.normalizeClass(["zero-code-data-tab-button",{active:i.modelValue===l}]),onClick:p=>i.$emit("update:modelValue",l)},e.toDisplayString(S(l)),11,On)),64))]),i.modelValue==="rendered"?(e.openBlock(),e.createElementBlock("div",Rn,[e.createElementVNode("span",Hn,e.toDisplayString(e.unref(A))+"/"+e.toDisplayString(i.pageData.length)+" 折りたたみ中 ",1),e.createElementVNode("button",{class:"zero-code-collapse-all-btn",disabled:i.pageData.length===0,onClick:k}," すべて折りたたみ ",8,Zn),e.createElementVNode("button",{class:"zero-code-expand-all-btn",disabled:e.unref(A)===0,onClick:a[0]||(a[0]=(...l)=>e.unref(N)&&e.unref(N)(...l))}," すべて展開 ",8,jn)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Un,[i.modelValue==="rendered"?(e.openBlock(),e.createElementBlock("div",Wn,[Array.isArray(i.pageData)&&i.pageData.length>0?(e.openBlock(),e.createElementBlock("div",qn,[e.createElementVNode("div",Gn,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:a[1]||(a[1]=l=>i.$emit("add-part",0))},a[4]||(a[4]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"パーツを追加",-1)]))]),e.createVNode(e.unref(Fn),{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value=l),animation:200,disabled:i.isTextEditing,"ghost-class":"ghost","chosen-class":"chosen","drag-class":"drag",onStart:f,onEnd:y},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.pageData,(l,p)=>(e.openBlock(),e.createElementBlock("div",{key:`${l.id||p}`,class:"zero-code-rendered-component zero-code-draggable-item"},[e.createElementVNode("div",Kn,[e.createElementVNode("div",Jn,[a[5]||(a[5]=e.createElementVNode("div",{class:"zero-code-drag-handle"},[e.createElementVNode("span",{class:"zero-code-drag-icon"},"⠿")],-1)),e.createElementVNode("span",Xn,e.toDisplayString(l.type||"unknown"),1),e.createElementVNode("span",Yn,e.toDisplayString(l.module_name||""),1)]),e.createElementVNode("div",Qn,[e.createElementVNode("button",{class:"zero-code-collapse-btn",title:e.unref(h)(l.id||`component-${p}`)?"展開":"折りたたみ",onClick:z=>e.unref(b)(l.id||`component-${p}`)},e.toDisplayString(e.unref(h)(l.id||`component-${p}`)?"＋":"－"),9,ea),e.createElementVNode("button",{class:"zero-code-edit-btn",onClick:z=>i.$emit("edit-part",p)},"編集",8,ta),e.createElementVNode("button",{class:"zero-code-delete-btn",onClick:z=>i.$emit("delete-part",p)},"削除",8,oa)])]),e.createVNode(e.Transition,{name:"collapse"},{default:e.withCtx(()=>[e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:`preview-${l.id}`,class:"zero-code-component-preview",innerHTML:i.renderComponentWithNested(l,p)},null,8,ra)),[[e.vShow,!e.unref(h)(l.id||`component-${p}`)]])]),_:2},1024),e.createElementVNode("div",na,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:z=>i.$emit("add-part",p+1)},a[6]||(a[6]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"パーツを追加",-1)]),8,aa)])]))),128))]),_:1},8,["modelValue","disabled"])])):(e.openBlock(),e.createElementBlock("div",sa,[e.createElementVNode("div",la,[a[8]||(a[8]=e.createElementVNode("p",{class:"zero-code-empty-message"},"パーツがありません",-1)),e.createElementVNode("div",ia,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:a[3]||(a[3]=l=>i.$emit("add-part",0))},a[7]||(a[7]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"最初のパーツを追加",-1)]))])])]))])):e.createCommentVNode("",!0),i.modelValue==="page"?(e.openBlock(),e.createElementBlock("div",da,[e.createElementVNode("div",ca,[e.createElementVNode("div",pa,[e.createElementVNode("div",ma,[a[9]||(a[9]=e.createElementVNode("h4",{style:{margin:"0 0 16px 0",color:"#374151","font-size":"1.1rem"}},"Pageデータ（リアルタイム更新）",-1)),e.createElementVNode("pre",ua,e.toDisplayString(B.value),1)])])])])):e.createCommentVNode("",!0)])]))}}),fa={class:"zero-code-modal-header"},ha={class:"zero-code-data-tabs"},ya={class:"zero-code-tab-buttons"},ba=["onClick"],$a={class:"zero-code-modal-body"},_a={key:0,class:"zero-code-parts-section"},Ea={key:0,class:"zero-code-parts-list"},za={class:"zero-code-part-section-title"},wa={class:"zero-code-modules-grid"},va=["onClick"],Ca={class:"zero-code-module-title"},Aa=["innerHTML"],Na={key:1,class:"zero-code-empty-state"},ka={key:1,class:"zero-code-parts-section"},Pa={key:0,class:"zero-code-parts-list"},Da={class:"zero-code-part-section-title"},Ia={class:"zero-code-modules-grid"},Sa=["onClick"],Ta={class:"zero-code-module-title"},Va=["innerHTML"],Ba={key:1,class:"zero-code-empty-state"},Cr=e.defineComponent({__name:"PartSelector",props:{parts:{type:Array},isNested:{type:Boolean,default:!1},modalContainer:{default:"body",type:String}},emits:["close","select-part"],setup(t,{emit:r}){const o=t;e.computed(()=>!o.modalContainer||o.modalContainer==="body"?!0:typeof document<"u");const n=e.computed(()=>!o.modalContainer||o.modalContainer==="body"?"body":typeof document<"u"&&document.querySelector(o.modalContainer)?o.modalContainer:"body"),s=e.ref("common"),f=["common","individual"],y=k=>({common:"共通パーツ",individual:"個別パーツ"})[k],h=e.computed(()=>o.parts.map(k=>({...k,module:k.module.filter(v=>{const S=v;return!S.category||S.category==="common"})})).filter(k=>k.module.length>0)),b=e.computed(()=>o.parts.map(k=>({...k,module:k.module.filter(v=>v.category==="individual")})).filter(k=>k.module.length>0)),A=r,N=(k,v)=>{A("select-part",k,v)},w=k=>{if(!k)return"";try{let v=k;return v=v.replace(/@slot\(\$[^)]+\)@/g,""),v=v.replace(/\{\$([^:]+):([^}]*)\}/g,(S,B,D)=>D&&D.trim()?D:{title:"サンプルタイトル",text:"サンプルテキストです。",image:"/sample-image.jpg",link:"#",url:"https://example.com",alt:"サンプル画像",content:"サンプルコンテンツ",description:"サンプル説明文です。"}[B]||`[${B}]`),v=v.replace(/\(\$([^:]+):([^)]+)\)/g,(S,B,D)=>D.split("|").filter(a=>a.trim())[0]||""),v=v.replace(/\(\$([^:?]+)\?:([^)]*)\)/g,(S,B,D)=>D||""),v=v.replace(/z-for-wrapper="[^"]*"/g,""),v=v.replace(/z-for="[^"]*"/g,""),v=v.replace(/z-slot="[^"]*"/g,""),v=v.replace(/\$(\w+)/g,(S,B)=>({title:"タイトル",text:"テキスト",content:"コンテンツ"})[B]||`[${B}]`),v}catch{return k}};return(k,v)=>(e.openBlock(),e.createBlock(e.Teleport,{to:n.value},[e.createElementVNode("div",{class:"zero-code-modal-overlay",onClick:v[2]||(v[2]=S=>k.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:v[1]||(v[1]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",fa,[e.createElementVNode("h4",null,e.toDisplayString(o.isNested?"ネストパーツを選択":"パーツを選択"),1),e.createElementVNode("button",{class:"zero-code-close-button",onClick:v[0]||(v[0]=S=>k.$emit("close"))},"✖️")]),e.createElementVNode("div",ha,[e.createElementVNode("div",ya,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(f,S=>e.createElementVNode("button",{key:S,class:e.normalizeClass(["zero-code-data-tab-button",{active:s.value===S}]),onClick:B=>s.value=S},e.toDisplayString(y(S)),11,ba)),64))])]),e.createElementVNode("div",$a,[s.value==="common"?(e.openBlock(),e.createElementBlock("div",_a,[h.value.length>0?(e.openBlock(),e.createElementBlock("div",Ea,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,(S,B)=>(e.openBlock(),e.createElementBlock("div",{key:B,class:"zero-code-part-section"},[e.createElementVNode("h5",za,e.toDisplayString(S.type),1),e.createElementVNode("div",wa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.module,(D,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"zero-code-module-card",onClick:a=>N(S.type,D)},[e.createElementVNode("div",Ca,e.toDisplayString(D.title),1),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:w(D.body)},null,8,Aa)],8,va))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",Na,v[3]||(v[3]=[e.createElementVNode("p",null,"共通パーツが登録されていません。",-1)])))])):e.createCommentVNode("",!0),s.value==="individual"?(e.openBlock(),e.createElementBlock("div",ka,[b.value.length>0?(e.openBlock(),e.createElementBlock("div",Pa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.value,(S,B)=>(e.openBlock(),e.createElementBlock("div",{key:B,class:"zero-code-part-section"},[e.createElementVNode("h5",Da,e.toDisplayString(S.type),1),e.createElementVNode("div",Ia,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.module,(D,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"zero-code-module-card",onClick:a=>N(S.type,D)},[e.createElementVNode("div",Ta,e.toDisplayString(D.title),1),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:w(D.body)},null,8,Va)],8,Sa))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",Ba,v[4]||(v[4]=[e.createElementVNode("p",null,"個別パーツが登録されていません。",-1)])))])):e.createCommentVNode("",!0)])])])],8,["to"]))}}),Fa={class:"zero-code-array-field"},Ma={class:"zero-code-array-header"},La={key:0,class:"zero-code-empty-array-message"},xa={class:"zero-code-empty-message-content"},Oa={class:"zero-code-empty-text"},Ra={class:"zero-code-button-text"},Ha=["onDragstart","onDrop"],Za={class:"zero-code-array-item-header"},ja={class:"zero-code-component-meta"},Ua=["onClick"],Wa={class:"zero-code-array-item-fields"},qa=["for"],Ga={key:0,class:"zero-code-radio-group"},Ka=["id","value","name","checked","onChange"],Ja=["for"],Xa={key:1,class:"zero-code-checkbox-group"},Ya=["id","checked","onChange"],Qa=["for"],es=["id","value","onInput"],ts=["value"],os=["id","value","onChange"],rs=["value","selected"],ns=["id","value","onInput"],as=["id","value","type","onInput"],ss={key:0,class:"zero-code-nested-array-field"},ls={class:"zero-code-nested-array-label"},is={class:"zero-code-nested-array-info"},ds={class:"zero-code-array-count"},cs=["onClick"],ps=e.defineComponent({__name:"ArrayFieldEditor",props:{componentId:{type:String},arrayKey:{type:String},items:{type:Array},fields:{type:Object},label:{type:String},itemLabel:{type:String}},emits:["add","remove","update","reorder","edit-nested"],setup(t,{emit:r}){const o=t,n=r,s=(v,S,B)=>{n("update",v,S,B)},f=(v,S,B)=>{const D=v[S];return Array.isArray(D)&&D.includes(B)},y=(v,S,B,D)=>{let a=o.items[v][S]||[];Array.isArray(a)||(a=[]),D?a.includes(B)||(a=[...a,B]):a=a.filter(l=>l!==B),n("update",v,S,a)};let h=null;const b=(v,S)=>{h=S,v.dataTransfer&&(v.dataTransfer.effectAllowed="move",v.dataTransfer.setData("text/plain",S.toString()));const B=v.target;B.style.opacity="0.5"},A=v=>{v.preventDefault(),v.dataTransfer&&(v.dataTransfer.dropEffect="move")},N=(v,S)=>{v.preventDefault(),h!==null&&h!==S&&n("reorder",h,S),h=null},w=v=>{const S=v.target;S.style.opacity="1",h=null},k=(v,S)=>!Array.isArray(S)||v==="id"||["nested_parts","content"].includes(v)?!1:S.length>0&&typeof S[0]=="object"&&S[0]!==null;return(v,S)=>(e.openBlock(),e.createElementBlock("div",Fa,[e.createElementVNode("div",Ma,[e.createElementVNode("h5",null,e.toDisplayString(v.label),1),e.createElementVNode("button",{class:"zero-code-btn zero-code-add-array-item",onClick:S[0]||(S[0]=B=>v.$emit("add"))},"+ 追加")]),v.items.length===0?(e.openBlock(),e.createElementBlock("div",La,[e.createElementVNode("div",xa,[e.createElementVNode("p",Oa,e.toDisplayString(v.label)+"はまだ追加されていません",1),e.createElementVNode("button",{class:"zero-code-btn zero-code-add-array-item-empty",onClick:S[1]||(S[1]=B=>v.$emit("add"))},[S[2]||(S[2]=e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1)),e.createElementVNode("span",Ra,"最初の"+e.toDisplayString(v.label)+"を追加",1)])])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.items,(B,D)=>(e.openBlock(),e.createElementBlock("div",{key:B?.id||D,class:"zero-code-array-item",draggable:"true",onDragstart:i=>b(i,D),onDragover:A,onDrop:i=>N(i,D),onDragend:w},[e.createElementVNode("div",Za,[e.createElementVNode("div",ja,[S[3]||(S[3]=e.createElementVNode("span",{class:"zero-code-drag-handle"},"⠿",-1)),e.createElementVNode("h6",null,e.toDisplayString(v.itemLabel)+" "+e.toDisplayString(D+1),1)]),e.createElementVNode("button",{class:"zero-code-btn zero-code-remove-array-item",onClick:i=>v.$emit("remove",D)},"削除",8,Ua)]),e.createElementVNode("div",Wa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.fields,(i,a)=>(e.openBlock(),e.createElementBlock("div",{key:a,class:"zero-code-field-group"},[e.createElementVNode("label",{for:`${v.componentId}_${v.arrayKey}_${D}_${a}`},e.toDisplayString(i.label)+": ",9,qa),i.type==="radio"&&i.options&&i.options.length>0?(e.openBlock(),e.createElementBlock("div",Ga,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-radio-item"},[e.createElementVNode("input",{id:`${v.componentId}_${v.arrayKey}_${D}_${a}_${l}`,value:l,type:"radio",name:`${v.componentId}_${v.arrayKey}_${D}_${a}`,class:"zero-code-radio-input",checked:B[a]===l||l==="指定なし"&&!B[a],onChange:p=>s(D,a,l==="指定なし"?"":l)},null,40,Ka),e.createElementVNode("label",{for:`${v.componentId}_${v.arrayKey}_${D}_${a}_${l}`,class:"zero-code-radio-label"},e.toDisplayString(l),9,Ja)]))),128))])):e.createCommentVNode("",!0),i.type==="checkbox"&&i.options&&i.options.length>0?(e.openBlock(),e.createElementBlock("div",Xa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-checkbox-item"},[e.createElementVNode("input",{id:`${v.componentId}_${v.arrayKey}_${D}_${a}_${l}`,checked:f(B,a,l),type:"checkbox",class:"zero-code-checkbox-input",onChange:p=>{const z=p.target;y(D,a,l,z.checked)}},null,40,Ya),e.createElementVNode("label",{for:`${v.componentId}_${v.arrayKey}_${D}_${a}_${l}`,class:"zero-code-checkbox-label"},e.toDisplayString(l),9,Qa)]))),128))])):i.type==="select"?(e.openBlock(),e.createElementBlock("select",{key:2,id:`${v.componentId}_${v.arrayKey}_${D}_${a}`,value:B[a],class:"zero-code-field-input zero-code-select-input",onInput:l=>{const p=l.target;s(D,a,p.value)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l),9,ts))),128))],40,es)):i.type==="select-multiple"?(e.openBlock(),e.createElementBlock("select",{key:3,id:`${v.componentId}_${v.arrayKey}_${D}_${a}`,value:B[a]||i.defaultValue,multiple:"",class:"zero-code-field-input zero-code-select-multiple",onChange:l=>{const p=l.target,z=Array.from(p.selectedOptions).map(E=>E.value);s(D,a,z)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l,selected:Array.isArray(B[a])&&B[a].includes(l)},e.toDisplayString(l),9,rs))),128))],40,os)):i.type==="textarea"?(e.openBlock(),e.createElementBlock("textarea",{key:4,id:`${v.componentId}_${v.arrayKey}_${D}_${a}`,value:B[a],class:"zero-code-field-input zero-code-field-textarea",onInput:l=>{const p=l.target;s(D,a,p.value)}},null,40,ns)):i.type==="text"||i.type==="number"?(e.openBlock(),e.createElementBlock("input",{key:5,id:`${v.componentId}_${v.arrayKey}_${D}_${a}`,value:B[a],type:i.type==="text"?"text":i.type,class:"zero-code-field-input",onInput:l=>{const p=l.target;s(D,a,p.value)}},null,40,as)):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B,(i,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:`nested_${a}`},[Array.isArray(i)&&a!=="id"&&k(a,i)?(e.openBlock(),e.createElementBlock("div",ss,[e.createElementVNode("h6",ls,e.toDisplayString(a)+" (ネスト配列)",1),e.createElementVNode("div",is,[e.createElementVNode("span",ds,e.toDisplayString(i.length)+"個の要素",1),e.createElementVNode("button",{class:"zero-code-btn zero-code-edit-nested-array-btn",title:"ネスト配列を編集",onClick:l=>v.$emit("edit-nested",D,a)}," 編集 ",8,cs)])])):e.createCommentVNode("",!0)],64))),128))])],40,Ha))),128))]))}});var ue=(t=>(t.VALIDATION="VALIDATION",t.NETWORK="NETWORK",t.COMPONENT="COMPONENT",t.TEMPLATE="TEMPLATE",t.FILE="FILE",t.PERMISSION="PERMISSION",t.IMAGE_LOAD_FAILED="IMAGE_LOAD_FAILED",t.UNKNOWN="UNKNOWN",t.NETWORK_ERROR="NETWORK_ERROR",t.VALIDATION_ERROR="VALIDATION_ERROR",t.PERMISSION_ERROR="PERMISSION_ERROR",t.COMPONENT_ERROR="COMPONENT_ERROR",t.TEMPLATE_PARSE_ERROR="TEMPLATE_PARSE_ERROR",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t))(ue||{});class ms{constructor(){Ht(this,"errorHistory",[]);Ht(this,"maxHistorySize",100)}handleError(r,o,n,s,f){const y={type:r,message:o,details:n,componentId:s,action:f,timestamp:Date.now()};return this.errorHistory.unshift(y),this.errorHistory.length>this.maxHistorySize&&(this.errorHistory=this.errorHistory.slice(0,this.maxHistorySize)),r==="VALIDATION"||r==="PERMISSION"?d.warn(`[${r}] ${o}`,n):d.error(`[${r}] ${o}`,n),y}componentError(r,o,n){return this.handleError("COMPONENT",r,n,o,"component_operation")}templateError(r,o){return this.handleError("TEMPLATE",r,o,void 0,"template_processing")}validationError(r,o){return this.handleError("VALIDATION",r,o,void 0,"validation")}fileError(r,o){return this.handleError("FILE",r,o,void 0,"file_operation")}networkError(r,o){return this.handleError("NETWORK",r,o,void 0,"network_request")}permissionError(r,o){return this.handleError("PERMISSION",r,o,void 0,"permission_check")}unknownError(r,o){return this.handleError("UNKNOWN",r,o,void 0,"unknown")}getErrorHistory(){return[...this.errorHistory]}getErrorsByType(r){return this.errorHistory.filter(o=>o.type===r)}clearHistory(){this.errorHistory=[],d.debug("エラー履歴をクリアしました")}getErrorStats(){const r=Object.values(ue).reduce((o,n)=>(o[n]=0,o),{});return this.errorHistory.forEach(o=>{r[o.type]++}),r}}function et(t,r,o,n="UNKNOWN"){try{return t()}catch(s){const f=s instanceof Error?{stack:s.stack,name:s.name}:{error:String(s)};return r.handleError(n,o,f),null}}const tt=new ms,us=["content","nested_parts"],Ar=["_isZForItem","_parentComponentId","_arrayName","_arrayIndex","_zForTemplate"];function ao(t){const r=(c,u)=>{if(u.length===0||u[0]>=c.length)return null;let m=c[u[0]];for(let g=1;g<u.length;g++){if(!m.nested_parts||!Array.isArray(m.nested_parts)||u[g]>=m.nested_parts.length)return null;m=m.nested_parts[u[g]]}return m},o=(c,u)=>{if(u.length===1)return c;let m=c[u[0]];for(let g=1;g<u.length-1;g++){if(!m.nested_parts||!Array.isArray(m.nested_parts))return[];m=m.nested_parts[u[g]]}return m.nested_parts||[]},n=c=>c.split("-").map(Number),s=c=>c.join("-"),f=(c,u,m=[])=>{if(d.debug(`findComponentRecursively: 検索開始 - componentId=${u}, depth=${m.length}`),!c||!Array.isArray(c))return d.debug(`findComponentRecursively: 無効なデータ - data=${c}, isArray=${Array.isArray(c)}`),null;d.debug(`findComponentRecursively: ${c.length}個のコンポーネントを検索中`);for(let g=0;g<c.length;g++){const $=c[g],C=[...m,g];if(d.debug(`findComponentRecursively: [${g}] チェック中 - id=${$.id}, type=${$.type}`),$.id===u)return d.success(`findComponentRecursively: 発見！ - ${u} at path=${C.join("-")}`),$;if($.nested_parts&&Array.isArray($.nested_parts)){d.debug(`findComponentRecursively: nested_parts検索 - ${$.id} (${$.nested_parts.length}個)`);const I=f($.nested_parts,u,C);if(I)return I}const P=Object.keys($);for(const I of P){const T=$[I];if(Array.isArray(T)&&I!=="nested_parts"){d.debug(`findComponentRecursively: z-for配列検索 - ${$.id}.${I} (${T.length}個)`);for(let V=0;V<T.length;V++){const L=T[V];if(L&&typeof L=="object"&&L.id){if(d.debug(`findComponentRecursively: z-for配列アイテム - ${L.id} in ${$.id}.${I}[${V}]`),L.id===u)return d.success(`findComponentRecursively: z-for配列アイテムで発見！ - ${u}`),L;if(L.nested_parts&&Array.isArray(L.nested_parts)){d.debug(`findComponentRecursively: z-for配列アイテムのネストパーツ検索 - ${L.id}.nested_parts (${L.nested_parts.length}個)`);const U=f(L.nested_parts,u,[...C,V]);if(U)return d.success(`findComponentRecursively: z-for配列内のネストパーツで発見！ - ${u}`),U}}}}}}return d.debug(`findComponentRecursively: 未発見 - ${u}`),null},y=(c,u)=>et(()=>{if(c==="z-for-item")return"";if(!Array.isArray(t))throw new Error("Parts配列が無効です");if(!c||!u)throw new Error("Type または ModuleName が指定されていません");const m=t.find($=>$.type===c);if(!m)throw new Error(`パーツタイプ "${c}" が見つかりません`);const g=m.module.find($=>$.title===u);if(!g)throw new Error(`モジュール "${u}" が見つかりません (type: ${c})`);return g.body},tt,`テンプレート取得エラー: ${c}/${u}`,ue.TEMPLATE)||"",h=new Set,b=(c,u)=>{d.debug(`extractZForTemplate開始: arrayName=${u}`);const m=new RegExp(`<(\\w+)[^>]*z-for="${u}"[^>]*>`),g=c.match(m);if(!g)return d.warn(`z-for="${u}" 開始タグが見つかりません`),d.debug("親テンプレート内容:",c.substring(0,500)),"";const $=c.indexOf(g[0]),C=g[1];let P=0,I=$,T=$;for(;T<c.length;)if(c.substring(T,T+C.length+1)===`<${C}`){const L=c.indexOf(">",T);L!==-1?(P++,T=L+1):T++}else if(c.substring(T,T+C.length+3)===`</${C}>`){if(P--,P===0){I=T+C.length+3;break}T+=C.length+3}else T++;if(P!==0)return d.warn(`z-for="${u}" の対応する終了タグが見つかりません（深度: ${P}）`),"";const V=c.substring($,I).trim();return d.debug(`z-for内テンプレート抽出成功: ${u}`,{extractedContent:V.substring(0,200),fullContent:V,startIndex:$,endIndex:I,depth:0}),V},A=()=>"comp_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36),N=c=>{const u=`${c.id}_${c.type}_${c.module_name}`;if(d.debug(`getFieldInfo: _isZForItem=${c._isZForItem}`),d.debug(`getFieldInfo: _arrayName=${c._arrayName}`),h.has(u))return d.warn(`getFieldInfo: 無限ループを検出、処理をスキップ: ${u}`),[];h.add(u);try{let m="";if(c._isZForItem){const I=c._parentType,T=c._parentModuleName;d.debug(`getFieldInfo: z-for-itemのparent情報 - type: ${I}, module: ${T}`),I&&T?m=y(I,T):(d.debug("getFieldInfo: 親情報なし、コンポーネント自体を使用"),m=y(c.type,c.module_name))}else m=y(c.type,c.module_name);if(!m)return[];if(d.debug(`getFieldInfo: component.id=${c.id}, type=${c.type}, module=${c.module_name}`),d.debug(`getFieldInfo: _isZForItem=${c._isZForItem}`),c._isZForItem){const I=c._arrayName;if(d.debug(`getFieldInfo: z-for配列要素を検出, arrayName=${I}`),d.debug("getFieldInfo: componentプロパティ:",Object.keys(c)),I){d.debug("getFieldInfo: 元のテンプレート:",m.substring(0,300));const T=b(m,I);T?(m=T,d.debug("getFieldInfo: z-for内テンプレート抽出完了:",m)):d.warn(`getFieldInfo: z-for内テンプレートの抽出に失敗: arrayName=${I}`)}}else d.debug("getFieldInfo: 通常のコンポーネント処理");const g=[],$=m.match(/\(\$([^:]+):(.*?)\)/g)||[],C=[];if(m.includes("z-for=")){const I=/<(\w+)[^>]*z-for="([^"]+)"[^>]*>/g;let T;for(;(T=I.exec(m))!==null;){const V=T[2],L=T.index;if(d.debug(`z-for検出: ${V}, 現在の配列: ${c._arrayName}`),c._isZForItem&&V!==c._arrayName){let U=0,M=L,O=L;for(;O<m.length;){if(m.substring(O,O+4)==="<div")U++;else if(m.substring(O,O+6)==="</div>"&&(U--,U===0)){M=O+6;break}O++}if(U===0){const Y=m.substring(L,M).match(/\(\$([^:]+):(.*?)\)/g);Y&&Y.forEach(re=>{const de=re.match(/\(\$([^:]+):(.*?)\)/);if(de){const me=de[1].replace("?","");C.push(me)}}),d.debug(`子z-for除外: ${V} のフィールドを除外リストに追加`)}}}}C.length>0&&d.debug("z-for配列内のフィールドを除外:",C);let P;return c._isZForItem?P=$.filter(I=>{const T=I.match(/\(\$([^:]+):(.*?)\)/);if(T){const V=T[1].replace("?",""),L=!C.includes(V);return L?d.debug(`z-for配列アイテム編集: フィールド ${V} を表示`):d.debug(`z-for配列アイテム編集: フィールド ${V} を除外（子z-forフィールド）`),L}return!1}):P=$.filter(I=>{const T=I.match(/\(\$([^:]+):(.*?)\)/);if(T){const V=T[1].replace("?","");let L=!1,U=!1;const M=new RegExp(`\\(\\$${V.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}[?:]`,"g"),O=/<[^>]*z-for="[^"]*"[^>]*>[\s\S]*?<\/[^>]*>/g;let J;for(;(J=O.exec(m))!==null;){const Y=J[0];if(M.test(Y)){L=!0;break}}if(L){const Y=m.replace(O,"");M.lastIndex=0,M.test(Y)&&(U=!0)}return L&&!U?(d.debug(`getFieldInfo: ${V} をz-for内専用フィールドとして除外`),!1):(d.debug(`getFieldInfo: ${V} を表示対象に含める`),!0)}return!0}),P.forEach(I=>{const T=I.match(/\(\$([^:]+):(.*?)\)/);if(T){const[,V,L]=T,U=V.includes("?"),M=V.replace("?","");if(L.includes("|")){let O=L.split("|"),J=!1;if((L.includes("||")||L.startsWith("|")||L.endsWith("|"))&&(J=!0),O=O.filter(Y=>Y.trim()!==""),J&&O.unshift("指定なし"),U){const Y=O.length>0?[O[0]]:[],re={type:"checkbox",paramName:M,propKey:M,options:O,defaultValue:Y,label:`${M} (チェックボックス)`};g.push(re)}else{const Y=O[0]||"",re={type:"radio",paramName:M,propKey:M,options:O,defaultValue:Y,label:`${M} (ラジオボタン)`};g.push(re)}}else if(L.includes(",")){const O=L.split(",").map(J=>J.trim()).filter(J=>J!=="");if(U){const J=O.length>0?[O[0]]:[],Y={type:"select-multiple",paramName:M,propKey:M,options:O,defaultValue:J,label:`${M} (セレクトボックス・複数選択)`};g.push(Y)}else{const J=O[0]||"",Y={type:"select",paramName:M,propKey:M,options:O,defaultValue:J,label:`${M} (セレクトボックス)`};g.push(Y)}}else{const O={type:"text",paramName:M,propKey:M,options:[],defaultValue:L,label:`${M} (テキストボックス)`};g.push(O)}}}),d.debug(`getFieldInfo: 抽出されたフィールド数=${g.length}`,g.map(I=>({paramName:I.paramName,type:I.type}))),g}catch(m){return d.error(`getFieldInfo: エラーが発生しました: ${u}`,m),[]}finally{h.delete(u)}},w=(c,u)=>{try{const m=y(c.type,c.module_name);if(!m)return!1;let g=m;if(c._isZForItem){const T=c._arrayName,V=b(m,T);V&&(g=V)}const $=new RegExp(`\\{\\$${u}:[^}]*\\}`),C=new RegExp(`\\(\\$${u}:[^)]*\\)`),P=new RegExp(`\\(\\$${u}\\?:[^)]*\\)`),I=$.test(g)||C.test(g)||P.test(g);if(!I&&!c._isZForItem){const T=/<[^>]*z-for="[^"]*"[^>]*>[\s\S]*?<\/[^>]*>/g;let V;for(;(V=T.exec(m))!==null;){const L=V[0];if(d.debug(`isTemplateField: z-forブロック検査中 - ${u}`,L.substring(0,100)),$.test(L)||C.test(L)||P.test(L))return d.success(`isTemplateField: ${u} はz-for内で使用されているためメイン編集パネルから除外`),!0}d.debug(`isTemplateField: ${u} - z-for内での使用検出結果: false`),d.debug("isTemplateField: テンプレート内容 (最初200文字):",m.substring(0,200))}return I}catch(m){return d.warn(`isTemplateField error for ${u}:`,m),!1}},k=(c,u)=>!!(["content","nested_parts"].includes(c)||Array.isArray(u)||typeof u=="object"&&u!==null);return{findComponentByPath:r,getParentContainer:o,parseHierarchyPath:n,stringifyHierarchyPath:s,findComponentRecursively:f,getTemplate:y,generateUniqueId:A,getFieldInfo:N,isTemplateField:w,shouldExcludeField:k,shouldShowBasicField:(c,u,m)=>{if(c==="id"||c==="type"||c==="module_name")return!1;const g=y(m.type,m.module_name);if(g&&g.includes("z-for=")){const $=/<[^>]*z-for="[^"]*"[^>]*>[\s\S]*?<\/[^>]*>/g;let C,P=!1,I=!1;const T=new RegExp(`\\(\\$${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}[?:]`,"g");for(;(C=$.exec(g))!==null;){const V=C[0];if(T.test(V)){P=!0;break}}if(P){const V=g.replace($,"");T.lastIndex=0,T.test(V)&&(I=!0)}if(P&&!I)return!1}return m._isZForItem||Ar.includes(c)||k(c,u)||w(m,c)||u===""||u===null||u===void 0||typeof u=="string"&&u.trim()===""||typeof u=="number"&&u===0?!1:typeof u=="string"&&u.trim()!==""||typeof u=="number"&&u!==0||typeof u=="boolean"},shouldShowArrayField:(c,u,m)=>{const g=`${m.id}_${m.type}_${m.module_name}_array_${c}`;if(h.has(g))return d.warn(`shouldShowArrayField: 無限ループを検出、処理をスキップ: ${g}`),!1;h.add(g);try{if(d.debug(`shouldShowArrayField開始: key=${c}, component: ${m.id} (${m.type}/${m.module_name})`,{key:c,value:u,componentId:m.id}),us.includes(String(c)))return d.debug(`shouldShowArrayField: ${c} はシステム内部フィールドのため除外`),!1;if(m._isZForItem&&Ar.includes(String(c)))return d.debug(`shouldShowArrayField: ${c} はz-forシステムフィールドのため除外`),!1;if(w(m,c))return d.debug(`shouldShowArrayField: ${c} はテンプレート記法フィールドのため除外`),!1;const $=y(m.type,m.module_name);if($){if(d.debug("shouldShowArrayField: テンプレート取得成功:",$.substring(0,200)),new RegExp(`z-for="${c}"`).test($))return d.success(`shouldShowArrayField: ${c}はz-for記法で使用されているため編集パネルでは非表示（プレビュー側で編集）`),Array.isArray(u)||(d.debug(`shouldShowArrayField: ${c}は配列でないが、記法で使用されているため空配列で初期化`),m[c]=[]),!1;d.debug(`shouldShowArrayField: ${c}は配列記法で使用されていない`)}else d.debug("shouldShowArrayField: テンプレート取得失敗");return Array.isArray(u)||d.debug(`shouldShowArrayField: ${c}は配列でなく、記法でも使用されていない`),!1}catch($){return d.error(`shouldShowArrayField: エラーが発生しました: ${g}`,$),!1}finally{h.delete(g)}},shouldShowArrayItemField:(c,u,m,g,$)=>c==="id"||Array.isArray(u)||typeof u=="object"&&u!==null||u===""||u===null||u===void 0||typeof u=="string"&&u.trim()===""||typeof u=="number"&&u===0?!1:(y(m.type,m.module_name),typeof u=="string"&&u.trim()!==""||typeof u=="number"&&u!==0||typeof u=="boolean"),getInputType:c=>c.includes("url")||c.includes("src")?"url":c.includes("email")?"email":c.includes("number")||c.includes("count")?"number":"text",updateCheckboxValue:(c,u,m,g)=>{c[u]||(c[u]=[]);const $=c[u];g?$.includes(m)||$.push(m):c[u]=$.filter(C=>C!==m)},isCheckboxChecked:(c,u,m)=>{const g=c[u];return Array.isArray(g)&&g.includes(m)},addArrayItem:(c,u)=>{c[u]||(c[u]=[]);const m={id:`${u}_${Date.now()}`},g=c[u];if(g.length>0){const $=g[0];Object.keys($).forEach(C=>{if(C!=="id"){const P=$[C],I=typeof P=="string"?"":P;m[C]=I}})}g.push(m)},removeArrayItem:(c,u,m)=>{const g=c[u];g&&g.length>m&&g.splice(m,1)},createNewComponent:(c,u)=>et(()=>{if(!c||!u)throw new Error("partType または module が指定されていません");if(!u.title||!u.body)throw new Error("module.title または module.body が無効です");const m=A();d.debug(`createNewComponent開始: partType=${c}, module=${u.title}`);const g={id:m,type:c,module_name:u.title},$=u.body;d.debug("createNewComponent テンプレート:",$.substring(0,300));const C=$.match(/\{\$([^:}]+):([^}]+)\}/g);C&&C.forEach(V=>{const L=V.match(/\{\$([^:}]+):([^}]+)\}/);if(L){const[,U,M]=L;U!=="input"&&(g[U]=String(M))}});const P=$.match(/\(\$([^:?]+):(.*?)\)/g);P&&P.forEach(V=>{const L=V.match(/\(\$([^:?]+):(.*?)\)/);if(L){const[,U,M]=L,O=M.split("|").filter(J=>J.trim()!=="");O.length>0&&(g[U]=String(O[0]))}});const I=$.match(/\(\$([^:?]+)\?:(.*?)\)/g);I&&I.forEach(V=>{const L=V.match(/\(\$([^:?]+)\?:(.*?)\)/);if(L){const[,U,M]=L,O=M.split("|").filter(J=>J.trim()!=="");g[U]=O.length>0?[O[0]]:[]}});const T=$.match(/z-for="([^"]+)"/g);return T?(d.debug("createNewComponent: z-for記法発見:",T),T.forEach(V=>{const L=V.match(/z-for="([^"]+)"/);if(L){const[,U]=L;g[U]?d.debug(`createNewComponent: z-for配列 ${U} は既に初期化済み`):(d.debug(`createNewComponent: z-for配列 ${U} を空配列で初期化`),g[U]=[])}})):d.debug("createNewComponent: z-for記法が見つかりませんでした"),d.debug("createNewComponent完了: newComponent=",g),g},tt,`コンポーネント作成エラー: ${c}/${u?.title}`,ue.COMPONENT)||{id:A(),type:c||"unknown",module_name:u?.title||"unknown"},createArrayItem:c=>{const u={id:A()},m=c.match(/\{\$([^:}]+):([^}]+)\}/g);m&&m.forEach($=>{const C=$.match(/\{\$([^:}]+):([^}]+)\}/);if(C){const[,P,I]=C;u[P]=String(I)}});const g=c.match(/\(\$([^:?]+):(.*?)\)/g);return g&&g.forEach($=>{const C=$.match(/\(\$([^:?]+):(.*?)\)/);if(C){const[,P,I]=C,T=I.split("|").filter(V=>V.trim()!=="");T.length>0&&(u[P]=String(T[0]))}}),u},getArrayItemFieldInfo:(c,u)=>{const m=y(c.type,c.module_name);if(!m)return[];const g=[];let $="";const C=b(m,u);return C&&($=C),$&&($.match(/\(\$([^:]+):(.*?)\)/g)||[]).forEach(I=>{const T=I.match(/\(\$([^:]+):(.*?)\)/);if(T){const[,V,L]=T,U=V.includes("?"),M=V.replace("?","");if(L.includes("|")){let O=L.split("|"),J=!1;if((L.includes("||")||L.startsWith("|")||L.endsWith("|"))&&(J=!0),O=O.filter(Y=>Y.trim()!==""),J&&O.unshift("指定なし"),U){const Y=O.length>0?[O[0]]:[],re={type:"checkbox",paramName:M,propKey:M,options:O,defaultValue:Y,label:`${M} (チェックボックス)`};g.push(re)}else{const Y=O[0]||"",re={type:"radio",paramName:M,propKey:M,options:O,defaultValue:Y,label:`${M} (ラジオボタン)`};g.push(re)}}else if(L.includes(",")){const O=L.split(",").map(J=>J.trim()).filter(J=>J!=="");if(U){const J=O.length>0?[O[0]]:[],Y={type:"select-multiple",paramName:M,propKey:M,options:O,defaultValue:J,label:`${M} (セレクトボックス・複数選択)`};g.push(Y)}else{const J=O[0]||"",Y={type:"select",paramName:M,propKey:M,options:O,defaultValue:J,label:`${M} (セレクトボックス)`};g.push(Y)}}else{const O={type:"text",paramName:M,propKey:M,options:[],defaultValue:L,label:`${M} (テキストボックス)`};g.push(O)}}}),g}}}const gs={class:"zero-code-content-sidebar"},fs={key:0,class:"zero-code-editable-component"},hs={class:"zero-code-component-info"},ys={class:"zero-code-component-type"},bs={class:"zero-code-component-module"},$s={class:"zero-code-component-id"},_s={class:"zero-code-fields"},Es={class:"zero-code-field-label"},zs={key:0,class:"zero-code-text-group"},ws=["value","onInput"],vs={key:1,class:"zero-code-radio-group"},Cs=["id","value","name","checked","onChange"],As=["for"],Ns={key:2,class:"zero-code-checkbox-group"},ks=["id","checked","onChange"],Ps=["for"],Ds={key:3,class:"zero-code-select-group"},Is=["value","onChange"],Ss=["value"],Ts={key:4,class:"zero-code-select-multiple-group"},Vs=["value","onChange"],Bs=["value","selected"],Fs={key:0,class:"zero-code-field-group"},Ms=["for"],Ls=["id","value","type","readonly","onInput"],xs=e.defineComponent({__name:"EditorPanel",props:{showEditor:{type:Boolean},selectedComponent:{type:[Object,null]},getFieldInfo:{type:Function},shouldShowBasicField:{type:Function},shouldShowArrayField:{type:Function},shouldShowArrayItemField:{type:Function},getInputType:{type:Function},isCheckboxChecked:{type:Function},partsData:{type:Array},modalContainer:{default:"body",type:String}},emits:["close","update:value","update:array-item","update:checkbox","add:array-item","remove:array-item","reorder:array-item"],setup(t,{emit:r}){const o=t;e.computed(()=>!o.modalContainer||o.modalContainer==="body"?!0:typeof document<"u");const n=e.computed(()=>!o.modalContainer||o.modalContainer==="body"?"body":typeof document<"u"&&document.querySelector(o.modalContainer)?o.modalContainer:"body"),s=r,f=()=>{s("close")},y=(D,i)=>{s("update:value",D,i)},h=()=>{if(!o.selectedComponent)return;o.getFieldInfo(o.selectedComponent).forEach(i=>{i.defaultValue&&!o.selectedComponent[i.propKey]&&((i.type==="checkbox"||i.type==="select-multiple")&&Array.isArray(i.defaultValue)?y(i.propKey,[...i.defaultValue]):y(i.propKey,i.defaultValue))})};e.watch(()=>o.selectedComponent,D=>{D&&h()},{immediate:!0});const b=(D,i,a,l)=>{if(!o.selectedComponent)return;const p=o.selectedComponent[D];if(!Array.isArray(p))return;const z={...p[i],[a]:l};s("update:array-item",D,i,z)},A=(D,i,a)=>{s("update:checkbox",D,i,a)},N=(D,i)=>{D&&s("add:array-item",i)},w=(D,i,a)=>{D&&s("remove:array-item",i,a)},k=(D,i,a)=>{if(!o.selectedComponent)return;const l=o.selectedComponent[D];if(!Array.isArray(l))return;const p=[...l],[z]=p.splice(i,1);p.splice(a,0,z),o.selectedComponent[D]=p,d.debug(`📋 配列並べ替え完了: ${D}[${i}] → [${a}]`),s("reorder:array-item",D,i,a)},v=D=>{if(!o.selectedComponent)return{};const i={};if(o.partsData){const p=ao(o.partsData).getArrayItemFieldInfo(o.selectedComponent,D);if(p.forEach(z=>{i[z.propKey]={label:z.label,type:z.type,options:z.options,defaultValue:z.defaultValue}}),p.length>0)return i}const a=o.selectedComponent[D];if(Array.isArray(a)&&a.length>0){const l=a[0];typeof l=="object"&&l!==null&&Object.keys(l).forEach(p=>{p!=="id"&&(l[p],i[p]={label:p.replace(/_/g," ").replace(/\b\w/g,z=>z.toUpperCase()),type:p.includes("desc")||p.includes("content")?"textarea":"text"})})}return Object.keys(i).length===0?{title:{label:"タイトル",type:"text"},content:{label:"内容",type:"textarea"}}:i},S=D=>D.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()).concat(" 一覧"),B=D=>{let i=D;return D.endsWith("s")&&(i=D.slice(0,-1)),i.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())};return(D,i)=>(e.openBlock(),e.createBlock(e.Teleport,{to:n.value},[D.showEditor&&D.selectedComponent?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-overlay",onClick:f},[e.createElementVNode("div",{class:"zero-code-sidebar",onClick:i[0]||(i[0]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",{class:"zero-code-header"},[e.createElementVNode("div",{class:"zero-code-header-buttons"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-close-button",onClick:f},"✖️")])]),e.createElementVNode("div",gs,[D.selectedComponent?(e.openBlock(),e.createElementBlock("div",fs,[e.createElementVNode("div",hs,[e.createElementVNode("span",ys,e.toDisplayString(D.selectedComponent.type),1),e.createElementVNode("span",bs,e.toDisplayString(D.selectedComponent.module_name),1),e.createElementVNode("span",$s,"ID: "+e.toDisplayString(D.selectedComponent.id),1)]),e.createElementVNode("div",_s,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.getFieldInfo(D.selectedComponent),a=>(e.openBlock(),e.createElementBlock("div",{key:a.propKey,class:"zero-code-template-field"},[e.createElementVNode("label",Es,e.toDisplayString(a.label)+":",1),a.type==="text"?(e.openBlock(),e.createElementBlock("div",zs,[e.createElementVNode("input",{value:D.selectedComponent[a.propKey]||a.defaultValue,type:"text",class:"zero-code-field-input",onInput:l=>{const p=l.target;y(a.propKey,p.value)}},null,40,ws)])):e.createCommentVNode("",!0),a.type==="radio"?(e.openBlock(),e.createElementBlock("div",vs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-radio-item"},[e.createElementVNode("input",{id:`${D.selectedComponent.id}_${a.propKey}_${l}`,value:l,type:"radio",name:`${D.selectedComponent.id}_${a.propKey}`,class:"zero-code-radio-input",checked:D.selectedComponent[a.propKey]===l||l==="指定なし"&&!D.selectedComponent[a.propKey],onChange:p=>y(a.propKey,l==="指定なし"?"":l)},null,40,Cs),e.createElementVNode("label",{for:`${D.selectedComponent.id}_${a.propKey}_${l}`,class:"zero-code-radio-label"},e.toDisplayString(l),9,As)]))),128))])):e.createCommentVNode("",!0),a.type==="checkbox"?(e.openBlock(),e.createElementBlock("div",Ns,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-checkbox-item"},[e.createElementVNode("input",{id:`${D.selectedComponent.id}_${a.propKey}_${l}`,checked:D.isCheckboxChecked(D.selectedComponent,a.propKey,l)||Array.isArray(a.defaultValue)&&a.defaultValue.includes(l)&&!D.selectedComponent[a.propKey],type:"checkbox",class:"zero-code-checkbox-input",onChange:p=>{const z=p.target;A(a.propKey,l,z.checked)}},null,40,ks),e.createElementVNode("label",{for:`${D.selectedComponent.id}_${a.propKey}_${l}`,class:"zero-code-checkbox-label"},e.toDisplayString(l),9,Ps)]))),128))])):e.createCommentVNode("",!0),a.type==="select"?(e.openBlock(),e.createElementBlock("div",Ds,[e.createElementVNode("select",{value:D.selectedComponent[a.propKey]||a.defaultValue,class:"zero-code-field-input zero-code-select-input",onChange:l=>{const p=l.target;y(a.propKey,p.value)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l},e.toDisplayString(l),9,Ss))),128))],40,Is)])):e.createCommentVNode("",!0),a.type==="select-multiple"?(e.openBlock(),e.createElementBlock("div",Ts,[e.createElementVNode("select",{value:D.selectedComponent[a.propKey]||a.defaultValue,multiple:"",class:"zero-code-field-input zero-code-select-multiple",onChange:l=>{const p=l.target,z=Array.from(p.selectedOptions).map(E=>E.value);y(a.propKey,z)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.options,l=>(e.openBlock(),e.createElementBlock("option",{key:l,value:l,selected:Array.isArray(D.selectedComponent[a.propKey])&&D.selectedComponent[a.propKey].includes(l)},e.toDisplayString(l),9,Bs))),128))],40,Vs)])):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.selectedComponent,(a,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:String(l)},[D.shouldShowBasicField(String(l),a,D.selectedComponent)?(e.openBlock(),e.createElementBlock("div",Fs,[e.createElementVNode("label",{for:`${D.selectedComponent.id}_${String(l)}`},e.toDisplayString(l)+":",9,Ms),e.createElementVNode("input",{id:`${D.selectedComponent.id}_${String(l)}`,value:a,type:D.getInputType(String(l)),class:"zero-code-field-input",readonly:String(l)==="id",onInput:p=>{const z=p.target;y(String(l),z.value)}},null,40,Ls)])):e.createCommentVNode("",!0)],64))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.selectedComponent,(a,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:String(l)},[D.shouldShowArrayField(String(l),a,D.selectedComponent)?(e.openBlock(),e.createBlock(ps,{key:0,"component-id":D.selectedComponent.id,"array-key":String(l),items:Array.isArray(a)?a:[],fields:v(String(l)),label:S(String(l)),"item-label":B(String(l)),onAdd:()=>N(D.selectedComponent,String(l)),onRemove:p=>w(D.selectedComponent,String(l),p),onReorder:(p,z)=>k(String(l),p,z),onUpdate:(p,z,E)=>b(String(l),p,z,E)},null,8,["component-id","array-key","items","fields","label","item-label","onAdd","onRemove","onReorder","onUpdate"])):e.createCommentVNode("",!0)],64))),128))])])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)],8,["to"]))}}),Os={class:"zero-code-tab-content"},Rs=e.defineComponent({__name:"EditorMainPanel",props:{dataTab:{type:String},editablePageData:{type:Array},localParts:{type:Array},localCommonParts:{type:Array},localIndividualParts:{type:Array},parts:{type:Array},commonImages:{type:Array},individualImages:{type:Array},showPartSelector:{type:Boolean},showNestedPartSelector:{type:Boolean},showEditor:{type:Boolean},selectedComponent:{type:[Object,null]},renderComponentWithNested:{type:Function},getFieldInfo:{type:Function},shouldShowBasicField:{type:Function},shouldShowArrayField:{type:Function},shouldShowArrayItemField:{type:Function},getInputType:{type:Function},isCheckboxChecked:{type:Function},partsData:{type:Array},isTextEditing:{type:Boolean}},emits:["update:data-tab","add-part","edit-part","delete-part","reorder-parts","close-part-selector","select-part","close-nested-part-selector","select-nested-part","close-editor","update-editor-value","add-array-item","remove-array-item","update-array-item","update-checkbox"],setup(t,{emit:r}){const o=t,n=Math.random().toString(36).substr(2,9);return e.onMounted(async()=>{await e.nextTick();const s=`.modal-container-${n}`;document.querySelector(s)||console.warn(`モーダルコンテナが見つかりません: ${s}`)}),e.watch(()=>o.editablePageData,s=>{},{deep:!0}),(s,f)=>(e.openBlock(),e.createElementBlock("div",Os,[e.createVNode(ga,{"model-value":s.dataTab,"page-data":s.editablePageData,parts:s.localParts&&s.localParts.length>0?s.localParts:s.parts||[],"common-parts":s.localCommonParts,"individual-parts":s.localIndividualParts,"common-images":s.commonImages,"individual-images":s.individualImages,"render-component-with-nested":s.renderComponentWithNested,"is-text-editing":s.isTextEditing,"onUpdate:modelValue":f[0]||(f[0]=y=>s.$emit("update:data-tab",y)),onAddPart:f[1]||(f[1]=y=>s.$emit("add-part",y)),onEditPart:f[2]||(f[2]=y=>s.$emit("edit-part",y)),onDeletePart:f[3]||(f[3]=y=>s.$emit("delete-part",y)),onReorderParts:f[4]||(f[4]=y=>s.$emit("reorder-parts",y))},null,8,["model-value","page-data","parts","common-parts","individual-parts","common-images","individual-images","render-component-with-nested","is-text-editing"]),s.showPartSelector?(e.openBlock(),e.createBlock(Cr,{key:0,parts:s.localParts&&s.localParts.length>0?s.localParts:s.parts||[],"modal-container":`.modal-container-${e.unref(n)}`,onClose:f[5]||(f[5]=y=>s.$emit("close-part-selector")),onSelectPart:f[6]||(f[6]=(y,h)=>s.$emit("select-part",y,h))},null,8,["parts","modal-container"])):e.createCommentVNode("",!0),s.showNestedPartSelector?(e.openBlock(),e.createBlock(Cr,{key:1,parts:s.localParts&&s.localParts.length>0?s.localParts:s.parts||[],"is-nested":!0,"modal-container":`.modal-container-${e.unref(n)}`,onClose:f[7]||(f[7]=y=>s.$emit("close-nested-part-selector")),onSelectPart:f[8]||(f[8]=(y,h)=>s.$emit("select-nested-part",y,h))},null,8,["parts","modal-container"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(`modal-container-${e.unref(n)}`),style:{position:"relative","z-index":"9999"}},null,2),(e.openBlock(),e.createBlock(xs,{key:2,"show-editor":s.showEditor,"selected-component":s.selectedComponent,"get-field-info":s.getFieldInfo,"should-show-basic-field":s.shouldShowBasicField,"should-show-array-field":s.shouldShowArrayField,"should-show-array-item-field":s.shouldShowArrayItemField,"get-input-type":s.getInputType,"is-checkbox-checked":s.isCheckboxChecked,"modal-container":`.modal-container-${e.unref(n)}`,onClose:f[9]||(f[9]=y=>s.$emit("close-editor")),"onUpdate:value":f[10]||(f[10]=(y,h)=>s.$emit("update-editor-value",y,h)),"onAdd:arrayItem":f[11]||(f[11]=y=>s.$emit("add-array-item",y)),"onRemove:arrayItem":f[12]||(f[12]=(y,h)=>s.$emit("remove-array-item",y,h)),"onUpdate:arrayItem":f[13]||(f[13]=y=>s.$emit("update-array-item",y)),"onUpdate:checkbox":f[14]||(f[14]=y=>s.$emit("update-checkbox",y))},null,8,["show-editor","selected-component","get-field-info","should-show-basic-field","should-show-array-field","should-show-array-item-field","get-input-type","is-checkbox-checked","modal-container"]))]))}}),Hs={class:"zero-code-data-display"},Zs={class:"zero-code-data-tabs"},js={class:"zero-code-form-group"},Us={class:"zero-code-form-group"},Ws=["value"],qs={class:"zero-code-data-content"},Gs={key:0,class:"zero-code-rendered-content"},Ks={class:"zero-code-component-header"},Js={class:"zero-code-component-info-header"},Xs={class:"zero-code-component-type"},Ys={class:"zero-code-component-id"},Qs={class:"zero-code-rendered-component"},el={class:"zero-code-component-header"},tl={class:"zero-code-component-info-header"},ol={class:"zero-code-component-module"},rl={class:"zero-code-header-actions"},nl=["onClick"],al=["onClick"],sl=["innerHTML"],ll={key:1,class:"zero-code-no-parts"},Nr=e.defineComponent({__name:"PartsManager",props:{parts:{type:Array},renderPartPreview:{type:Function}},emits:["edit-part","delete-part","search","filter"],setup(t,{emit:r}){const o=t,n=r,s=e.ref(""),f=e.ref(""),y=e.computed(()=>Array.from(new Set(o.parts.map(N=>N.type)))),h=e.computed(()=>{let N=[...o.parts];if(f.value&&(N=N.filter(w=>w.type===f.value)),s.value){const w=s.value.toLowerCase();N=N.map(k=>({...k,module:k.module.filter(v=>v.title.toLowerCase().includes(w)||v.body.toLowerCase().includes(w))})).filter(k=>k.module.length>0)}return N}),b=()=>{n("search",s.value)},A=()=>{n("filter",f.value)};return(N,w)=>(e.openBlock(),e.createElementBlock("div",Hs,[w[4]||(w[4]=e.createElementVNode("div",{class:"zero-code-component-header"},[e.createElementVNode("h4",null,"パーツ管理")],-1)),e.createElementVNode("div",Zs,[e.createElementVNode("div",js,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":w[0]||(w[0]=k=>s.value=k),placeholder:"パーツ名で検索...",class:"zero-code-form-input",onInput:b},null,544),[[e.vModelText,s.value]])]),e.createElementVNode("div",Us,[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":w[1]||(w[1]=k=>f.value=k),class:"zero-code-form-select",onChange:A},[w[2]||(w[2]=e.createElementVNode("option",{value:""},"すべてのType",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,k=>(e.openBlock(),e.createElementBlock("option",{key:k,value:k},e.toDisplayString(k),9,Ws))),128))],544),[[e.vModelSelect,f.value]])])]),e.createElementVNode("div",qs,[Array.isArray(h.value)&&h.value.length>0?(e.openBlock(),e.createElementBlock("div",Gs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,(k,v)=>(e.openBlock(),e.createElementBlock("div",{key:v,class:"zero-code-data-section"},[e.createElementVNode("div",Ks,[e.createElementVNode("div",Js,[e.createElementVNode("span",Xs,e.toDisplayString(k.type),1)]),e.createElementVNode("span",Ys,e.toDisplayString(k.module.length)+"個のパーツ",1)]),e.createElementVNode("div",Qs,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.module,(S,B)=>(e.openBlock(),e.createElementBlock("div",{key:B,class:"zero-code-draggable-item"},[e.createElementVNode("div",el,[e.createElementVNode("div",tl,[e.createElementVNode("span",ol,e.toDisplayString(S.title),1)]),e.createElementVNode("div",rl,[e.createElementVNode("button",{class:"zero-code-edit-btn",onClick:D=>N.$emit("edit-part",{type:k.type,module:S})}," 編集 ",8,nl),e.createElementVNode("button",{class:"zero-code-delete-btn",onClick:D=>N.$emit("delete-part",{type:k.type,title:S.title})}," 削除 ",8,al)])]),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:o.renderPartPreview(S.body)},null,8,sl)]))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",ll,w[3]||(w[3]=[e.createElementVNode("p",null,"登録されたパーツがありません。",-1)])))])]))}}),il={class:"zero-code-modal-header"},dl={class:"zero-code-modal-title"},cl={class:"zero-code-title-main"},pl={class:"zero-code-modal-subtitle"},ml={class:"zero-code-modal-body"},ul={class:"zero-code-form-layout"},gl={class:"zero-code-form-section"},fl={key:0,class:"zero-code-form-group"},hl={class:"zero-code-type-input-group"},yl=["value"],bl={key:1,class:"zero-code-form-group"},$l={class:"zero-code-form-group"},_l={class:"zero-code-body-editor-container"},El={class:"zero-code-preview-section"},zl={class:"zero-code-preview-container"},wl=["innerHTML"],vl={class:"zero-code-modal-footer"},Cl={class:"zero-code-modal-actions"},Al=["disabled"],Nl=e.defineComponent({__name:"PartRegistrationModal",props:{isEditing:{type:Boolean,default:!1},existingTypes:{type:Array},partCategory:{default:"common",type:String},editingPart:{default:null,type:[Object,null]},initialData:{default:()=>({type:"",title:"",body:""}),type:Object},renderPartPreview:{type:Function}},emits:["close","save"],setup(t,{emit:r}){const o=t,n=r,s=()=>o.isEditing&&o.editingPart?{type:o.editingPart.type,title:o.editingPart.module.title,body:o.editingPart.module.body}:{type:o.initialData.type,title:o.initialData.title,body:o.initialData.body},f=e.ref(s()),y=e.computed(()=>(o.isEditing||f.value.type.trim()!==""&&f.value.title.trim()!=="")&&f.value.body.trim()!==""),h=()=>{},b=()=>{y.value&&n("save",{type:f.value.type,title:f.value.title,body:f.value.body,category:o.partCategory||"common"})};return(A,N)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:N[7]||(N[7]=w=>A.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-part-modal",onClick:N[6]||(N[6]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",il,[e.createElementVNode("div",dl,[e.createElementVNode("div",cl,[e.createElementVNode("h3",null,e.toDisplayString(A.isEditing?"パーツ編集":"新規パーツ登録"),1),e.createElementVNode("span",{class:e.normalizeClass(["zero-code-badge",A.partCategory])},e.toDisplayString(A.partCategory==="common"?"共通パーツ":"個別パーツ"),3)]),e.createElementVNode("p",pl,e.toDisplayString(A.isEditing?"パーツの内容を編集できます":"新しいパーツを作成します"),1)]),e.createElementVNode("button",{class:"zero-code-modal-close-btn",onClick:N[0]||(N[0]=w=>A.$emit("close"))},N[8]||(N[8]=[e.createElementVNode("span",null,"✖️",-1)]))]),e.createElementVNode("div",ml,[e.createElementVNode("div",ul,[e.createElementVNode("div",gl,[A.isEditing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",fl,[N[10]||(N[10]=e.createElementVNode("label",{for:"part-type",class:"zero-code-form-label"},"Type",-1)),e.createElementVNode("div",hl,[e.withDirectives(e.createElementVNode("select",{id:"part-type","onUpdate:modelValue":N[1]||(N[1]=w=>f.value.type=w),class:"zero-code-form-select"},[N[9]||(N[9]=e.createElementVNode("option",{value:""},"新しいTypeを選択",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(A.existingTypes,w=>(e.openBlock(),e.createElementBlock("option",{key:w,value:w},e.toDisplayString(w),9,yl))),128))],512),[[e.vModelSelect,f.value.type]]),!f.value.type||!A.existingTypes.includes(f.value.type)?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":N[2]||(N[2]=w=>f.value.type=w),placeholder:"新しいType名を入力",class:"zero-code-form-input"},null,512)),[[e.vModelText,f.value.type]]):e.createCommentVNode("",!0)])])),A.isEditing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",bl,[N[11]||(N[11]=e.createElementVNode("label",{for:"part-title",class:"zero-code-form-label"},"Title",-1)),e.withDirectives(e.createElementVNode("input",{id:"part-title","onUpdate:modelValue":N[3]||(N[3]=w=>f.value.title=w),placeholder:"パーツのタイトルを入力",class:"zero-code-form-input"},null,512),[[e.vModelText,f.value.title]])])),e.createElementVNode("div",$l,[N[12]||(N[12]=e.createElementVNode("label",{for:"part-body",class:"zero-code-form-label"},"HTML Template",-1)),e.createElementVNode("div",_l,[e.withDirectives(e.createElementVNode("textarea",{id:"part-body","onUpdate:modelValue":N[4]||(N[4]=w=>f.value.body=w),class:"zero-code-body-editor",placeholder:"HTMLソースを直接編集してください...",onInput:h},null,544),[[e.vModelText,f.value.body]])])])]),e.createElementVNode("div",El,[N[13]||(N[13]=e.createElementVNode("div",{class:"zero-code-preview-header"},[e.createElementVNode("h4",null,"プレビュー"),e.createElementVNode("span",{class:"zero-code-preview-info"},"リアルタイムで表示を確認")],-1)),e.createElementVNode("div",zl,[e.createElementVNode("div",{class:"zero-code-preview-content",innerHTML:A.renderPartPreview(f.value.body)},null,8,wl)])])])]),e.createElementVNode("div",vl,[e.createElementVNode("div",Cl,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:N[5]||(N[5]=w=>A.$emit("close"))}," キャンセル "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",disabled:!y.value,onClick:b},e.toDisplayString(A.isEditing?"更新":"登録"),9,Al)])])])]))}}),kl={class:"zero-code-tab-content"},Pl={class:"zero-code-data-tabs"},Dl={class:"zero-code-tab-buttons"},Il=["onClick"],Sl={class:"zero-code-parts-content"},Tl={key:0,class:"zero-code-parts-section"},Vl={class:"zero-code-section-header"},Bl={key:1,class:"zero-code-parts-section"},Fl={class:"zero-code-section-header"},Ml={key:2,class:"zero-code-parts-section"},Ll={class:"zero-code-data-display-section"},xl={class:"zero-code-parts-sub-tabs"},Ol={class:"zero-code-parts-sub-content"},Rl={key:0,class:"zero-code-parts-sub-section"},Hl={key:0},Zl={class:"zero-code-data-display-pre"},jl={key:1},Ul={key:1,class:"zero-code-parts-sub-section"},Wl={key:0},ql={class:"zero-code-data-display-pre"},Gl={key:1},Kl=e.defineComponent({__name:"PartsManagementPanel",props:{localParts:{type:Array},localCommonParts:{type:Array},localIndividualParts:{type:Array},showPartRegistration:{type:Boolean},existingPartTypes:{type:Array},editingPart:{type:null},renderPartPreview:{type:Function}},emits:["update-parts","edit-part","delete-part","show-registration","close-registration","save-part"],setup(t,{emit:r}){const o=t,n=r,s=e.ref("common"),f=e.ref("common"),y=e.ref("common"),h=["common","individual","data"],b=i=>({common:"共通パーツ",individual:"個別パーツ",data:"データ表示"})[i],A=e.computed(()=>o.localCommonParts&&o.localCommonParts.length>0?o.localCommonParts:o.localParts.map(i=>({...i,module:i.module.filter(a=>{const l=a;return!l.category||l.category==="common"})})).filter(i=>i.module.length>0)),N=e.computed(()=>o.localIndividualParts&&o.localIndividualParts.length>0?o.localIndividualParts:o.localParts.map(i=>({...i,module:i.module.filter(a=>a.category==="individual")})).filter(i=>i.module.length>0)),w=i=>{f.value=i,n("close-registration")},k=()=>{n("close-registration")},v=i=>{const a=i.module;f.value=a.category||"common",n("edit-part",i)},S=i=>{n("delete-part",i)},B=i=>{const a={...i,category:f.value};n("save-part",a)},D=i=>{const a=(l,p=0)=>{const z="  ".repeat(p),E="  ".repeat(p+1);if(Array.isArray(l))return l.length===0?"[]":`[
${l.map(c=>E+a(c,p+1)).join(`,
`)}
${z}]`;if(typeof l=="object"&&l!==null){const _=Object.entries(l);return _.length===0?"{}":`{
${_.map(([u,m])=>{let g;if(typeof m=="string"){const $=m.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if($.includes(`
`)){const C=$.split(`
`);g=C.map((I,T)=>T===0?`\`${I}`:T===C.length-1?`${E}${I}\``:`${E}${I}`).join(`
`)}else g=`"${$}"`}else g=a(m,p+1);return`${E}"${u}": ${g}`}).join(`,
`)}
${z}}`}return typeof l=="string"?`"${l.replace(/"/g,'\\"')}"`:JSON.stringify(l)};return a(i)};return(i,a)=>(e.openBlock(),e.createElementBlock("div",kl,[e.createElementVNode("div",Pl,[e.createElementVNode("div",Dl,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(h,l=>e.createElementVNode("button",{key:l,class:e.normalizeClass(["zero-code-data-tab-button",{active:s.value===l}]),onClick:p=>s.value=l},e.toDisplayString(b(l)),11,Il)),64))])]),e.createElementVNode("div",Sl,[s.value==="common"?(e.openBlock(),e.createElementBlock("div",Tl,[e.createElementVNode("div",Vl,[e.createElementVNode("h4",null,"共通パーツ ("+e.toDisplayString(A.value.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-add-part-btn",onClick:a[0]||(a[0]=l=>w("common"))}," ＋ 共通パーツ登録 ")]),e.createVNode(Nr,{parts:A.value,"render-part-preview":i.renderPartPreview,onEditPart:v,onDeletePart:S},null,8,["parts","render-part-preview"])])):e.createCommentVNode("",!0),s.value==="individual"?(e.openBlock(),e.createElementBlock("div",Bl,[e.createElementVNode("div",Fl,[e.createElementVNode("h4",null,"個別パーツ ("+e.toDisplayString(N.value.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-add-part-btn",onClick:a[1]||(a[1]=l=>w("individual"))}," ＋ 個別パーツ登録 ")]),e.createVNode(Nr,{parts:N.value,"render-part-preview":i.renderPartPreview,onEditPart:v,onDeletePart:S},null,8,["parts","render-part-preview"])])):e.createCommentVNode("",!0),s.value==="data"?(e.openBlock(),e.createElementBlock("div",Ml,[e.createElementVNode("div",Ll,[e.createElementVNode("div",xl,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:y.value==="common"}]),onClick:a[2]||(a[2]=l=>y.value="common")}," 共通Partsデータ ",2),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:y.value==="individual"}]),onClick:a[3]||(a[3]=l=>y.value="individual")}," 個別Partsデータ ",2)]),e.createElementVNode("div",Ol,[y.value==="common"?(e.openBlock(),e.createElementBlock("div",Rl,[A.value&&A.value.length>0?(e.openBlock(),e.createElementBlock("div",Hl,[e.createElementVNode("pre",Zl,e.toDisplayString(D(A.value)),1)])):(e.openBlock(),e.createElementBlock("div",jl,a[4]||(a[4]=[e.createElementVNode("p",null,"共通パーツデータがありません",-1)])))])):e.createCommentVNode("",!0),y.value==="individual"?(e.openBlock(),e.createElementBlock("div",Ul,[N.value&&N.value.length>0?(e.openBlock(),e.createElementBlock("div",Wl,[e.createElementVNode("pre",ql,e.toDisplayString(D(N.value)),1)])):(e.openBlock(),e.createElementBlock("div",Gl,a[5]||(a[5]=[e.createElementVNode("p",null,"個別パーツデータがありません",-1)])))])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)]),i.showPartRegistration?(e.openBlock(),e.createBlock(Nl,{key:0,"existing-types":i.existingPartTypes,"render-part-preview":i.renderPartPreview,"editing-part":i.editingPart,"is-editing":!!i.editingPart,"part-category":f.value,onClose:k,onSave:B},null,8,["existing-types","render-part-preview","editing-part","is-editing","part-category"])):e.createCommentVNode("",!0)]))}});function Q(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}let Mt,Ge;function Jl(t,r){Mt=t,Ge=r}function Do(t,r){t.querySelectorAll("[z-if]").forEach(n=>{const s=n.getAttribute("z-if");s&&(r[s]?n.removeAttribute("z-if"):n.remove())})}function Xl(t,r){const o=t.querySelectorAll("[z-for-wrapper]");o.length>0&&o.forEach(n=>{const s=n.getAttribute("z-for-wrapper");if(s){const f=r[s];!Array.isArray(f)||f.length,n.removeAttribute("z-for-wrapper")}})}function kr(t,r){return`
    <div class="zero-code-add-array-item-button-container">
      <button class="zero-code-add-array-item-button" onclick="window.addArrayItem('${Q(t)}', '${Q(r)}')">
        <span class="zero-code-plus-icon">＋</span>
        <span class="zero-code-button-text">${r}を追加</span>
      </button>
    </div>
  `}function Yl(t,r,o){return`
    <div class="zero-code-z-for-controls" data-component-id="${t}" data-array-name="${r}" data-index="${o}">
      <div class="zero-code-z-for-controls-inner">
        <button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${Q(t)}', '${Q(r)}', ${o})" title="上に追加">
          <span class="zero-code-control-icon">＋</span>
        </button>
        <span class="zero-code-z-for-drag-handle"
              draggable="true"
              onDragStart="window.handleZForDragStart(event, '${Q(t)}', '${Q(r)}', ${o})"
              style="cursor: grab;"
              title="ドラッグして並び替え">⠿</span>
        <button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${Q(t)}', '${Q(r)}', ${o})" title="編集">
          <span class="zero-code-control-icon">✎</span>
        </button>
        <button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${Q(t)}', '${Q(r)}', ${o})" title="削除">
          <span class="zero-code-control-icon">✕</span>
        </button>
      </div>
    </div>
  `}function Pr(t,r,o,n,s){const f=t.querySelectorAll("[z-for]");f.length>0&&(f.forEach(h=>{const b=h.getAttribute("z-for");if(b){const A=r[b];if(Array.isArray(A)&&A.length>0){const N=s(r.type,r.module_name),w=new RegExp(`<(\\w+)[^>]*z-for="${b}"[^>]*>`),k=N.match(w),v=k?N.indexOf(k[0]):-1;if(v!==-1&&k){const S=k[1];let B=0,D=v;for(let l=v;l<N.length;l++)if(N.substring(l,l+S.length+1)===`<${S}`)B++;else if(N.substring(l,l+S.length+3)===`</${S}>`&&(B--,B===0)){D=l+S.length+3;break}const i=N.substring(v,D),a=[i];if(a&&a[0]){let l="";const p=i.match(new RegExp(`<${S}([^>]*z-for="[^"]*"[^>]*)>`));let z="";p&&p[1]&&(z=p[1].replace(/\s*z-for="[^"]*"\s*/,"").trim());const E=i.indexOf(">")+1,_=i.lastIndexOf(`</${S}>`),c=i.substring(E,_).trim();if(c){const u=c;A.forEach(($,C)=>{let P=u;const I=`<div class="zero-code-z-for-controls" data-component-id="${Q(r.id)}" data-array-name="${Q(b)}" data-index="${C}">
<div class="zero-code-z-for-controls-inner">
<button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(b)}', ${C})" title="上に追加">
<span class="zero-code-control-icon">＋</span>
</button>
<span class="zero-code-z-for-drag-handle" draggable="true" onDragStart="window.handleZForDragStart(event, '${Q(r.id)}', '${Q(b)}', ${C})" title="ドラッグして並び替え">⠿</span>
<button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${Q(r.id)}', '${Q(b)}', ${C})" title="編集">
<span class="zero-code-control-icon">✎</span>
</button>
<button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${Q(r.id)}', '${Q(b)}', ${C})" title="削除">
<span class="zero-code-control-icon">✕</span>
</button>
</div>
</div>`;if(Mt&&(P=Mt(P,$,r,N,b)),Ge&&(P=Ge(P,$)),P.includes("z-if")||P.includes("z-slot")||P.includes("z-for")){const de=new DOMParser().parseFromString(`<div>${P}</div>`,"text/html"),me=`${r.id}_${b}_${C}`;let Ne=r;if(typeof window<"u"&&window.getLatestComponentData){const Pe=window.getLatestComponentData(r.id);Pe&&(Ne=Pe)}const ke={...Ne,...$,type:Ne.type,module_name:Ne.module_name,id:me};Do(de,ke),de.querySelectorAll("[z-slot]").forEach(Pe=>{const he=Pe.getAttribute("z-slot");if(he&&ke[he]){const Ce=ke[he];if(Array.isArray(Ce)&&Ce.length>0){let ge='<div class="zero-code-z-for-nested-parts">';Ce.forEach((pt,bt)=>{const Fo=`${r.id}.${b}[${C}].${he}`;ge+=`
                            <div class="zero-code-add-nested-part-button-container">
                              <button class="zero-code-add-position-part-button" onclick="event.stopPropagation(); window.openNestedPartSelector('${Q(Fo)}', ${bt})">
                                <span class="zero-code-plus-icon">＋</span>
                                <span class="zero-code-button-text">上にパーツを追加</span>
                              </button>
                            </div>
                          `;const At=n(pt,s,o+2),st=`${r.id}.${b}[${C}].${he}[${bt}]`,co=o+2;ge+=`
                            <div class="zero-code-nested-component zero-code-nested-depth-${co} zero-code-z-for-nested-part" 
                                 draggable="true"
                                 data-component-id="${pt.id}" 
                                 data-path="${st}" 
                                 data-parent-path="${r.id}.${b}[${C}].${he}"
                                 data-index="${bt}"
                                 data-nested-path="${st}"
                                 data-slot-name="${he}"
                                 data-part-index="${bt}"
                                 ondragstart="window.handleNestedPartDragStart && window.handleNestedPartDragStart(event)"
                                 ondragend="window.handleNestedPartDragEnd && window.handleNestedPartDragEnd(event)"
                                 class="zero-code-nested-component"
                                 onmousedown="this.style.cursor = 'grabbing'"
                                 onmouseup="this.style.cursor = 'grab'">
                              <div class="zero-code-component-header zero-code-nested-header">
                                <!-- ドラッグハンドル（視覚的インジケーター） -->
                                <div class="zero-code-drag-handle-nested" title="ドラッグして並び替え">
                                  ⠿
                                </div>
                                <div class="zero-code-component-meta">
                                  <span class="zero-code-component-type">${pt.type}</span>
                                  <span class="zero-code-component-module">${pt.module_name}</span>
                                </div>
                                <div class="zero-code-header-actions">
                                  <button 
                                    class="zero-code-collapse-btn"
                                    onclick="window.toggleNestedCollapse('${Q(st)}')"
                                    title="折りたたみ切り替え"
                                    id="collapse-btn-${Q(st)}"
                                  >
                                    －
                                  </button>
                                  <button class="zero-code-edit-button" onclick="window.openNestedEditor('${Q(st)}')">編集</button>
                                  <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${Q(st)}')">削除</button>
                                </div>
                              </div>
                              <div class="zero-code-nested-component-content" 
                                   id="nested-content-${Q(st)}"
                                   ondragover="window.handleNestedPartDragOver && window.handleNestedPartDragOver(event)"
                                   ondrop="window.handleNestedPartDrop && window.handleNestedPartDrop(event)"
                                   data-slot-name="${he}" 
                                   data-part-index="${bt}" 
                                   data-parent-path="${r.id}.${b}[${C}].${he}">${At}</div>
                            </div>
                          `});const Se=`${r.id}.${b}[${C}].${he}`;ge+=`
                          <div class="zero-code-add-nested-part-button-container">
                            <button class="zero-code-add-position-part-button" onclick="event.stopPropagation(); window.openNestedPartSelector('${Q(Se)}', ${Ce.length})">
                              <span class="zero-code-plus-icon">＋</span>
                              <span class="zero-code-button-text">下にパーツを追加</span>
                            </button>
                          </div>
                        `,ge+="</div>";const Je=Pe.innerHTML,$e=document.createElement("div");$e.innerHTML=Je,$e.querySelectorAll('[class*="zero-code-"]').forEach(pt=>pt.remove());const Ot=$e.innerHTML.trim();Pe.innerHTML=Ot+ge}else{const ge=`${r.id}.${b}[${C}].${he}`,Se=Pe.innerHTML,Je=document.createElement("div");Je.innerHTML=Se,Je.querySelectorAll('[class*="zero-code-"]').forEach(Ot=>Ot.remove());const ot=Je.innerHTML.trim();Pe.innerHTML=ot+`
                          <div class="zero-code-z-for-empty-slot">
                            スロット "${he}" は空です
                            <div class="zero-code-add-nested-part-button-container">
                              <button class="zero-code-add-nested-part-button" onclick="event.stopPropagation(); window.openNestedPartSelector('${Q(ge)}', 0)">
                                <span class="zero-code-plus-icon">＋</span>
                                <span class="zero-code-button-text">パーツを追加</span>
                              </button>
                            </div>
                          </div>
                        `}Pe.removeAttribute("z-slot")}else if(he){const Ce=`${r.id}.${b}[${C}].${he}`,ge=Pe.innerHTML,Se=document.createElement("div");Se.innerHTML=ge,Se.querySelectorAll('[class*="zero-code-"]').forEach(ot=>ot.remove());const $e=Se.innerHTML.trim();Pe.innerHTML=$e+`
                        <div class="zero-code-z-for-empty-slot">
                          スロット "${he}" にデータがありません
                          <div class="zero-code-add-nested-part-button-container">
                            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(Ce)}', 0)">
                              <span class="zero-code-plus-icon">＋</span>
                              <span class="zero-code-button-text">パーツを追加</span>
                            </button>
                          </div>
                        </div>
                      `,Pe.removeAttribute("z-slot")}}),de.querySelectorAll("[z-for]").length>0&&Pr(de,ke,o+1,n,s),P=de.body.innerHTML.replace(/^<div>|<\/div>$/g,"")}let T=z;T.includes("($")&&Ge&&(T=Ge(T,$));let V="",L=T,U="";if(T){const de=T.match(/class="([^"]*)"/);de&&(V=de[1]);const me=T.match(/style="([^"]*)"/);me&&(U=me[1]),L=T.replace(/\s*class="[^"]*"\s*/,"").replace(/\s*style="[^"]*"\s*/,"").trim()}const M=`${V?V+" ":""}zero-code-z-for-item-wrapper`,O=U?`${U}; cursor: grab;`:"cursor: grab;";let Y=[`class="${M}"`,'draggable="true"',`data-component-id="${Q(r.id)}"`,`data-array-name="${Q(b)}"`,`data-item-index="${C}"`,`ondragstart="window.handleZForDragStart && window.handleZForDragStart(event, '${Q(r.id)}', '${Q(b)}', ${C})"`,'ondragend="window.handleZForDragEnd && window.handleZForDragEnd(event)"','ondragover="window.handleZForArrayItemDragOver && window.handleZForArrayItemDragOver(event)"','ondrop="window.handleZForArrayItemDrop && window.handleZForArrayItemDrop(event)"',`style="${O}"`,`onmousedown="this.style.cursor = 'grabbing'"`,`onmouseup="this.style.cursor = 'grab'"`].join(" ");L&&(Y+=` ${L}`);const re=`<div ${Y}>
${I}
${P}
</div>`;l+=re});const m=`<div class="zero-code-z-for-add-last-button">
<button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(b)}', ${A.length})" title="最後に追加">
<span class="zero-code-control-icon">＋</span>
</button>
</div>`;l+=m;const g=h.parentNode;if(g){const $=document.createElement("div");$.innerHTML=l;const C=document.createDocumentFragment();for(;$.firstChild;)C.appendChild($.firstChild);g.replaceChild(C,h)}else h.outerHTML=l}}}}else{const N=`<div class="zero-code-z-for-empty-array">
<div class="zero-code-z-for-empty-message">
<p class="zero-code-empty-text">${b}はまだ追加されていません</p>
<button class="zero-code-z-for-btn zero-code-z-for-add-first-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(b)}', 0)" title="最初の要素を追加">
<span class="zero-code-control-icon">＋</span>
<span class="zero-code-button-text">最初の${b}を追加</span>
</button>
</div>
</div>`;h.innerHTML=N,h.removeAttribute("z-for")}}}),t.querySelectorAll("[z-for-wrapper]").forEach(h=>{h.removeAttribute("z-for-wrapper")}))}function Ql(t,r,o){let n=t;const s=/<(\w+)([^>]*z-for="([^"]*)"[^>]*)\s*\/>/g;let f;for(;(f=s.exec(t))!==null;){const[b,A,N,w]=f,k=r[w];if(Array.isArray(k)&&k.length>0){let v="";k.forEach((B,D)=>{let i=N.replace(/\s*z-for="[^"]*"\s*/,"").trim();i.includes("($")&&Ge&&(i=Ge(i,B)),Object.keys(B).forEach(l=>{if(l!=="id"){const p=B[l];if(typeof p=="string"){const z=new RegExp(`\\{\\$${l}:[^}]*\\}`,"g");i=i.replace(z,p)}}});const a=`
          <div class="zero-code-z-for-item-wrapper" 
               data-component-id="${r.id}"
               data-array-name="${w}"
               data-item-index="${D}">
            ${Yl(r.id,w,D)}
            <${A}${i?" "+i:""} />
          </div>
        `;v+=a});const S=`
        <div class="zero-code-z-for-add-last-button">
          <button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${r.id}', '${w}', ${k.length})" title="最後に追加">
            <span class="zero-code-control-icon">＋</span>
          </button>
        </div>
      `;v+=S,n=n.replace(b,v)}else n=n.replace(b,kr(r.id,w))}const y=/<(\w+)([^>]*z-for="([^"]*)"[^>]*)>([\s\S]*?)<\/\1>/g;let h;for(;(h=y.exec(t))!==null;){const[b,A,N,w,k]=h,v=r[w];if(Array.isArray(v)&&v.length>0,Array.isArray(v)&&v.length>0){let S="";v.forEach((D,i)=>{let a=k;if(`${Q(r.id)}${Q(w)}${i}`,Mt&&(a=Mt(a,D,r,t,w)),Ge&&(a=Ge(a,D)),a.includes("z-if")||a.includes("z-slot")||a.includes("z-for")){const $=new DOMParser().parseFromString(`<div>${a}</div>`,"text/html"),C=`${r.id}_${w}_0`;let P=r;if(typeof window<"u"&&window.getLatestComponentData){const V=window.getLatestComponentData(r.id);V&&(P=V)}const I={...D,type:P.type,module_name:P.module_name,id:C};Do($,I),$.querySelectorAll("[z-slot]").forEach(V=>{const L=V.getAttribute("z-slot");if(L&&I[L]){const U=I[L];if(Array.isArray(U)&&U.length>0){let M='<div class="zero-code-z-for-nested-parts">';U.forEach((me,Ne)=>{const ke=`${r.id}.${w}[0].${L}`;M+=`
                    <div class="zero-code-add-nested-part-button-container">
                      <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${Q(ke)}', ${Ne})">
                        <span class="zero-code-plus-icon">＋</span>
                        <span class="zero-code-button-text">上にパーツを追加</span>
                      </button>
                    </div>
                  `;let Ke=me.content||me.title||me.name||"(内容なし)";const yt=`${r.id}.${w}[0].${L}[${Ne}]`;M+=`
                    <div class="zero-code-z-for-nested-part">
                      <div class="zero-code-z-for-part-header">
                        <small>${me.type||"unknown"} (ID: ${me.id}) [z-for内]</small>
                        <div class="zero-code-z-for-part-actions">
                          <button class="zero-code-edit-button" onclick="window.openNestedEditor('${Q(yt)}')">編集</button>
                          <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${Q(yt)}')">削除</button>
                        </div>
                      </div>
                      <div>${Ke}</div>
                    </div>
                  `});const O=`${r.id}.${w}[0].${L}`;M+=`
                  <div class="zero-code-add-nested-part-button-container">
                    <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(O)}', ${U.length})">
                      <span class="zero-code-plus-icon">＋</span>
                      <span class="zero-code-button-text">ネストパーツを追加</span>
                    </button>
                  </div>
                `,M+="</div>";const J=V.innerHTML,Y=document.createElement("div");Y.innerHTML=J,Y.querySelectorAll('[class*="zero-code-"]').forEach(me=>me.remove());const de=Y.innerHTML.trim();V.innerHTML=de+M}else{const M=V.innerHTML,O=document.createElement("div");O.innerHTML=M,O.querySelectorAll('[class*="zero-code-"]').forEach(re=>re.remove());const Y=O.innerHTML.trim();V.innerHTML=Y+`
                  <div class="zero-code-z-for-empty-slot">
                    スロット "${L}" は空です
                    <div class="zero-code-add-nested-part-button-container">
                      <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(r.id)}', 0)">
                        <span class="zero-code-plus-icon">＋</span>
                        <span class="zero-code-button-text">ネストパーツを追加</span>
                      </button>
                    </div>
                  </div>
                `}V.removeAttribute("z-slot")}else if(L){const U=V.innerHTML,M=document.createElement("div");M.innerHTML=U,M.querySelectorAll('[class*="zero-code-"]').forEach(Y=>Y.remove());const J=M.innerHTML.trim();V.innerHTML=J+`
                <div class="zero-code-z-for-empty-slot">
                  スロット "${L}" にデータがありません
                  <div class="zero-code-add-nested-part-button-container">
                    <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${Q(r.id)}', 0)">
                      <span class="zero-code-plus-icon">＋</span>
                      <span class="zero-code-button-text">ネストパーツを追加</span>
                    </button>
                  </div>
                </div>
              `,V.removeAttribute("z-slot")}}),a=$.body.innerHTML.replace(/^<div>|<\/div>$/g,"")}let l=N.replace(/\s*z-for="[^"]*"\s*/,"").trim();l.includes("($")&&Ge&&(l=Ge(l,D));let p="",z="",E=l;if(l){const $=l.match(/class="([^"]*)"/);$&&(p=$[1]);const C=l.match(/style="([^"]*)"/);C&&(z=C[1]),E=l.replace(/\s*class="[^"]*"\s*/,"").replace(/\s*style="[^"]*"\s*/,"").trim()}const _=`${p?p+" ":""}zero-code-z-for-item-wrapper`,c=z?`${z}; cursor: grab;`:"cursor: grab;",u=`
          <div class="zero-code-z-for-controls" data-component-id="${r.id}" data-array-name="${w}" data-index="${i}">
            <div class="zero-code-z-for-controls-inner">
              <button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${Q(r.id)}', '${Q(w)}', ${i})" title="上に追加">
                <span class="zero-code-control-icon">＋</span>
              </button>
              <span class="zero-code-z-for-drag-handle"
                    draggable="true"
                    onDragStart="window.handleZForDragStart(event, '${Q(r.id)}', '${Q(w)}', ${i})"
                    style="cursor: grab;"
                    title="ドラッグして並び替え">⠿</span>
              <button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${Q(r.id)}', '${Q(w)}', ${i})" title="編集">
                <span class="control-icon">✎</span>
              </button>
              <button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${Q(r.id)}', '${Q(w)}', ${i})" title="削除">
                <span class="control-icon">✕</span>
              </button>
            </div>
          </div>
        `;let m=`class="${_}" 
               draggable="true"
               data-component-id="${r.id}"
               data-array-name="${w}"
               data-item-index="${i}"
               ondragstart="window.handleZForDragStart && window.handleZForDragStart(event, '${r.id}', '${w}', ${i})"
               ondragend="window.handleZForDragEnd && window.handleZForDragEnd(event)"
               ondragover="window.handleZForArrayItemDragOver && window.handleZForArrayItemDragOver(event)"
               ondrop="window.handleZForArrayItemDrop && window.handleZForArrayItemDrop(event)"
               style="${c}"
               onmousedown="this.style.cursor = 'grabbing'"
               onmouseup="this.style.cursor = 'grab'"`;E&&(m+=` ${E}`);const g=`
          <div ${m}>
            ${u}
            ${a}
          </div>
        `;S+=g});const B=`
        <div class="zero-code-z-for-add-last-button">
          <button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${r.id}', '${w}', ${v.length})" title="最後に追加">
            <span class="zero-code-control-icon">＋</span>
          </button>
        </div>
      `;S+=B,n=n.replace(b,S)}else n=n.replace(b,kr(r.id,w))}return n}function ei(t,r,o,n,s){t.querySelectorAll("[z-slot]").forEach(y=>{const h=y.getAttribute("z-slot");if(h){const b=r[h],A=Array.isArray(b)?b:[];if(A.length===0){const N=y.innerHTML,w=document.createElement("div");w.innerHTML=N,w.querySelectorAll('[class*="zero-code-"]').forEach(S=>S.remove());const v=w.innerHTML.trim();y.innerHTML=v+`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${r.id}', 0)">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">ネストパーツを追加</span>
            </button>
          </div>
        `}else{let N="";A.forEach((B,D)=>{const i=B.id,a=r.id,l=o+1;N+=`
            <div class="zero-code-add-nested-part-button-container">
              <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${Q(a)}', ${D})">
                <span class="zero-code-plus-icon">＋</span>
                <span class="zero-code-button-text">上にパーツを追加（${l}階層目）</span>
              </button>
            </div>
          `,N+=`
            <div class="nested-component nested-depth-${l} draggable-nested" 
                 draggable="true" 
                 data-component-id="${B.id}" 
                 data-path="${i}" 
                 data-parent-path="${a}"
                 data-index="${D}"
                 class="zero-code-nested-component">
              <div class="zero-code-component-header zero-code-nested-header">
                <!-- ドラッグハンドル -->
                <div class="zero-code-drag-handle-nested">
                  ⠿
                </div>
                <div class="zero-code-component-meta">
                  <span class="zero-code-component-type">${B.type}</span>
                  <span class="zero-code-component-module">${B.module_name}</span>
                </div>
                <div class="zero-code-header-actions">
                  <button 
                    class="zero-code-collapse-btn"
                    onclick="window.toggleNestedCollapse('${i}')"
                    title="折りたたみ切り替え"
                    id="collapse-btn-${i}"
                  >
                    －
                  </button>
                  <button class="zero-code-edit-button" onclick="window.openNestedEditor('${i}')">編集</button>
                  <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${i}')">削除</button>
                </div>
              </div>
              <div class="zero-code-nested-component-content" id="nested-content-${i}">
                ${n(B,s,l)}
              </div>
            </div>
          `}),N+=`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${Q(r.id)}', ${A.length})">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">下にパーツを追加（${o+1}階層目）</span>
            </button>
          </div>
        `;const w=y.innerHTML,k=document.createElement("div");k.innerHTML=w,k.querySelectorAll('[class*="zero-code-"]').forEach(B=>B.remove());const S=k.innerHTML.trim();y.innerHTML=S+N}y.removeAttribute("z-slot"),d.success(`z-slot属性を除去: ${h}`)}})}const ti=[/v-[a-zA-Z-]+(?::[a-zA-Z-\.]+)?="[^"]*"/g,/@[a-zA-Z-]+(?:\.[a-zA-Z-]+)*="[^"]*"/g,/:[a-zA-Z-]+(?:\.[a-zA-Z-]+)*="[^"]*"/g,/v-slot:[a-zA-Z-]+="[^"]*"/g,/#[a-zA-Z-]+="[^"]*"/g],oi=[/\{\{[^}]+\}\}/g,/v-text="[^"]*"/g,/v-html="[^"]*"/g];function ri(t){return et(()=>{const r=new Map,o=new Map;let n=t;return d.debug("Vue.jsディレクティブ保護開始",{htmlLength:t.length}),ti.forEach((s,f)=>{n=n.replace(s,y=>{const h=`__VUE_DIR_${f}_${r.size}__`;return r.set(h,y),d.debug(`ディレクティブ保護: ${y} → ${h}`),h})}),oi.forEach((s,f)=>{n=n.replace(s,y=>{const h=`__VUE_INT_${f}_${o.size}__`;return o.set(h,y),d.debug(`補間記法保護: ${y} → ${h}`),h})}),d.success("Vue.jsディレクティブ保護完了",{directiveCount:r.size,interpolationCount:o.size,resultLength:n.length}),{html:n,directives:r,interpolations:o}},tt,"Vue.jsディレクティブ保護中にエラーが発生しました",ue.TEMPLATE)||{html:t,directives:new Map,interpolations:new Map}}function Dr(t,r){return et(()=>{let o=t;return d.debug("Vue.jsディレクティブ復元開始",{directiveCount:r.directives.size,interpolationCount:r.interpolations.size}),r.directives.forEach((n,s)=>{o=o.replace(new RegExp(s,"g"),n),d.debug(`ディレクティブ復元: ${s} → ${n}`)}),r.interpolations.forEach((n,s)=>{o=o.replace(new RegExp(s,"g"),n),d.debug(`補間記法復元: ${s} → ${n}`)}),d.success("Vue.jsディレクティブ復元完了",{resultLength:o.length}),o},tt,"Vue.jsディレクティブ復元中にエラーが発生しました",ue.TEMPLATE)||t}function ni(t){return et(()=>{const r=ri(t),n=new DOMParser().parseFromString(r.html,"text/html");return d.debug("安全DOMパース完了",{originalLength:t.length,protectedLength:r.html.length,parsedElementCount:n.body.children.length}),{doc:n,preservation:r}},tt,"安全DOMパース中にエラーが発生しました",ue.TEMPLATE)||{doc:new DOMParser().parseFromString("<div></div>","text/html"),preservation:{html:t,directives:new Map,interpolations:new Map}}}function Lt(t){return t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," "):""}function so(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}function ai(t){if(!t)return t;let r=t.replace(/(<br\s*\/?>)+$/gi,"");return r=r.replace(/\s+$/,""),r}function si(t,r,o){return et(()=>{d.debug("統合テンプレート処理開始",{componentId:r.id,htmlLength:t.length});let n=t;return n=n.replace(/(\(\$[^:)]+\?:[^)]*\)|\(\$[^:)]+:[^)]*\)|\{\$[^:}]+:[^}]*\})/g,s=>s.includes("?:")?li(s,r):s.startsWith("(")&&s.includes(":")?ii(s,r):s.startsWith("{")&&s.includes(":")?di(s,r,o):s),d.success("統合テンプレート処理完了",{componentId:r.id,resultLength:n.length}),n},tt,`統合テンプレート処理中にエラーが発生しました (componentId: ${r.id})`,ue.TEMPLATE)||t}function li(t,r){const o=t.match(/\(\$([^:?]+)\?:([^)]*)\)/);if(!o)return t;const[,n,s]=o,f=s.split("|"),y=r[n];return Array.isArray(y)?y.join(" "):y&&f.includes(String(y))?String(y):f[0]||""}function ii(t,r){const o=t.match(/\(\$([^:]+):([^)]*)\)/);if(!o)return t;const[,n,s]=o,f=s.split("|"),y=r[n];return y&&f.includes(String(y))?String(y):f[0]||""}function di(t,r,o){const n=t.match(/\{\$([^:]+):([^}]*)\}/);if(!n)return t;const[,s,f]=n,y=r[s],h=Lt(y?String(y):f);return ci(o,s)?`<div class="tiptap-content" data-component-id="${r.id}" data-param-name="${s}">${h}</div>`:h}function ci(t,r){const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`\\{\\$${o}:[^}]*\\}`,"g");let s;for(;(s=n.exec(t))!==null;){const f=s.index,y=t.substring(0,f),h=y.lastIndexOf("<"),b=y.lastIndexOf(">");if(h>b)continue;const A=[];if([/<(pre|code)[^>]*>[\s\S]*?<\/(pre|code)>/gi,/<div[^>]*class="[^"]*code-block[^"]*"[^>]*>[\s\S]*?<\/div>/gi].forEach(S=>{S.lastIndex=0;let B;for(;(B=S.exec(t))!==null;)A.push({start:B.index,end:B.index+B[0].length})}),!A.some(S=>f>=S.start&&f<=S.end))return!0}return!1}const lo=new Map;function pi(t,r,o){const n=`${t}:${r}`;if(lo.has(n))return lo.get(n);const s=o(t,r);return lo.set(n,s),s}function mi(){lo.clear(),d.debug("テンプレートキャッシュをクリアしました")}const Ir=new DOMParser,ht=new Map,ui=50;function gi(t){return et(()=>{if(ht.has(t)){const o=ht.get(t);if(o)return d.debug("DOMParser: キャッシュからヒット"),o.cloneNode(!0)}const r=Ir.parseFromString(t,"text/html");if(ht.size>=ui){const o=ht.keys().next().value;o&&ht.delete(o)}return ht.set(t,r.cloneNode(!0)),d.debug("DOMParser: 新規パース＆キャッシュ保存"),r},tt,"HTML解析中にエラーが発生しました",ue.TEMPLATE)||Ir.parseFromString("<div></div>","text/html")}function fi(t,r,o,n=1){return et(()=>{d.debug("最適化z-directive処理開始",{componentId:r.id,currentDepth:n});let s=t;return s=hi(s,r),s=yi(s,r,o),s=bi(s,r,n,o),d.success("最適化z-directive処理完了",{componentId:r.id,resultLength:s.length}),s},tt,`z-directive処理中にエラーが発生しました (componentId: ${r.id})`,ue.TEMPLATE)||t}function hi(t,r){return t.replace(/<([^>]*z-if="([^"]*)"[^>]*)>([\\s\\S]*?)<\/[^>]*>/g,(o,n,s,f)=>{if(!r[s])return d.debug(`z-if要素を非表示: ${s}`),"";const h=n.replace(/\s*z-if="[^"]*"\s*/," ").trim();return d.debug(`z-if要素を表示: ${s}`),`<div ${h}>${f}</div>`})}function yi(t,r,o){return t.replace(/<(\w+)([^>]*z-for="([^"]*)"[^>]*)>([\s\S]*?)<\/\1>/g,(n,s,f,y,h)=>{const b=r[y];return d.debug(`z-for処理: ${y}`,{length:Array.isArray(b)?b.length:"not array"}),!Array.isArray(b)||b.length===0?`
          <div class="add-array-item-button-container">
            <button class="add-array-item-button" onclick="window.addArrayItem('${r.id}', '${y}')">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">${y}を追加</span>
            </button>
          </div>
        `:b.map(N=>{let w=h;return Object.keys(N).forEach(k=>{if(k!=="id"){const v=N[k];if(typeof v=="string")[new RegExp(`\\{\\$${k}:([^}]+)\\}`,"g"),new RegExp(`\\(\\$${k}:([^)]+)\\)`,"g")].forEach(B=>{w=w.replace(B,v)});else if(Array.isArray(v)){const S=new RegExp(`\\(\\$${k}\\?:([^)]+)\\)`,"g");w=w.replace(S,v.join(" "))}}}),w}).join("")})}function bi(t,r,o,n){const s=gi(t),f=s.querySelectorAll("[z-slot]");return d.debug(`z-slot要素発見: ${f.length}個`),f.forEach(y=>{const h=y.getAttribute("z-slot");if(h){const b=r[h],A=Array.isArray(b)?b:[];if(A.length===0){const N=y.innerHTML;y.innerHTML=N+`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${so(r.id)}', 0)">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">ネストパーツを追加</span>
            </button>
          </div>
        `}else{const N=A.map((k,v)=>{const S=o+1,B=Math.max(0,S-1)*20;return`
            <div class="nested-component nested-depth-${S}" style="margin-left: ${B}px;">
              <div class="component-header">
                <span class="component-type">${k.type}</span>
                <span class="component-module">${k.module_name}</span>
                <button onclick="window.openNestedEditor('${k.id}')">編集</button>
                <button onclick="window.deleteNestedPart('${k.id}')">削除</button>
              </div>
            </div>
          `}).join(""),w=y.innerHTML;y.innerHTML=w+N}y.removeAttribute("z-slot")}}),s.body.innerHTML}function $i(){ht.clear(),d.debug("DOMキャッシュをクリアしました")}function Io(){const t=e.ref(null);let r=!1;const o=(E,_)=>{const c=`\\{\\$${_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}:[^}]*\\}`,u=new RegExp(c,"g");let m;for(;(m=u.exec(E))!==null;){const g=m.index,$=E.substring(0,g),C=$.lastIndexOf("<"),P=$.lastIndexOf(">");if(C>P)continue;const I=[];if([/<(pre|code)[^>]*>[\s\S]*?<\/(pre|code)>/gi,/<div[^>]*class="[^"]*code-block[^"]*"[^>]*>[\s\S]*?<\/div>/gi].forEach(M=>{M.lastIndex=0;let O;for(;(O=M.exec(E))!==null;)I.push({start:O.index,end:O.index+O[0].length})}),!I.some(M=>g>=M.start&&g<=M.end))return!0}return!1},n=(E,_,c)=>E.replace(/\{\$([^:]+):(.*?)\}/g,(u,m,g)=>{const $=String(_[m]||g),C=Lt($);return o(c,m)?m==="content"?`<div class="zero-code-rich-editable-text block-editable" data-component-id="${_.id}" data-param="${m}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${_.id}', '${m}', this.innerHTML, this);">${C}</div>`:`<span class="zero-code-rich-editable-text inline-editable" data-component-id="${_.id}" data-param="${m}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${_.id}', '${m}', this.innerHTML, this);">${C}</span>`:C}),s=(E,_,c,u,m)=>E.replace(/\{\$([^:]+):(.*?)\}/g,(g,$,C)=>{const P=String(_[$]||C),I=Lt(P);if(o(u,$)){const L=c[m].indexOf(_),U=`${c.id}_${m}_${L}_${$}`;return $==="content"?`<div class="zero-code-rich-editable-text array-item-text block-editable" data-component-id="${U}" data-param="${$}" data-array-name="${m}" data-item-index="${L}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${U}', '${$}', this.innerHTML, this);">${I}</div>`:`<span class="zero-code-rich-editable-text array-item-text inline-editable" data-component-id="${U}" data-param="${$}" data-array-name="${m}" data-item-index="${L}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${U}', '${$}', this.innerHTML, this);">${I}</span>`}return I}),f=(E,_)=>{let c=E.replace(/\(\$([^:?]+)\?:(.*?)\)/g,(u,m,g)=>{const $=_[m];return Array.isArray($)?$.join(" "):g.split("|").filter(P=>P.trim())[0]||""});return c=c.replace(/\(\$([^:?]+):(.*?)\)/g,(u,m,g)=>{if(_[m]){let P=_[m];return P==="指定無し"&&(P=""),Array.isArray(P)?P.join(" "):String(P)}const $=m;if(_[$]){let P=_[$];return P==="指定無し"&&(P=""),Array.isArray(P)?P.join(" "):String(P)}return g.split("|").filter(P=>P.trim())[0]||""}),c},y=(E,_)=>E.replace(/\(\$([^:?]+):(.*?)\)/g,(c,u,m)=>{let g=_[u];return g==="指定無し"&&(g=""),Array.isArray(g)?g.join(" "):g?String(g):m.split("|").filter(C=>C.trim())[0]||""}),h=(E,_)=>E.replace(/\(\$([^:?]+)\?:(.*?)\)/g,(c,u,m)=>{const g=_[u];return Array.isArray(g)?g.join(" "):String(g||"")}),b=(E,_,c,u)=>{const m=c(E.type,E.module_name);if(!m)return`<div>テンプレートが見つかりません: ${E.type}/${E.module_name}</div>`;let g=m;return g=y(g,E),g=h(g,E),g=n(g,E,m),g=k(g,E,c,_,1),g},A=(E,_,c=0)=>{const u=_(E.type,E.module_name);if(!u)return`<div>テンプレートが見つかりません: ${E.type}/${E.module_name}</div>`;let m=u;return m=y(m,E),m=h(m,E),m=n(m,E,u),m=k(m,E,_,c,1),m},N=(E,_,c,u)=>{const m=_(E.type,E.module_name);if(!m)return`<div>テンプレートが見つかりません: ${E.type}/${E.module_name}</div>`;let g=m;return g=y(g,E),g=h(g,E),g=n(g,E,m),g=k(g,E,_,0,c),g},w=(E,_=[],c,u)=>{if(!E||E.length===0)return`
        <div class="zero-code-add-nested-part-button-container">
          <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${so(c(_))}', 0)">
            <span class="zero-code-plus-icon">＋</span>
            <span class="zero-code-button-text">ネストパーツを追加（${_.length+1}階層目）</span>
          </button>
        </div>
      `;let m="";return E.forEach((g,$)=>{const C=[..._,$],P=c(C),I=C.length;m+=`
        <div class="zero-code-add-nested-part-button-container">
          <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${so(c(_))}', ${$})">
            <span class="zero-code-plus-icon">＋</span>
            <span class="zero-code-button-text">上にパーツを追加（${_.length+1}階層目）</span>
          </button>
        </div>
      `,m+=`
        <div class="zero-code-nested-component zero-code-nested-depth-${I} zero-code-draggable-nested" 
             draggable="true" 
             data-component-id="${g.id}" 
             data-path="${P}" 
             data-parent-path="${c(_)}"
             data-index="${$}"
>
          <div class="zero-code-component-header zero-code-nested-header">
            <!-- ドラッグハンドル -->
            <div class="zero-code-drag-handle-nested">
              ⠿
            </div>
            <div class="zero-code-component-meta">
              <span class="zero-code-component-type">${g.type}</span>
              <span class="zero-code-component-module">${g.module_name}</span>
            </div>
            <div class="zero-code-header-actions">
              <button 
                class="zero-code-collapse-btn"
                onclick="window.toggleNestedCollapse('${P}')"
                title="折りたたみ切り替え"
                id="collapse-btn-${P}"
              >
                －
              </button>
              <button class="zero-code-edit-button" onclick="window.openNestedEditor('${P}')">編集</button>
              <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${P}')">削除</button>
            </div>
          </div>
          <div class="zero-code-nested-component-content" id="nested-content-${P}">
            ${u?A(g,u):`<div>テンプレートが見つかりません: ${g.type}/${g.module_name}</div>`}
          </div>
          <script>
            // 折りたたみ状態の初期化
            if (typeof window !== 'undefined' && window.isNestedCollapsed) {
              setTimeout(() => {
                const isCollapsed = window.isNestedCollapsed('${P}')
                const contentElement = document.getElementById('nested-content-${P}')
                const buttonElement = document.getElementById('collapse-btn-${P}')
                
                if (contentElement && buttonElement) {
                  if (isCollapsed) {
                    contentElement.style.display = 'none'
                    buttonElement.textContent = '＋'
                    buttonElement.setAttribute('title', '展開')
                  } else {
                    contentElement.style.display = 'block'
                    buttonElement.textContent = '－'
                    buttonElement.setAttribute('title', '折りたたみ')
                  }
                }
              }, 0)
            }
          <\/script>
        </div>
      `,g.nested_parts&&Array.isArray(g.nested_parts)&&g.nested_parts.length>0&&(m+=w(g.nested_parts,C,c,u))}),m+=`
      <div class="zero-code-add-nested-part-button-container">
        <button class="zero-code-add-position-part-button" onclick="window.openNestedPartSelector('${so(c(_))}', ${E.length})">
          <span class="zero-code-plus-icon">＋</span>
          <span class="zero-code-button-text">下にパーツを追加（${_.length+1}階層目）</span>
        </button>
      </div>
    `,m},k=(E,_,c,u=0,m=1)=>et(()=>{r||(Jl(s,f),r=!0);const{doc:g,preservation:$}=ni(E),C=(U,M,O)=>N(U,M,O);Do(g,_),Xl(g,_),Pr(g,_,m,C,c);const P=$.html.match(/z-for="[^"]*"/g),I=g.querySelectorAll("[z-for]");if(!(P&&P.length>0&&I.length===0)){if(I.length>0){const U=Ql($.html,_);if(U!==$.html)return Dr(U,$)}}ei(g,_,m,C,c),g.querySelectorAll("img").forEach(U=>{U.classList.add("zero-code-editable-image")});const V=g.body.innerHTML;return Dr(V,$)},tt,`Z-Directive処理中にエラーが発生しました (componentId: ${_.id})`,ue.TEMPLATE)||E,v=(E,_)=>{const c=_(E.type,E.module_name);return c?c.includes("@slot($nested_parts)@"):!1},S=(E,_,c={})=>et(()=>{if(c&&c.isPreviewMode===!0){const g={maxRecursionDepth:c.maxRecursionDepth};return B(E,_,g)}const u=pi(E.type,E.module_name,_);if(!u)return`<div>テンプレートが見つかりません: ${E.type}/${E.module_name}</div>`;let m=si(u,E,u);return m=fi(m,E,_,1),m},tt,`最適化レンダリング中にエラーが発生しました (componentId: ${E.id})`,ue.TEMPLATE)||`<div>レンダリングエラー: ${E.id}</div>`,B=(E,_,c={})=>{let u=E;if(typeof window<"u"&&window.getLatestComponentData){const C=window.getLatestComponentData(E.id);C&&(u=C)}const m=_(E.type,E.module_name);if(!m)return"";let g=m,$=c.maxRecursionDepth;return $||($=l(m)),g=p(g,u,_,0,$),g=y(g,u),g=h(g,u),g=a(g,u),g=i(g),g},D=(E,_,c)=>{const m=new globalThis.DOMParser().parseFromString(E,"text/html");return m.querySelectorAll("[z-if]").forEach(I=>{const T=I.getAttribute("z-if");T&&(_[T]?I.removeAttribute("z-if"):I.remove())}),m.querySelectorAll("[z-for-wrapper]").forEach(I=>{const T=I.getAttribute("z-for-wrapper");if(T){const V=_[T];!Array.isArray(V)||V.length===0?I.remove():I.removeAttribute("z-for-wrapper")}}),m.querySelectorAll("[z-slot]").forEach(I=>{const T=I.getAttribute("z-slot");if(T)if(_[T]&&Array.isArray(_[T])){const L=_[T].map(U=>B(U,c)).join("");I.outerHTML=L}else I.remove()}),m.querySelectorAll("img").forEach(I=>{I.classList.add("zero-code-editable-image")}),m.body.innerHTML},i=E=>{const c=new DOMParser().parseFromString(E,"text/html"),u=["zero-code-z-for-item-wrapper","zero-code-field-wrapper","zero-code-array-item","zero-code-nested-array","field-editor","tiptap-content","zero-code-z-for-controls","zero-code-z-for-controls-inner","zero-code-z-for-btn","zero-code-z-for-add-btn","zero-code-z-for-edit-btn","zero-code-z-for-delete-btn","zero-code-z-for-drag-handle","zero-code-nested-part","zero-code-add-nested-part-button-container","zero-code-add-nested-part-button"],m=c.querySelectorAll("*");return m.forEach($=>{const C=$.classList;u.forEach(P=>{C.contains(P)&&C.remove(P)}),Array.from(C).forEach(P=>{P.includes("zero-code")&&C.remove(P)}),$.className===""&&$.removeAttribute("class")}),c.querySelectorAll('.zero-code-z-for-controls, .zero-code-add-nested-part-button-container, .zero-code-z-for-add-last-button, [onclick*="ZForArrayItem"], [onclick*="NestedPartSelector"], [onclick*="NestedEditor"], [onclick*="addZForArrayItem"], [onclick*="editZForArrayItem"], [onclick*="removeZForArrayItem"]').forEach($=>{$.remove()}),m.forEach($=>{Array.from($.attributes).forEach(C=>{(C.name.startsWith("data-component-id")||C.name.startsWith("data-field-")||C.name.startsWith("data-param-")||C.name.includes("contenteditable"))&&$.removeAttribute(C.name)})}),c.body.innerHTML},a=(E,_)=>E.replace(/\{\$([^:]+):(.*?)\}/g,(c,u,m)=>{const g=String(_[u]||m);return Lt(g)}),l=E=>{const c=new globalThis.DOMParser().parseFromString(`<root>${E}</root>`,"text/html"),u=($,C=0)=>{let P=C;for(const I of Array.from($.children)){let T=C;I.hasAttribute("z-for")&&(T+=1);const V=u(I,T);P=Math.max(P,V)}return P},m=c.body.querySelector("root");if(!m)return 3;const g=u(m);return Math.max(g+2,3)},p=(E,_,c,u=0,m)=>{const $=new globalThis.DOMParser().parseFromString(E,"text/html");if($.querySelectorAll("[z-if]").forEach(M=>{const O=M.getAttribute("z-if");O&&(_[O]?M.removeAttribute("z-if"):M.remove())}),$.querySelectorAll("[z-for-wrapper]").forEach(M=>{const O=M.getAttribute("z-for-wrapper");if(O){const J=_[O];!Array.isArray(J)||J.length===0?M.remove():M.removeAttribute("z-for-wrapper")}}),u===0&&!m){const M=c(_.type,_.module_name);m=l(M)}const I=m??5;if(u>=I)return D(E,_,c);let T=!0,V=0;for(;T&&V<3;)T=!1,V++,Array.from($.querySelectorAll("[z-for]")).forEach(O=>{const J=O.getAttribute("z-for");if(!O.hasAttribute("data-zfor-processed")&&J){let Y=_;if(typeof window<"u"&&window.getLatestComponentData){const de=_.id.split("_")[0]+"_"+_.id.split("_")[1]+"_"+_.id.split("_")[2]+"_"+_.id.split("_")[3],me=window.getLatestComponentData(de);me&&(Y=me)}let re=_[J];if(!re&&Y[J]&&(re=Y[J]),!re&&J==="items"&&typeof window<"u"&&window.getLatestComponentData){const de=_.id.includes("_categories_")?_.id.split("_categories_")[0]:_.id.split("_")[0]+"_"+_.id.split("_")[1]+"_"+_.id.split("_")[2]+"_"+_.id.split("_")[3],me=window.getLatestComponentData(de);if(me&&me.categories){const Ne=_.id.match(/_categories_(\d+)/);if(Ne){const ke=parseInt(Ne[1]);me.categories[ke]&&me.categories[ke].items&&(re=me.categories[ke].items)}}}if(Array.isArray(re)&&re.length>0){O.setAttribute("data-zfor-processed","true");const de=c(_.type,_.module_name),me=new RegExp(`<(\\w+)[^>]*z-for="${J}"[^>]*>`),Ne=de.match(me),ke=Ne?de.indexOf(Ne[0]):-1;let Ke=O.innerHTML;if(ke!==-1&&Ne){const he=Ne[0].match(/<(\w+)/),Ce=he?he[1]:"div";let ge=0,Se=ke;for(let $e=ke;$e<de.length;$e++)if(de.substring($e,$e+Ce.length+1)===`<${Ce}`)ge++;else if(de.substring($e,$e+Ce.length+3)===`</${Ce}>`&&(ge--,ge===0)){Se=$e+Ce.length+3;break}Ke=de.substring(ke,Se).replace(/\s+z-for="[^"]*"/,"")}const yt=re.map((he,Ce)=>{let ge=Ke;const Se={..._,...he,type:_.type,module_name:_.module_name,id:`${_.id}_${J}_${Ce}`};if(typeof window<"u"&&window.getLatestComponentData){const Je=_.id.includes("_categories_")?_.id.split("_categories_")[0]:_.id.includes("_items_")?_.id.split("_items_")[0]:_.id.split("_")[0]+"_"+_.id.split("_")[1]+"_"+_.id.split("_")[2]+"_"+_.id.split("_")[3],$e=window.getLatestComponentData(Je);$e&&J==="categories"&&$e.categories&&$e.categories[Ce]&&Object.assign(Se,$e.categories[Ce])}return ge=p(ge,Se,c,u+1,I),ge=y(ge,he),ge=h(ge,he),ge=a(ge,Se),ge}).join("");O.outerHTML=yt,T=!0;const Pe=new DOMParser().parseFromString($.body.innerHTML,"text/html");$.body.innerHTML=Pe.body.innerHTML}else O.remove()}});return $.querySelectorAll("[z-slot]").forEach(M=>{const O=M.getAttribute("z-slot");if(O)if(_[O]&&Array.isArray(_[O])){const Y=_[O].map(re=>B(re,c)).join("");M.outerHTML=Y}else M.remove()}),$.querySelectorAll("img").forEach(M=>{M.classList.add("zero-code-editable-image")}),$.body.innerHTML};return{editingText:t,shouldApplyTiptap:o,processTextReplacementWithTemplate:n,processArrayItemTextReplacement:s,processArrayItemParameterReplacement:f,processSelectionSyntax:y,processConditionalClassSyntax:h,processZDirectives:k,renderComponentWithNested:b,renderComponentWithoutSlot:A,renderNestedComponentWithDepth:N,renderNestedComponentsWithUI:w,hasNestedSlot:v,renderComponentOptimized:S,clearAllCaches:()=>{mi(),$i()}}}function xt(){return{getImageSrc:s=>s.fileData?.base64&&s.fileData.base64.trim()!==""?`data:${s.fileData.type||s.type||"image/jpeg"};base64,${s.fileData.base64}`:s.url||"",isImageUpdated:s=>!!(s.fileData?.base64&&s.fileData.base64.trim()!==""),getImageAlt:s=>s.alt||s.name||"画像",updateImageData:(s,f,y)=>({...s,fileData:{...s.fileData,base64:y,type:f.type,size:f.size},type:f.type,size:f.size,uploadedAt:new Date().toISOString()})}}const _i={class:"zero-code-page-preview"},Ei={class:"zero-code-page-preview-content"},zi=["innerHTML"],wi=e.defineComponent({__name:"PagePreview",props:{pageData:{type:Array},parts:{type:Array},commonImages:{type:Array},individualImages:{type:Array}},setup(t){const r=t,o=Io(),{getImageSrc:n}=xt(),s=e.computed(()=>[...r.commonImages,...r.individualImages]),f=A=>{if(!A||s.value.length===0)return A;let N=A;return N=N.replace(/<img([^>]*?)src=["']([^"']+)["']([^>]*?)>/gi,(w,k,v,S)=>{const B=s.value.find(D=>!!(D.id===v||D.url===v||D.name===v||v.endsWith("/"+D.name)||D.url.endsWith(v)||v.split("/").pop()===D.name));if(B){const D=n(B);return`<img${k}src="${D}"${S}>`}return w}),N},y=(A,N)=>{if(!Array.isArray(r.parts))return"";const w=r.parts.find(v=>v.type===A);if(!w)return"";const k=w.module.find(v=>v.title===N);return k?k.body:""},h=e.computed(()=>{if(!Array.isArray(r.pageData)||r.pageData.length===0)return'<div class="zero-code-no-content">ページにコンテンツがありません</div>';let A='<div class="zero-code-page-container">';return r.pageData.forEach(N=>{const w=b(N);!w||w.trim()===""?A+=`<div class="zero-code-error-component">テンプレートが見つかりません: ${N.type}/${N.module_name}</div>`:A+=w}),A+="</div>",A}),b=A=>{const N=o.renderComponentOptimized(A,y,{isPreviewMode:!0});return f(N)};return(A,N)=>(e.openBlock(),e.createElementBlock("div",_i,[e.createElementVNode("div",Ei,[e.createElementVNode("div",{innerHTML:h.value},null,8,zi)])]))}}),vi={class:"zero-code-tab-content"},Ci={class:"zero-code-data-tabs"},Ai={class:"zero-code-tab-buttons"},Ni=["onClick"],ki={class:"zero-code-preview-content"},Pi={key:0,class:"zero-code-preview-section"},Di={key:1,class:"zero-code-preview-section"},Ii={class:"zero-code-html-source"},Si={class:"zero-code-html-source-pre"},Ti=e.defineComponent({__name:"PreviewPanel",props:{editablePageData:{type:Array},localParts:{type:Array},parts:{type:Array},commonImages:{type:Array},individualImages:{type:Array}},setup(t){const r=t,o=Io(),n=e.ref("preview"),s=e.ref(0),f=["preview","source"],y=w=>({preview:"プレビュー表示",source:"HTMLソース"})[w],h=(w,k)=>{const v=r.localParts&&r.localParts.length>0?r.localParts:r.parts||[];if(!Array.isArray(v))return"";const S=v.find(D=>D.type===w);if(!S)return"";const B=S.module.find(D=>D.title===k);return B?B.body:""},b=w=>o.renderComponentOptimized(w,h,{isPreviewMode:!0}),A=e.computed(()=>{if(!Array.isArray(r.editablePageData)||r.editablePageData.length===0)return'<div class="zero-code-no-content">ページにコンテンツがありません</div>';let w='<div class="zero-code-page-container">';return r.editablePageData.forEach(k=>{const v=b(k);!v||v.trim()===""?w+=`<div class="zero-code-error-component">テンプレートが見つかりません: ${k.type}/${k.module_name}</div>`:w+=v}),w+="</div>",w}),N=w=>{if(!w)return"";try{const S=new globalThis.DOMParser().parseFromString(`<root>${w}</root>`,"text/html").body.firstChild;if(!S)return w;const B=new Set(["img","br","hr","input","meta","link","area","base","col","embed","source","track","wbr"]),D=new Set(["span","a","strong","em","u","mark","code","small","sub","sup","i","b"]),i=(l,p=0,z=!1)=>{const E=l.tagName.toLowerCase(),_=z?"":"  ".repeat(p),c=B.has(E),u=D.has(E);let m=`<${E}`;for(let T=0;T<l.attributes.length;T++){const V=l.attributes[T];m+=` ${V.name}="${V.value}"`}m+=">";let g=_+m;if(c)return g;let $=!1,C=!1;const P=[];let I="";for(let T=0;T<l.childNodes.length;T++){const V=l.childNodes[T];if(V.nodeType===1){$=!0;const U=i(V,p+1,u||z);P.push(U)}else if(V.nodeType===3){const L=V.textContent?.replace(/\s+/g," ").trim();L&&(C=!0,I+=L)}}return $&&C?u||z?g+=I+P.join(""):(g+=I+`
`+P.join(`
`),P.length>0&&(g+=`
`+_)):$?u||z?g+=P.join(""):(g+=`
`+P.join(`
`),P.length>0&&(g+=`
`+_)):C&&(g+=I),g+=`</${E}>`,g};let a="";for(let l=0;l<S.childNodes.length;l++){const p=S.childNodes[l];p.nodeType===1&&(a+=i(p)+`
`)}return a.replace(/\n{3,}/g,`

`).replace(/\n\s*\n\s*</g,`
<`).trim()}catch{return w.replace(/>\s*</g,`>
<`).split(`
`).filter(v=>v.trim()).map((v,S,B)=>{const D=v.trim();if(!D)return"";let i=0;for(let a=0;a<S;a++){const l=B[a].trim();l.match(/<[^\/!][^>]*[^\/]>$/)&&i++,l.match(/<\/[^>]+>$/)&&i--}return D.startsWith("</")&&i--,"  ".repeat(Math.max(0,i))+D}).join(`
`)}};return e.watch(()=>r.editablePageData,()=>{s.value++},{deep:!0,immediate:!0}),(w,k)=>(e.openBlock(),e.createElementBlock("div",vi,[e.createElementVNode("div",Ci,[e.createElementVNode("div",Ai,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(f,v=>e.createElementVNode("button",{key:v,class:e.normalizeClass(["zero-code-data-tab-button",{active:n.value===v}]),onClick:S=>n.value=v},e.toDisplayString(y(v)),11,Ni)),64))])]),e.createElementVNode("div",ki,[n.value==="preview"?(e.openBlock(),e.createElementBlock("div",Pi,[(e.openBlock(),e.createBlock(wi,{key:s.value,"page-data":w.editablePageData,parts:w.localParts&&w.localParts.length>0?w.localParts:w.parts||[],"common-images":w.commonImages,"individual-images":w.individualImages},null,8,["page-data","parts","common-images","individual-images"]))])):e.createCommentVNode("",!0),n.value==="source"?(e.openBlock(),e.createElementBlock("div",Di,[e.createElementVNode("div",Ii,[k[0]||(k[0]=e.createElementVNode("div",{class:"zero-code-source-header"},[e.createElementVNode("p",{class:"zero-code-source-description"},"パーツごとに改行・インデントされたHTMLソース")],-1)),e.createElementVNode("pre",Si,[e.createElementVNode("code",null,e.toDisplayString(N(A.value)),1)])])])):e.createCommentVNode("",!0)])]))}}),Vi={class:"zero-code-modal-header"},Bi={class:"zero-code-modal-body"},Fi={class:"zero-code-img-file-input-section"},Mi={key:0,class:"zero-code-img-file-info"},Li={class:"zero-code-img-file-preview"},xi=["src"],Oi={class:"zero-code-img-file-details"},Ri={class:"zero-code-form-section"},Hi={class:"zero-code-form-group"},Zi=["disabled"],ji={class:"zero-code-form-group"},Ui=["disabled"],Wi={key:0,class:"zero-code-form-group"},qi=["disabled"],Gi={class:"zero-code-modal-footer"},Ki=["disabled"],Ji=e.defineComponent({__name:"ImageUploadModal",props:{category:{type:String},componentId:{type:String}},emits:["close","upload"],setup(t,{emit:r}){const o=t,n=r,s=e.ref(null),f=e.ref(""),y=e.ref(""),h=e.ref(""),b=e.ref(o.componentId||""),A=e.computed(()=>s.value&&y.value.trim()&&h.value.trim()),N=a=>{const l=a.target;l.files&&l.files[0]&&k(l.files[0])},w=a=>{a.preventDefault(),a.dataTransfer&&a.dataTransfer.files[0]&&k(a.dataTransfer.files[0])},k=a=>{s.value=a,y.value=a.name.replace(/\.[^/.]+$/,""),h.value=a.name,f.value&&URL.revokeObjectURL(f.value),f.value=URL.createObjectURL(a)},v=a=>new Promise((l,p)=>{const z=new FileReader;z.readAsDataURL(a),z.onload=()=>l(z.result),z.onerror=E=>p(E)}),S=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),B=a=>{if(a===0)return"0 Bytes";const l=1024,p=["Bytes","KB","MB","GB"],z=Math.floor(Math.log(a)/Math.log(l));return parseFloat((a/Math.pow(l,z)).toFixed(2))+" "+p[z]},D=async()=>{if(!(!s.value||!A.value))try{const a=await v(s.value),l=a.split(",")[1]||a,p={id:S(),name:y.value,originalName:s.value.name,url:`/img/${y.value}`,alt:h.value,size:s.value.size,type:s.value.type,uploadedAt:new Date().toISOString(),category:o.category,componentId:o.category==="individual"?b.value:void 0,fileData:{base64:l}};n("upload",p)}catch{alert("画像のアップロードに失敗しました。")}},i=()=>{f.value&&URL.revokeObjectURL(f.value)};return e.onUnmounted(i),(a,l)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:l[8]||(l[8]=p=>a.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:l[7]||(l[7]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Vi,[e.createElementVNode("h4",null,"画像アップロード（"+e.toDisplayString(a.category==="common"?"共通":"個別")+"）",1),e.createElementVNode("button",{class:"zero-code-img-close-btn",onClick:l[0]||(l[0]=p=>a.$emit("close"))},"×")]),e.createElementVNode("div",Bi,[e.createElementVNode("div",Fi,[l[9]||(l[9]=e.createElementVNode("label",{for:"file-input",class:"zero-code-img-file-input-label"},[e.createElementVNode("div",{class:"zero-code-img-file-input-area"},[e.createElementVNode("span",{class:"zero-code-img-file-input-text"},"クリックしてファイルを選択"),e.createElementVNode("span",{class:"zero-code-img-file-input-hint"},"またはドラッグ&ドロップ")])],-1)),e.createElementVNode("input",{id:"file-input",type:"file",accept:"image/*",style:{display:"none"},onChange:N,onDrop:w,onDragover:l[1]||(l[1]=e.withModifiers(()=>{},["prevent"])),onDragenter:l[2]||(l[2]=e.withModifiers(()=>{},["prevent"]))},null,32)]),s.value?(e.openBlock(),e.createElementBlock("div",Mi,[e.createElementVNode("div",Li,[e.createElementVNode("img",{src:f.value,alt:"プレビュー"},null,8,xi)]),e.createElementVNode("div",Oi,[e.createElementVNode("p",null,[l[10]||(l[10]=e.createElementVNode("strong",null,"ファイル名:",-1)),e.createTextVNode(" "+e.toDisplayString(s.value.name),1)]),e.createElementVNode("p",null,[l[11]||(l[11]=e.createElementVNode("strong",null,"サイズ:",-1)),e.createTextVNode(" "+e.toDisplayString(B(s.value.size)),1)]),e.createElementVNode("p",null,[l[12]||(l[12]=e.createElementVNode("strong",null,"タイプ:",-1)),e.createTextVNode(" "+e.toDisplayString(s.value.type),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Ri,[e.createElementVNode("div",Hi,[l[13]||(l[13]=e.createElementVNode("label",{for:"image-name"},"保存名:",-1)),e.withDirectives(e.createElementVNode("input",{id:"image-name","onUpdate:modelValue":l[3]||(l[3]=p=>y.value=p),type:"text",placeholder:"画像の保存名を入力",disabled:!s.value},null,8,Zi),[[e.vModelText,y.value]])]),e.createElementVNode("div",ji,[l[14]||(l[14]=e.createElementVNode("label",{for:"image-alt"},"alt属性:",-1)),e.withDirectives(e.createElementVNode("input",{id:"image-alt","onUpdate:modelValue":l[4]||(l[4]=p=>h.value=p),type:"text",placeholder:"画像の説明を入力",disabled:!s.value},null,8,Ui),[[e.vModelText,h.value]])]),a.category==="individual"?(e.openBlock(),e.createElementBlock("div",Wi,[l[15]||(l[15]=e.createElementVNode("label",{for:"component-id"},"コンポーネントID:",-1)),e.withDirectives(e.createElementVNode("input",{id:"component-id","onUpdate:modelValue":l[5]||(l[5]=p=>b.value=p),type:"text",placeholder:"コンポーネントIDを入力",disabled:!s.value},null,8,qi),[[e.vModelText,b.value]])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",Gi,[e.createElementVNode("button",{class:"zero-code-img-btn zero-code-img-btn-secondary",onClick:l[6]||(l[6]=p=>a.$emit("close"))},"キャンセル"),e.createElementVNode("button",{class:"zero-code-img-btn zero-code-img-btn-primary",disabled:!A.value,onClick:D}," アップロード ",8,Ki)])])]))}}),Xi={class:"zero-code-modal-header"},Yi={class:"zero-code-modal-body"},Qi={class:"zero-code-img-detail-preview"},ed=["src","alt"],td={key:0,class:"zero-code-img-updated-badge"},od={class:"zero-code-form-section"},rd={class:"zero-code-form-group"},nd={class:"zero-code-form-group"},ad={key:0,class:"zero-code-form-group"},sd={class:"zero-code-img-detail-info"},ld={class:"zero-code-img-detail-info-group"},id={class:"zero-code-img-detail-info-group"},dd={class:"zero-code-img-detail-info-group"},cd={class:"zero-code-img-detail-info-group"},pd={class:"zero-code-img-detail-info-group"},md={class:"zero-code-img-detail-url-group"},ud={class:"zero-code-modal-footer"},gd={class:"zero-code-modal-footer-right"},fd=e.defineComponent({__name:"ImageDetailModal",props:{image:{type:Object}},emits:["close","delete","replace"],setup(t,{emit:r}){const o=t,n=r,s=e.reactive({...o.image}),f=e.ref(null),{getImageSrc:y,getImageAlt:h,isImageUpdated:b,updateImageData:A}=xt(),N=e.computed(()=>y(s)),w=e.computed(()=>h(s)),k=()=>{confirm("この画像を削除しますか？この操作は取り消せません。")&&n("delete",s.id)},v=()=>{f.value&&f.value.click()},S=async l=>{const p=l.target;if(!p.files||!p.files[0])return;const z=p.files[0];if(!confirm(`画像を "${z.name}" に差し替えますか？この操作は取り消せません。`)){p.value="";return}try{const E=await B(z),_=A(s,z,E.split(",")[1]);Object.assign(s,_),n("replace",s.id,_)}catch{alert("画像の差し替えに失敗しました。")}finally{p.value=""}},B=l=>new Promise((p,z)=>{const E=new FileReader;E.readAsDataURL(l),E.onload=()=>p(E.result),E.onerror=_=>z(_)}),D=async l=>{try{await navigator.clipboard.writeText(l),alert("URLをクリップボードにコピーしました")}catch{const z=document.createElement("textarea");z.value=l,document.body.appendChild(z),z.select(),document.execCommand("copy"),document.body.removeChild(z),alert("URLをクリップボードにコピーしました")}},i=l=>{if(!l||isNaN(l))return"サイズ不明";if(l===0)return"0 Bytes";const p=1024,z=["Bytes","KB","MB","GB"],E=Math.floor(Math.log(l)/Math.log(p));return parseFloat((l/Math.pow(p,E)).toFixed(2))+" "+z[E]},a=l=>{if(!l)return"日時不明";const p=new Date(l);return isNaN(p.getTime())?"日時不明":p.toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return(l,p)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:p[8]||(p[8]=z=>l.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:p[7]||(p[7]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Xi,[p[9]||(p[9]=e.createElementVNode("h4",null,"画像詳細",-1)),e.createElementVNode("button",{class:"zero-code-close-button",onClick:p[0]||(p[0]=z=>l.$emit("close"))},"✖️")]),e.createElementVNode("div",Yi,[e.createElementVNode("div",Qi,[e.createElementVNode("img",{src:N.value,alt:w.value},null,8,ed),e.unref(b)(s)?(e.openBlock(),e.createElementBlock("div",td," 差し替え済み ")):e.createCommentVNode("",!0)]),e.createElementVNode("div",od,[e.createElementVNode("div",rd,[p[10]||(p[10]=e.createElementVNode("label",{for:"detail-image-name"},"ファイル名:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-image-name","onUpdate:modelValue":p[1]||(p[1]=z=>s.name=z),type:"text",readonly:""},null,512),[[e.vModelText,s.name]])]),e.createElementVNode("div",nd,[p[11]||(p[11]=e.createElementVNode("label",{for:"detail-image-alt"},"alt属性:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-image-alt","onUpdate:modelValue":p[2]||(p[2]=z=>s.alt=z),type:"text",readonly:""},null,512),[[e.vModelText,s.alt]])]),s.componentId?(e.openBlock(),e.createElementBlock("div",ad,[p[12]||(p[12]=e.createElementVNode("label",{for:"detail-component-id"},"コンポーネントID:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-component-id","onUpdate:modelValue":p[3]||(p[3]=z=>s.componentId=z),type:"text",readonly:""},null,512),[[e.vModelText,s.componentId]])])):e.createCommentVNode("",!0),e.createElementVNode("div",sd,[e.createElementVNode("div",ld,[p[13]||(p[13]=e.createElementVNode("label",null,"カテゴリ:",-1)),e.createElementVNode("span",{class:e.normalizeClass(["zero-code-img-detail-category",s.category])},e.toDisplayString(s.category==="common"?"共通画像":"個別画像"),3)]),e.createElementVNode("div",id,[p[14]||(p[14]=e.createElementVNode("label",null,"ファイルサイズ:",-1)),e.createElementVNode("span",null,e.toDisplayString(i(s.fileData?.size||s.size||0)),1)]),e.createElementVNode("div",dd,[p[15]||(p[15]=e.createElementVNode("label",null,"ファイルタイプ:",-1)),e.createElementVNode("span",null,e.toDisplayString(s.fileData?.type||s.type||"不明"),1)]),e.createElementVNode("div",cd,[p[16]||(p[16]=e.createElementVNode("label",null,"アップロード日時:",-1)),e.createElementVNode("span",null,e.toDisplayString(a(s.uploadedAt)),1)]),e.createElementVNode("div",pd,[p[17]||(p[17]=e.createElementVNode("label",null,"画像URL:",-1)),e.createElementVNode("div",md,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":p[4]||(p[4]=z=>s.url=z),type:"text",readonly:"",class:"zero-code-img-detail-url-input"},null,512),[[e.vModelText,s.url]]),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary zero-code-copy-btn",title:"URLをコピー",onClick:p[5]||(p[5]=z=>D(s.url))}," 📋 ")])])])])]),e.createElementVNode("div",ud,[e.createElementVNode("div",{class:"zero-code-modal-footer-left"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-danger",onClick:k}," 削除 "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",onClick:v}," 差し替え ")]),e.createElementVNode("div",gd,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:p[6]||(p[6]=z=>l.$emit("close"))}," 閉じる ")]),e.createElementVNode("input",{ref_key:"fileInputRef",ref:f,type:"file",accept:"image/*",style:{display:"none"},onChange:S},null,544)])])]))}}),hd={class:"zero-code-tab-content"},yd={class:"zero-code-data-tabs"},bd={class:"zero-code-tab-buttons"},$d=["onClick"],_d={class:"zero-code-image-content"},Ed={key:0,class:"zero-code-image-section"},zd={class:"zero-code-section-header"},wd={class:"zero-code-img-grid"},vd=["onClick"],Cd=["src","alt"],Ad={key:0,class:"zero-code-img-updated-badge"},Nd={class:"zero-code-img-info"},kd={class:"zero-code-img-name"},Pd={class:"zero-code-img-size"},Dd=["onClick"],Id={key:0,class:"zero-code-empty-state"},Sd={key:1,class:"zero-code-image-section"},Td={class:"zero-code-section-header"},Vd={class:"zero-code-img-grid"},Bd=["onClick"],Fd=["src","alt"],Md={key:0,class:"zero-code-img-updated-badge"},Ld={class:"zero-code-img-info"},xd={class:"zero-code-img-name"},Od={class:"zero-code-img-size"},Rd=["onClick"],Hd={key:0,class:"zero-code-empty-state"},Zd={key:2,class:"zero-code-image-section"},jd={class:"zero-code-data-display-section"},Ud={class:"zero-code-parts-sub-tabs"},Wd={class:"zero-code-parts-sub-content"},qd={key:0,class:"zero-code-parts-sub-section"},Gd={key:0},Kd={class:"zero-code-data-display-pre"},Jd={key:1},Xd={key:1,class:"zero-code-parts-sub-section"},Yd={key:0},Qd={class:"zero-code-data-display-pre"},ec={key:1},tc={class:"zero-code-image-stats"},oc=e.defineComponent({__name:"ImageManagementPanel",props:{commonImages:{type:Array},individualImages:{type:Array}},emits:["updateCommonImages","updateIndividualImages","sendCommonImagesData","sendIndividualImagesData"],setup(t,{emit:r}){const o=t,n=r,{getImageSrc:s,getImageAlt:f,isImageUpdated:y}=xt(),h=e.ref("common"),b=e.ref("common"),A=e.ref(!1),N=e.ref(!1),w=e.ref("common"),k=e.ref(null),v=e.computed(()=>o.commonImages.length+o.individualImages.length),S=["common","individual","data"],B=m=>({common:"共通画像",individual:"個別画像",data:"データ表示"})[m],D=m=>{if(!m||isNaN(m))return"サイズ不明";if(m===0)return"0 Bytes";const g=1024,$=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(m)/Math.log(g));return parseFloat((m/Math.pow(g,C)).toFixed(2))+" "+$[C]},i=m=>{w.value=m,A.value=!0},a=()=>{A.value=!1},l=m=>{k.value=m,N.value=!0},p=()=>{N.value=!1,k.value=null},z=m=>{if(w.value==="common"){const g=[...o.commonImages,m];n("updateCommonImages",g)}else{const g=[...o.individualImages,m];n("updateIndividualImages",g)}a()},E=m=>{const g=($,C=0)=>{const P="  ".repeat(C),I="  ".repeat(C+1);if(Array.isArray($))return $.length===0?"[]":`[
${$.map(V=>I+g(V,C+1)).join(`,
`)}
${P}]`;if(typeof $=="object"&&$!==null){const T=Object.entries($);return T.length===0?"{}":`{
${T.map(([L,U])=>{let M;if(typeof U=="string"){const O=U.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if(O.includes(`
`)){const J=O.split(`
`);M=J.map((re,de)=>de===0?`\`${re}`:de===J.length-1?`${I}${re}\``:`${I}${re}`).join(`
`)}else M=`"${O}"`}else M=g(U,C+1);return`${I}"${L}": ${M}`}).join(`,
`)}
${P}}`}return typeof $=="string"?`"${$.replace(/"/g,'\\"')}"`:JSON.stringify($)};return g(m)},_=m=>{if(!k.value)return;if(k.value.category==="common"){const $=o.commonImages.filter(C=>C.id!==m);n("updateCommonImages",$)}else{const $=o.individualImages.filter(C=>C.id!==m);n("updateIndividualImages",$)}p()},c=(m,g)=>{if(g.category==="common"){const C=o.commonImages.map(P=>P.id===m?g:P);n("updateCommonImages",C)}else{const C=o.individualImages.map(P=>P.id===m?g:P);n("updateIndividualImages",C)}p()},u=(m,g)=>{if(confirm("この画像を削除しますか？"))if(g==="common"){const $=o.commonImages.filter(C=>C.id!==m);n("updateCommonImages",$)}else{const $=o.individualImages.filter(C=>C.id!==m);n("updateIndividualImages",$)}};return(m,g)=>(e.openBlock(),e.createElementBlock("div",hd,[e.createElementVNode("div",yd,[e.createElementVNode("div",bd,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(S,$=>e.createElementVNode("button",{key:$,class:e.normalizeClass(["zero-code-data-tab-button",{active:h.value===$}]),onClick:C=>h.value=$},e.toDisplayString(B($)),11,$d)),64))])]),e.createElementVNode("div",_d,[h.value==="common"?(e.openBlock(),e.createElementBlock("div",Ed,[e.createElementVNode("div",zd,[e.createElementVNode("h4",null,"共通画像 ("+e.toDisplayString(m.commonImages.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-img-upload-btn common",onClick:g[0]||(g[0]=$=>i("common"))}," 共通画像をアップロード ")]),e.createElementVNode("div",wd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.commonImages,$=>(e.openBlock(),e.createElementBlock("div",{key:$.id,class:"zero-code-img-item",onClick:C=>l($)},[e.createElementVNode("img",{src:e.unref(s)($),alt:e.unref(f)($)},null,8,Cd),e.unref(y)($)?(e.openBlock(),e.createElementBlock("div",Ad," 差し替え済み ")):e.createCommentVNode("",!0),e.createElementVNode("div",Nd,[e.createElementVNode("p",kd,e.toDisplayString($.name),1),e.createElementVNode("p",Pd,e.toDisplayString(D($.fileData?.size||$.size||0)),1)]),e.createElementVNode("button",{class:"zero-code-img-delete-btn",onClick:e.withModifiers(C=>u($.id,"common"),["stop"])}," 削除 ",8,Dd)],8,vd))),128))]),m.commonImages.length===0?(e.openBlock(),e.createElementBlock("div",Id,g[4]||(g[4]=[e.createElementVNode("p",null,"共通画像が登録されていません。",-1)]))):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),h.value==="individual"?(e.openBlock(),e.createElementBlock("div",Sd,[e.createElementVNode("div",Td,[e.createElementVNode("h4",null,"個別画像 ("+e.toDisplayString(m.individualImages.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-img-upload-btn individual",onClick:g[1]||(g[1]=$=>i("individual"))}," 個別画像をアップロード ")]),e.createElementVNode("div",Vd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.individualImages,$=>(e.openBlock(),e.createElementBlock("div",{key:$.id,class:"zero-code-img-item",onClick:C=>l($)},[e.createElementVNode("img",{src:e.unref(s)($),alt:e.unref(f)($)},null,8,Fd),e.unref(y)($)?(e.openBlock(),e.createElementBlock("div",Md," 差し替え済み ")):e.createCommentVNode("",!0),e.createElementVNode("div",Ld,[e.createElementVNode("p",xd,e.toDisplayString($.name),1),e.createElementVNode("p",Od,e.toDisplayString(D($.fileData?.size||$.size||0)),1)]),e.createElementVNode("button",{class:"zero-code-img-delete-btn",onClick:e.withModifiers(C=>u($.id,"individual"),["stop"])}," 削除 ",8,Rd)],8,Bd))),128))]),m.individualImages.length===0?(e.openBlock(),e.createElementBlock("div",Hd,g[5]||(g[5]=[e.createElementVNode("p",null,"個別画像が登録されていません。",-1)]))):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),h.value==="data"?(e.openBlock(),e.createElementBlock("div",Zd,[e.createElementVNode("div",jd,[e.createElementVNode("div",Ud,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:b.value==="common"}]),onClick:g[2]||(g[2]=$=>b.value="common")}," 共通画像データ ",2),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:b.value==="individual"}]),onClick:g[3]||(g[3]=$=>b.value="individual")}," 個別画像データ ",2)]),e.createElementVNode("div",Wd,[b.value==="common"?(e.openBlock(),e.createElementBlock("div",qd,[m.commonImages&&m.commonImages.length>0?(e.openBlock(),e.createElementBlock("div",Gd,[e.createElementVNode("pre",Kd,e.toDisplayString(E(m.commonImages)),1)])):(e.openBlock(),e.createElementBlock("div",Jd,g[6]||(g[6]=[e.createElementVNode("p",null,"共通画像データがありません",-1)])))])):e.createCommentVNode("",!0),b.value==="individual"?(e.openBlock(),e.createElementBlock("div",Xd,[m.individualImages&&m.individualImages.length>0?(e.openBlock(),e.createElementBlock("div",Yd,[e.createElementVNode("pre",Qd,e.toDisplayString(E(m.individualImages)),1)])):(e.openBlock(),e.createElementBlock("div",ec,g[7]||(g[7]=[e.createElementVNode("p",null,"個別画像データがありません",-1)])))])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",tc,[g[8]||(g[8]=e.createElementVNode("strong",null,"画像情報:",-1)),e.createTextVNode(" 共通画像: "+e.toDisplayString(m.commonImages.length)+"件, 個別画像: "+e.toDisplayString(m.individualImages.length)+"件, 合計: "+e.toDisplayString(v.value)+"件 ",1)]),A.value?(e.openBlock(),e.createBlock(Ji,{key:0,category:w.value,onClose:a,onUpload:z},null,8,["category"])):e.createCommentVNode("",!0),N.value&&k.value?(e.openBlock(),e.createBlock(fd,{key:1,image:k.value,onClose:p,onDelete:_,onReplace:c},null,8,["image"])):e.createCommentVNode("",!0)]))}});function rc(){const t=e.ref("editor"),r=b=>{t.value!==b&&(d.info(`🔄 タブ切り替え: ${t.value} → ${b}`),t.value=b)};return{activeTab:t,availableTabs:["editor","parts","preview","images"],switchToTab:r,isActiveTab:b=>t.value===b,showEditor:()=>{r("editor")},showPartsManager:()=>{r("parts")},showPreview:()=>{r("preview")},showImageManager:()=>{r("images")}}}function nc(t,r){const o=e.reactive({editablePageData:[],localParts:[],localCommonParts:[],localIndividualParts:[],activeTab:"editor",dataTab:"rendered",showEditor:!1,showPartSelector:!1,showNestedPartSelector:!1,selectedComponent:null,selectedComponentIndex:null,editingText:null,insertPosition:0,nestedInsertPath:"",nestedInsertPosition:0});e.watch(()=>t.page,b=>{Array.isArray(b)&&b.length>0&&(o.editablePageData=[...b])},{immediate:!0,deep:!0}),e.watch(()=>t.parts,b=>{Array.isArray(b)&&(o.localParts=[...b])},{immediate:!0,deep:!0});const n={currentComponentIndex:e.computed(()=>o.selectedComponentIndex===null?-1:typeof o.selectedComponentIndex=="number"?o.selectedComponentIndex:parseInt(o.selectedComponentIndex.toString())),pageDataLength:e.computed(()=>o.editablePageData.length),hasSelectedComponent:e.computed(()=>o.selectedComponent!==null),isEditing:e.computed(()=>o.showEditor&&o.selectedComponent!==null),isTiptapEditing:e.computed(()=>o.editingText!==null)},s={switchToTab:b=>{o.activeTab=b,b==="editor"&&(o.dataTab="rendered")},setDataTab:b=>{o.dataTab=b}},f={openEditor:(b,A)=>{o.selectedComponent=b,o.selectedComponentIndex=A,o.showEditor=!0},closeEditor:()=>{r.emit("editorClosed",{componentId:o.selectedComponent?.id,componentIndex:o.selectedComponentIndex}),o.showEditor=!1,o.selectedComponent=null,o.selectedComponentIndex=null},openPartSelector:b=>{o.insertPosition=b,o.showPartSelector=!0},closePartSelector:()=>{o.showPartSelector=!1},openNestedPartSelector:(b,A)=>{o.nestedInsertPath=b,o.nestedInsertPosition=A,o.showNestedPartSelector=!0},closeNestedPartSelector:()=>{o.showNestedPartSelector=!1}},y={startTiptapEdit:(b,A,N=[],w=0,k,v)=>{o.editingText={componentId:b,paramName:A,hierarchyPath:N,depth:w,arrayName:k,itemIndex:v}},stopTiptapEdit:()=>{o.editingText=null}},h=()=>{o.editablePageData=Array.isArray(t.page)?[...t.page]:[],o.localParts=Array.isArray(t.parts)?[...t.parts]:[],o.localCommonParts=Array.isArray(t.commonParts)?[...t.commonParts]:[],o.localIndividualParts=Array.isArray(t.individualParts)?[...t.individualParts]:[]};return e.watch(()=>t.page,b=>{Array.isArray(b)&&(o.editablePageData=[...b])},{deep:!0,immediate:!0}),e.watch(()=>t.parts,b=>{Array.isArray(b)&&(o.localParts=[...b])},{deep:!0,immediate:!0}),e.watch(()=>t.commonParts,b=>{Array.isArray(b)&&(o.localCommonParts=[...b])},{deep:!0,immediate:!0}),e.watch(()=>t.individualParts,b=>{Array.isArray(b)&&(o.localIndividualParts=[...b])},{deep:!0,immediate:!0}),h(),{...e.toRefs(o),...n,...s,...f,...y,initializeData:h}}function ac(){const t=h=>h.includes("url")||h.includes("src")||h.includes("link")?"url":h.includes("email")?"email":h.includes("number")||h.includes("count")?"number":h.includes("date")?"date":h.includes("time")?"time":h.includes("password")?"password":h.includes("tel")||h.includes("phone")?"tel":"text";return{getInputType:t,formatFileSize:h=>{if(h===0)return"0 Bytes";const b=1024,A=["Bytes","KB","MB","GB"],N=Math.floor(Math.log(h)/Math.log(b));return parseFloat((h/Math.pow(b,N)).toFixed(2))+" "+A[N]},component:{findComponentByPath:(h,b)=>{let A=h,N=null;for(let w=0;w<b.length;w++){const k=b[w];if(k>=0&&k<A.length)N=A[k],w<b.length-1&&(A=N.nested_parts||[]);else return null}return N},createNewComponent:(h,b)=>({id:`comp_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:h,module_name:b,nested_parts:[]}),deleteComponent:(h,b)=>h.filter((A,N)=>N!==b),duplicateComponent:h=>{const b=`comp_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;return{...JSON.parse(JSON.stringify(h)),id:b}},addArrayItem:(h,b)=>{h[b]||(h[b]=[]);const A=h[b],N={id:`item_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};A.push(N)},removeArrayItem:(h,b,A)=>{const N=h[b];Array.isArray(N)&&A>=0&&A<N.length&&N.splice(A,1)}},template:{getTemplate:(h,b,A)=>{const N=A.find(k=>k.type===h);return N&&N.module.find(k=>k.title===b)?.body||""},extractFields:h=>{const b=[];return[/\{\$([^:}]+):/g,/\(\$([^:}]+):/g,/\(\$([^?}]+)\?:/g].forEach(N=>{let w;for(;(w=N.exec(h))!==null;){const k=w[1];b.includes(k)||b.push(k)}}),b},extractSlots:h=>[]},array:{addArrayItem:(h,b)=>[...h,b],removeArrayItem:(h,b)=>h.filter((A,N)=>N!==b),updateArrayItem:(h,b,A)=>h.map((N,w)=>w===b?A:N),moveArrayItem:(h,b,A)=>{const N=[...h],[w]=N.splice(b,1);return N.splice(A,0,w),N}},field:{getFieldValue:(h,b)=>h[b]||"",setFieldValue:(h,b,A)=>({...h,[b]:A}),validateField:(h,b)=>{switch(t(h)){case"email":return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b);case"url":try{return new URL(b),!0}catch{return!1}case"number":return!isNaN(Number(b));default:return!0}}},string:{stringifyHierarchyPath:h=>h.join("."),parseHierarchyPath:h=>{if(!h||typeof h!="string")return d.warn("Invalid pathString provided:",h),[];try{const b=h.split("."),A=[];for(const N of b){const w=N.trim();if(w==="")continue;const k=parseInt(w,10);if(!isNaN(k)&&k>=0)A.push(k);else return d.error(`Invalid path component: "${N}" in pathString: "${h}"`),[]}return A}catch(b){return d.error("Error parsing hierarchy path:",h,b),[]}},camelToKebab:h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kebabToCamel:h=>h.replace(/-([a-z])/g,(b,A)=>A.toUpperCase())}}}function sc(){let t=null;const r=p=>{if(!p||typeof p!="string"||p.trim()==="")return"<p></p>";const z=["p","strong","em","u","s","a","span","br"],E=["href","target","style"],_=document.createElement("div");_.innerHTML=p;const c=m=>{const g=m.tagName.toLowerCase();if(!z.includes(g)){const $=m.parentNode;if($){for(;m.firstChild;)$.insertBefore(m.firstChild,m);$.removeChild(m)}return}Array.from(m.attributes).forEach($=>{E.includes($.name.toLowerCase())||m.removeAttribute($.name)}),Array.from(m.children).forEach($=>{c($)})};Array.from(_.children).forEach(m=>{c(m)});let u=_.innerHTML;return u=u.replace(/<p>\s*<\/p>/g,"<p><br></p>").replace(/<p>\s*<br>\s*<\/p>/g,"<p><br></p>").replace(/(<\w+>)\s*(<\/\w+>)/g,"$1<br>$2"),u.includes("<")||(u=`<p>${u}</p>`),(!u||u.trim()==="")&&(u="<p><br></p>"),u},o=()=>{const p=window.getSelection();if(!p||p.rangeCount===0)return{selection:null,range:null};const z=p.getRangeAt(0);return t?.contains(z.commonAncestorContainer)?{selection:p,range:z}:{selection:null,range:null}},n=(p,z)=>{const E=document.createElement(p);return z&&Object.entries(z).forEach(([_,c])=>{E.setAttribute(_,c)}),E},s=(p,z)=>{try{p.surroundContents(z)}catch{const E=p.extractContents();z.appendChild(E),p.insertNode(z)}},f=(p,z,E)=>{const _=n(z,E);s(p,_)},y=(p,z)=>{const E=document.createElement("span");Object.assign(E.style,z),s(p,E)},h=(p,z)=>{if(!p.collapsed)return;const E=document.createTextNode("テキスト");p.insertNode(E),p.selectNodeContents(E),z.removeAllRanges(),z.addRange(p)},b=p=>{const{selection:z,range:E}=o();if(!z||!E)return;let _=E.commonAncestorContainer;_.nodeType===Node.TEXT_NODE&&(_=_.parentElement||_);const c=_.closest("p");if(c){const u={left:"left",center:"center",right:"right"};c.style.textAlign=u[p]}},A=(p,z)=>{if(!t){d.warn("Editor element not found");return}t.focus();const{selection:E,range:_}=o();if(!E||!_){d.warn("Invalid selection");return}h(_,E);const c={bold:()=>f(_,"strong"),italic:()=>f(_,"em"),underline:()=>f(_,"u"),strikeThrough:()=>f(_,"s"),justifyLeft:()=>b("left"),justifyCenter:()=>b("center"),justifyRight:()=>b("right"),createLink:()=>z&&f(_,"a",{href:z,target:"_blank"}),backColor:()=>z&&y(_,{backgroundColor:z})};try{const u=c[p];u?u():d.warn(`Unknown style: ${p}`)}catch(u){d.error(`Failed to apply style ${p}:`,u);try{document.execCommand(p,!1,z)}catch(m){d.error("Fallback command failed:",m)}}},N=(p,z)=>{if(!t)return;t.focus();const E=window.getSelection();if(E?.rangeCount&&t.contains(E.getRangeAt(0).commonAncestorContainer)){const _=E.getRangeAt(0);E.removeAllRanges(),E.addRange(_)}A(p,z)},w={toggleBold:()=>N("bold"),toggleItalic:()=>N("italic"),toggleUnderline:()=>N("underline"),toggleStrike:()=>N("strikeThrough"),alignLeft:()=>N("justifyLeft"),alignCenter:()=>N("justifyCenter"),alignRight:()=>N("justifyRight"),setLink:()=>{const p=window.prompt("URLを入力してください:");p&&N("createLink",p)},isActive:p=>{if(!t)return!1;const z=window.getSelection();if(!z?.rangeCount)return!1;const E=z.getRangeAt(0);return t.contains(E.commonAncestorContainer)?{bold:()=>k("strong"),italic:()=>k("em"),underline:()=>k("u"),strike:()=>k("s")}[p]?.()??!1:!1}},k=p=>{const{selection:z,range:E}=o();if(!z||!E)return!1;let _=E.commonAncestorContainer;for(_.nodeType===window.Node.TEXT_NODE&&(_=_.parentElement||_);_&&_!==t;){if(_.nodeType===window.Node.ELEMENT_NODE&&_.tagName.toLowerCase()===p.toLowerCase())return!0;_=_.parentElement}return!1},v=()=>`
    border: 2px solid #3b82f6;
    border-radius: 8px;
    padding: 12px 16px;
    min-height: 60px;
    background: white;
    outline: none;
    line-height: 1.6;
    color: #1f2937;
    font-size: 14px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    transition: all 0.2s ease;
  `,S=p=>{Object.entries({"data-gramm":"false",spellcheck:"false",autocomplete:"off",autocorrect:"off",autocapitalize:"off"}).forEach(([E,_])=>{p.setAttribute(E,_)})},B=(p,z)=>{let E=null,_=null;p.addEventListener("focus",()=>{p.style.borderColor="#3b82f6",p.style.boxShadow="0 0 0 3px rgba(59,130,246,0.1), 0 1px 3px rgba(0,0,0,0.1)"}),p.addEventListener("blur",()=>{p.style.borderColor="#3b82f6",p.style.boxShadow="0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)"}),p.addEventListener("keydown",u=>{if(u.key==="Enter"&&!u.shiftKey){u.preventDefault();const m=window.getSelection();if(!m?.rangeCount)return;const g=m.getRangeAt(0),$=g.startContainer;let C=null;if($.nodeType===window.Node.TEXT_NODE?C=$.parentElement?.closest("p")||null:$.nodeType===window.Node.ELEMENT_NODE&&(C=$.closest("p")||null),C){const P=document.createElement("p");P.innerHTML="<br>",C.insertAdjacentElement("afterend",P);const I=document.createRange();I.setStart(P,0),I.setEnd(P,0),m.removeAllRanges(),m.addRange(I)}else{const P=document.createElement("p");P.innerHTML="<br>",g.deleteContents(),g.insertNode(P);const I=document.createRange();I.setStart(P,0),I.setEnd(P,0),m.removeAllRanges(),m.addRange(I)}p.dispatchEvent(new Event("input",{bubbles:!0}))}}),p.addEventListener("input",()=>{E&&window.clearTimeout(E),E=window.setTimeout(()=>{const u=r(p.innerHTML);if(u!==p.innerHTML){const m=window.getSelection();let g=null;if(m&&m.rangeCount>0&&(g=m.getRangeAt(0).cloneRange()),p.innerHTML=u,g&&m)try{m.removeAllRanges(),m.addRange(g)}catch{const C=document.createRange();C.selectNodeContents(p),C.collapse(!1),m.removeAllRanges(),m.addRange(C)}}z?.(p.innerHTML)},300)}),p.addEventListener("selectionchange",()=>{try{p.dispatchEvent(new CustomEvent("selectionchange"))}catch(u){d.warn("Selection change error:",u)}});const c=new globalThis.MutationObserver(()=>{_&&window.clearTimeout(_),_=window.setTimeout(()=>{z?.(p.innerHTML)},100)});return c.observe(p,{childList:!0,subtree:!0,characterData:!0}),{saveTimeout:E,updateTimeout:_,observer:c}},D=(p,z,E)=>{const _=z.querySelector(".simple-editor-content");_&&_.remove();const c=document.createElement("div");c.className="simple-editor-content",c.contentEditable="true";const u=r(p);c.innerHTML=u,c.style.cssText=v(),S(c);const{saveTimeout:m,updateTimeout:g,observer:$}=B(c,E);return z.appendChild(c),t=c,{element:c,getHTML:()=>c.innerHTML,setContent:C=>c.innerHTML=C,destroy:()=>{window.clearTimeout(m),window.clearTimeout(g),$.disconnect(),c.remove(),t=null},isActive:C=>w.isActive(C),isInitialized:!0,isDestroyed:!1,isFocused:!1,chain:()=>({focus:()=>({toggleMark:C=>({run:()=>{({bold:w.toggleBold,italic:w.toggleItalic,underline:w.toggleUnderline,strike:w.toggleStrike})[C]?.()}}),setTextAlign:C=>({run:()=>{({left:w.alignLeft,center:w.alignCenter,right:w.alignRight})[C]?.()}})})})}},i=(p,z,E)=>{try{return z.innerHTML="",D(p,z,E)}catch(_){throw d.error("Editor init error:",_),_}},a=()=>{if(t)try{t.remove(),t=null}catch(p){d.error("Editor destroy error:",p)}},l=()=>!!t;return e.onBeforeUnmount(()=>a()),{initEditor:i,destroyEditor:a,getEditor:()=>t,isEditorReady:l}}function So(t,r,o=100){const n=new Map;return(...s)=>{const f=r?r(...s):JSON.stringify(s);if(n.has(f))return d.debug("メモ化キャッシュヒット:",f),n.get(f);const y=t(...s);if(n.size>=o){const h=n.keys().next().value;h&&n.delete(h)}return n.set(f,y),d.debug("メモ化キャッシュ保存:",f),y}}const io={findComponent:So((t,r)=>{for(const o of t){if(o.id===r)return o;if(o.nested_parts){const n=io.findComponent(o.nested_parts,r);if(n)return n}}return null},(t,r)=>`${r}_${t.length}_${t.map(o=>o.id).join("_")}`,50),getComponentPath:So((t,r,o=[])=>{for(let n=0;n<t.length;n++){const s=t[n],f=[...o,n];if(s.id===r)return f;if(s.nested_parts){const y=io.getComponentPath(s.nested_parts,r,f);if(y)return y}}return null},(t,r,o)=>`path_${r}_${t.length}_${o?.join("_")||""}`,30),getComponentDepth:So((t,r,o=0)=>{for(const n of t){if(n.id===r)return o;if(n.nested_parts){const s=io.getComponentDepth(n.nested_parts,r,o+1);if(s>=0)return s}}return-1},(t,r,o=0)=>`depth_${r}_${o}_${t.length}`,30)};function lc(t,r){let o=null;return(...n)=>{o&&clearTimeout(o),o=setTimeout(()=>{t(...n),o=null},r)}}function ic(t,r){const o=performance.now(),n=t(),f=performance.now()-o;return f>100?d.warn(`⚠️ 重い処理を検出: ${r} (${f.toFixed(2)}ms)`):d.debug(`⚡ パフォーマンス: ${r} (${f.toFixed(2)}ms)`),n}class Sr{constructor(){Ht(this,"events",new Map);Ht(this,"isEnabled",!0)}on(r,o){this.events.has(r)||this.events.set(r,new Set);const n=this.events.get(r);return n.add(o),()=>{n.delete(o)}}emit(r,o){if(!this.isEnabled){d.warn(`EventBus: 無効化されているため ${r} イベントを無視`);return}const n=this.events.get(r);if(!n||n.size===0){d.warn(`EventBus: ${r} イベントのリスナーが見つかりません`);return}const s=[];n.forEach(f=>{try{const y=f(o);y instanceof Promise&&s.push(y)}catch(y){d.error(`EventBus: ${r} イベントリスナーでエラー`,y)}}),s.length>0&&Promise.allSettled(s).then(f=>{f.forEach((y,h)=>{y.status==="rejected"&&d.error(`EventBus: ${r} 非同期リスナー[${h}]でエラー`,y.reason)})})}off(r){this.events.delete(r)}clear(){this.events.clear()}disable(){this.isEnabled=!1}enable(){this.isEnabled=!0}getListenerCount(r){if(r)return this.events.get(r)?.size||0;let o=0;return this.events.forEach(n=>{o+=n.size}),o}}const Oe=new Sr,dc={addArrayItem:(t,r)=>{Oe.emit("addArrayItem",{componentId:t,arrayKey:r})},addZForArrayItem:(t,r,o)=>{Oe.emit("addZForArrayItem",{componentId:t,arrayName:r,insertIndex:o})},removeZForArrayItem:(t,r,o)=>{Oe.emit("removeZForArrayItem",{componentId:t,arrayName:r,index:o})},reorderZForArrayItem:(t,r,o,n)=>{Oe.emit("reorderZForArrayItem",{componentId:t,arrayName:r,fromIndex:o,toIndex:n})},editZForArrayItem:(t,r,o)=>{Oe.emit("editZForArrayItem",{componentId:t,arrayName:r,index:o})},deleteNestedPart:t=>{Oe.emit("deleteNestedPart",{pathString:t})},openNestedEditor:t=>{Oe.emit("openNestedEditor",{pathString:t})},openNestedPartSelector:(t,r)=>{Oe.emit("openNestedPartSelector",{pathString:t,position:r})},startRichTextEdit:(t,r,o)=>Oe.emit("startRichTextEdit",{componentId:t,paramName:r,currentValue:o}),selectImage:(t,r)=>{Oe.emit("selectImage",{componentId:t,paramName:r})},uploadImage:(t,r,o)=>{Oe.emit("uploadImage",{file:t,category:r,componentId:o})}};function cc(t,r,o){const n=t.includes("[DEBUG]"),s=/\d+/.test(t),f=t.replace(/\[DEBUG\]|\d+/g,"").trim();if(r.toLowerCase().includes("url")||r.toLowerCase().includes("image")||r.toLowerCase().includes("icon")||t.startsWith("/")||t.includes(".jpg")||t.includes(".png")||t.includes(".gif")||t.includes(".svg"))return t;let y;return r==="name"&&t.includes("ネスト")?y=`新しいネスト項目${o}`:r==="title"&&t.includes("アイテム")?y=`新しいアイテム${o}`:s?y=`${f}${o}`:y=t.startsWith("新しい")?`${t}${o}`:`新しい${r}${o}`,n&&(y+=" [DEBUG]"),y}function pc(t,r){console.log("🔥 [useZeroCode] 初期化開始");const o=new Sr,n=nc(t,o),s=ac(),f=Io(),y=sc();console.log("🔥 [useZeroCode] z-forイベントリスナー登録開始"),o.on("addZForArrayItem",({componentId:i,arrayName:a,insertIndex:l})=>{console.log("🔥 [EventBus受信] addZForArrayItem受信 (早期登録版):",{componentId:i,arrayName:a,insertIndex:l});try{console.log("🔥 [処理実行] 配列アイテム追加処理開始");const p=i.split("_");console.log("🔥 [DEBUG] componentId parts:",p);let z,E=null;const _=h(n.editablePageData.value,i),c=_&&_.id===i;if(p.length>=3&&/^\d+$/.test(p[p.length-1])&&!c){const $=parseInt(p[p.length-1]);let C="",P="";const I=`_${$}`,T=i.slice(0,-I.length),V=p.slice(0,4).join("_");if(T.startsWith(V+"_"))P=V,C=T.slice(V.length+1);else{const M=T.lastIndexOf("_");M!==-1&&(C=T.slice(M+1),P=T.slice(0,M))}if(!C){const M=i.match(/^(.+)_([^_]+_[^_]+)_(\d+)$/);M?(P=M[1],C=M[2]):(P=p.slice(0,-2).join("_"),C=p[p.length-2])}console.log("🔥 [DEBUG] 修正版ネスト形式検出:",{componentId:i,parts:p,baseParentId:P,parentArrayName:C,parentIndex:$,arrayName:a});const L=P;console.log("🔥 [DEBUG] baseParentIdでコンポーネント検索:",P);const U=h(n.editablePageData.value,P);if(console.log("🔥 [DEBUG] 検索結果:",U?U.id:"null"),U)if(console.log("🔥 [DEBUG] 親コンポーネントの配列確認:",C,U[C]),U[C]&&U[C][$])E=U[C][$],console.log("🔥 [DEBUG] ネスト対象コンポーネント:",E),E&&!Array.isArray(E[a])&&(E[a]=[],console.log("🔥 [DEBUG] 配列フィールド初期化:",a)),z=E?E[a]:void 0,console.log("🔥 [DEBUG] ネスト対象特定完了:",{targetComponentId:E?E.id:"null",arrayName:a,currentArrayLength:z?z.length:0});else throw console.error("🔥 [DEBUG] 親配列または指定インデックスが見つかりません:",{parentArrayName:C,parentIndex:$,parentArray:U[C],parentArrayLength:U[C]?.length}),new Error(`Parent array or index not found: ${C}[${$}]`);else throw console.error("🔥 [DEBUG] baseParentIdでコンポーネントが見つかりません:",P),console.error("🔥 [DEBUG] 現在のページデータ:",n.editablePageData.value.map(M=>M.id)),new Error(`Parent component not found: ${P}`)}else console.log("🔥 [DEBUG] 通常形式検出:",i),E=_||h(n.editablePageData.value,i),E&&(Array.isArray(E[a])||(E[a]=[]),z=E[a]);if(!E||!z)throw new Error(`Target component or array not found: ${i}`);const u=n.localParts.value&&n.localParts.value.length>0?n.localParts.value:[],g={id:ao(u).generateUniqueId()};if(z&&z.length>0){console.log("🔥 [DEBUG] 既存アイテムベース生成開始");const $=z[0];console.log("🔥 [DEBUG] サンプルアイテム:",$),Object.keys($).forEach(C=>{if(C!=="id"&&!g[C]){const P=$[C];typeof P=="string"?(g[C]=cc(P,C,z.length+1),console.log(`🔥 [DEBUG] 文字列フィールドコピー: ${C} = "${g[C]}"`)):Array.isArray(P)?g[C]=[]:typeof P=="number"?g[C]=P===0?0:Math.floor(Math.random()*100)+1:typeof P=="boolean"?g[C]=!1:g[C]=P}}),console.log("🔥 [DEBUG] 既存アイテムベース生成完了:",g)}else{console.log("🔥 [DEBUG] 空配列 - デフォルト値設定");const $=a.replace(/_/g,"");g.name=`新しい${$}${(z?.length||0)+1}`}z.splice(l,0,g),console.log("🔥 [DEBUG] z-for配列アイテム追加完了:",{arrayName:a,insertIndex:l,newItem:g,finalArrayLength:z.length}),r("update:page",n.editablePageData.value),console.log("🔥 [処理完了] アイテム追加成功！")}catch(p){console.error("🔥 [処理エラー] z-forアイテム追加エラー:",p),alert(`エラーが発生しました: ${p instanceof Error?p.message:String(p)}`)}}),o.on("reorderZForArrayItem",({componentId:i,arrayName:a,fromIndex:l,toIndex:p})=>{console.log("🔥 [EventBus受信] reorderZForArrayItem受信 (早期登録版):",{componentId:i,arrayName:a,fromIndex:l,toIndex:p});try{console.log("🔥 [処理実行] 配列アイテム並べ替え処理開始");const z=i.split("_");console.log("🔥 [DEBUG] 並べ替えcomponentId parts:",z);let E,_=null;const c=h(n.editablePageData.value,i),u=c&&c.id===i;if(z.length>=3&&/^\d+$/.test(z[z.length-1])&&!u){const g=parseInt(z[z.length-1]);let $="",C="";const P=`_${g}`,I=i.slice(0,-P.length),T=z.slice(0,4).join("_");if(I.startsWith(T+"_"))C=T,$=I.slice(T.length+1);else{const L=I.lastIndexOf("_");L!==-1&&($=I.slice(L+1),C=I.slice(0,L))}if(!$){const L=i.match(/^(.+)_([^_]+_[^_]+)_(\d+)$/);L?(C=L[1],$=L[2]):(C=z.slice(0,-2).join("_"),$=z[z.length-2])}console.log("🔥 [DEBUG] 並べ替えネスト形式検出:",{componentId:i,parts:z,baseParentId:C,parentArrayName:$,parentIndex:g,arrayName:a});const V=h(n.editablePageData.value,C);if(console.log("🔥 [DEBUG] 並べ替え親要素検索結果:",{baseParentId:C,parentArrayName:$,parentIndex:g,realComponentFound:!!V,realComponentId:V?.id,realComponentKeys:V?Object.keys(V):null,hasParentArray:V?!!V[$]:!1,parentArrayLength:V&&V[$]?V[$].length:0,hasTargetIndex:V&&V[$]?!!V[$][g]:!1,availableArrays:V?Object.keys(V).filter(L=>Array.isArray(V[L])):null}),V&&V[$]&&V[$][g])_=V[$][g],_&&!Array.isArray(_[a])&&(_[a]=[]),E=_?_[a]:void 0,console.log("🔥 [DEBUG] 並べ替えネスト対象特定完了:",{targetComponentId:_?_.id:null,arrayName:a,currentArrayLength:E?E.length:0});else throw console.error("🔥 [ERROR] 並べ替え失敗詳細:",{baseParentId:C,parentArrayName:$,parentIndex:g,realComponent:V?{id:V.id,keys:Object.keys(V)}:null,parentArray:V&&V[$]?V[$]:null}),new Error(`Parent array or index not found for reorder: ${$}[${g}]`)}else console.log("🔥 [DEBUG] 並べ替え通常形式検出:",i),_=c||h(n.editablePageData.value,i),_&&(Array.isArray(_[a])||(_[a]=[]),E=_[a]);if(!_||!E)throw new Error(`Target component or array not found for reorder: ${i}`);const[m]=E.splice(l,1);E.splice(p,0,m),console.log("🔥 [DEBUG] z-for配列アイテム並べ替え完了:",{arrayName:a,fromIndex:l,toIndex:p,movedItem:m.id||m,finalArrayLength:E.length}),r("update:page",n.editablePageData.value),console.log("🔥 [処理完了] アイテム並べ替え成功！")}catch(z){console.error("🔥 [処理エラー] z-forアイテム並べ替えエラー:",z),alert(`並べ替えでエラーが発生しました: ${z instanceof Error?z.message:String(z)}`)}}),console.log("🔥 [useZeroCode] 早期z-forリスナー登録完了（追加・並べ替え）");const h=(i,a)=>ic(()=>io.findComponent(i,a),`findComponent(${a})`),b=lc(i=>{r("update:page",i),d.debug("💾 ページデータ更新をemit")},100),A=(i,a)=>{const l=()=>{i._isZForItem&&delete i._isZForItem,i._parentComponentId&&delete i._parentComponentId,i._arrayName&&delete i._arrayName,i._arrayIndex&&delete i._arrayIndex,i.module_name&&delete i.module_name,d.debug("🧹 z-for配列アイテムのメタデータクリーンアップ完了:",{editorId:a,cleanedProperties:["_isZForItem","_parentComponentId","_arrayName","_arrayIndex","module_name"]})},p=()=>{l(),o.off("editorClosed")};o.on("editorClosed",p),d.debug("🔧 z-for配列アイテム編集クリーンアップ処理を設定:",{editorId:a,hasMetadata:{_isZForItem:!!i._isZForItem,_parentComponentId:!!i._parentComponentId,_arrayName:!!i._arrayName,_arrayIndex:!!i._arrayIndex}})},N=(i,a,l)=>{d.debug(`🔍 updateNestedComponent: 検索開始 - targetId: ${a}, components数: ${i.length}`);for(let p=0;p<i.length;p++){const z=i[p];if(d.debug(`🔍 チェック中: ${z.id} === ${a} ?`),z.id===a)return d.debug(`✅ コンポーネント発見 - 更新実行: ${a}`),d.debug("🔍 更新前:",z),d.debug("🔍 更新後:",l),i[p]=l,!0;if(z.nested_parts&&Array.isArray(z.nested_parts)&&(d.debug(`🔍 nested_parts内を検索: ${z.id}`),N(z.nested_parts,a,l)))return!0;for(const[E,_]of Object.entries(z))if(Array.isArray(_)&&E!=="nested_parts"){d.debug(`🔍 配列プロパティ検索: ${z.id}.${E}`);for(const c of _)if(c&&typeof c=="object"){for(const[u,m]of Object.entries(c))if(Array.isArray(m)&&(d.debug(`🔍 スロット検索: ${z.id}.${E}[].${u}`),N(m,a,l)))return!0}}}return d.debug(`❌ コンポーネントが見つかりませんでした: ${a}`),!1},w=(i,a)=>{for(let l=0;l<i.length;l++){if(i[l].id===a)return i.splice(l,1),!0;if(i[l].nested_parts&&Array.isArray(i[l].nested_parts)&&w(i[l].nested_parts,a))return!0;for(const[p,z]of Object.entries(i[l]))if(Array.isArray(z)&&p!=="nested_parts"){for(const E of z)if(E&&typeof E=="object"){for(const[_,c]of Object.entries(E))if(Array.isArray(c)&&w(c,a))return!0}}}return!1},k={addPart:(i,a)=>{d.debug("🔧 addPart呼び出し:",{part:i,position:a,currentPageData:n.editablePageData.value});const l=[...n.editablePageData.value];l.splice(a,0,i),n.editablePageData.value=l,d.debug("🔧 新しいページデータ:",l),r("update:page",l)},deletePart:i=>{if(window.confirm("このパーツを削除しますか？")){const a=s.component.deleteComponent(n.editablePageData.value,i);n.editablePageData.value=a,r("update:page",a)}},duplicatePart:i=>{const a=n.editablePageData.value[i];if(a){const l=s.component.duplicateComponent(a),p=[...n.editablePageData.value];p.splice(i+1,0,l),n.editablePageData.value=p,r("update:page",p)}},reorderParts:i=>{n.editablePageData.value=i,r("update:page",i)},movePart:(i,a)=>{const l=[...n.editablePageData.value],[p]=l.splice(i,1);l.splice(a,0,p),n.editablePageData.value=l,r("update:page",l)},reorderNestedParts:(i,a)=>{const l=s.string.parseHierarchyPath(i),p=JSON.parse(JSON.stringify(n.editablePageData.value)),z=s.component.findComponentByPath(p,l);z?(z.nested_parts=[...a],n.editablePageData.value=p,r("update:page",p)):d.error("❌ 親コンポーネントが見つかりません:",{pathString:i,path:l})},moveNestedPart:(i,a,l)=>{const p=s.string.parseHierarchyPath(i),z=JSON.parse(JSON.stringify(n.editablePageData.value)),E=s.component.findComponentByPath(z,p);if(E?.nested_parts&&E.nested_parts.length>Math.max(a,l)){const _=[...E.nested_parts];if(a>=0&&a<_.length&&l>=0&&l<_.length&&a!==l){const[c]=_.splice(a,1);_.splice(l,0,c),E.nested_parts=_,n.editablePageData.value=z,r("update:page",z)}else d.error("❌ 無効なインデックス:",{fromIndex:a,toIndex:l,arrayLength:_.length})}else d.error("❌ 親コンポーネントまたはnested_partsが見つかりません:",{pathString:i,path:p})},moveNestedPartBetweenLevels:(i,a,l,p)=>{const z=s.string.parseHierarchyPath(i),E=s.string.parseHierarchyPath(l),_=[...n.editablePageData.value],c=s.component.findComponentByPath(_,z);if(!c?.nested_parts)return;const[u]=c.nested_parts.splice(a,1),m=s.component.findComponentByPath(_,E);m&&(m.nested_parts||(m.nested_parts=[]),m.nested_parts.splice(p,0,u),n.editablePageData.value=_,r("update:page",_))},moveNestedPartById:(i,a,l)=>{d.debug(`🔧 moveNestedPartById: 親ID=${i}, ${a} → ${l}`);const p=JSON.parse(JSON.stringify(n.editablePageData.value)),z=h(p,i);if(z?.nested_parts&&z.nested_parts.length>Math.max(a,l)){const E=[...z.nested_parts];if(a>=0&&a<E.length&&l>=0&&l<E.length&&a!==l){const[_]=E.splice(a,1);E.splice(l,0,_),z.nested_parts=E,n.editablePageData.value=p,r("update:page",p),d.debug(`  - ✅ 並べ替え成功: ${_.id} を位置 ${l} に移動`)}else d.error("❌ 無効なインデックス:",{fromIndex:a,toIndex:l,arrayLength:E.length})}else d.error("❌ 親コンポーネントまたはnested_partsが見つかりません:",{parentComponentId:i})},moveNestedPartBetweenLevelsById:(i,a,l,p)=>{d.debug(`🔧 moveNestedPartBetweenLevelsById: ${i}[${a}] → ${l}[${p}]`);const z=JSON.parse(JSON.stringify(n.editablePageData.value)),E=h(z,i);if(!E?.nested_parts){d.error("❌ ソース親コンポーネントが見つかりません:",i);return}const[_]=E.nested_parts.splice(a,1),c=h(z,l);if(!c){d.error("❌ ターゲット親コンポーネントが見つかりません:",l);return}c.nested_parts||(c.nested_parts=[]),c.nested_parts.splice(p,0,_),n.editablePageData.value=z,r("update:page",z),d.debug(`  - ✅ 階層間移動成功: ${_.id} を ${l} の位置 ${p} に移動`)},moveZForNestedPart:(i,a,l)=>{d.debug(`🔥🔧 moveZForNestedPart: パス=${i}, ${a} → ${l}`);const p=i.match(/^(\w+)\.(\w+)\[(\d+)\]\.(\w+)$/);if(d.debug("🔥 パス解析結果:",{parentPath:i,pathMatch:p}),!p){d.error("❌ 無効なz-forネストパーツパス:",i);return}const[,z,E,_,c]=p,u=parseInt(_);d.debug("🔥 解析済み情報:",{componentId:z,arrayName:E,arrayIndex:u,slotName:c});const m=JSON.parse(JSON.stringify(n.editablePageData.value)),g=h(m,z);if(d.debug("🔥 コンポーネント検索結果:",g),!g){d.error("❌ コンポーネントが見つかりません:",z);return}const $=g[E];if(d.debug("🔥 z-for配列:",{arrayName:E,array:$,isArray:Array.isArray($),length:$?.length}),!Array.isArray($)||u>=$.length){d.error("❌ 配列が見つかりません:",{arrayName:E,arrayIndex:u,arrayLength:$?.length});return}const C=$[u];if(d.debug("🔥 配列アイテム:",{arrayIndex:u,arrayItem:C}),!C||!C[c]||!Array.isArray(C[c])){d.error("❌ ネストパーツ配列が見つかりません:",{slotName:c,arrayItem:C,slot:C?.[c]});return}const P=C[c];if(d.debug("🔥 ネストパーツ配列:",{slotName:c,nestedParts:P,length:P.length}),a<0||a>=P.length||l<0||l>=P.length){d.error("❌ 無効なインデックス:",{fromIndex:a,toIndex:l,arrayLength:P.length});return}if(a===l){d.debug("📍 同じ位置のため移動なし");return}d.debug("🔥 並べ替え前:",P.map(T=>T.id));const[I]=P.splice(a,1);P.splice(l,0,I),d.debug("🔥 並べ替え後:",P.map(T=>T.id)),n.editablePageData.value=m,r("update:page",m),d.debug(`✅ z-for内ネストパーツ並べ替え成功: ${I.id} を位置 ${l} に移動`)},openEditor:i=>{const a=n.editablePageData.value[i];a&&n.openEditor(a,i)},saveComponent:i=>{const a=n.selectedComponentIndex.value;if(d.debug("🐛 saveComponent デバッグ:",{selectedIndex:a,selectedIndexType:typeof a,updatedComponentId:i.id,updatedComponentData:i,isZForItem:i._isZForItem}),i._isZForItem){d.debug("🔍 z-for配列アイテム保存開始");const l=i._parentComponentId,p=i._parentArrayName,z=i._parentIndex,E=i._arrayName,_=i._arrayIndex;d.debug("🔍 z-for保存パラメータ:",{parentComponentId:l,parentArrayName:p,parentIndex:z,arrayName:E,arrayIndex:_});const c=JSON.parse(JSON.stringify(n.editablePageData.value));if(l&&p&&z!==void 0){const u=h(c,l);if(u&&Array.isArray(u[p])){const m=u[p];if(z>=0&&z<m.length){const g=m[z];if(g[E]&&Array.isArray(g[E])){const $=g[E];if(_>=0&&_<$.length){const{_isZForItem:C,_parentComponentId:P,_parentArrayName:I,_parentIndex:T,_arrayName:V,_arrayIndex:L,_parentType:U,_parentModuleName:M,type:O,module_name:J,...Y}=i;$[_]={...$[_],...Y},n.editablePageData.value=c,r("update:page",c),d.debug(`✅ ネストz-for配列アイテム保存完了 - ${p}[${z}].${E}[${_}]`)}else d.error(`❌ 子配列インデックス範囲外: ${_}`)}else d.error(`❌ 子配列が見つからない: ${E}`)}else d.error(`❌ 親配列インデックス範囲外: ${z}`)}else d.error(`❌ 親コンポーネントまたは親配列が見つからない: ${l}.${p}`)}else{const u=h(c,l);if(u&&Array.isArray(u[E])){const m=u[E];if(_>=0&&_<m.length){const{_isZForItem:g,_parentComponentId:$,_arrayName:C,_arrayIndex:P,_zForTemplate:I,...T}=i;m[_]={...m[_],...T},n.editablePageData.value=c,r("update:page",c),d.debug(`✅ z-for配列アイテム保存完了 - ${E}[${_}]`)}else d.error(`❌ z-for配列インデックス範囲外: ${_}`)}else d.error(`❌ z-for親コンポーネントまたは配列が見つからない: ${l}.${E}`)}n.closeEditor();return}if(typeof a=="number"&&a>=0){const l=[...n.editablePageData.value];l[a]=i,n.editablePageData.value=l,r("update:page",l),d.debug(`✅ メインコンポーネント保存完了 - ID: ${i.id}`)}else if(typeof a=="string"){d.debug(`🔍 ネストコンポーネント保存開始 - 検索対象ID: ${a}`);const l=JSON.parse(JSON.stringify(n.editablePageData.value));d.debug("🔍 保存前のPageData:",JSON.stringify(l,null,2));const p=N(l,a,i);d.debug(`🔍 updateNestedComponent結果: ${p}`),d.debug("🔍 保存後のPageData:",JSON.stringify(l,null,2)),p?(n.editablePageData.value=l,r("update:page",l),d.debug(`✅ ネストコンポーネント保存完了 - ID: ${i.id}, パス: ${a}`)):d.error(`❌ ネストコンポーネント保存失敗 - ID: ${i.id}, パス: ${a}`)}else d.error(`❌ 無効なselectedIndex: ${a} (type: ${typeof a})`);n.closeEditor()},addNestedPart:(i,a,l)=>{d.debug(`🔧 addNestedPart: 親ID=${i}, 位置=${a}, 新コンポーネント=${l.id}`);const p=JSON.parse(JSON.stringify(n.editablePageData.value)),z=/^(.+)\.(.+)\[(\d+)\]\.(.+)$/,E=i.match(z);d.debug(`🔍 パス解析: ${i} -> zForMatch:`,E);let _=!1;if(E){const[,c,u,m,g]=E;d.debug("z-for内ネストパーツ追加:",{parentId:c,arrayName:u,arrayIndex:m,slotName:g,position:a});const $=h(p,c);if($)if(d.debug(`✅ 親コンポーネント発見: ${$.id}`),d.debug(`🔍 配列チェック: ${u} ->`,$[u]),$[u]&&Array.isArray($[u])){const C=$[u][parseInt(m)];d.debug(`🔍 配列アイテム[${m}]:`,C),C?(C[g]||(C[g]=[],d.debug(`🆕 スロット初期化: ${g}`)),d.debug(`🔍 スロット[${g}]現在の内容:`,C[g]),C[g].splice(a,0,l),d.debug(`✅ z-for内パーツ追加成功: ${l.id} -> スロット内容:`,C[g]),_=!0):d.debug(`❌ 配列アイテムが見つかりません: インデックス${m}`)}else d.debug(`❌ 配列が見つかりません: ${u}`);else d.debug(`❌ 親コンポーネントが見つかりません: ${c}`)}else{const c=h(p,i);c&&(c.nested_parts||(c.nested_parts=[]),c.nested_parts.splice(a,0,l),d.debug(`  - ✅ パーツ追加成功: ${l.id} を ${i} の位置 ${a} に追加`),d.debug("  - 追加後のnested_parts:",c.nested_parts.map(u=>u.id)),_=!0)}_?(n.editablePageData.value=p,r("update:page",p)):d.debug(`  - ❌ 親コンポーネントが見つかりません: ${i}`)},deleteNestedPart:i=>{if(window.confirm("このネストパーツを削除しますか？")){const a=JSON.parse(JSON.stringify(n.editablePageData.value)),l=/^(.+)\.(.+)\[(\d+)\]\.(.+)\[(\d+)\]$/,p=i.match(l);let z=!1;if(p){const[,E,_,c,u,m]=p;d.debug("z-for内ネストパーツ削除:",{parentId:E,arrayName:_,arrayIndex:c,slotName:u,partIndex:m});const g=h(a,E);if(g)if(d.debug(`✅ 削除対象の親コンポーネント発見: ${g.id}`),g[_]&&Array.isArray(g[_])){const $=g[_][parseInt(c)];$&&$[u]&&Array.isArray($[u])?(d.debug(`🗑️ z-for内パーツ削除実行: ${u}[${m}]`),$[u].splice(parseInt(m),1),z=!0):d.debug(`❌ スロットまたはパーツが見つかりません: ${u}`)}else d.debug(`❌ 配列が見つかりません: ${_}`);else d.debug(`❌ 削除対象の親コンポーネントが見つかりません: ${E}`)}else z=w(a,i);z?(n.editablePageData.value=a,r("update:page",a)):d.debug(`❌ Component not found for deletion: ${i}`)}},startTiptapEdit:(i,a,l=[],p=0)=>{n.startTiptapEdit(i,a,l,p)},startSimpleTiptapEdit:(i,a)=>{n.startTiptapEdit(i,a,[],0)},stopTiptapEdit:()=>{n.stopTiptapEdit()},sendPageData:()=>{b(n.editablePageData.value)},sendCommonPartsData:()=>{r("update:commonParts",n.localCommonParts.value)},sendIndividualPartsData:()=>{r("update:individualParts",n.localIndividualParts.value)},addArrayItem:(i,a)=>{s.component.addArrayItem(i,a),b(n.editablePageData.value)},removeArrayItem:(i,a,l)=>{s.component.removeArrayItem(i,a,l),b(n.editablePageData.value)},resetPageData:()=>{n.editablePageData.value=Array.isArray(t.page)?[...t.page]:[],r("update:page",n.editablePageData.value)},resetPartsData:()=>{n.localParts.value=Array.isArray(t.parts)?[...t.parts]:[],r("update:parts",n.localParts.value)}},v={currentComponent:e.computed(()=>n.selectedComponent.value),currentTemplate:e.computed(()=>{const i=n.selectedComponent.value;return i?s.template.getTemplate(i.type,i.module_name,n.localParts.value):""}),currentFields:e.computed(()=>{const i=v.currentTemplate.value;return s.template.extractFields(i)}),currentSlots:e.computed(()=>{const i=v.currentTemplate.value;return s.template.extractSlots(i)}),renderComponent:i=>f.renderComponentWithoutSlot(i,(a,l)=>s.template.getTemplate(a,l,n.localParts.value)),renderPartPreview:i=>{if(!i)return"";try{let a=i;return a=a.replace(/\{\$([^:]+):([^}]*)\}/g,(l,p,z)=>z&&z.trim()?z:{title:"サンプルタイトル",text:"サンプルテキスト",content:"サンプルコンテンツ",heading:"見出し",description:"説明文",label:"ラベル",source:"情報源",tooltip:"ツールチップ"}[p]||`[${p}]`),a=a.replace(/\(\$([^:]+):([^)]+)\)/g,(l,p,z)=>z.split("|").filter(_=>_.trim())[0]||""),a=a.replace(/\(\$([^:?]+)\?:([^)]*)\)/g,(l,p,z)=>z||""),a=a.replace(/z-slot="[^"]*"/g,""),a=a.replace(/z-for="[^"]*"/g,""),a=a.replace(/z-for-wrapper="[^"]*"/g,""),a}catch(a){return d.error("プレビューレンダリングエラー:",a),i}}},S=()=>{o.on("addArrayItem",({componentId:i,arrayKey:a})=>{try{if(d.debug(`EventBus: addArrayItem - componentId=${i}, arrayKey=${a}`),!i||!a)throw new Error("componentId または arrayKey が指定されていません");const l=h(n.editablePageData.value,i);if(!l)throw new Error(`Component not found: ${i}`);d.success(`Component found: ${l.id}, adding array item to ${a}`);const p=n.localParts.value&&n.localParts.value.length>0?n.localParts.value:[];p.length>0?ao(p).addArrayItem(l,a):k.addArrayItem(l,a),r("update:page",n.editablePageData.value)}catch(l){d.error(`配列アイテム追加エラー: ${l}`,{componentId:i,arrayKey:a})}}),o.on("removeZForArrayItem",({componentId:i,arrayName:a,index:l})=>{try{d.debug(`EventBus: removeZForArrayItem - componentId=${i}, arrayName=${a}, index=${l}`),d.debug("🔥 DELETE - componentId:",i);const p=i.split("_");d.debug("🔥 DELETE - componentId parts:",p);let z;const E=h(n.editablePageData.value,i),_=E&&E.id===i;if(p.length>=3&&/^\d+$/.test(p[p.length-1])&&!_){const c=p.slice(0,-2).join("_"),u=p[p.length-2],m=p[p.length-1];d.debug("🔥 DELETE - ネスト形式検出:",{baseParentId:c,parentArrayName:u,parentIndex:m}),d.debug("ネストz-forアイテム削除:",{baseParentId:c,parentArrayName:u,parentIndex:m});let g=c,$=u;if(!h(n.editablePageData.value,c)){const I=[];for(let T=0;T<c.length;T++)c[T]==="_"&&I.push(T);if(I.length>=1){const T=I[I.length-1];g=c.substring(0,T),$=`${c.substring(T+1)}_${u}`,d.debug("🔥 DELETE - ネストz-for IDを修正:",{originalBaseParentId:c,realComponentId:g,realArrayPath:$,parentIndex:m})}}const P=h(n.editablePageData.value,g);if(P&&Array.isArray(P[$])){const I=P[$][parseInt(m)];d.debug("🔥 DELETE - Parent item:",I),d.debug("🔥 DELETE - Parent item target array name:",a),d.debug("🔥 DELETE - Parent item target array:",I?I[a]:void 0),I&&Array.isArray(I[a])&&(z=I[a])}}else{d.debug("🔥 DELETE - 通常形式検出:",i);const c=E||h(n.editablePageData.value,i);c&&Array.isArray(c[a])&&(z=c[a])}if(!z||l<0||l>=z.length)throw new Error(`Invalid target array or index: ${a}[${l}]`);z.splice(l,1),d.success(`z-for配列アイテム削除完了: ${a}[${l}]`),r("update:page",n.editablePageData.value)}catch(p){d.error(`z-for配列アイテム削除エラー: ${p}`,{componentId:i,arrayName:a,index:l})}}),o.on("editZForArrayItem",({componentId:i,arrayName:a,index:l})=>{try{d.debug(`EventBus: editZForArrayItem - componentId=${i}, arrayName=${a}, index=${l}`),d.debug("🔥 EDIT - componentId:",i);const p=i.split("_");d.debug("🔥 REORDER - componentId parts:",p);let z;const E=h(n.editablePageData.value,i),_=E&&E.id===i;if(p.length>=3&&/^\d+$/.test(p[p.length-1])&&!_){const c=p.slice(0,-2).join("_"),u=p[p.length-2],m=p[p.length-1];d.debug("🔥 REORDER - ネスト形式検出:",{baseParentId:c,parentArrayName:u,parentIndex:m}),d.debug("ネストz-forアイテム並び替え:",{baseParentId:c,parentArrayName:u,parentIndex:m});let g=c,$=u;if(!h(n.editablePageData.value,c)){const I=[];for(let T=0;T<c.length;T++)c[T]==="_"&&I.push(T);if(I.length>=1){const T=I[I.length-1];g=c.substring(0,T),$=`${c.substring(T+1)}_${u}`,d.debug("🔥 REORDER - ネストz-for IDを修正:",{originalBaseParentId:c,realComponentId:g,realArrayPath:$,parentIndex:m})}}const P=h(n.editablePageData.value,g);if(d.debug("🔥 Parent component found:",P?P.id:null),P&&Array.isArray(P[$])){const I=P[$][parseInt(m)];d.debug("🔥 Parent item:",I),d.debug("🔥 Parent item target array name:",a),d.debug("🔥 Parent item target array:",I?I[a]:void 0),I&&Array.isArray(I[a])&&(z=I[a])}}else{d.debug("🔥 REORDER - 通常形式検出:",i);const c=E||h(n.editablePageData.value,i);c&&Array.isArray(c[a])&&(z=c[a])}if(z&&l>=0&&l<z.length){const c=z[l];d.info(`z-for配列アイテム編集開始: ${i}.${a}[${l}]`,c)}else throw d.error("🔥 Invalid array or index:",{arrayName:a,index:l,arrayLength:z?.length}),new Error(`Invalid array or index: ${a}[${l}]`)}catch(p){d.error(`z-for配列アイテム編集エラー: ${p}`,{componentId:i,arrayName:a,index:l})}}),o.on("editZForArrayItem",({componentId:i,arrayName:a,index:l})=>{try{d.debug(`EventBus: editZForArrayItem - componentId=${i}, arrayName=${a}, index=${l}`);const p=h(n.editablePageData.value,i),z=a,E=l;if(!p){const g=i.split("_");d.debug("🔥 EDIT - componentId parts:",g);const $=h(n.editablePageData.value,i),C=$&&$.id===i;if(g.length>=3&&/^\d+$/.test(g[g.length-1])&&!C){const P=g.slice(0,-2).join("_"),I=g[g.length-2],T=g[g.length-1];d.debug("🔥 EDIT - ネスト形式検出:",{baseParentId:P,parentArrayName:I,parentIndex:T}),d.debug("ネストz-forアイテム編集:",{baseParentId:P,parentArrayName:I,parentIndex:T});let V=P,L=I;if(!h(n.editablePageData.value,P)){const O=[];for(let J=0;J<P.length;J++)P[J]==="_"&&O.push(J);if(O.length>=1){const J=O[O.length-1];V=P.substring(0,J),L=`${P.substring(J+1)}_${I}`,d.debug("🔥 EDIT - ネストz-for IDを修正:",{originalBaseParentId:P,realComponentId:V,realArrayPath:L,parentIndex:T})}}const M=h(n.editablePageData.value,V);if(M){const O=M[L];if(Array.isArray(O)&&Number(T)<O.length){const J=O[Number(T)];if(J[a]){const Y=J[a];if(Array.isArray(Y)&&l<Y.length){const re=Y[l];re._isZForItem=!0,re._arrayName=a,re._arrayIndex=l,re._parentType=M.type,re._parentModuleName=M.module_name,re._parentComponentId=P,re._parentArrayName=I,re._parentIndex=Number(T);const de=re.type,me=re.module_name;re.type="z-for-item",re.module_name=M.module_name,d.debug("子z-for配列アイテム編集:",{parentComponent:M.id,parentArrayName:I,parentIndex:Number(T),childArrayName:a,childIndex:l,childItem:re}),n.openEditor(re,`${i}_${a}_${l}`),A(re,`${i}_${a}_${l}`);return}}}}}}if(!p)throw new Error(`Component not found: ${i}`);const _=p,c=_[a];if(!Array.isArray(c)||l<0||l>=c.length)throw new Error(`Invalid array or index: ${a}[${l}]`);const u=c[l];d.debug("🔍 z-for配列アイテム詳細:",{componentId:i,arrayName:a,index:l,item:u,itemKeys:Object.keys(u),itemType:u.type,itemModuleName:u.module_name,itemId:u.id,parentType:_.type,parentModuleName:_.module_name});const m={...u,id:`${i}_${a}_${l}`,type:u.type||_.type,module_name:u.module_name||_.module_name,_isZForItem:!0,_parentComponentId:i,_arrayName:a,_arrayIndex:l,_zForTemplate:null};d.debug("🔍 作成されたtempComponent:",{tempComponentId:m.id,tempComponentType:m.type,tempComponentModuleName:m.module_name,allKeys:Object.keys(m)}),d.debug("z-for配列アイテム編集: コンポーネント検索結果",{componentId:i,componentFound:!!_,componentType:_.type,componentModuleName:_.module_name,arrayName:a,arrayLength:c.length,index:l,itemKeys:Object.keys(u),tempComponentId:m.id}),n.openEditor(m,`${i}_${a}_${l}`),d.success(`z-for配列アイテム編集開始: ${a}[${l}]`)}catch(p){d.error(`z-for配列アイテム編集エラー: ${p}`,{componentId:i,arrayName:a,index:l})}}),o.on("deleteNestedPart",({pathString:i})=>{d.debug(`EventBus: deleteNestedPart - path=${i}`),k.deleteNestedPart(i)}),o.on("openNestedEditor",({pathString:i})=>{if(d.debug(`EventBus: openNestedEditor - path=${i}`),!i||typeof i!="string"){d.error("Invalid pathString:",i);return}const a=/^(.+)\.(.+)\[(\d+)\]\.(.+)\[(\d+)\]$/,l=i.match(a);let p=null;if(l){const[,z,E,_,c,u]=l;d.debug("z-for内パス解析:",{parentId:z,arrayName:E,arrayIndex:_,slotName:c,partIndex:u});const m=h(n.editablePageData.value,z);if(m&&m[E]&&Array.isArray(m[E])){const g=m[E][parseInt(_)];g&&g[c]&&Array.isArray(g[c])&&(p=g[c][parseInt(u)],d.debug("z-for内ネストパーツを発見:",p))}}else p=h(n.editablePageData.value,i);p?(d.debug("Found component:",{id:p.id,type:p.type,module:p.module_name}),n.openEditor(p,i)):d.error(`Component not found with ID: ${i}`)}),o.on("openNestedPartSelector",({pathString:i,position:a})=>{d.debug(`EventBus: openNestedPartSelector - path=${i}, position=${a}`),n.openNestedPartSelector(i,a)})},B=i=>{["startTiptapEdit","stopTiptapEdit","openPartSelector","openNestedPartSelector","openNestedEditor","deleteNestedPart","addArrayItem","addZForArrayItem","removeZForArrayItem","reorderZForArrayItem","editZForArrayItem","handleZForDragStart","handleZForDragEnd","handleZForArrayItemDragOver","handleZForArrayItemDrop"].forEach(_=>{delete window[_]});const l=`inst_${Math.random().toString(36).substr(2,9)}`,p={addArrayItem:(_,c)=>{o.emit("addArrayItem",{componentId:_,arrayKey:c})},addZForArrayItem:(_,c,u)=>{o.emit("addZForArrayItem",{componentId:_,arrayName:c,insertIndex:u})},removeZForArrayItem:(_,c,u)=>{o.emit("removeZForArrayItem",{componentId:_,arrayName:c,index:u})},reorderZForArrayItem:(_,c,u,m)=>{o.emit("reorderZForArrayItem",{componentId:_,arrayName:c,fromIndex:u,toIndex:m})},editZForArrayItem:(_,c,u)=>{o.emit("editZForArrayItem",{componentId:_,arrayName:c,index:u})},deleteNestedPart:_=>{o.emit("deleteNestedPart",{pathString:_})},openNestedEditor:_=>{o.emit("openNestedEditor",{pathString:_})},openNestedPartSelector:(_,c)=>{o.emit("openNestedPartSelector",{pathString:_,position:c})}};window[`startTiptapEdit_${l}`]=i||k.startSimpleTiptapEdit,window[`stopTiptapEdit_${l}`]=k.stopTiptapEdit,window[`openPartSelector_${l}`]=_=>n.openPartSelector(_),window[`openNestedPartSelector_${l}`]=p.openNestedPartSelector,window[`openNestedEditor_${l}`]=p.openNestedEditor,window[`deleteNestedPart_${l}`]=p.deleteNestedPart,window[`addArrayItem_${l}`]=p.addArrayItem,window.startTiptapEdit=i||k.startSimpleTiptapEdit,window.stopTiptapEdit=k.stopTiptapEdit,window.openPartSelector=_=>n.openPartSelector(_),window.openNestedPartSelector=p.openNestedPartSelector,window.openNestedEditor=p.openNestedEditor,window.deleteNestedPart=p.deleteNestedPart,window.addArrayItem=p.addArrayItem,window.addZForArrayItem=p.addZForArrayItem,window.removeZForArrayItem=p.removeZForArrayItem,window.reorderZForArrayItem=p.reorderZForArrayItem,window.editZForArrayItem=p.editZForArrayItem;let z=null,E=null;window.handleZForDragStart=(_,c,u,m)=>{const g=_.target;if(d.debug("🔥 z-for drag start called",{target:g,componentId:c,arrayName:u,index:m}),g.tagName==="BUTTON"||g.tagName==="A"||g.closest("button, a")){d.debug("🔥 z-for: クリック可能要素からのドラッグをブロック"),_.preventDefault();return}_.stopPropagation(),z={componentId:c,arrayName:u,index:m},d.debug("🔥 z-for dragged item set:",z);const $=g.closest(".zero-code-z-for-item-wrapper");$?(d.debug("🔥 z-for item wrapper found:",$),$.style.opacity="0.5",$.style.transform="scale(0.95)",$.classList.add("dragging")):(d.debug("🔥 z-for item wrapper not found, using target"),g.style.opacity="0.5"),_.dataTransfer.effectAllowed="move",_.dataTransfer.setData("text/html",g.outerHTML),d.debug("z-for drag start",{componentId:c,arrayName:u,index:m})},window.handleZForDragEnd=_=>{const c=_.target,u=c.closest(".zero-code-z-for-item-wrapper");u?(u.style.opacity="1",u.style.transform="scale(1)",u.classList.remove("dragging")):c.style.opacity="1",document.querySelectorAll(".z-for-item-wrapper.drag-over").forEach(m=>{m.classList.remove("drag-over")}),setTimeout(()=>{z=null,d.debug("z-for drag end - draggedItem reset")},50),d.debug("z-for drag end")},window.handleZForArrayItemDragOver=_=>{_.preventDefault(),_.dataTransfer.dropEffect="move";const u=_.currentTarget.closest(".zero-code-z-for-item-wrapper");u&&!u.classList.contains("dragging")&&(document.querySelectorAll(".z-for-item-wrapper.drag-over").forEach(m=>{m.classList.remove("drag-over")}),u.classList.add("drag-over"))},window.handleZForArrayItemDrop=_=>{_.preventDefault(),_.stopPropagation();const c=_.currentTarget;d.debug("🔥 handleZForArrayItemDrop called",{target:c,draggedItem:z});const u=c.closest(".zero-code-z-for-item-wrapper");if(u&&u.classList.remove("drag-over"),!z){d.error("🔥 No dragged item found in drop handler"),d.warn("No dragged item found");return}d.debug("🔥 Dragged item found:",z);const m=u?.getAttribute("data-component-id")||c.getAttribute("data-component-id"),g=u?.getAttribute("data-array-name")||c.getAttribute("data-array-name"),$=u?.getAttribute("data-item-index")||c.getAttribute("data-item-index"),C=parseInt($||"0");z.componentId===m&&z.arrayName===g&&z.index!==C&&(d.debug("🔥 z-for reorder executing:",{componentId:z.componentId,arrayName:z.arrayName,fromIndex:z.index,toIndex:C}),dc.reorderZForArrayItem(z.componentId,z.arrayName,z.index,C),d.debug("🔥 z-for reorder completed"),d.success("z-for array item reordered",{from:z.index,to:C})),z=null},window.handleNestedPartDragStart=_=>{d.debug("🔥 handleNestedPartDragStart called",_.target);const c=_.target;if(c.tagName==="BUTTON"||c.tagName==="A"||c.closest("button, a")){d.debug("🔥 クリック可能要素からのドラッグをブロック"),_.preventDefault();return}const u=c.closest(".z-for-nested-part");if(u){const m=u.getAttribute("data-nested-path"),g=u.getAttribute("data-slot-name"),$=u.getAttribute("data-part-index");d.debug("🔥 z-forネストパーツドラッグ情報:",{nestedPath:m,slotName:g,partIndex:$}),m&&g&&$!==null&&(E={path:m,slotName:g,index:parseInt($)},u.classList.add("dragging"),u.style.opacity="0.5",d.debug("🔥 draggingクラス追加:",u),_.dataTransfer.effectAllowed="move",_.dataTransfer.setData("text/html",u.outerHTML),d.debug("🔥 z-for nested part drag start",E),d.debug("z-for nested part drag start",E))}else d.debug("🔥 z-for内ネストパーツではない:",c.classList.toString())},window.handleNestedPartDragEnd=_=>{const u=_.target.closest(".z-for-nested-part");u&&(u.classList.remove("dragging"),u.style.opacity="1"),document.querySelectorAll(".z-for-nested-part.drag-over").forEach(m=>{m.classList.remove("drag-over")}),E=null,d.debug("z-for nested part drag end")},window.handleNestedPartDragOver=_=>{_.preventDefault(),_.dataTransfer.dropEffect="move";const u=_.currentTarget.closest(".z-for-nested-part");u&&!u.classList.contains("dragging")&&(document.querySelectorAll(".z-for-nested-part.drag-over").forEach(m=>{m.classList.remove("drag-over")}),u.classList.add("drag-over"))},window.handleNestedPartDrop=_=>{d.debug("🔥 handleNestedPartDrop called",_.currentTarget),_.preventDefault();const c=_.currentTarget,u=c.closest(".z-for-nested-part")||c.closest(".nested-component");if(u&&u.classList.remove("drag-over"),!E){d.debug("🔥 No dragged nested part found"),d.warn("No dragged nested part found");return}const m=c.getAttribute("data-slot-name"),g=c.getAttribute("data-part-index");if(d.debug("🔥 ドロップ先情報:",{dropSlotName:m,dropPartIndex:g,draggedNestedPart:E}),m&&g!==null){const $=parseInt(g);if(m===E.slotName){const C=E.path.match(/^(.+\.\w+\[\d+\]\.\w+)\[\d+\]$/);if(d.debug("🔥 パス解析:",{path:E.path,pathMatch:C}),C){const P=C[1];d.debug("🔥 並べ替え実行:",{parentPath:P,fromIndex:E.index,toIndex:$}),d.debug("z-for nested part reorder",{parentPath:P,fromIndex:E.index,toIndex:$}),k.moveZForNestedPart(P,E.index,$)}}else d.debug("🔥 異なるスロット間の移動は未サポート:",{dropSlotName:m,draggedSlotName:E.slotName})}else d.debug("🔥 ドロップ先の情報が不完全:",{dropSlotName:m,dropPartIndex:g});E=null},d.debug("グローバル関数を安全に公開完了")},D=()=>{d.debug("useZeroCode クリーンアップ実行")};return{state:{editablePageData:n.editablePageData,localParts:n.localParts,localCommonParts:n.localCommonParts,localIndividualParts:n.localIndividualParts,activeTab:n.activeTab,dataTab:n.dataTab,showEditor:n.showEditor,showPartSelector:n.showPartSelector,showNestedPartSelector:n.showNestedPartSelector,selectedComponent:n.selectedComponent,selectedComponentIndex:n.selectedComponentIndex,editingText:n.editingText,insertPosition:n.insertPosition,nestedInsertPath:n.nestedInsertPath,nestedInsertPosition:n.nestedInsertPosition},computed:{currentComponentIndex:n.currentComponentIndex,pageDataLength:n.pageDataLength,hasSelectedComponent:n.hasSelectedComponent,isEditing:n.isEditing,isTiptapEditing:n.isTiptapEditing,...v},actions:k,utils:s,templateProcessor:f,simpleEditor:y,switchToTab:n.switchToTab,setDataTab:n.setDataTab,openEditor:n.openEditor,closeEditor:n.closeEditor,openPartSelector:n.openPartSelector,closePartSelector:n.closePartSelector,openNestedPartSelector:n.openNestedPartSelector,closeNestedPartSelector:n.closeNestedPartSelector,setupEventListeners:S,exposeGlobalFunctions:B,cleanup:D}}const Tr={parts:{common:[{type:"title",description:"タイトル系のコンポーネント",module:[{title:"title_1_1",category:"common",description:"メインタイトル（z-for、z-slot対応版）",tags:["title","z-for","z-slot","nested"],body:`
<div class="m_titleA ($state:s_state1|s_state2) ($variant:s_state3|s_state4|)">
  <h1 class="m_titleA__title">{$title:メインタイトルテキスト}</h1>
  <div class="m_titleA__label ($label_state?:s_state5|s_state6|s_state7)">{$label:ラベルテキスト}</div>
  <div z-slot="nested_parts" class="m_titleA__contents"></div>
  <div><img src="($image_url:/img/hero_image.jpg)" alt="($image_alt:画像の説明テキスト)"></div>
  <div class="m_titleA__card" z-for-wrapper="cards">
    <div z-for="cards" class="m_titleA__cardList ($card_state:s_state1|s_state2)">
      <div>{$card_title:カードアイテム1}</div>
      <div>{$card_desc:カードアイテム2}</div>
      <div z-slot="nested_parts"></div>
    </div>
  </div>
  <div class="m_titleA__category ($category:news,blog,event,product,service)">
    <span>カテゴリ選択</span>
  </div>
  <div class="m_titleA__tags ($tags?:important,featured,popular,trending,new)">
    <span>タグ選択（複数）</span>
  </div>
</div>`},{title:"title_1_2",category:"common",description:"シンプルタイトル",tags:["title","simple"],body:`
<div class="m_titleB">
  <h2 class="m_titleB__title">{$title:サブタイトルテキスト}</h2>
  <p class="m_titleB__subtitle">{$subtitle:サブタイトル説明文}</p>
</div>`}]},{type:"hero",description:"ヒーロー系のコンポーネント",module:[{title:"hero_1_1",category:"common",description:"メインヒーロー（配列カード対応）",tags:["hero","z-for","cards"],body:`
<div class="m_heroA ($layout:full|contained) ($theme:light|dark)">
  <div class="m_heroA__background">
    <img src="($bg_image:/img/hero_image.jpg)" alt="($bg_alt:ヒーロー背景画像)">
  </div>
  <div class="m_heroA__content">
    <h1 class="m_heroA__title">{$title:ヒーローメインタイトル}</h1>
    <p class="m_heroA__description">{$description:ヒーロー説明文がここに入ります}</p>
    <div class="m_heroA__actions">
      <a href="($cta_url:#)" class="m_heroA__cta ($cta_style:primary|secondary)">{$cta_text:今すぐ始める}</a>
    </div>
  </div>
  <div class="m_heroA__features" z-for-wrapper="features">
    <div z-for="features" class="m_heroA__feature">
      <div class="m_heroA__feature-icon">
        <img src="($icon_url:/img/placeholder.jpg)" alt="($icon_alt:アイコン)">
      </div>
      <h3>{$feature_title:機能タイトル}</h3>
      <p>{$feature_description:機能の説明文}</p>
    </div>
  </div>
</div>`}]},{type:"content",description:"コンテンツ系のコンポーネント",module:[{title:"content_1_1",category:"common",description:"基本コンテンツブロック",tags:["content","text","simple"],body:`
<div class="m_contentA ($alignment:left|center|right) ($size:small|medium|large)">
  <div class="m_contentA__header">
    <h2 class="m_contentA__title">{$title:コンテンツタイトル}</h2>
    <p class="m_contentA__subtitle">{$subtitle:サブタイトル}</p>
  </div>
  <div class="m_contentA__body">
    <p class="m_contentA__text">{$content:ここにメインコンテンツが入ります。リッチテキスト編集に対応しています。}</p>
    <div class="m_contentA__image ($image_position:top|bottom|left|right)">
      <img src="($image_url:/img/placeholder.jpg)" alt="($image_alt:コンテンツ画像)">
    </div>
  </div>
  <div z-slot="nested_parts" class="m_contentA__nested"></div>
</div>`}]}],individual:[{type:"button",description:"ボタン系のコンポーネント",module:[{title:"button_1_1",category:"individual",description:"基本ボタン",tags:["button","cta","action"],body:`
<div class="m_buttonA">
  <a href="($url:#)" class="m_buttonA__link ($style:primary|secondary|outline) ($size:small|medium|large)">
    {$text:ボタンテキスト}
  </a>
</div>`},{title:"button_1_2",category:"individual",description:"アイコン付きボタン",tags:["button","icon","cta"],body:`
<div class="m_buttonB">
  <button class="m_buttonB__button ($variant:filled|outline|text) ($color:primary|secondary|success|warning|error)">
    <span class="m_buttonB__icon ($icon_position:left|right)">
      <img src="($icon_url:/img/placeholder.jpg)" alt="($icon_alt:アイコン)">
    </span>
    <span class="m_buttonB__text">{$text:アイコンボタン}</span>
  </button>
</div>`}]},{type:"card",description:"カード系のコンポーネント",module:[{title:"card_1_1",category:"individual",description:"基本カード（配列対応）",tags:["card","z-for","list"],body:`
<div class="m_cardA ($layout:grid|list) ($columns:1|2|3|4)">
  <div class="m_cardA__container" z-for-wrapper="items">
    <div z-for="items" class="m_cardA__item ($card_style:flat|elevated|outline)">
      <div class="m_cardA__image">
        <img src="($image_url:/img/placeholder.jpg)" alt="($image_alt:カード画像)">
      </div>
      <div class="m_cardA__content">
        <h3 class="m_cardA__title">{$title:カードタイトル}</h3>
        <p class="m_cardA__description">{$description:カードの説明文がここに入ります}</p>
        <div class="m_cardA__meta">
          <span class="m_cardA__category ($category:news|blog|product)">{$category_label:カテゴリ}</span>
          <time class="m_cardA__date">{$date:2024-01-01}</time>
        </div>
      </div>
      <div class="m_cardA__actions">
        <a href="($link_url:#)" class="m_cardA__link">{$link_text:詳細を見る}</a>
      </div>
    </div>
  </div>
</div>`}]},{type:"form",description:"フォーム系のコンポーネント",module:[{title:"form_1_1",category:"individual",description:"基本フォーム",tags:["form","contact","input"],body:`
<div class="m_formA ($layout:vertical|horizontal) ($style:modern|classic)">
  <form class="m_formA__form">
    <div class="m_formA__header">
      <h2 class="m_formA__title">{$title:お問い合わせフォーム}</h2>
      <p class="m_formA__description">{$description:ご質問やお問い合わせがございましたら、以下のフォームよりお送りください。}</p>
    </div>
    <div class="m_formA__fields" z-for-wrapper="fields">
      <div z-for="fields" class="m_formA__field ($field_type:text|email|tel|textarea|select)">
        <label class="m_formA__label">{$label:フィールドラベル}</label>
        <input type="($input_type:text|email|tel)" class="m_formA__input ($required?:required)" placeholder="($placeholder:入力してください)">
        <span class="m_formA__help">{$help_text:補助テキスト}</span>
      </div>
    </div>
    <div class="m_formA__actions">
      <button type="submit" class="m_formA__submit ($submit_style:primary|secondary)">{$submit_text:送信する}</button>
    </div>
  </form>
</div>`}]}]},pages:[{id:"default-page",title:"デフォルトページ",description:"Vue CMS エディターのサンプルページ",components:[{id:"hero-1",type:"hero",module_name:"hero_1_1",title:"Vue CMS エディターへようこそ",description:"直感的で強力なコンテンツ管理システムです。ドラッグ&ドロップでページを作成し、リアルタイムでプレビューできます。",bg_image:"/img/hero_image.jpg",bg_alt:"Vue CMS ヒーロー画像",layout:"full",theme:"light",cta_text:"今すぐ始める",cta_url:"#get-started",cta_style:"primary",features:[{id:"feature-1",feature_title:"簡単操作",feature_description:"ドラッグ&ドロップで直感的にページを作成",icon_url:"/img/placeholder.jpg",icon_alt:"簡単操作アイコン"},{id:"feature-2",feature_title:"リアルタイムプレビュー",feature_description:"編集内容をリアルタイムで確認できます",icon_url:"/img/placeholder.jpg",icon_alt:"プレビューアイコン"},{id:"feature-3",feature_title:"Web Components",feature_description:"どこでも使える再利用可能なコンポーネント",icon_url:"/img/placeholder.jpg",icon_alt:"コンポーネントアイコン"}]},{id:"title-1",type:"title",module_name:"title_1_1",title:"主な機能",label:"Features",state:"s_state1",variant:"s_state3",label_state:["s_state5","s_state6"],image_url:"/img/banner.jpg",image_alt:"機能紹介画像",category:"product",tags:["featured","popular"],cards:[{id:"card-1",card_title:"テンプレート記法",card_desc:"{$param:default} 形式でテキストを編集",card_state:"s_state1"},{id:"card-2",card_title:"選択記法",card_desc:"($param:option1|option2) 形式で選択肢を提供",card_state:"s_state2"},{id:"card-3",card_title:"配列記法",card_desc:"z-for で繰り返し要素を管理",card_state:"s_state1"}],nested_parts:[{id:"content-1",type:"content",module_name:"content_1_1",title:"ネストされたコンテンツ",subtitle:"z-slot 機能のデモンストレーション",content:"このコンテンツは title コンポーネントの中にネストされています。z-slot 記法を使用することで、柔軟な構造を作ることができます。",alignment:"center",size:"medium",image_url:"/img/team.jpg",image_alt:"チーム画像",image_position:"right"}]},{id:"card-section-1",type:"card",module_name:"card_1_1",layout:"grid",columns:"3",items:[{id:"item-1",title:"はじめての方へ",description:"Vue CMS エディターの基本的な使い方を学びましょう",image_url:"/img/product1.jpg",image_alt:"チュートリアル画像",category:"blog",category_label:"ブログ",date:"2024-01-15",link_text:"チュートリアルを見る",link_url:"/tutorial",card_style:"elevated"},{id:"item-2",title:"アドバンス機能",description:"上級者向けの機能と使用方法について詳しく解説",image_url:"/img/background.jpg",image_alt:"アドバンス機能画像",category:"product",category_label:"製品",date:"2024-01-20",link_text:"詳細を見る",link_url:"/advanced",card_style:"elevated"},{id:"item-3",title:"コミュニティ",description:"ユーザーコミュニティに参加して情報交換をしましょう",image_url:"/img/logo.png",image_alt:"コミュニティ画像",category:"news",category_label:"ニュース",date:"2024-01-25",link_text:"参加する",link_url:"/community",card_style:"elevated"}]}]}],images:{common:[{id:"hero-bg",name:"hero_image.jpg",url:"/img/hero_image.jpg",alt:"ヒーロー背景画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:256e3}},{id:"logo",name:"logo.png",url:"/img/logo.png",alt:"Vue CMS ロゴ",category:"common",fileData:{base64:"",type:"image/png",size:48e3}},{id:"banner",name:"banner.jpg",url:"/img/banner.jpg",alt:"バナー画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:128e3}},{id:"background",name:"background.jpg",url:"/img/background.jpg",alt:"背景画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:512e3}},{id:"team",name:"team.jpg",url:"/img/team.jpg",alt:"チーム画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:196e3}},{id:"placeholder",name:"placeholder.jpg",url:"/img/placeholder.jpg",alt:"プレースホルダー画像",category:"common",fileData:{base64:"",type:"image/jpeg",size:32e3}}],individual:[{id:"product-1",name:"product1.jpg",url:"/img/product1.jpg",alt:"製品画像1",category:"individual",fileData:{base64:"",type:"image/jpeg",size:86e3}}]}},Vr=[{type:"basic_list",description:"基本的なz-for内z-slotパターン",module:[{title:"item",category:"test",body:`
          <div class="category-item">
            <h3>{$title:アイテムタイトル}</h3>
            <p>{$description:アイテムの説明}</p>
            <div z-for="items" class="($item_class:item-wrapper|highlight-item|normal-item)">
              <div class="product-card">
                <h4>{$name:商品名}</h4>
                <p>{$price:価格}</p>
                <div class="slot-content" z-slot="details">
                  <!-- 商品詳細スロット -->
                </div>
              </div>
            </div>
          </div>
        `,description:"基本的なリストアイテムパーツ",tags:["z-for","z-slot","basic"]}]},{type:"nested_list",description:"ネストしたz-for内z-slotパターン",module:[{title:"category",category:"test",body:`
          <div class="nested-list">
            <h2>{$category_name:カテゴリー名}</h2>
            <div z-for="categories" class="category-wrapper">
              <h3>{$cat_title:サブカテゴリー}</h3>
              <div z-for="products" class="product-list">
                <div class="product-card">
                  <h4>{$product_name:商品名}</h4>
                  <span>{$product_price:価格}</span>
                  <div class="slot-content" z-slot="product_details">
                    <!-- 商品詳細スロット -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,description:"ネストしたカテゴリーパーツ",tags:["z-for","z-slot","nested"]}]},{type:"multi_slot",description:"複数スロットパターン",module:[{title:"container",category:"test",body:`
          <div class="multi-slot-container">
            <h2>{$container_title:コンテナタイトル}</h2>
            <div z-for="sections" class="section-item">
              <div class="section-header">
                <h3>{$section_title:セクションタイトル}</h3>
                <div z-slot="header_parts" class="header-slot">
                  <!-- ヘッダースロット -->
                </div>
              </div>
              <div class="section-content">
                <p>{$section_content:セクション内容}</p>
                <div z-slot="content_parts" class="content-slot">
                  <!-- コンテンツスロット -->
                </div>
              </div>
              <div class="section-footer">
                <div z-slot="footer_parts" class="footer-slot">
                  <!-- フッタースロット -->
                </div>
              </div>
            </div>
          </div>
        `,description:"複数スロットコンテナパーツ",tags:["z-for","z-slot","multiple"]}]},{type:"conditional",description:"条件付きz-slotパターン",module:[{title:"faq",category:"test",body:`
          <div class="faq-container">
            <h2>{$faq_title:FAQタイトル}</h2>
            <div z-for="questions" class="faq-item">
              <h3>{$question:質問}</h3>
              <p>{$answer:回答}</p>
              <div z-if="has_details" class="details-section">
                <div z-slot="additional_info" class="slot-content">
                  <!-- 追加情報スロット（条件付き） -->
                </div>
              </div>
            </div>
          </div>
        `,description:"条件付きFAQパーツ",tags:["z-for","z-slot","conditional","z-if"]}]},{type:"empty",description:"空スロットパターン",module:[{title:"list",category:"test",body:`
          <div class="empty-slot-container">
            <h2>{$list_title:リストタイトル}</h2>
            <div z-for="empty_items" class="empty-item">
              <h3>{$item_title:アイテム}</h3>
              <div z-slot="empty_slot" class="slot-content">
                <!-- 初期状態で空のスロット -->
              </div>
            </div>
          </div>
        `,description:"空スロットリストパーツ",tags:["z-for","z-slot","empty"]}]},{type:"dynamic",description:"動的スロット名パターン",module:[{title:"mixed",category:"test",body:`
          <div class="dynamic-slot-container">
            <h2>{$container_title:動的スロットコンテナ}</h2>
            <div z-for="mixed_items" class="mixed-item">
              <h3>{$item_name:アイテム名} - Type: {$item_type:タイプ}</h3>
              <div z-if="type_a" z-slot="slot_type_a" class="slot-content">
                <!-- タイプAスロット -->
              </div>
              <div z-if="type_b" z-slot="slot_type_b" class="slot-content">
                <!-- タイプBスロット -->
              </div>
              <div z-if="type_c" z-slot="slot_type_c" class="slot-content">
                <!-- タイプCスロット -->
              </div>
            </div>
          </div>
        `,description:"動的スロットパーツ",tags:["z-for","z-slot","dynamic","conditional"]}]},{type:"parts",description:"テスト用共通パーツ",module:[{title:"text",category:"common",body:'<p class="text-part">{$text:テキストパーツ}</p>',description:"テキストパーツ",tags:["common","text"]},{title:"button",category:"common",body:'<button class="btn-part ($btn_style:primary|secondary|danger)">{$btn_text:ボタン}</button>',description:"ボタンパーツ",tags:["common","button"]},{title:"image",category:"common",body:'<img src="{$img_src:https://via.placeholder.com/150}" alt="{$img_alt:画像}" class="img-part">',description:"画像パーツ",tags:["common","image"]},{title:"link",category:"common",body:'<a href="{$link_url:#}" class="link-part">{$link_text:リンク}</a>',description:"リンクパーツ",tags:["common","link"]},{title:"badge",category:"common",body:'<span class="badge ($badge_color:blue|green|red|yellow)">{$badge_text:バッジ}</span>',description:"バッジパーツ",tags:["common","badge"]},{title:"card",category:"common",body:`
          <div class="card-part">
            <h4>{$card_title:カードタイトル}</h4>
            <p>{$card_content:カード内容}</p>
          </div>
        `,description:"カードパーツ",tags:["common","card"]}]}],mc=[{id:"zfor-zslot-tests",title:"z-for & z-slot テストページ",description:"z-for内でz-slotを使用する様々なパターンのテスト",components:[{id:"test_basic_zfor_zslot",type:"basic_list",module_name:"item",title:"基本リスト",description:"z-for内の各アイテムにz-slotがある基本パターン",item_class:"normal-item",items:[{id:"item_001",name:"アイテム1",price:"¥1,000",details:[{id:"detail_001",type:"parts",module_name:"text",text:"このアイテムの詳細説明です"},{id:"detail_002",type:"parts",module_name:"button",btn_text:"詳細を見る",btn_style:"primary"}]},{id:"item_002",name:"アイテム2",price:"¥2,000",details:[{id:"detail_003",type:"parts",module_name:"badge",badge_text:"新商品",badge_color:"green"}]},{id:"item_003",name:"アイテム3",price:"¥3,000",details:[]}]},{id:"test_nested_zfor_zslot",type:"nested_list",module_name:"category",category_name:"商品カタログ",categories:[{id:"cat_001",cat_title:"電化製品",products:[{id:"prod_001",product_name:"ノートPC",product_price:"¥98,000",product_details:[{id:"pd_001",type:"parts",module_name:"text",text:"高性能ノートパソコン"}]},{id:"prod_002",product_name:"タブレット",product_price:"¥45,000",product_details:[{id:"pd_002",type:"parts",module_name:"badge",badge_text:"セール中",badge_color:"red"}]}]},{id:"cat_002",cat_title:"家具",products:[{id:"prod_003",product_name:"デスク",product_price:"¥25,000",product_details:[]}]}]},{id:"test_multiple_zslot",type:"multi_slot",module_name:"container",container_title:"複数スロットテスト",sections:[{id:"sec_001",section_title:"セクション1",section_content:"これはセクション1の内容です",header_parts:[{id:"hp_001",type:"parts",module_name:"badge",badge_text:"ヘッダー",badge_color:"blue"}],content_parts:[{id:"cp_001",type:"parts",module_name:"text",text:"コンテンツエリアのテキスト"},{id:"cp_002",type:"parts",module_name:"button",btn_text:"アクション",btn_style:"secondary"}],footer_parts:[{id:"fp_001",type:"parts",module_name:"link",link_text:"フッターリンク",link_url:"#footer"}]},{id:"sec_002",section_title:"セクション2",section_content:"これはセクション2の内容です",header_parts:[],content_parts:[{id:"cp_003",type:"parts",module_name:"card",card_title:"カード",card_content:"カードコンテンツ"}],footer_parts:[]}]},{id:"test_conditional_zslot",type:"conditional",module_name:"faq",faq_title:"よくある質問",questions:[{id:"q_001",question:"配送料はいくらですか？",answer:"全国一律500円です。",has_details:!0,additional_info:[{id:"ai_001",type:"parts",module_name:"text",text:"10,000円以上のご購入で送料無料"},{id:"ai_002",type:"parts",module_name:"badge",badge_text:"期間限定",badge_color:"yellow"}]},{id:"q_002",question:"返品は可能ですか？",answer:"商品到着後7日以内であれば可能です。",has_details:!1,additional_info:[]},{id:"q_003",question:"支払い方法は？",answer:"クレジットカード、銀行振込、代金引換が利用可能です。",has_details:!0,additional_info:[{id:"ai_003",type:"parts",module_name:"link",link_text:"詳しい支払い方法",link_url:"#payment"}]}]},{id:"test_empty_zslot",type:"empty",module_name:"list",list_title:"空スロットテスト",empty_items:[{id:"empty_001",item_title:"空のアイテム1",empty_slot:[]},{id:"empty_002",item_title:"空のアイテム2",empty_slot:[]},{id:"empty_003",item_title:"空のアイテム3",empty_slot:[]}]},{id:"test_dynamic_zslot",type:"dynamic",module_name:"mixed",container_title:"動的スロットテスト",mixed_items:[{id:"mix_001",item_name:"タイプA アイテム",item_type:"A",type_a:!0,type_b:!1,type_c:!1,slot_type_a:[{id:"sta_001",type:"parts",module_name:"text",text:"タイプA専用コンテンツ"}],slot_type_b:[],slot_type_c:[]},{id:"mix_002",item_name:"タイプB アイテム",item_type:"B",type_a:!1,type_b:!0,type_c:!1,slot_type_a:[],slot_type_b:[{id:"stb_001",type:"parts",module_name:"button",btn_text:"タイプB ボタン",btn_style:"danger"}],slot_type_c:[]},{id:"mix_003",item_name:"タイプC アイテム",item_type:"C",type_a:!1,type_b:!1,type_c:!0,slot_type_a:[],slot_type_b:[],slot_type_c:[{id:"stc_001",type:"parts",module_name:"badge",badge_text:"タイプC",badge_color:"green"},{id:"stc_002",type:"parts",module_name:"link",link_text:"タイプCリンク",link_url:"#type-c"}]}]}]}],uc={parts:{common:Vr.filter(t=>t.type==="parts"||t.module.some(r=>r.category==="common")),individual:Vr.filter(t=>t.type!=="parts"&&!t.module.some(r=>r.category==="common"))},pages:mc,images:{common:[],individual:[]}},Br=e.ref({environment:"development",enableMockData:!0,defaultDataSet:"samples"}),ct=e.ref(Tr),To=e.ref(!1),Vo=e.ref(null);function gc(){const t=A=>{Br.value.environment=A,d.info(`🌍 データ環境を ${A} に設定しました`)},r=async(A="samples")=>{To.value=!0,Vo.value=null;try{if(A==="samples")ct.value=Tr;else if(A==="tests"||A==="zfor-zslot")ct.value=uc;else throw new Error(`未知のデータセット: ${A}`);return!0}catch(N){const w=N instanceof Error?N.message:"データ読み込みエラー";return Vo.value=w,d.error(`❌ データ読み込み失敗: ${w}`),!1}finally{To.value=!1}},o=e.computed(()=>ct.value.parts),n=e.computed(()=>ct.value.pages),s=e.computed(()=>ct.value.images),f=e.computed(()=>[...ct.value.parts.common,...ct.value.parts.individual]),y=e.computed(()=>ct.value.pages[0]?.components||[]),h=e.readonly({isLoading:To,loadError:Vo,config:e.readonly(Br)});return{parts:o,pages:n,images:s,combinedParts:f,defaultPageData:y,state:h,setEnvironment:t,loadData:r,initialize:async()=>{await r("samples")}}}const fc={class:"zero-code-tab-navigation"},hc=["onClick"],yc=e.defineComponent({__name:"TabNavigation",props:{activeTab:{type:String}},emits:["update:active-tab"],setup(t){const r=["editor","preview","parts","images"],o=n=>({editor:"エディタ",preview:"ページプレビュー",parts:"パーツ管理",images:"画像管理"})[n];return(n,s)=>(e.openBlock(),e.createElementBlock("div",fc,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(r,f=>e.createElementVNode("button",{key:f,class:e.normalizeClass(["zero-code-tab-button",{active:n.activeTab===f}]),onClick:y=>n.$emit("update:active-tab",f)},e.toDisplayString(o(f)),11,hc)),64))]))}});function bc(){const t=e.ref([]),r=e.computed(()=>t.value.length>0),o=(h,b=ue.UNKNOWN,A)=>{const N={id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:b,message:h instanceof Error?h.message:h,details:h instanceof Error?h.stack:void 0,timestamp:new Date,context:A};t.value.push(N),setTimeout(()=>{s(N.id)},1e4)},n=()=>{t.value=[]},s=h=>{const b=t.value.findIndex(A=>A.id===h);b!==-1&&t.value.splice(b,1)};return{errors:t,hasErrors:r,handleError:o,clearErrors:n,clearError:s,getErrorsByType:h=>t.value.filter(b=>b.type===h),showErrorNotification:(h,b=ue.UNKNOWN)=>{o(h,b)}}}const $c={class:"zero-code-error-boundary"},_c={key:0,class:"zero-code-error-notifications"},Ec={class:"zero-code-error-content"},zc={class:"zero-code-error-message"},wc={class:"zero-code-error-icon"},vc={class:"zero-code-error-text"},Cc=["onClick"],Ac={key:0,class:"zero-code-error-details"},Nc={class:"zero-code-error-details-pre"},kc={class:"zero-code-error-boundary-content"},Pc=e.defineComponent({__name:"ErrorBoundary",props:{showDetails:{type:Boolean,default:!1}},setup(t){const{errors:r,hasErrors:o,clearError:n}=bc(),s=y=>{switch(y){case ue.NETWORK_ERROR:return"error-network";case ue.VALIDATION_ERROR:return"error-validation";case ue.PERMISSION_ERROR:return"error-permission";case ue.COMPONENT_ERROR:return"error-component";case ue.IMAGE_LOAD_FAILED:return"error-image";case ue.TEMPLATE_PARSE_ERROR:return"error-template";default:return"error-unknown"}},f=y=>{switch(y){case ue.NETWORK_ERROR:return"🌐";case ue.VALIDATION_ERROR:return"⚠️";case ue.PERMISSION_ERROR:return"🔒";case ue.COMPONENT_ERROR:return"🧩";case ue.IMAGE_LOAD_FAILED:return"🖼️";case ue.TEMPLATE_PARSE_ERROR:return"📄";default:return"❌"}};return(y,h)=>(e.openBlock(),e.createElementBlock("div",$c,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",_c,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),b=>(e.openBlock(),e.createElementBlock("div",{key:b.id,class:e.normalizeClass(["zero-code-error-notification",s(b.type)])},[e.createElementVNode("div",Ec,[e.createElementVNode("div",zc,[e.createElementVNode("span",wc,e.toDisplayString(f(b.type)),1),e.createElementVNode("span",vc,e.toDisplayString(b.message),1)]),e.createElementVNode("button",{class:"zero-code-error-close",title:"エラーを閉じる",onClick:A=>e.unref(n)(b.id)}," × ",8,Cc)]),b.details&&y.showDetails?(e.openBlock(),e.createElementBlock("div",Ac,[e.createElementVNode("pre",Nc,e.toDisplayString(b.details),1)])):e.createCommentVNode("",!0)],2))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",kc,[e.renderSlot(y.$slots,"default")])]))}}),Dc={class:"zero-code-toolbar-content"},Ic={class:"zero-code-toolbar-section"},Sc={key:0,class:"zero-code-toolbar-separator"},Tc=["title","disabled","onClick"],Vc={class:"zero-code-toolbar-section"},Bc=e.defineComponent({__name:"RichTextToolbar",props:{show:{type:Boolean},position:{type:Object},actions:{type:Array},editingState:{type:null},isEditing:{type:Boolean}},emits:["executeCommand","save","cancel"],setup(t,{emit:r}){const o=t;e.onMounted(()=>{d.debug("🔧 RichTextToolbar mounted")}),e.watch(()=>o.show,h=>{d.debug("🔧 RichTextToolbar show changed:",h)},{immediate:!0}),e.watch(()=>o.position,h=>{d.debug("🔧 RichTextToolbar position changed:",h)},{deep:!0,immediate:!0}),e.watch(()=>o.actions,h=>{d.debug("🔧 RichTextToolbar actions changed:",h?.length||0)},{immediate:!0});const n=r,s=h=>{d.debug("🔧 ツールバーコマンド実行:",h),n("executeCommand",h)},f=()=>{n("save")},y=()=>{n("cancel")};return(h,b)=>h.show?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-rich-text-toolbar",style:e.normalizeStyle({top:h.position.top+"px",left:h.position.left+"px"})},[e.createElementVNode("div",Dc,[e.createElementVNode("div",Ic,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.actions,(A,N)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:N},[A&&A.name==="separator"?(e.openBlock(),e.createElementBlock("div",Sc)):A?(e.openBlock(),e.createElementBlock("button",{key:1,class:e.normalizeClass(["zero-code-toolbar-btn",{active:A.active,disabled:!h.isEditing}]),title:A.title||"",disabled:!h.isEditing,tabindex:"-1",onClick:w=>s(A.command||""),onMousedown:b[0]||(b[0]=e.withModifiers(()=>{},["prevent","stop"]))},e.toDisplayString(A.icon||""),43,Tc)):e.createCommentVNode("",!0)],64))),128))]),b[3]||(b[3]=e.createElementVNode("div",{class:"zero-code-toolbar-separator"},null,-1)),e.createElementVNode("div",Vc,[e.createElementVNode("button",{class:"zero-code-toolbar-btn zero-code-save-btn",title:"保存 (Ctrl+S)",tabindex:"-1",onClick:f,onMousedown:b[1]||(b[1]=e.withModifiers(()=>{},["prevent","stop"]))}," ✓ ",32),e.createElementVNode("button",{class:"zero-code-toolbar-btn zero-code-cancel-btn",title:"キャンセル (Esc)",tabindex:"-1",onClick:y,onMousedown:b[2]||(b[2]=e.withModifiers(()=>{},["prevent","stop"]))}," ✕ ",32)])])],4)):e.createCommentVNode("",!0)}}),Fc={class:"zero-code-tab-navigation"},Mc={class:"zero-code-search-section"},Lc={class:"zero-code-modal-body"},xc={key:0,class:"zero-code-empty-state"},Oc={key:1,class:"zero-code-image-grid"},Rc=["title","onClick"],Hc={class:"zero-code-image-preview"},Zc=["src","alt","onError"],jc={key:0,class:"zero-code-img-updated-badge"},Uc={key:1,class:"zero-code-selection-indicator"},Wc={class:"zero-code-image-info"},qc={class:"zero-code-image-name"},Gc={class:"zero-code-image-alt"},Kc={key:0,class:"zero-code-image-preview-section"},Jc={class:"zero-code-selected-preview"},Xc=["src","alt"],Yc={class:"zero-code-selected-info"},Qc={class:"zero-code-info-item"},ep={class:"zero-code-info-item"},tp={class:"zero-code-info-item"},op={key:0,class:"zero-code-info-item"},rp={class:"zero-code-modal-footer"},np=["disabled"],ap=e.defineComponent({__name:"ImageSelectorModal",props:{visible:{type:Boolean},commonImages:{default:()=>[],type:Array},individualImages:{default:()=>[],type:Array},currentValue:{type:String}},emits:["close","select"],setup(t,{emit:r}){const o=t,n=r,{getImageSrc:s,getImageAlt:f,isImageUpdated:y}=xt(),h=e.ref("common"),b=e.ref(""),A=e.ref(null),N=e.computed(()=>h.value==="common"?o.commonImages||[]:o.individualImages||[]),w=e.computed(()=>{const i=b.value.toLowerCase();return i?N.value.filter(a=>a.name.toLowerCase().includes(i)||a.alt&&a.alt.toLowerCase().includes(i)||a.url.toLowerCase().includes(i)):N.value}),k=()=>{n("close")},v=i=>{A.value?.id===i.id?A.value=null:A.value=i},S=()=>{A.value=null},B=()=>{if(A.value){if(!!(A.value.fileData?.base64&&A.value.fileData.base64.trim()!=="")){const a=s(A.value),l=f(A.value);n("select",a,l)}else n("select",A.value.url,A.value.alt||"");k()}},D=(i,a)=>{const l=i.target;l.src="/img/placeholder.jpg",console.warn(`画像読み込みエラー: ${a.url}`)};return e.watch(()=>o.visible,i=>{if(i){if(o.currentValue){const l=[...o.commonImages||[],...o.individualImages||[]].find(p=>p.url===o.currentValue);l&&(A.value=l,h.value=l.category)}b.value=""}else A.value=null}),e.watch(h,()=>{A.value=null}),(i,a)=>i.visible?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-modal-overlay",onClick:k},[e.createElementVNode("div",{class:"zero-code-modal-content zero-code-image-selector-modal",onClick:a[3]||(a[3]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",{class:"zero-code-modal-header"},[a[4]||(a[4]=e.createElementVNode("h3",{class:"zero-code-modal-title"},"画像を選択",-1)),e.createElementVNode("button",{class:"zero-code-close-button",title:"閉じる",onClick:k}," ✕ ")]),e.createElementVNode("div",Fc,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-tab-button",{active:h.value==="common"}]),onClick:a[0]||(a[0]=l=>h.value="common")}," 共通画像 ("+e.toDisplayString((i.commonImages||[]).length)+") ",3),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-tab-button",{active:h.value==="individual"}]),onClick:a[1]||(a[1]=l=>h.value="individual")}," 個別画像 ("+e.toDisplayString((i.individualImages||[]).length)+") ",3)]),e.createElementVNode("div",Mc,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>b.value=l),type:"text",placeholder:"画像を検索...",class:"zero-code-search-input"},null,512),[[e.vModelText,b.value]])]),e.createElementVNode("div",Lc,[w.value.length===0?(e.openBlock(),e.createElementBlock("div",xc,a[5]||(a[5]=[e.createElementVNode("p",null,"該当する画像がありません",-1)]))):(e.openBlock(),e.createElementBlock("div",Oc,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value,l=>(e.openBlock(),e.createElementBlock("div",{key:l.id,class:e.normalizeClass(["zero-code-image-item",{selected:A.value?.id===l.id}]),title:A.value?.id===l.id?"クリックで選択解除":"クリックで選択",onClick:p=>v(l)},[e.createElementVNode("div",Hc,[e.createElementVNode("img",{src:e.unref(s)(l),alt:e.unref(f)(l),loading:"lazy",onError:p=>D(p,l)},null,40,Zc),e.unref(y)(l)?(e.openBlock(),e.createElementBlock("div",jc," 差し替え済み ")):e.createCommentVNode("",!0),A.value?.id===l.id?(e.openBlock(),e.createElementBlock("div",Uc,a[6]||(a[6]=[e.createElementVNode("span",{class:"zero-code-check-icon"},"✓",-1)]))):e.createCommentVNode("",!0)]),e.createElementVNode("div",Wc,[e.createElementVNode("div",qc,e.toDisplayString(l.name),1),e.createElementVNode("div",Gc,e.toDisplayString(l.alt),1)])],10,Rc))),128))]))]),A.value?(e.openBlock(),e.createElementBlock("div",Kc,[e.createElementVNode("div",{class:"zero-code-preview-header"},[a[8]||(a[8]=e.createElementVNode("h4",{class:"zero-code-preview-title"},"選択中の画像",-1)),e.createElementVNode("button",{class:"zero-code-clear-selection-btn",title:"選択を解除",onClick:S},a[7]||(a[7]=[e.createElementVNode("span",{class:"zero-code-clear-icon"},"✕",-1),e.createTextVNode(" 選択解除 ")]))]),e.createElementVNode("div",Jc,[e.createElementVNode("img",{src:e.unref(s)(A.value),alt:e.unref(f)(A.value)},null,8,Xc),e.createElementVNode("div",Yc,[e.createElementVNode("div",Qc,[a[9]||(a[9]=e.createElementVNode("label",{class:"zero-code-info-label"},"ファイル名",-1)),e.createElementVNode("strong",null,e.toDisplayString(A.value.name),1)]),e.createElementVNode("div",ep,[a[10]||(a[10]=e.createElementVNode("label",{class:"zero-code-info-label"},"説明",-1)),e.createElementVNode("p",null,e.toDisplayString(A.value.alt||"説明なし"),1)]),e.createElementVNode("div",tp,[a[11]||(a[11]=e.createElementVNode("label",{class:"zero-code-info-label"},"URL",-1)),e.createElementVNode("code",null,e.toDisplayString(A.value.url),1)]),e.unref(y)(A.value)?(e.openBlock(),e.createElementBlock("div",op,a[12]||(a[12]=[e.createElementVNode("label",{class:"zero-code-info-label"},"状態",-1),e.createElementVNode("span",{class:"zero-code-status-badge"},"差し替え済み",-1)]))):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),e.createElementVNode("div",rp,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:k}," キャンセル "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",disabled:!A.value,onClick:B},e.toDisplayString(A.value&&e.unref(y)(A.value)?"差し替え画像を適用":"選択した画像を適用"),9,np)])])])):e.createCommentVNode("",!0)}}),sp={class:"zero-code-editor-content"},lp={class:"zero-code-button-section"},ip={key:0,class:"zero-code-data-display-area"},dp={class:"zero-code-data-display-header"},cp={class:"zero-code-data-display-content"},pp={class:"zero-code-data-display-pre"},mp=e.defineComponent({__name:"ZeroCode.ce",props:{parts:{default:()=>[],type:Array},commonParts:{default:()=>[],type:Array},individualParts:{default:()=>[],type:Array},page:{default:()=>[],type:Array},commonImages:{default:()=>[],type:Array},individualImages:{default:()=>[],type:Array}},emits:["update:parts","update:commonParts","update:individualParts","update:page","update:commonImages","update:individualImages"],setup(t,{expose:r,emit:o}){const n=t,s=o,f=e.ref(`zero-code-${Math.random().toString(36).substr(2,9)}`),y=gc(),{getImageSrc:h}=xt(),b=e.computed(()=>[...Be.value,...Fe.value]),A=F=>{if(!F)return F;const x=b.value;if(x.length===0)return F;let R=F;return R=R.replace(/<img([^>]*?)src=["']([^"']+)["']([^>]*?)>/gi,(Z,q,G,K)=>{const W=x.find(H=>!!(H.id===G||H.url===G||H.name===G||G.endsWith("/"+H.name)||H.url.endsWith(G)||G.split("/").pop()===H.name));if(W){const H=h(W);return`<img${q}src="${H}"${K}>`}return Z}),R},N=F=>{const x=Be.value.findIndex(Z=>Z.id===F);if(x!==-1){const Z=[...Be.value];Z[x]={...Z[x],fileData:{...Z[x].fileData,base64:""}},Lr(Z);return}const R=Fe.value.findIndex(Z=>Z.id===F);if(R!==-1){const Z=[...Fe.value];Z[R]={...Z[R],fileData:{...Z[R].fileData,base64:""}},xr(Z)}};e.onMounted(async()=>{try{d.info("🚀 ZeroCode エディター：データローダー初期化中..."),await y.initialize(),y.combinedParts.value&&y.combinedParts.value.length>0?(S.value=y.combinedParts.value,d.success(`✅ パーツデータ設定完了 (${y.combinedParts.value.length}件)`)):d.warn("⚠️ パーツデータが見つかりません"),y.defaultPageData.value&&y.defaultPageData.value.length>0?(v.value=y.defaultPageData.value,d.success(`✅ ページデータ設定完了 (${y.defaultPageData.value.length}件)`)):d.warn("⚠️ ページデータが見つかりません"),y.images.value?(Be.value=y.images.value.common,Fe.value=y.images.value.individual,d.success(`✅ 画像データ設定完了 (共通:${y.images.value.common.length}件, 個別:${y.images.value.individual.length}件)`)):d.warn("⚠️ 画像データが見つかりません"),d.success("✅ データローダー初期化完了"),e.nextTick(()=>{const F=new CustomEvent("zero-code-initialized",{detail:{partsCount:S.value?.length||0,pageCount:v.value?.length||0}});document.dispatchEvent(F),d.debug("🎉 zero-code-initialized イベントを発火")})}catch(F){d.error("❌ データローダー初期化失敗:",F)}});const w=pc(n,s),k=w.state.selectedComponent;w.state.selectedComponentIndex;const v=w.state.editablePageData,S=w.state.localParts,B=w.state.dataTab,D=e.ref(!1),i=e.ref({top:0,left:0}),a=e.ref(null),l=e.ref(""),p=e.ref(""),z=e.ref(""),E=e.computed(()=>a.value!==null),_=e.ref(!1),c=e.ref(""),u=e.ref(null),m=e.ref(""),g=e.reactive({showToolbar:e.computed(()=>D.value),position:e.computed(()=>i.value),actions:[{name:"bold",icon:"B",title:"太字",command:"bold"},{name:"italic",icon:"I",title:"斜体",command:"italic"},{name:"underline",icon:"U",title:"下線",command:"underline"},{name:"separator"},{name:"link",icon:"🔗",title:"リンク",command:"link"}],editingState:{},executeCommand:F=>{d.debug("リッチテキストコマンド実行:",F),$(F)},stopEdit:F=>{d.debug("リッチテキスト編集終了:",F),P(F)}}),$=F=>{if(a.value){d.debug("🔧 書式設定コマンド実行:",F);try{if(F==="link"){const x=prompt("リンクのURLを入力してください:","https://");if(x&&x.trim()){const R=document.execCommand("createLink",!1,x);d.debug("🔧 リンク作成:",R?"成功":"失敗")}}else{const x=document.execCommand(F,!1,void 0);d.debug("🔧 書式設定:",F,x?"成功":"失敗")}d.debug("🔧 データ更新をスキップ（選択範囲保護）")}catch(x){d.error("🚨 execCommandエラー:",x)}}},C=()=>{if(!a.value||!p.value||!z.value)return;const F=a.value.innerHTML,x=ai(F),R=Z=>{const G=(K=>{const W=K.split("_");if(W.length<4)return null;const H=W[W.length-1],X=W[W.length-2];if(!/^\d+$/.test(X))return null;const ee=["outer_items","inner_items","items","categories","tags","list"];for(const ce of ee){const se=`_${ce}_${X}_${H}`;if(K.endsWith(se))return{parentId:K.slice(0,-se.length),arrayName:ce,arrayIndex:parseInt(X),paramName:H}}return null})(p.value);if(G&&console.log("🔧 [Z-FOR編集] ID解析成功:",{originalId:p.value,parentId:G.parentId,arrayName:G.arrayName,arrayIndex:G.arrayIndex,paramName:G.paramName,newValue:x}),G){const{parentId:K,arrayName:W,arrayIndex:H,paramName:X}=G,ee=(se,ae)=>{for(const pe of se){if(pe.id===ae&&Array.isArray(pe[W]))return pe[W][H];if(pe.nested_parts&&Array.isArray(pe.nested_parts)){const _e=ee(pe.nested_parts,ae);if(_e)return _e}for(const[_e,Ee]of Object.entries(pe))if(Array.isArray(Ee)&&_e!=="nested_parts")for(let De=0;De<Ee.length;De++){const ze=Ee[De];if(ze&&typeof ze=="object"){if(`${pe.id}_${_e}_${De}`===ae&&Array.isArray(ze[W]))return ze[W][H];for(const[je,Me]of Object.entries(ze))if(Array.isArray(Me)){const Rt=ee(Me,ae);if(Rt)return Rt}}}}return null},ce=ee(Z,K);return ce&&typeof ce=="object"?(ce[X]=x,console.log("✅ [Z-FOR編集] 更新成功:",{path:`${K}.${W}[${H}].${X}`,oldValue:ce[X],newValue:x}),!0):(console.log("❌ [Z-FOR編集] 配列アイテムが見つからない:",{targetId:p.value,searchedParentId:K}),!1)}for(const K of Z){if(K.id===p.value)return K[z.value]=x,!0;if(K.nested_parts&&Array.isArray(K.nested_parts)&&(d.debug(`🔍 nested_parts内を検索: ${K.id}`),R(K.nested_parts)))return!0;for(const[W,H]of Object.entries(K))if(Array.isArray(H)&&W!=="nested_parts"){d.debug(`🔍 配列プロパティ検索: ${K.id}.${W}`);for(const X of H)if(X&&typeof X=="object"){if(X.id===p.value)return X[z.value]=x,d.debug("🔧 配列内コンポーネント更新完了:",X),!0;for(const[ee,ce]of Object.entries(X))if(Array.isArray(ce)&&(d.debug(`🔍 スロット検索: ${K.id}.${W}[].${ee}`),R(ce)))return!0}}}return d.debug(`❌ コンポーネントが見つかりませんでした: ${p.value}`),!1};R(v.value)&&(a.value&&F!==x&&(a.value.innerHTML=x),e.nextTick(()=>{const Z=JSON.parse(JSON.stringify(v.value));v.value=Z,e.triggerRef(v),e.nextTick(()=>{s("update:page",v.value),console.log("🔄 [Z-FOR編集] triggerRef強制更新完了:",{dataLength:v.value.length,hasUpdatedContent:JSON.stringify(v.value).includes("あああ")})})}))},P=F=>{a.value&&(d.debug("🔧 編集終了:",F?"保存":"キャンセル"),F?(C(),d.debug("🔧 最終保存完了")):(a.value.innerHTML=l.value,d.debug("🔧 変更を破棄しました")),a.value.contentEditable="false",a.value.classList.remove("editing"),a.value.style.userSelect="",a.value.style.webkitUserSelect="",d.debug("🔧 編集終了、スタイルクリーンアップ完了"),d.debug("🔧 編集モード終了処理完了"),a.value._cleanup&&(a.value._cleanup(),delete a.value._cleanup),a.value=null,l.value="",p.value="",z.value="",D.value=!1,d.debug("🔧 ツールバーを非表示にしました"))},I=F=>{w.actions.openEditor(F)},T=()=>{w.closeEditor()},V=F=>{w.actions.deletePart(F)},L=F=>{w.actions.reorderParts(F)},U=()=>{const F=document.querySelector(`.${f.value}`);if(!F)return;let x=null,R=null;const Z=W=>{const H=W,X=H.target;if(X.classList.contains("draggable-nested")){if(a.value){d.debug("🔧 テキスト編集中のためネストパーツドラッグを無効化"),H.preventDefault();return}if(X.classList.contains("z-for-nested-part")){d.debug("🔧 z-for内ネストパーツ - z-for専用ハンドラーに委譲");return}x=X;const ee=X.dataset.componentId||"",ce=X.dataset.path||"",se=X.dataset.parentPath||"",ae=parseInt(X.dataset.index||"0");R={componentId:ee,path:ce,parentPath:se,index:ae},H.dataTransfer&&(H.dataTransfer.effectAllowed="move",H.dataTransfer.setData("text/plain","nested-component")),X.style.opacity="0.5",d.debug("🔧 ネストパーツドラッグ開始:",R)}},q=W=>{const H=W;H.preventDefault(),H.dataTransfer&&(H.dataTransfer.dropEffect="move")},G=W=>{const H=W;if(H.preventDefault(),!x||!R)return;const ee=H.target.closest(".draggable-nested");if(ee&&ee!==x){const ce=ee.dataset.parentPath||"",se=parseInt(ee.dataset.index||"0");d.debug("🔧 ネストパーツドロップ:",{draggedParentPath:R.parentPath,draggedIndex:R.index,targetParentPath:ce,targetIndex:se}),R.parentPath===ce?(d.debug("🔧 同じ親内での並べ替え実行"),w.actions.moveNestedPartById(R.parentPath,R.index,se)):d.debug("🔧 異なる親間の移動は未対応")}x&&(x.style.opacity="1"),x=null,R=null},K=W=>{const H=W.target;H.classList.contains("draggable-nested")&&(H.style.opacity="1"),x=null,R=null};return F.addEventListener("dragstart",Z),F.addEventListener("dragover",q),F.addEventListener("drop",G),F.addEventListener("dragend",K),d.debug("🔧 ネストパーツドラッグ&ドロップリスナー設定完了"),()=>{F.removeEventListener("dragstart",Z),F.removeEventListener("dragover",q),F.removeEventListener("drop",G),F.removeEventListener("dragend",K),d.debug("🔧 ネストパーツドラッグ&ドロップリスナー削除完了")}},M=e.ref(null),O=e.ref(""),J=e.ref(""),Y=F=>{let x=null,R="";switch(F){case"page":x=v.value,R="Pageデータ";break;case"commonParts":x=w.state.localCommonParts.value,(!x||x.length===0)&&(x=S.value?.map(Z=>({...Z,module:Z.module?.filter(q=>!q.category||q.category==="common")})).filter(Z=>Z.module&&Z.module.length>0)||[]),(!x||x.length===0)&&(x=n.parts?.map(Z=>({...Z,module:Z.module?.filter(q=>!q.category||q.category==="common")})).filter(Z=>Z.module&&Z.module.length>0)||[]),R="共通Partsデータ",console.log("🔍 最終共通パーツデータ:",JSON.stringify(x,null,2));break;case"individualParts":x=w.state.localIndividualParts.value,(!x||x.length===0)&&(x=S.value?.map(Z=>({...Z,module:Z.module?.filter(q=>q.category==="individual")})).filter(Z=>Z.module&&Z.module.length>0)||[]),(!x||x.length===0)&&(x=n.parts?.map(Z=>({...Z,module:Z.module?.filter(q=>q.category==="individual")})).filter(Z=>Z.module&&Z.module.length>0)||[]),R="個別Partsデータ",console.log("🔍 最終個別パーツデータ:",JSON.stringify(x,null,2));break;case"commonImages":x=Be.value,R="共通画像データ";break;case"individualImages":x=Fe.value,R="個別画像データ";break;default:return}M.value=x,O.value=R,J.value=F},re=()=>{M.value=null,O.value="",J.value=""},de=e.computed(()=>M.value?JSON.stringify(M.value,null,2):""),me=async()=>{try{await navigator.clipboard.writeText(de.value),alert("データをクリップボードにコピーしました")}catch(F){console.error("クリップボードのコピーに失敗:",F),alert("クリップボードのコピーに失敗しました")}},Ne=()=>{if(J.value){switch(J.value){case"page":w.actions.sendPageData();break;case"commonParts":w.actions.sendCommonPartsData();break;case"individualParts":w.actions.sendIndividualPartsData();break;case"commonImages":Or();break;case"individualImages":Rr();break}alert(`${O.value}を送信しました`)}},ke=()=>{w.actions.resetPageData()},Ke=e.ref(null),yt=e.computed(()=>{const F=new Set;return S.value&&S.value.forEach(x=>{x.type&&F.add(x.type)}),Array.from(F)}),Pe=e.ref(new Map),he=(F,x)=>{console.log(`🔥 [EDITOR] renderComponentWithNested呼び出し - componentId: ${F.id}, type: ${F.type}/${F.module_name}`),F.id.includes("div_nested_zfor");let R=x;R===void 0&&(R=v.value.findIndex(se=>se.id===F.id),R===-1&&(R=0));const Z=v.value[R]||F;Object.keys(Z).filter(se=>Array.isArray(Z[se]));const q=(se,ae="")=>{const pe=[];for(const[_e,Ee]of Object.entries(se))if(Array.isArray(Ee)){const De=ae?`${ae}.${_e}`:_e,ze=`${De}:${Ee.length}:${JSON.stringify(Ee.map((Te,je)=>({i:je,id:Te?.id||Te?.name||`item_${je}`,...Object.fromEntries(Object.entries(Te||{}).slice(0,3))})))}`;pe.push(ze),Ee.forEach((Te,je)=>{if(Te&&typeof Te=="object"){const Me=q(Te,`${De}[${je}]`);pe.push(...Me)}})}return pe},K=q(Z).join("|"),W=`${Z.id}-${R}`;Pe.value.get(W)!==K&&(Pe.value.set(W,K),Object.keys(Z).filter(ae=>Array.isArray(Z[ae])).forEach(ae=>{Z[ae].length>0}));const ee=w.templateProcessor.renderComponentWithNested(Z,R,(se,ae)=>w.utils.template.getTemplate(se,ae,S.value),(se,ae,pe,_e)=>w.templateProcessor.renderNestedComponentsWithUI(se,ae,Ee=>Ee.join("-"),_e||((Ee,De)=>w.utils.template.getTemplate(Ee,De,S.value))));return Z.id,console.log(`🔥 [EDITOR] ${Z.id} - 最終レンダリング結果:`,{resultLength:ee?.length||0,resultPreview:ee?.substring(0,300)+"...",hasInnerItems:ee?.includes("inner_items"),hasNestedContent:ee?.includes("ネスト1-1")}),A(ee)},Ce=F=>{s("update:parts",F)},ge=F=>{Ke.value=F,At.value=!0},Se=F=>{console.log("🔧 deletePartFromManager呼び出し:",F);const{type:x,title:R}=F;if(confirm(`パーツ「${R}」を削除しますか？`)){const Z=G=>G.map(K=>K.type===x?{...K,module:K.module.filter(W=>W.title!==R)}:K).filter(K=>K.module.length>0),q=Z(S.value);if(S.value=q,s("update:parts",q),w.state.localCommonParts.value.length>0){const G=Z(w.state.localCommonParts.value);w.state.localCommonParts.value=G,s("update:commonParts",G)}if(w.state.localIndividualParts.value.length>0){const G=Z(w.state.localIndividualParts.value);w.state.localIndividualParts.value=G,s("update:individualParts",G)}console.log("🔧 削除処理完了")}},Je=F=>{const x=typeof F=="string"?F:F.body||"",R=w.computed.renderPartPreview(x);return A(R)},$e=F=>{const{type:x,title:R,body:Z,category:q="common"}=F,G=[...S.value];let K=G.find(H=>H.type===x);K||(K={type:x,module:[]},G.push(K));const W={title:R,body:Z,category:q};if(Ke.value){const H=K.module.findIndex(X=>X.title===Ke.value.module.title);H!==-1&&(K.module[H]=W)}else K.module.push(W);S.value=G,s("update:parts",G),Mr()},{activeTab:ot,switchToTab:Ot}=rc(),pt=F=>{Ot(F),w.switchToTab(F)},bt=w.state.showPartSelector,Fo=w.state.showNestedPartSelector,At=e.ref(!1),st=F=>{w.openPartSelector(F)},co=()=>{w.closePartSelector()},Fr=()=>{w.closeNestedPartSelector()},up=()=>{At.value=!0},Mr=()=>{At.value=!1,Ke.value=null},gp=w.state.showEditor,Be=e.ref([]),Fe=e.ref([]),Lr=F=>{Be.value=F,s("update:commonImages",F)},xr=F=>{Fe.value=F,s("update:individualImages",F)},Or=()=>{s("update:commonImages",Be.value)},Rr=()=>{s("update:individualImages",Fe.value)},Mo=vr(),fp=(F,x,R)=>{d.debug("🔧 selectPart呼び出し:",{type:F,module:x,index:R,insertPosition:w.state.insertPosition.value});const Z=mt.value.createNewComponent(F,x),q=R!==void 0?R:w.state.insertPosition.value;d.debug("🔧 新しいコンポーネント作成:",Z),d.debug("🔧 挿入位置:",q),w.actions.addPart(Z,q),co()},hp=(F,x)=>{const R=w.state.nestedInsertPath.value,Z=w.state.nestedInsertPosition.value,q=mt.value.createNewComponent(F,x);w.actions.addNestedPart(R,Z,q),Fr()},mt=e.computed(()=>{const F=S.value&&S.value.length>0?S.value:n.parts||[];return d.debug("componentUtils更新: parts length:",F.length),ao(F)}),yp=F=>mt.value.getFieldInfo(F),bp=(F,x,R)=>mt.value.shouldShowBasicField(F,x,R),$p=(F,x,R)=>mt.value.shouldShowArrayField(F,x,R),_p=(F,x,R,Z,q)=>mt.value.shouldShowArrayItemField(F,x,R,Z,q),Ep=F=>mt.value.getInputType(F),zp=(F,x,R)=>mt.value.isCheckboxChecked(F,x,R),wp=(F,x)=>{const R=k.value;if(R){if(R[F]=x,R._isZForItem){const Z=R._parentComponentId,q=R._arrayName,G=R._arrayIndex;d.debug(`🔄 z-for配列アイテムリアルタイム更新: ${Z}.${q}[${G}].${F} = ${x}`);const K=(H,X)=>{for(const ee of H){if(ee.id===X)return ee;if(ee.nested_parts&&Array.isArray(ee.nested_parts)){const ce=K(ee.nested_parts,X);if(ce)return ce}for(const[ce,se]of Object.entries(ee))if(Array.isArray(se)&&ce!=="nested_parts"){for(const ae of se)if(ae&&typeof ae=="object"){for(const[pe,_e]of Object.entries(ae))if(Array.isArray(_e)){const Ee=K(_e,X);if(Ee)return Ee}}}}return null},W=K(v.value,Z);if(W&&Array.isArray(W[q])){const H=W[q];G>=0&&G<H.length&&(H[G][F]=x,d.debug(`✅ z-for配列アイテム更新完了: ${Z}.${q}[${G}].${F}`))}}s("update:page",v.value)}};e.watch(()=>n.commonImages,F=>{Array.isArray(F)&&(Be.value=JSON.parse(JSON.stringify(F)))},{immediate:!0}),e.watch(()=>n.individualImages,F=>{Array.isArray(F)&&(Fe.value=JSON.parse(JSON.stringify(F)))},{immediate:!0});let Lo=null;e.watch(()=>v.value,()=>{Lo&&e.nextTick(()=>{Lo()})},{deep:!0});const vp=(F,x,R)=>{u.value=F,m.value=x,c.value=R,_.value=!0},Hr=()=>{_.value=!1,u.value=null,m.value="",c.value=""},Cp=(F,x)=>{if(u.value&&m.value){let R=F,Z=null;F.startsWith("data:")?(Z=[...Be.value,...Fe.value].find(K=>h(K)===F),Z&&(R=Z.url)):Z=[...Be.value,...Fe.value].find(K=>K.url===F),Z&&!F.startsWith("data:")&&Z.fileData?.base64&&Z.fileData.base64.trim()!==""&&N(Z.id),u.value[m.value]=R;const q=m.value.replace(/url$/i,"alt").replace(/image$/i,"alt");q!==m.value&&u.value[q]!==void 0&&(u.value[q]=x),s("update:page",v.value),e.nextTick(()=>{e.triggerRef(v),S.value&&e.triggerRef(S)}),d.debug("🖼️ 画像選択完了:",R)}Hr()},Zr=F=>{if(!a.value||!D.value)return;const x=F.target,R=document.querySelector(`.${f.value}`);!R||!R.contains(x)||x.closest(".zero-code-rich-text-toolbar")||x===a.value||a.value.contains(x)||(d.debug("🔧 編集外エリアクリック、自動保存してツールバー非表示"),P(!0))};let xo=null,po=null;return e.onMounted(async()=>{d.debug("🔧 ZeroCode初期化開始"),document.addEventListener("click",Zr),d.debug("🔧 グローバルクリックリスナー追加完了");const F=()=>{d.debug("🖼️ 浮遊編集ボタン追加処理開始");const q=document.querySelector(`.${f.value}`);if(!q)return;const G=q.querySelectorAll("img");d.debug("🖼️ 検出された画像数:",G.length),G.forEach(K=>{const W=K;if(W.hasAttribute("data-edit-button-id")||!W.classList.contains("zero-code-editable-image"))return;const H=v.value?.[0];if(H)try{const X=W.getBoundingClientRect();d.debug("🔍 画像位置情報:",{src:W.src.substring(W.src.lastIndexOf("/")+1),rect:{top:X.top,left:X.left,right:X.right,bottom:X.bottom,width:X.width,height:X.height},scrollY:window.scrollY,scrollX:window.scrollX});const ee=document.createElement("button");ee.innerHTML="✏️",ee.className="zero-code-image-floating-button";const ce=X.top+8,se=X.right-32;d.debug("🔍 ボタン計算位置:",{buttonTop:ce,buttonLeft:se}),ee.style.cssText=`
              position: fixed !important;
              top: ${ce}px !important;
              left: ${se}px !important;
              width: 28px !important;
              height: 28px !important;
              background: #3b82f6 !important;
              color: #ffffff !important;
              border: 2px solid #ffffff !important;
              border-radius: 50% !important;
              font-size: 12px !important;
              cursor: pointer !important;
              box-shadow: 0 3px 12px rgba(59, 130, 246, 0.4), 0 1px 4px rgba(0, 0, 0, 0.2) !important;
              z-index: 1000 !important;
              opacity: 0 !important;
              font-family: inherit !important;
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              pointer-events: auto !important;
            `,W.setAttribute("data-edit-button-id",`edit-btn-${Date.now()}`),ee.setAttribute("data-target-image",W.getAttribute("data-edit-button-id"));const ae=()=>{ee.style.opacity="1"},pe=()=>{ee.style.opacity="0"};W.addEventListener("mouseenter",ae),W.addEventListener("mouseleave",pe),ee.addEventListener("mouseenter",ae),ee.addEventListener("mouseleave",pe);const _e=()=>{if(document.body.contains(W)){const Ee=W.getBoundingClientRect(),De=Ee.top+8,ze=Ee.right-32;ee.style.top=`${De}px`,ee.style.left=`${ze}px`}else ee.remove()};window.addEventListener("scroll",_e),window.addEventListener("resize",_e),ee.addEventListener("click",Ee=>{if(Ee.preventDefault(),Ee.stopPropagation(),d.debug("🖼️ 浮遊編集ボタンクリック"),H){const De=Object.keys(H).filter(ze=>ze.toLowerCase().includes("url")||ze.toLowerCase().includes("image")||ze.toLowerCase().includes("icon"));if(d.debug("🔍 コンポーネントデータ:",H),d.debug("🔍 画像フィールド一覧:",De),d.debug("🔍 各フィールドの値:",De.reduce((ze,Te)=>(ze[Te]=H[Te],ze),{})),De.length>0){let ze=De[0];const Te=W.src;d.debug("🔍 クリックされた画像のsrc:",Te);for(const je of De){const Me=H[je];if(d.debug(`🔍 フィールド ${je} の値をチェック:`,Me),Me&&typeof Me=="string"){const Rt=[...Be.value||[],...Fe.value||[]];let Oo=null;if(Rt.length>0&&(Oo=Rt.find(Xe=>!!(Xe.id===Me||Xe.url===Me||Xe.name===Me||Me.endsWith("/"+Xe.name)||Xe.url.endsWith(Me)||Me.split("/").pop()===Xe.name))),Oo)try{const Xe=h(Oo);if(d.debug(`🔍 ${je}フィールドの解決されたsrc:`,Xe),Xe===Te){d.debug(`✅ 一致発見! フィールド: ${je}`),ze=je;break}}catch(Xe){d.debug("🔍 画像解決エラー:",Xe)}if(Me===Te){d.debug(`✅ 直接一致発見! フィールド: ${je}`),ze=je;break}}}d.debug("🖼️ 特定されたフィールド:",ze,"クリックされた画像:",Te),vp(H,ze,W.src)}else d.debug("🔍 画像フィールドが見つかりません")}else d.debug("🔍 テスト用クリック - コンポーネントなし")}),document.body.appendChild(ee),d.debug("🖼️ 浮遊編集ボタン追加完了")}catch(X){d.error("🚨 画像ボタン追加エラー:",X)}})};Lo=F,setTimeout(()=>{d.debug("🔍 5秒後の画像ボタン追加実行"),F()},5e3),e.nextTick(()=>{d.debug("🔍 nextTick後の浮遊ボタン追加実行"),F()});const x=new MutationObserver(()=>{F()}),R=document.querySelector(`.${f.value}`);R&&x.observe(R,{childList:!0,subtree:!0});const Z=po;po=q=>{x.disconnect(),Z&&Z(q)},d.debug("🔧 画像編集ボタン追加処理完了"),d.debug("🔧 イベントリスナー設定中..."),w.setupEventListeners(),d.debug("🔧 EventBusリスナー登録中..."),Oe.on("reorderZForArrayItem",({componentId:q,arrayName:G,fromIndex:K,toIndex:W})=>{d.debug("🔄 z-for並び替えイベント受信:",{componentId:q,arrayName:G,fromIndex:K,toIndex:W});const H=v.value.find(ee=>ee.id===q);if(!H){d.warn("対象コンポーネントが見つかりません:",{componentId:q,arrayName:G,availableIds:v.value.map(ee=>ee.id)});return}let X=null;if(H.arrayFields&&(X=H.arrayFields[G]),!X&&H[G]&&(X=H[G]),!X||!Array.isArray(X)){d.warn("指定された配列フィールドが見つからないか、配列ではありません:",{componentId:q,arrayName:G,foundDirectly:!!H[G],foundInArrayFields:!!(H.arrayFields&&H.arrayFields[G]),itemType:typeof X});return}if(K>=0&&W>=0&&K<X.length&&W<X.length){const[ee]=X.splice(K,1);X.splice(W,0,ee),d.debug("✅ z-for並び替え完了:",{arrayName:G,from:K,to:W})}else d.warn("無効な並び替えインデックス:",{fromIndex:K,toIndex:W,arrayLength:X.length})}),d.debug("🔧 グローバル関数公開中..."),w.exposeGlobalFunctions((q,G)=>{d.debug("🔧 Tiptap編集開始:",{componentId:q,paramName:G}),D.value=!0,w.actions.startTiptapEdit(q,G,[],0)}),typeof window<"u"&&(window.testAddImageButtons=()=>{d.debug("🔍 手動テスト：画像ボタン追加実行"),F()},window.testImageInfo=()=>{const q=document.querySelector(`.${f.value}`);if(!q)return;const G=q.querySelectorAll("img");d.debug("🔍 手動テスト：全画像数",G.length),G.forEach((W,H)=>{const X=W.getBoundingClientRect();d.debug(`🔍 画像${H}:`,{src:W.src.substring(W.src.lastIndexOf("/")+1),parent:W.parentElement?.tagName,hasDataId:!!W.closest("[data-component-id]"),visible:X.width>0&&X.height>0,rect:{top:X.top,left:X.left,width:X.width,height:X.height}})});const K=document.querySelectorAll(".zero-code-image-floating-button");d.debug("🔍 現在の浮遊ボタン数:",K.length)}),typeof window<"u"&&(window.getLatestComponentData=q=>{const G=v.value.find(H=>H.id===q);if(G)return G;const K=/^(.+?)_([^_]+_[^_]+)_(\d+)$/,W=q.match(K);if(W){const[,H,X,ee]=W,ce=parseInt(ee,10),se=v.value.find(ae=>ae.id===H);if(se&&Array.isArray(se[X])&&se[X][ce]){const ae=se[X][ce];return{...se,...ae,type:se.type,module_name:se.module_name,id:q}}}return null}),window.toggleNestedCollapse=q=>{d.debug("🔧 ネストパーツ折りたたみ切り替え:",q),Mo.toggleCollapse(q),e.nextTick(()=>{const G=document.getElementById(`nested-content-${q}`),K=document.querySelector(`[onclick="window.toggleNestedCollapse('${q}')"]`);G&&K&&(Mo.isCollapsed(q)?(G.style.display="none",K.textContent="＋",K.setAttribute("title","展開")):(G.style.display="block",K.textContent="－",K.setAttribute("title","折りたたみ")))})},window.isNestedCollapsed=q=>Mo.isCollapsed(q),window.reorderZForArrayItem=(q,G,K,W)=>{d.debug("🔄 reorderZForArrayItem グローバル関数呼び出し:",{componentId:q,arrayName:G,fromIndex:K,toIndex:W}),Oe.emit("reorderZForArrayItem",{componentId:q,arrayName:G,fromIndex:K,toIndex:W})},xo=U()||null,window.startRichTextEdit=async(q,G,K,W)=>{d.debug("🔧 リッチテキスト編集開始:",{componentId:q,paramName:G,currentValue:K});const H=W||window.event?.target;if(a.value===H){d.debug("🔧 既に編集中の要素、スキップ");return}if(H){a.value&&(d.debug("🔧 前回の編集セッションを終了"),P(!1)),d.debug("🔧 事前設定開始"),a.value=H,l.value=H.innerHTML,p.value=q,z.value=G,await e.nextTick(),H.contentEditable="true",d.debug("🔧 contentEditable設定完了:",H.contentEditable),H.style.userSelect="text",H.style.webkitUserSelect="text",d.debug("🔧 user-select設定完了:",H.style.userSelect),H.classList.add("editing"),d.debug("🔧 editingクラス追加完了"),d.debug("🔧 編集モード設定完了");const X=ae=>{const pe=ae.relatedTarget;if(pe&&pe.closest(".zero-code-rich-text-toolbar")){d.debug("🔧 ツールバーへのフォーカス移動、編集継続");return}d.debug("🔧 フォーカス喪失、自動保存とツールバー非表示"),setTimeout(()=>{a.value===H&&P(!0)},150)};H.addEventListener("blur",X),d.debug("🔧 イベントリスナー追加完了"),H._cleanup=()=>{H.removeEventListener("blur",X),d.debug("🔧 イベントリスナークリーンアップ完了")},d.debug("🔧 ツールバー位置計算開始");const ee=H.getBoundingClientRect(),ce=window.pageYOffset||document.documentElement.scrollTop,se=window.pageXOffset||document.documentElement.scrollLeft;i.value={top:ee.top+ce-80,left:ee.left+se},d.debug("🔧 ツールバー位置設定完了:",i.value),d.debug("🔧 ツールバー表示開始"),D.value=!0,d.debug("🔧 リッチテキスト編集開始完了（ツールバー付き）"),await e.nextTick(),setTimeout(()=>{if(H&&a.value===H){H.focus();const ae=document.createRange(),pe=window.getSelection();if(pe&&H.childNodes.length>0){const _e=H.childNodes[H.childNodes.length-1];_e.nodeType===Node.TEXT_NODE?ae.setStart(_e,_e.textContent?.length||0):ae.setStartAfter(_e),ae.collapse(!0),pe.removeAllRanges(),pe.addRange(ae),d.debug("🔧 カーソルを末尾に移動完了")}else pe&&(ae.selectNodeContents(H),ae.collapse(!1),pe.removeAllRanges(),pe.addRange(ae),d.debug("🔧 空要素の末尾にカーソル設定完了"));d.debug("🔧 遅延フォーカス完了、テキスト選択準備完了（末尾から開始）")}},10)}},d.debug("localParts.value:",S.value),d.debug("props.parts:",n.parts),d.debug("🔧 グローバル関数確認:"),d.debug("  openNestedPartSelector:",typeof window.openNestedPartSelector),d.debug("  openNestedEditor:",typeof window.openNestedEditor),d.debug("✅ ZeroCode初期化完了")}),r({parts:e.computed(()=>S.value&&S.value.length>0?S.value:n.parts||[]),page:e.computed(()=>v.value||[])}),e.onUnmounted(()=>{d.debug("🔧 ZeroCode破棄処理開始"),document.removeEventListener("click",Zr),po&&document.removeEventListener("click",po);const F=document.querySelector(`.${f.value}`);(F?F.querySelectorAll(".zero-code-image-floating-button"):[]).forEach(R=>R.remove()),xo&&xo(),Oe.off("reorderZForArrayItem"),d.debug("🔧 ZeroCode破棄処理完了")}),(F,x)=>(e.openBlock(),e.createBlock(Pc,null,{default:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(`zero-code editor-container ${f.value}`)},[e.createVNode(yc,{"active-tab":e.unref(ot)||"editor","onUpdate:activeTab":pt},null,8,["active-tab"]),e.createVNode(Bc,{show:D.value,position:i.value,actions:g.actions,"editing-state":g.editingState,"is-editing":D.value,onExecuteCommand:g.executeCommand,onSave:x[0]||(x[0]=R=>g.stopEdit(!0)),onCancel:x[1]||(x[1]=R=>g.stopEdit(!1))},null,8,["show","position","actions","editing-state","is-editing","onExecuteCommand"]),e.createElementVNode("div",sp,[e.unref(ot)==="editor"?(e.openBlock(),e.createBlock(Rs,{key:0,"data-tab":e.unref(B),"editable-page-data":e.unref(v),"local-parts":e.unref(S),"local-common-parts":e.unref(w).state.localCommonParts.value,"local-individual-parts":e.unref(w).state.localIndividualParts.value,parts:n.parts||[],"common-images":Be.value,"individual-images":Fe.value,"show-part-selector":e.unref(bt),"show-nested-part-selector":e.unref(Fo),"show-editor":e.unref(gp),"selected-component":e.unref(k),"render-component-with-nested":he,"get-field-info":yp,"should-show-basic-field":bp,"should-show-array-field":$p,"should-show-array-item-field":_p,"get-input-type":Ep,"is-checkbox-checked":zp,"parts-data":e.unref(S)&&e.unref(S).length>0?e.unref(S):n.parts||[],"is-text-editing":E.value,"onUpdate:dataTab":x[2]||(x[2]=R=>B.value=R),onAddPart:st,onEditPart:I,onDeletePart:V,onReorderParts:L,onClosePartSelector:co,onSelectPart:fp,onCloseNestedPartSelector:Fr,onSelectNestedPart:hp,onCloseEditor:T,onUpdateEditorValue:wp},null,8,["data-tab","editable-page-data","local-parts","local-common-parts","local-individual-parts","parts","common-images","individual-images","show-part-selector","show-nested-part-selector","show-editor","selected-component","parts-data","is-text-editing"])):e.createCommentVNode("",!0),e.unref(ot)==="parts"?(e.openBlock(),e.createBlock(Kl,{key:1,"local-parts":e.unref(S),"local-common-parts":e.unref(w).state.localCommonParts.value,"local-individual-parts":e.unref(w).state.localIndividualParts.value,"show-part-registration":At.value,"existing-part-types":yt.value,"editing-part":Ke.value,"render-part-preview":Je,onUpdateParts:Ce,onShowRegistration:up,onEditPart:ge,onDeletePart:Se,onCloseRegistration:Mr,onSavePart:$e},null,8,["local-parts","local-common-parts","local-individual-parts","show-part-registration","existing-part-types","editing-part"])):e.createCommentVNode("",!0),e.unref(ot)==="preview"?(e.openBlock(),e.createBlock(Ti,{key:2,"editable-page-data":e.unref(v),"local-parts":e.unref(S),parts:n.parts||[],"common-images":Be.value,"individual-images":Fe.value},null,8,["editable-page-data","local-parts","parts","common-images","individual-images"])):e.createCommentVNode("",!0),e.unref(ot)==="images"?(e.openBlock(),e.createBlock(oc,{key:3,"common-images":Be.value,"individual-images":Fe.value,onUpdateCommonImages:Lr,onUpdateIndividualImages:xr,onSendCommonImagesData:Or,onSendIndividualImagesData:Rr},null,8,["common-images","individual-images"])):e.createCommentVNode("",!0)]),e.createElementVNode("div",lp,[e.createElementVNode("button",{class:"zero-code-send-btn zero-code-page-btn",onClick:x[3]||(x[3]=R=>Y("page"))},"Pageデータを表示"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-common-parts-btn",onClick:x[4]||(x[4]=R=>Y("commonParts"))},"共通Partsデータを表示"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-individual-parts-btn",onClick:x[5]||(x[5]=R=>Y("individualParts"))},"個別Partsデータを表示"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-common-images-btn",onClick:x[6]||(x[6]=R=>Y("commonImages"))}," 共通画像データを表示 "),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-individual-images-btn",onClick:x[7]||(x[7]=R=>Y("individualImages"))}," 個別画像データを表示 "),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-reset-btn",onClick:ke},"リセット")]),M.value?(e.openBlock(),e.createElementBlock("div",ip,[e.createElementVNode("div",dp,[e.createElementVNode("h4",null,e.toDisplayString(O.value),1),e.createElementVNode("button",{class:"zero-code-close-button",onClick:re},"✕")]),e.createElementVNode("div",cp,[e.createElementVNode("pre",pp,e.toDisplayString(de.value),1)]),e.createElementVNode("div",{class:"zero-code-data-display-footer"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:me},"クリップボードにコピー"),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",onClick:Ne},"このデータを送信")])])):e.createCommentVNode("",!0),e.createVNode(ap,{visible:_.value,"common-images":Be.value,"individual-images":Fe.value,"current-value":c.value,onClose:Hr,onSelect:Cp},null,8,["visible","common-images","individual-images","current-value"])],2)]),_:1}))}}),Bo=e.defineCustomElement(mp,{shadowRoot:!1});customElements.define("zero-code",Bo),Le.ZeroCode=Bo,Le.default=Bo,Object.defineProperties(Le,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vue-cms-editor.optimized.umd.js.map
