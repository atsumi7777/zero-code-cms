(function($e,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):($e=typeof globalThis<"u"?globalThis:$e||self,e($e.ZeroCode={},$e.Vue))})(this,function($e,e){"use strict";var Ad=Object.defineProperty;var Pd=($e,e,et)=>e in $e?Ad($e,e,{enumerable:!0,configurable:!0,writable:!0,value:et}):$e[e]=et;var zt=($e,e,et)=>Pd($e,typeof e!="symbol"?e+"":e,et);var et=Object.defineProperty,vt=Object.getOwnPropertySymbols,go=Object.prototype.hasOwnProperty,ho=Object.prototype.propertyIsEnumerable,yo=(t,r,o)=>r in t?et(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,tt=(t,r)=>{for(var o in r||(r={}))go.call(r,o)&&yo(t,o,r[o]);if(vt)for(var o of vt(r))ho.call(r,o)&&yo(t,o,r[o]);return t},bo=(t,r)=>{var o={};for(var n in t)go.call(t,n)&&r.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&vt)for(var n of vt(t))r.indexOf(n)<0&&ho.call(t,n)&&(o[n]=t[n]);return o};const _d="[vue-draggable-plus]: ";function Sd(t){}function Id(t){}function Eo(t,r,o){return o>=0&&o<t.length&&t.splice(o,0,t.splice(r,1)[0]),t}function ur(t){return t.replace(/-(\w)/g,(r,o)=>o?o.toUpperCase():"")}function mr(t){return Object.keys(t).reduce((r,o)=>(typeof t[o]<"u"&&(r[ur(o)]=t[o]),r),{})}function $o(t,r){return Array.isArray(t)&&t.splice(r,1),t}function wo(t,r,o){return Array.isArray(t)&&t.splice(r,0,o),t}function fr(t){return typeof t>"u"}function gr(t){return typeof t=="string"}function zo(t,r,o){const n=t.children[o];t.insertBefore(r,n)}function Zt(t){t.parentNode&&t.parentNode.removeChild(t)}function hr(t,r=document){var o;let n=null;return typeof(r==null?void 0:r.querySelector)=="function"?n=(o=r==null?void 0:r.querySelector)==null?void 0:o.call(r,t):n=document.querySelector(t),n||(`${t}`,void 0),n}function yr(t,r,o=null){return function(...n){return t.apply(o,n),r.apply(o,n)}}function br(t,r){const o=tt({},t);return Object.keys(r).forEach(n=>{o[n]?o[n]=yr(t[n],r[n]):o[n]=r[n]}),o}function Er(t){return t instanceof HTMLElement}function vo(t,r){Object.keys(t).forEach(o=>{r(o,t[o])})}function $r(t){return t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97)}const wr=Object.assign;/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function No(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function De(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?No(Object(o),!0).forEach(function(n){zr(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):No(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function Nt(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Nt=function(r){return typeof r}:Nt=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Nt(t)}function zr(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function Me(){return Me=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},Me.apply(this,arguments)}function vr(t,r){if(t==null)return{};var o={},n=Object.keys(t),a,f;for(f=0;f<n.length;f++)a=n[f],!(r.indexOf(a)>=0)&&(o[a]=t[a]);return o}function Nr(t,r){if(t==null)return{};var o=vr(t,r),n,a;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(t);for(a=0;a<f.length;a++)n=f[a],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var Cr="1.15.2";function Fe(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Oe=Fe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),dt=Fe(/Edge/i),Co=Fe(/firefox/i),ct=Fe(/safari/i)&&!Fe(/chrome/i)&&!Fe(/android/i),ko=Fe(/iP(ad|od|hone)/i),Ao=Fe(/chrome/i)&&Fe(/android/i),Po={capture:!1,passive:!1};function q(t,r,o){t.addEventListener(r,o,!Oe&&Po)}function K(t,r,o){t.removeEventListener(r,o,!Oe&&Po)}function Ct(t,r){if(r){if(r[0]===">"&&(r=r.substring(1)),t)try{if(t.matches)return t.matches(r);if(t.msMatchesSelector)return t.msMatchesSelector(r);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(r)}catch{return!1}return!1}}function kr(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Pe(t,r,o,n){if(t){o=o||document;do{if(r!=null&&(r[0]===">"?t.parentNode===o&&Ct(t,r):Ct(t,r))||n&&t===o)return t;if(t===o)break}while(t=kr(t))}return null}var _o=/\s+/g;function ve(t,r,o){if(t&&r)if(t.classList)t.classList[o?"add":"remove"](r);else{var n=(" "+t.className+" ").replace(_o," ").replace(" "+r+" "," ");t.className=(n+(o?" "+r:"")).replace(_o," ")}}function Z(t,r,o){var n=t&&t.style;if(n){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(o=t.currentStyle),r===void 0?o:o[r];!(r in n)&&r.indexOf("webkit")===-1&&(r="-webkit-"+r),n[r]=o+(typeof o=="string"?"":"px")}}function ot(t,r){var o="";if(typeof t=="string")o=t;else do{var n=Z(t,"transform");n&&n!=="none"&&(o=n+" "+o)}while(!r&&(t=t.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(o)}function So(t,r,o){if(t){var n=t.getElementsByTagName(r),a=0,f=n.length;if(o)for(;a<f;a++)o(n[a],a);return n}return[]}function Te(){var t=document.scrollingElement;return t||document.documentElement}function ce(t,r,o,n,a){if(!(!t.getBoundingClientRect&&t!==window)){var f,y,d,g,C,v,w;if(t!==window&&t.parentNode&&t!==Te()?(f=t.getBoundingClientRect(),y=f.top,d=f.left,g=f.bottom,C=f.right,v=f.height,w=f.width):(y=0,d=0,g=window.innerHeight,C=window.innerWidth,v=window.innerHeight,w=window.innerWidth),(r||o)&&t!==window&&(a=a||t.parentNode,!Oe))do if(a&&a.getBoundingClientRect&&(Z(a,"transform")!=="none"||o&&Z(a,"position")!=="static")){var N=a.getBoundingClientRect();y-=N.top+parseInt(Z(a,"border-top-width")),d-=N.left+parseInt(Z(a,"border-left-width")),g=y+f.height,C=d+f.width;break}while(a=a.parentNode);if(n&&t!==window){var E=ot(a||t),c=E&&E.a,l=E&&E.d;E&&(y/=l,d/=c,w/=c,v/=l,g=y+v,C=d+w)}return{top:y,left:d,bottom:g,right:C,width:w,height:v}}}function Io(t,r,o){for(var n=Ze(t,!0),a=ce(t)[r];n;){var f=ce(n)[o],y=void 0;if(y=a>=f,!y)return n;if(n===Te())break;n=Ze(n,!1)}return!1}function rt(t,r,o,n){for(var a=0,f=0,y=t.children;f<y.length;){if(y[f].style.display!=="none"&&y[f]!==U.ghost&&(n||y[f]!==U.dragged)&&Pe(y[f],o.draggable,t,!1)){if(a===r)return y[f];a++}f++}return null}function Ut(t,r){for(var o=t.lastElementChild;o&&(o===U.ghost||Z(o,"display")==="none"||r&&!Ct(o,r));)o=o.previousElementSibling;return o||null}function ke(t,r){var o=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==U.clone&&(!r||Ct(t,r))&&o++;return o}function Do(t){var r=0,o=0,n=Te();if(t)do{var a=ot(t),f=a.a,y=a.d;r+=t.scrollLeft*f,o+=t.scrollTop*y}while(t!==n&&(t=t.parentNode));return[r,o]}function Ar(t,r){for(var o in t)if(t.hasOwnProperty(o)){for(var n in r)if(r.hasOwnProperty(n)&&r[n]===t[o][n])return Number(o)}return-1}function Ze(t,r){if(!t||!t.getBoundingClientRect)return Te();var o=t,n=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var a=Z(o);if(o.clientWidth<o.scrollWidth&&(a.overflowX=="auto"||a.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(a.overflowY=="auto"||a.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return Te();if(n||r)return o;n=!0}}while(o=o.parentNode);return Te()}function Pr(t,r){if(t&&r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t}function jt(t,r){return Math.round(t.top)===Math.round(r.top)&&Math.round(t.left)===Math.round(r.left)&&Math.round(t.height)===Math.round(r.height)&&Math.round(t.width)===Math.round(r.width)}var pt;function To(t,r){return function(){if(!pt){var o=arguments,n=this;o.length===1?t.call(n,o[0]):t.apply(n,o),pt=setTimeout(function(){pt=void 0},r)}}}function _r(){clearTimeout(pt),pt=void 0}function Vo(t,r,o){t.scrollLeft+=r,t.scrollTop+=o}function Bo(t){var r=window.Polymer,o=window.jQuery||window.Zepto;return r&&r.dom?r.dom(t).cloneNode(!0):o?o(t).clone(!0)[0]:t.cloneNode(!0)}function Mo(t,r,o){var n={};return Array.from(t.children).forEach(function(a){var f,y,d,g;if(!(!Pe(a,r.draggable,t,!1)||a.animated||a===o)){var C=ce(a);n.left=Math.min((f=n.left)!==null&&f!==void 0?f:1/0,C.left),n.top=Math.min((y=n.top)!==null&&y!==void 0?y:1/0,C.top),n.right=Math.max((d=n.right)!==null&&d!==void 0?d:-1/0,C.right),n.bottom=Math.max((g=n.bottom)!==null&&g!==void 0?g:-1/0,C.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var Ne="Sortable"+new Date().getTime();function Sr(){var t=[],r;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(n){if(!(Z(n,"display")==="none"||n===U.ghost)){t.push({target:n,rect:ce(n)});var a=De({},t[t.length-1].rect);if(n.thisAnimationDuration){var f=ot(n,!0);f&&(a.top-=f.f,a.left-=f.e)}n.fromRect=a}})}},addAnimationState:function(o){t.push(o)},removeAnimationState:function(o){t.splice(Ar(t,{target:o}),1)},animateAll:function(o){var n=this;if(!this.options.animation){clearTimeout(r),typeof o=="function"&&o();return}var a=!1,f=0;t.forEach(function(y){var d=0,g=y.target,C=g.fromRect,v=ce(g),w=g.prevFromRect,N=g.prevToRect,E=y.rect,c=ot(g,!0);c&&(v.top-=c.f,v.left-=c.e),g.toRect=v,g.thisAnimationDuration&&jt(w,v)&&!jt(C,v)&&(E.top-v.top)/(E.left-v.left)===(C.top-v.top)/(C.left-v.left)&&(d=Dr(E,w,N,n.options)),jt(v,C)||(g.prevFromRect=C,g.prevToRect=v,d||(d=n.options.animation),n.animate(g,E,v,d)),d&&(a=!0,f=Math.max(f,d),clearTimeout(g.animationResetTimer),g.animationResetTimer=setTimeout(function(){g.animationTime=0,g.prevFromRect=null,g.fromRect=null,g.prevToRect=null,g.thisAnimationDuration=null},d),g.thisAnimationDuration=d)}),clearTimeout(r),a?r=setTimeout(function(){typeof o=="function"&&o()},f):typeof o=="function"&&o(),t=[]},animate:function(o,n,a,f){if(f){Z(o,"transition",""),Z(o,"transform","");var y=ot(this.el),d=y&&y.a,g=y&&y.d,C=(n.left-a.left)/(d||1),v=(n.top-a.top)/(g||1);o.animatingX=!!C,o.animatingY=!!v,Z(o,"transform","translate3d("+C+"px,"+v+"px,0)"),this.forRepaintDummy=Ir(o),Z(o,"transition","transform "+f+"ms"+(this.options.easing?" "+this.options.easing:"")),Z(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){Z(o,"transition",""),Z(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},f)}}}}function Ir(t){return t.offsetWidth}function Dr(t,r,o,n){return Math.sqrt(Math.pow(r.top-t.top,2)+Math.pow(r.left-t.left,2))/Math.sqrt(Math.pow(r.top-o.top,2)+Math.pow(r.left-o.left,2))*n.animation}var nt=[],Wt={initializeByDefault:!0},ut={mount:function(t){for(var r in Wt)Wt.hasOwnProperty(r)&&!(r in t)&&(t[r]=Wt[r]);nt.forEach(function(o){if(o.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),nt.push(t)},pluginEvent:function(t,r,o){var n=this;this.eventCanceled=!1,o.cancel=function(){n.eventCanceled=!0};var a=t+"Global";nt.forEach(function(f){r[f.pluginName]&&(r[f.pluginName][a]&&r[f.pluginName][a](De({sortable:r},o)),r.options[f.pluginName]&&r[f.pluginName][t]&&r[f.pluginName][t](De({sortable:r},o)))})},initializePlugins:function(t,r,o,n){nt.forEach(function(y){var d=y.pluginName;if(!(!t.options[d]&&!y.initializeByDefault)){var g=new y(t,r,t.options);g.sortable=t,g.options=t.options,t[d]=g,Me(o,g.defaults)}});for(var a in t.options)if(t.options.hasOwnProperty(a)){var f=this.modifyOption(t,a,t.options[a]);typeof f<"u"&&(t.options[a]=f)}},getEventProperties:function(t,r){var o={};return nt.forEach(function(n){typeof n.eventProperties=="function"&&Me(o,n.eventProperties.call(r[n.pluginName],t))}),o},modifyOption:function(t,r,o){var n;return nt.forEach(function(a){t[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[r]=="function"&&(n=a.optionListeners[r].call(t[a.pluginName],o))}),n}};function Tr(t){var r=t.sortable,o=t.rootEl,n=t.name,a=t.targetEl,f=t.cloneEl,y=t.toEl,d=t.fromEl,g=t.oldIndex,C=t.newIndex,v=t.oldDraggableIndex,w=t.newDraggableIndex,N=t.originalEvent,E=t.putSortable,c=t.extraEventProperties;if(r=r||o&&o[Ne],!!r){var l,m=r.options,s="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Oe&&!dt?l=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent(n,!0,!0)),l.to=y||o,l.from=d||o,l.item=a||o,l.clone=f,l.oldIndex=g,l.newIndex=C,l.oldDraggableIndex=v,l.newDraggableIndex=w,l.originalEvent=N,l.pullMode=E?E.lastPutMode:void 0;var i=De(De({},c),ut.getEventProperties(n,r));for(var p in i)l[p]=i[p];o&&o.dispatchEvent(l),m[s]&&m[s].call(r,l)}}var Vr=["evt"],we=function(t,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=o.evt,a=Nr(o,Vr);ut.pluginEvent.bind(U)(t,r,De({dragEl:B,parentEl:ie,ghostEl:j,rootEl:ne,nextEl:Xe,lastDownEl:kt,cloneEl:ae,cloneHidden:Ue,dragStarted:ft,putSortable:ye,activeSortable:U.active,originalEvent:n,oldIndex:at,oldDraggableIndex:mt,newIndex:Ce,newDraggableIndex:je,hideGhostForTarget:Zo,unhideGhostForTarget:Uo,cloneNowHidden:function(){Ue=!0},cloneNowShown:function(){Ue=!1},dispatchSortableEvent:function(f){Ee({sortable:r,name:f,originalEvent:n})}},a))};function Ee(t){Tr(De({putSortable:ye,cloneEl:ae,targetEl:B,rootEl:ne,oldIndex:at,oldDraggableIndex:mt,newIndex:Ce,newDraggableIndex:je},t))}var B,ie,j,ne,Xe,kt,ae,Ue,at,Ce,mt,je,At,ye,st=!1,Pt=!1,_t=[],Ye,_e,Xt,Yt,Fo,Oo,ft,lt,gt,ht=!1,St=!1,It,be,Kt=[],Jt=!1,Dt=[],Tt=typeof document<"u",Vt=ko,Lo=dt||Oe?"cssFloat":"float",Br=Tt&&!Ao&&!ko&&"draggable"in document.createElement("div"),xo=function(){if(Tt){if(Oe)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),Ro=function(t,r){var o=Z(t),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),a=rt(t,0,r),f=rt(t,1,r),y=a&&Z(a),d=f&&Z(f),g=y&&parseInt(y.marginLeft)+parseInt(y.marginRight)+ce(a).width,C=d&&parseInt(d.marginLeft)+parseInt(d.marginRight)+ce(f).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&y.float&&y.float!=="none"){var v=y.float==="left"?"left":"right";return f&&(d.clear==="both"||d.clear===v)?"vertical":"horizontal"}return a&&(y.display==="block"||y.display==="flex"||y.display==="table"||y.display==="grid"||g>=n&&o[Lo]==="none"||f&&o[Lo]==="none"&&g+C>n)?"vertical":"horizontal"},Mr=function(t,r,o){var n=o?t.left:t.top,a=o?t.right:t.bottom,f=o?t.width:t.height,y=o?r.left:r.top,d=o?r.right:r.bottom,g=o?r.width:r.height;return n===y||a===d||n+f/2===y+g/2},Fr=function(t,r){var o;return _t.some(function(n){var a=n[Ne].options.emptyInsertThreshold;if(!(!a||Ut(n))){var f=ce(n),y=t>=f.left-a&&t<=f.right+a,d=r>=f.top-a&&r<=f.bottom+a;if(y&&d)return o=n}}),o},Ho=function(t){function r(a,f){return function(y,d,g,C){var v=y.options.group.name&&d.options.group.name&&y.options.group.name===d.options.group.name;if(a==null&&(f||v))return!0;if(a==null||a===!1)return!1;if(f&&a==="clone")return a;if(typeof a=="function")return r(a(y,d,g,C),f)(y,d,g,C);var w=(f?y:d).options.group.name;return a===!0||typeof a=="string"&&a===w||a.join&&a.indexOf(w)>-1}}var o={},n=t.group;(!n||Nt(n)!="object")&&(n={name:n}),o.name=n.name,o.checkPull=r(n.pull,!0),o.checkPut=r(n.put),o.revertClone=n.revertClone,t.group=o},Zo=function(){!xo&&j&&Z(j,"display","none")},Uo=function(){!xo&&j&&Z(j,"display","")};Tt&&!Ao&&document.addEventListener("click",function(t){if(Pt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Pt=!1,!1},!0);var Ke=function(t){if(B){t=t.touches?t.touches[0]:t;var r=Fr(t.clientX,t.clientY);if(r){var o={};for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);o.target=o.rootEl=r,o.preventDefault=void 0,o.stopPropagation=void 0,r[Ne]._onDragOver(o)}}},Or=function(t){B&&B.parentNode[Ne]._isOutsideThisEl(t.target)};function U(t,r){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=r=Me({},r),t[Ne]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ro(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(f,y){f.setData("Text",y.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:U.supportPointer!==!1&&"PointerEvent"in window&&!ct,emptyInsertThreshold:5};ut.initializePlugins(this,t,o);for(var n in o)!(n in r)&&(r[n]=o[n]);Ho(r);for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this));this.nativeDraggable=r.forceFallback?!1:Br,this.nativeDraggable&&(this.options.touchStartThreshold=1),r.supportPointer?q(t,"pointerdown",this._onTapStart):(q(t,"mousedown",this._onTapStart),q(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(q(t,"dragover",this),q(t,"dragenter",this)),_t.push(this.el),r.store&&r.store.get&&this.sort(r.store.get(this)||[]),Me(this,Sr())}U.prototype={constructor:U,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(lt=null)},_getDirection:function(t,r){return typeof this.options.direction=="function"?this.options.direction.call(this,t,r,B):this.options.direction},_onTapStart:function(t){if(t.cancelable){var r=this,o=this.el,n=this.options,a=n.preventOnFilter,f=t.type,y=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,d=(y||t).target,g=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||d,C=n.filter;if(Wr(o),!B&&!(/mousedown|pointerdown/.test(f)&&t.button!==0||n.disabled)&&!g.isContentEditable&&!(!this.nativeDraggable&&ct&&d&&d.tagName.toUpperCase()==="SELECT")&&(d=Pe(d,n.draggable,o,!1),!(d&&d.animated)&&kt!==d)){if(at=ke(d),mt=ke(d,n.draggable),typeof C=="function"){if(C.call(this,t,d,this)){Ee({sortable:r,rootEl:g,name:"filter",targetEl:d,toEl:o,fromEl:o}),we("filter",r,{evt:t}),a&&t.cancelable&&t.preventDefault();return}}else if(C&&(C=C.split(",").some(function(v){if(v=Pe(g,v.trim(),o,!1),v)return Ee({sortable:r,rootEl:v,name:"filter",targetEl:d,fromEl:o,toEl:o}),we("filter",r,{evt:t}),!0}),C)){a&&t.cancelable&&t.preventDefault();return}n.handle&&!Pe(g,n.handle,o,!1)||this._prepareDragStart(t,y,d)}}},_prepareDragStart:function(t,r,o){var n=this,a=n.el,f=n.options,y=a.ownerDocument,d;if(o&&!B&&o.parentNode===a){var g=ce(o);if(ne=a,B=o,ie=B.parentNode,Xe=B.nextSibling,kt=o,At=f.group,U.dragged=B,Ye={target:B,clientX:(r||t).clientX,clientY:(r||t).clientY},Fo=Ye.clientX-g.left,Oo=Ye.clientY-g.top,this._lastX=(r||t).clientX,this._lastY=(r||t).clientY,B.style["will-change"]="all",d=function(){if(we("delayEnded",n,{evt:t}),U.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Co&&n.nativeDraggable&&(B.draggable=!0),n._triggerDragStart(t,r),Ee({sortable:n,name:"choose",originalEvent:t}),ve(B,f.chosenClass,!0)},f.ignore.split(",").forEach(function(C){So(B,C.trim(),qt)}),q(y,"dragover",Ke),q(y,"mousemove",Ke),q(y,"touchmove",Ke),q(y,"mouseup",n._onDrop),q(y,"touchend",n._onDrop),q(y,"touchcancel",n._onDrop),Co&&this.nativeDraggable&&(this.options.touchStartThreshold=4,B.draggable=!0),we("delayStart",this,{evt:t}),f.delay&&(!f.delayOnTouchOnly||r)&&(!this.nativeDraggable||!(dt||Oe))){if(U.eventCanceled){this._onDrop();return}q(y,"mouseup",n._disableDelayedDrag),q(y,"touchend",n._disableDelayedDrag),q(y,"touchcancel",n._disableDelayedDrag),q(y,"mousemove",n._delayedDragTouchMoveHandler),q(y,"touchmove",n._delayedDragTouchMoveHandler),f.supportPointer&&q(y,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(d,f.delay)}else d()}},_delayedDragTouchMoveHandler:function(t){var r=t.touches?t.touches[0]:t;Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){B&&qt(B),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;K(t,"mouseup",this._disableDelayedDrag),K(t,"touchend",this._disableDelayedDrag),K(t,"touchcancel",this._disableDelayedDrag),K(t,"mousemove",this._delayedDragTouchMoveHandler),K(t,"touchmove",this._delayedDragTouchMoveHandler),K(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,r){r=r||t.pointerType=="touch"&&t,!this.nativeDraggable||r?this.options.supportPointer?q(document,"pointermove",this._onTouchMove):r?q(document,"touchmove",this._onTouchMove):q(document,"mousemove",this._onTouchMove):(q(B,"dragend",this),q(ne,"dragstart",this._onDragStart));try{document.selection?Mt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,r){if(st=!1,ne&&B){we("dragStarted",this,{evt:r}),this.nativeDraggable&&q(document,"dragover",Or);var o=this.options;!t&&ve(B,o.dragClass,!1),ve(B,o.ghostClass,!0),U.active=this,t&&this._appendGhost(),Ee({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){if(_e){this._lastX=_e.clientX,this._lastY=_e.clientY,Zo();for(var t=document.elementFromPoint(_e.clientX,_e.clientY),r=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(_e.clientX,_e.clientY),t!==r);)r=t;if(B.parentNode[Ne]._isOutsideThisEl(t),r)do{if(r[Ne]){var o=void 0;if(o=r[Ne]._onDragOver({clientX:_e.clientX,clientY:_e.clientY,target:t,rootEl:r}),o&&!this.options.dragoverBubble)break}t=r}while(r=r.parentNode);Uo()}},_onTouchMove:function(t){if(Ye){var r=this.options,o=r.fallbackTolerance,n=r.fallbackOffset,a=t.touches?t.touches[0]:t,f=j&&ot(j,!0),y=j&&f&&f.a,d=j&&f&&f.d,g=Vt&&be&&Do(be),C=(a.clientX-Ye.clientX+n.x)/(y||1)+(g?g[0]-Kt[0]:0)/(y||1),v=(a.clientY-Ye.clientY+n.y)/(d||1)+(g?g[1]-Kt[1]:0)/(d||1);if(!U.active&&!st){if(o&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<o)return;this._onDragStart(t,!0)}if(j){f?(f.e+=C-(Xt||0),f.f+=v-(Yt||0)):f={a:1,b:0,c:0,d:1,e:C,f:v};var w="matrix(".concat(f.a,",").concat(f.b,",").concat(f.c,",").concat(f.d,",").concat(f.e,",").concat(f.f,")");Z(j,"webkitTransform",w),Z(j,"mozTransform",w),Z(j,"msTransform",w),Z(j,"transform",w),Xt=C,Yt=v,_e=a}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!j){var t=this.options.fallbackOnBody?document.body:ne,r=ce(B,!0,Vt,!0,t),o=this.options;if(Vt){for(be=t;Z(be,"position")==="static"&&Z(be,"transform")==="none"&&be!==document;)be=be.parentNode;be!==document.body&&be!==document.documentElement?(be===document&&(be=Te()),r.top+=be.scrollTop,r.left+=be.scrollLeft):be=Te(),Kt=Do(be)}j=B.cloneNode(!0),ve(j,o.ghostClass,!1),ve(j,o.fallbackClass,!0),ve(j,o.dragClass,!0),Z(j,"transition",""),Z(j,"transform",""),Z(j,"box-sizing","border-box"),Z(j,"margin",0),Z(j,"top",r.top),Z(j,"left",r.left),Z(j,"width",r.width),Z(j,"height",r.height),Z(j,"opacity","0.8"),Z(j,"position",Vt?"absolute":"fixed"),Z(j,"zIndex","100000"),Z(j,"pointerEvents","none"),U.ghost=j,t.appendChild(j),Z(j,"transform-origin",Fo/parseInt(j.style.width)*100+"% "+Oo/parseInt(j.style.height)*100+"%")}},_onDragStart:function(t,r){var o=this,n=t.dataTransfer,a=o.options;if(we("dragStart",this,{evt:t}),U.eventCanceled){this._onDrop();return}we("setupClone",this),U.eventCanceled||(ae=Bo(B),ae.removeAttribute("id"),ae.draggable=!1,ae.style["will-change"]="",this._hideClone(),ve(ae,this.options.chosenClass,!1),U.clone=ae),o.cloneId=Mt(function(){we("clone",o),!U.eventCanceled&&(o.options.removeCloneOnHide||ne.insertBefore(ae,B),o._hideClone(),Ee({sortable:o,name:"clone"}))}),!r&&ve(B,a.dragClass,!0),r?(Pt=!0,o._loopId=setInterval(o._emulateDragOver,50)):(K(document,"mouseup",o._onDrop),K(document,"touchend",o._onDrop),K(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",a.setData&&a.setData.call(o,n,B)),q(document,"drop",o),Z(B,"transform","translateZ(0)")),st=!0,o._dragStartId=Mt(o._dragStarted.bind(o,r,t)),q(document,"selectstart",o),ft=!0,ct&&Z(document.body,"user-select","none")},_onDragOver:function(t){var r=this.el,o=t.target,n,a,f,y=this.options,d=y.group,g=U.active,C=At===d,v=y.sort,w=ye||g,N,E=this,c=!1;if(Jt)return;function l(R,F){we(R,E,De({evt:t,isOwner:C,axis:N?"vertical":"horizontal",revert:f,dragRect:n,targetRect:a,canSort:v,fromSortable:w,target:o,completed:s,onMove:function(X,L){return Bt(ne,r,B,n,X,ce(X),t,L)},changed:i},F))}function m(){l("dragOverAnimationCapture"),E.captureAnimationState(),E!==w&&w.captureAnimationState()}function s(R){return l("dragOverCompleted",{insertion:R}),R&&(C?g._hideClone():g._showClone(E),E!==w&&(ve(B,ye?ye.options.ghostClass:g.options.ghostClass,!1),ve(B,y.ghostClass,!0)),ye!==E&&E!==U.active?ye=E:E===U.active&&ye&&(ye=null),w===E&&(E._ignoreWhileAnimating=o),E.animateAll(function(){l("dragOverAnimationComplete"),E._ignoreWhileAnimating=null}),E!==w&&(w.animateAll(),w._ignoreWhileAnimating=null)),(o===B&&!B.animated||o===r&&!o.animated)&&(lt=null),!y.dragoverBubble&&!t.rootEl&&o!==document&&(B.parentNode[Ne]._isOutsideThisEl(t.target),!R&&Ke(t)),!y.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),c=!0}function i(){Ce=ke(B),je=ke(B,y.draggable),Ee({sortable:E,name:"change",toEl:r,newIndex:Ce,newDraggableIndex:je,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),o=Pe(o,y.draggable,r,!0),l("dragOver"),U.eventCanceled)return c;if(B.contains(t.target)||o.animated&&o.animatingX&&o.animatingY||E._ignoreWhileAnimating===o)return s(!1);if(Pt=!1,g&&!y.disabled&&(C?v||(f=ie!==ne):ye===this||(this.lastPutMode=At.checkPull(this,g,B,t))&&d.checkPut(this,g,B,t))){if(N=this._getDirection(t,o)==="vertical",n=ce(B),l("dragOverValid"),U.eventCanceled)return c;if(f)return ie=ne,m(),this._hideClone(),l("revert"),U.eventCanceled||(Xe?ne.insertBefore(B,Xe):ne.appendChild(B)),s(!0);var p=Ut(r,y.draggable);if(!p||Hr(t,N,this)&&!p.animated){if(p===B)return s(!1);if(p&&r===t.target&&(o=p),o&&(a=ce(o)),Bt(ne,r,B,n,o,a,t,!!o)!==!1)return m(),p&&p.nextSibling?r.insertBefore(B,p.nextSibling):r.appendChild(B),ie=r,i(),s(!0)}else if(p&&Rr(t,N,this)){var u=rt(r,0,y,!0);if(u===B)return s(!1);if(o=u,a=ce(o),Bt(ne,r,B,n,o,a,t,!1)!==!1)return m(),r.insertBefore(B,u),ie=r,i(),s(!0)}else if(o.parentNode===r){a=ce(o);var b=0,z,A=B.parentNode!==r,h=!Mr(B.animated&&B.toRect||n,o.animated&&o.toRect||a,N),$=N?"top":"left",k=Io(o,"top","top")||Io(B,"top","top"),P=k?k.scrollTop:void 0;lt!==o&&(z=a[$],ht=!1,St=!h&&y.invertSwap||A),b=Zr(t,o,a,N,h?1:y.swapThreshold,y.invertedSwapThreshold==null?y.swapThreshold:y.invertedSwapThreshold,St,lt===o);var S;if(b!==0){var D=ke(B);do D-=b,S=ie.children[D];while(S&&(Z(S,"display")==="none"||S===j))}if(b===0||S===o)return s(!1);lt=o,gt=b;var M=o.nextElementSibling,I=!1;I=b===1;var V=Bt(ne,r,B,n,o,a,t,I);if(V!==!1)return(V===1||V===-1)&&(I=V===1),Jt=!0,setTimeout(xr,30),m(),I&&!M?r.appendChild(B):o.parentNode.insertBefore(B,I?M:o),k&&Vo(k,0,P-k.scrollTop),ie=B.parentNode,z!==void 0&&!St&&(It=Math.abs(z-ce(o)[$])),i(),s(!0)}if(r.contains(B))return s(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){K(document,"mousemove",this._onTouchMove),K(document,"touchmove",this._onTouchMove),K(document,"pointermove",this._onTouchMove),K(document,"dragover",Ke),K(document,"mousemove",Ke),K(document,"touchmove",Ke)},_offUpEvents:function(){var t=this.el.ownerDocument;K(t,"mouseup",this._onDrop),K(t,"touchend",this._onDrop),K(t,"pointerup",this._onDrop),K(t,"touchcancel",this._onDrop),K(document,"selectstart",this)},_onDrop:function(t){var r=this.el,o=this.options;if(Ce=ke(B),je=ke(B,o.draggable),we("drop",this,{evt:t}),ie=B&&B.parentNode,Ce=ke(B),je=ke(B,o.draggable),U.eventCanceled){this._nulling();return}st=!1,St=!1,ht=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Gt(this.cloneId),Gt(this._dragStartId),this.nativeDraggable&&(K(document,"drop",this),K(r,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ct&&Z(document.body,"user-select",""),Z(B,"transform",""),t&&(ft&&(t.cancelable&&t.preventDefault(),!o.dropBubble&&t.stopPropagation()),j&&j.parentNode&&j.parentNode.removeChild(j),(ne===ie||ye&&ye.lastPutMode!=="clone")&&ae&&ae.parentNode&&ae.parentNode.removeChild(ae),B&&(this.nativeDraggable&&K(B,"dragend",this),qt(B),B.style["will-change"]="",ft&&!st&&ve(B,ye?ye.options.ghostClass:this.options.ghostClass,!1),ve(B,this.options.chosenClass,!1),Ee({sortable:this,name:"unchoose",toEl:ie,newIndex:null,newDraggableIndex:null,originalEvent:t}),ne!==ie?(Ce>=0&&(Ee({rootEl:ie,name:"add",toEl:ie,fromEl:ne,originalEvent:t}),Ee({sortable:this,name:"remove",toEl:ie,originalEvent:t}),Ee({rootEl:ie,name:"sort",toEl:ie,fromEl:ne,originalEvent:t}),Ee({sortable:this,name:"sort",toEl:ie,originalEvent:t})),ye&&ye.save()):Ce!==at&&Ce>=0&&(Ee({sortable:this,name:"update",toEl:ie,originalEvent:t}),Ee({sortable:this,name:"sort",toEl:ie,originalEvent:t})),U.active&&((Ce==null||Ce===-1)&&(Ce=at,je=mt),Ee({sortable:this,name:"end",toEl:ie,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){we("nulling",this),ne=B=ie=j=Xe=ae=kt=Ue=Ye=_e=ft=Ce=je=at=mt=lt=gt=ye=At=U.dragged=U.ghost=U.clone=U.active=null,Dt.forEach(function(t){t.checked=!0}),Dt.length=Xt=Yt=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":B&&(this._onDragOver(t),Lr(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],r,o=this.el.children,n=0,a=o.length,f=this.options;n<a;n++)r=o[n],Pe(r,f.draggable,this.el,!1)&&t.push(r.getAttribute(f.dataIdAttr)||jr(r));return t},sort:function(t,r){var o={},n=this.el;this.toArray().forEach(function(a,f){var y=n.children[f];Pe(y,this.options.draggable,n,!1)&&(o[a]=y)},this),r&&this.captureAnimationState(),t.forEach(function(a){o[a]&&(n.removeChild(o[a]),n.appendChild(o[a]))}),r&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,r){return Pe(t,r||this.options.draggable,this.el,!1)},option:function(t,r){var o=this.options;if(r===void 0)return o[t];var n=ut.modifyOption(this,t,r);typeof n<"u"?o[t]=n:o[t]=r,t==="group"&&Ho(o)},destroy:function(){we("destroy",this);var t=this.el;t[Ne]=null,K(t,"mousedown",this._onTapStart),K(t,"touchstart",this._onTapStart),K(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(K(t,"dragover",this),K(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(r){r.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),_t.splice(_t.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!Ue){if(we("hideClone",this),U.eventCanceled)return;Z(ae,"display","none"),this.options.removeCloneOnHide&&ae.parentNode&&ae.parentNode.removeChild(ae),Ue=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(Ue){if(we("showClone",this),U.eventCanceled)return;B.parentNode==ne&&!this.options.group.revertClone?ne.insertBefore(ae,B):Xe?ne.insertBefore(ae,Xe):ne.appendChild(ae),this.options.group.revertClone&&this.animate(B,ae),Z(ae,"display",""),Ue=!1}}};function Lr(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function Bt(t,r,o,n,a,f,y,d){var g,C=t[Ne],v=C.options.onMove,w;return window.CustomEvent&&!Oe&&!dt?g=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(g=document.createEvent("Event"),g.initEvent("move",!0,!0)),g.to=r,g.from=t,g.dragged=o,g.draggedRect=n,g.related=a||r,g.relatedRect=f||ce(r),g.willInsertAfter=d,g.originalEvent=y,t.dispatchEvent(g),v&&(w=v.call(C,g,y)),w}function qt(t){t.draggable=!1}function xr(){Jt=!1}function Rr(t,r,o){var n=ce(rt(o.el,0,o.options,!0)),a=Mo(o.el,o.options,j),f=10;return r?t.clientX<a.left-f||t.clientY<n.top&&t.clientX<n.right:t.clientY<a.top-f||t.clientY<n.bottom&&t.clientX<n.left}function Hr(t,r,o){var n=ce(Ut(o.el,o.options.draggable)),a=Mo(o.el,o.options,j),f=10;return r?t.clientX>a.right+f||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>a.bottom+f||t.clientX>n.right&&t.clientY>n.top}function Zr(t,r,o,n,a,f,y,d){var g=n?t.clientY:t.clientX,C=n?o.height:o.width,v=n?o.top:o.left,w=n?o.bottom:o.right,N=!1;if(!y){if(d&&It<C*a){if(!ht&&(gt===1?g>v+C*f/2:g<w-C*f/2)&&(ht=!0),ht)N=!0;else if(gt===1?g<v+It:g>w-It)return-gt}else if(g>v+C*(1-a)/2&&g<w-C*(1-a)/2)return Ur(r)}return N=N||y,N&&(g<v+C*f/2||g>w-C*f/2)?g>v+C/2?1:-1:0}function Ur(t){return ke(B)<ke(t)?1:-1}function jr(t){for(var r=t.tagName+t.className+t.src+t.href+t.textContent,o=r.length,n=0;o--;)n+=r.charCodeAt(o);return n.toString(36)}function Wr(t){Dt.length=0;for(var r=t.getElementsByTagName("input"),o=r.length;o--;){var n=r[o];n.checked&&Dt.push(n)}}function Mt(t){return setTimeout(t,0)}function Gt(t){return clearTimeout(t)}Tt&&q(document,"touchmove",function(t){(U.active||st)&&t.cancelable&&t.preventDefault()}),U.utils={on:q,off:K,css:Z,find:So,is:function(t,r){return!!Pe(t,r,t,!1)},extend:Pr,throttle:To,closest:Pe,toggleClass:ve,clone:Bo,index:ke,nextTick:Mt,cancelNextTick:Gt,detectDirection:Ro,getChild:rt},U.get=function(t){return t[Ne]},U.mount=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];r[0].constructor===Array&&(r=r[0]),r.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(U.utils=De(De({},U.utils),n.utils)),ut.mount(n)})},U.create=function(t,r){return new U(t,r)},U.version=Cr;var pe=[],yt,Qt,eo=!1,to,oo,Ft,bt;function Xr(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this))}return t.prototype={dragStarted:function(r){var o=r.originalEvent;this.sortable.nativeDraggable?q(document,"dragover",this._handleAutoScroll):this.options.supportPointer?q(document,"pointermove",this._handleFallbackAutoScroll):o.touches?q(document,"touchmove",this._handleFallbackAutoScroll):q(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(r){var o=r.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?K(document,"dragover",this._handleAutoScroll):(K(document,"pointermove",this._handleFallbackAutoScroll),K(document,"touchmove",this._handleFallbackAutoScroll),K(document,"mousemove",this._handleFallbackAutoScroll)),jo(),Ot(),_r()},nulling:function(){Ft=Qt=yt=eo=bt=to=oo=null,pe.length=0},_handleFallbackAutoScroll:function(r){this._handleAutoScroll(r,!0)},_handleAutoScroll:function(r,o){var n=this,a=(r.touches?r.touches[0]:r).clientX,f=(r.touches?r.touches[0]:r).clientY,y=document.elementFromPoint(a,f);if(Ft=r,o||this.options.forceAutoScrollFallback||dt||Oe||ct){ro(r,this.options,y,o);var d=Ze(y,!0);eo&&(!bt||a!==to||f!==oo)&&(bt&&jo(),bt=setInterval(function(){var g=Ze(document.elementFromPoint(a,f),!0);g!==d&&(d=g,Ot()),ro(r,n.options,g,o)},10),to=a,oo=f)}else{if(!this.options.bubbleScroll||Ze(y,!0)===Te()){Ot();return}ro(r,this.options,Ze(y,!1),!1)}}},Me(t,{pluginName:"scroll",initializeByDefault:!0})}function Ot(){pe.forEach(function(t){clearInterval(t.pid)}),pe=[]}function jo(){clearInterval(bt)}var ro=To(function(t,r,o,n){if(r.scroll){var a=(t.touches?t.touches[0]:t).clientX,f=(t.touches?t.touches[0]:t).clientY,y=r.scrollSensitivity,d=r.scrollSpeed,g=Te(),C=!1,v;Qt!==o&&(Qt=o,Ot(),yt=r.scroll,v=r.scrollFn,yt===!0&&(yt=Ze(o,!0)));var w=0,N=yt;do{var E=N,c=ce(E),l=c.top,m=c.bottom,s=c.left,i=c.right,p=c.width,u=c.height,b=void 0,z=void 0,A=E.scrollWidth,h=E.scrollHeight,$=Z(E),k=E.scrollLeft,P=E.scrollTop;E===g?(b=p<A&&($.overflowX==="auto"||$.overflowX==="scroll"||$.overflowX==="visible"),z=u<h&&($.overflowY==="auto"||$.overflowY==="scroll"||$.overflowY==="visible")):(b=p<A&&($.overflowX==="auto"||$.overflowX==="scroll"),z=u<h&&($.overflowY==="auto"||$.overflowY==="scroll"));var S=b&&(Math.abs(i-a)<=y&&k+p<A)-(Math.abs(s-a)<=y&&!!k),D=z&&(Math.abs(m-f)<=y&&P+u<h)-(Math.abs(l-f)<=y&&!!P);if(!pe[w])for(var M=0;M<=w;M++)pe[M]||(pe[M]={});(pe[w].vx!=S||pe[w].vy!=D||pe[w].el!==E)&&(pe[w].el=E,pe[w].vx=S,pe[w].vy=D,clearInterval(pe[w].pid),(S!=0||D!=0)&&(C=!0,pe[w].pid=setInterval((function(){n&&this.layer===0&&U.active._onTouchMove(Ft);var I=pe[this.layer].vy?pe[this.layer].vy*d:0,V=pe[this.layer].vx?pe[this.layer].vx*d:0;typeof v=="function"&&v.call(U.dragged.parentNode[Ne],V,I,t,Ft,pe[this.layer].el)!=="continue"||Vo(pe[this.layer].el,V,I)}).bind({layer:w}),24))),w++}while(r.bubbleScroll&&N!==g&&(N=Ze(N,!1)));eo=C}},30),Wo=function(t){var r=t.originalEvent,o=t.putSortable,n=t.dragEl,a=t.activeSortable,f=t.dispatchSortableEvent,y=t.hideGhostForTarget,d=t.unhideGhostForTarget;if(r){var g=o||a;y();var C=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:r,v=document.elementFromPoint(C.clientX,C.clientY);d(),g&&!g.el.contains(v)&&(f("spill"),this.onSpill({dragEl:n,putSortable:o}))}};function no(){}no.prototype={startIndex:null,dragStart:function(t){var r=t.oldDraggableIndex;this.startIndex=r},onSpill:function(t){var r=t.dragEl,o=t.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var n=rt(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(r,n):this.sortable.el.appendChild(r),this.sortable.animateAll(),o&&o.animateAll()},drop:Wo},Me(no,{pluginName:"revertOnSpill"});function ao(){}ao.prototype={onSpill:function(t){var r=t.dragEl,o=t.putSortable,n=o||this.sortable;n.captureAnimationState(),r.parentNode&&r.parentNode.removeChild(r),n.animateAll()},drop:Wo},Me(ao,{pluginName:"removeOnSpill"}),U.mount(new Xr),U.mount(ao,no);function Yr(t){return t==null?t:JSON.parse(JSON.stringify(t))}function Kr(t){e.getCurrentInstance()&&e.onUnmounted(t)}function Jr(t){e.getCurrentInstance()?e.onMounted(t):e.nextTick(t)}let Xo=null,Yo=null;function Ko(t=null,r=null){Xo=t,Yo=r}function qr(){return{data:Xo,clonedData:Yo}}const Jo=Symbol("cloneElement");function Gr(...t){var r,o;const n=(r=e.getCurrentInstance())==null?void 0:r.proxy;let a=null;const f=t[0];let[,y,d]=t;Array.isArray(e.unref(y))||(d=y,y=null);let g=null;const{immediate:C=!0,clone:v=Yr,customUpdate:w}=(o=e.unref(d))!=null?o:{};function N(h){var $;const{from:k,oldIndex:P,item:S}=h;a=Array.from(k.childNodes);const D=e.unref(($=e.unref(y))==null?void 0:$[P]),M=v(D);Ko(D,M),S[Jo]=M}function E(h){const $=h.item[Jo];if(!fr($)){if(Zt(h.item),e.isRef(y)){const k=[...e.unref(y)];y.value=wo(k,h.newDraggableIndex,$);return}wo(e.unref(y),h.newDraggableIndex,$)}}function c(h){const{from:$,item:k,oldIndex:P,oldDraggableIndex:S,pullMode:D,clone:M}=h;if(zo($,k,P),D==="clone"){Zt(M);return}if(e.isRef(y)){const I=[...e.unref(y)];y.value=$o(I,S);return}$o(e.unref(y),S)}function l(h){if(w){w(h);return}const{from:$,item:k,oldIndex:P,oldDraggableIndex:S,newDraggableIndex:D}=h;if(Zt(k),zo($,k,P),e.isRef(y)){const M=[...e.unref(y)];y.value=Eo(M,S,D);return}Eo(e.unref(y),S,D)}function m(h){const{newIndex:$,oldIndex:k,from:P,to:S}=h;let D=null;const M=$===k&&P===S;try{if(M){let I=null;a==null||a.some((V,R)=>{if(I&&(a==null?void 0:a.length)!==S.childNodes.length)return P.insertBefore(I,V.nextSibling),!0;const F=S.childNodes[R];I=S==null?void 0:S.replaceChild(V,F)})}}catch(I){D=I}finally{a=null}e.nextTick(()=>{if(Ko(),D)throw D})}const s={onUpdate:l,onStart:N,onAdd:E,onRemove:c,onEnd:m};function i(h){const $=e.unref(f);return h||(h=gr($)?hr($,n==null?void 0:n.$el):$),h&&!Er(h)&&(h=h.$el),h||void 0,h}function p(){var h;const $=(h=e.unref(d))!=null?h:{},{immediate:k,clone:P}=$,S=bo($,["immediate","clone"]);return vo(S,(D,M)=>{$r(D)&&(S[D]=(I,...V)=>{const R=qr();return wr(I,R),M(I,...V)})}),br(y===null?{}:s,S)}const u=h=>{h=i(h),g&&b.destroy(),g=new U(h,p())};e.watch(()=>d,()=>{g&&vo(p(),(h,$)=>{g==null||g.option(h,$)})},{deep:!0});const b={option:(h,$)=>g==null?void 0:g.option(h,$),destroy:()=>{g==null||g.destroy(),g=null},save:()=>g==null?void 0:g.save(),toArray:()=>g==null?void 0:g.toArray(),closest:(...h)=>g==null?void 0:g.closest(...h)},z=()=>b==null?void 0:b.option("disabled",!0),A=()=>b==null?void 0:b.option("disabled",!1);return Jr(()=>{C&&u()}),Kr(b.destroy),tt({start:u,pause:z,resume:A},b)}const so=["update","start","add","remove","choose","unchoose","end","sort","filter","clone","move","change"],Qr=["clone","animation","ghostClass","group","sort","disabled","store","handle","draggable","swapThreshold","invertSwap","invertedSwapThreshold","removeCloneOnHide","direction","chosenClass","dragClass","ignore","filter","preventOnFilter","easing","setData","dropBubble","dragoverBubble","dataIdAttr","delay","delayOnTouchOnly","touchStartThreshold","forceFallback","fallbackClass","fallbackOnBody","fallbackTolerance","fallbackOffset","supportPointer","emptyInsertThreshold","scroll","forceAutoScrollFallback","scrollSensitivity","scrollSpeed","bubbleScroll","modelValue","tag","target","customUpdate",...so.map(t=>`on${t.replace(/^\S/,r=>r.toUpperCase())}`)],en=e.defineComponent({name:"VueDraggable",model:{prop:"modelValue",event:"update:modelValue"},props:Qr,emits:["update:modelValue",...so],setup(t,{slots:r,emit:o,expose:n,attrs:a}){const f=so.reduce((v,w)=>{const N=`on${w.replace(/^\S/,E=>E.toUpperCase())}`;return v[N]=(...E)=>o(w,...E),v},{}),y=e.computed(()=>{const v=e.toRefs(t),{modelValue:w}=v,N=bo(v,["modelValue"]),E=Object.entries(N).reduce((c,[l,m])=>{const s=e.unref(m);return s!==void 0&&(c[l]=s),c},{});return tt(tt({},f),mr(tt(tt({},a),E)))}),d=e.computed({get:()=>t.modelValue,set:v=>o("update:modelValue",v)}),g=e.ref(),C=e.reactive(Gr(t.target||g,d,y));return n(C),()=>{var v;return e.h(t.tag||"div",{ref:g},(v=r==null?void 0:r.default)==null?void 0:v.call(r,C))}}}),tn={class:"zero-code-data-display"},on={class:"zero-code-data-tabs"},rn=["onClick"],nn={class:"zero-code-data-content"},an={key:0,class:"zero-code-data-section"},sn={key:0,class:"zero-code-rendered-content"},ln={class:"zero-code-add-part-button-container"},dn={class:"zero-code-component-header"},cn={class:"zero-code-header-actions"},pn=["onClick"],un=["onClick"],mn=["innerHTML"],fn={class:"zero-code-add-part-button-container"},gn=["onClick"],hn={key:1,class:"zero-code-no-data"},yn={class:"zero-code-empty-state"},bn={class:"zero-code-add-part-button-container"},En={key:1,class:"zero-code-data-section"},$n={class:"zero-code-data-display-section"},wn={class:"zero-code-parts-sub-content"},zn={class:"zero-code-parts-sub-section"},vn={class:"zero-code-data-display-pre"},Nn=e.defineComponent({__name:"DataDisplay",props:{modelValue:{type:String},pageData:{type:Array},parts:{type:Array},commonParts:{type:Array},individualParts:{type:Array},renderComponentWithNested:{type:Function},isTextEditing:{type:Boolean}},emits:["update:modelValue","add-part","edit-part","delete-part","reorder-parts"],setup(t,{emit:r}){const o=t,n=r,a=e.computed({get:()=>o.pageData,set:w=>{n("reorder-parts",w)}}),f=()=>{},y=()=>{},d=["rendered","page"],g=w=>({rendered:"レンダリング結果",source:"HTMLソース",page:"データ表示"})[w],C=e.computed(()=>v(o.pageData)),v=w=>{const N=(E,c=0)=>{const l="  ".repeat(c),m="  ".repeat(c+1);if(Array.isArray(E))return E.length===0?"[]":`[
${E.map(i=>m+N(i,c+1)).join(`,
`)}
${l}]`;if(typeof E=="object"&&E!==null){const s=Object.entries(E);return s.length===0?"{}":`{
${s.map(([p,u])=>{let b;if(typeof u=="string"){const z=u.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if(z.includes(`
`)){const A=z.split(`
`);b=A.map(($,k)=>k===0?`\`${$}`:k===A.length-1?`${m}${$}\``:`${m}${$}`).join(`
`)}else b=`"${z}"`}else b=N(u,c+1);return`${m}"${p}": ${b}`}).join(`,
`)}
${l}}`}return typeof E=="string"?`"${E.replace(/"/g,'\\"')}"`:JSON.stringify(E)};return N(w)};return(w,N)=>(e.openBlock(),e.createElementBlock("div",tn,[e.createElementVNode("div",on,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(d,E=>e.createElementVNode("button",{key:E,class:e.normalizeClass(["zero-code-data-tab-button",{active:w.modelValue===E}]),onClick:c=>w.$emit("update:modelValue",E)},e.toDisplayString(g(E)),11,rn)),64))]),e.createElementVNode("div",nn,[w.modelValue==="rendered"?(e.openBlock(),e.createElementBlock("div",an,[Array.isArray(w.pageData)&&w.pageData.length>0?(e.openBlock(),e.createElementBlock("div",sn,[e.createElementVNode("div",ln,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:N[0]||(N[0]=E=>w.$emit("add-part",0))},N[3]||(N[3]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"パーツを追加",-1)]))]),e.createVNode(e.unref(en),{modelValue:a.value,"onUpdate:modelValue":N[1]||(N[1]=E=>a.value=E),animation:200,disabled:w.isTextEditing,"ghost-class":"ghost","chosen-class":"chosen","drag-class":"drag",onStart:f,onEnd:y},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.pageData,(E,c)=>(e.openBlock(),e.createElementBlock("div",{key:E.id||c,class:"zero-code-rendered-component zero-code-draggable-item"},[e.createElementVNode("div",dn,[N[4]||(N[4]=e.createElementVNode("div",{class:"zero-code-drag-handle"},[e.createElementVNode("span",{class:"zero-code-drag-icon"},"⠿")],-1)),e.createElementVNode("div",cn,[e.createElementVNode("button",{class:"zero-code-edit-btn",onClick:l=>w.$emit("edit-part",c)},"編集",8,pn),e.createElementVNode("button",{class:"zero-code-delete-btn",onClick:l=>w.$emit("delete-part",c)},"削除",8,un)])]),e.createElementVNode("div",{class:"zero-code-component-preview",innerHTML:w.renderComponentWithNested(E,c)},null,8,mn),e.createElementVNode("div",fn,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:l=>w.$emit("add-part",c+1)},N[5]||(N[5]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"パーツを追加",-1)]),8,gn)])]))),128))]),_:1},8,["modelValue","disabled"])])):(e.openBlock(),e.createElementBlock("div",hn,[e.createElementVNode("div",yn,[N[7]||(N[7]=e.createElementVNode("p",{class:"zero-code-empty-message"},"パーツがありません",-1)),e.createElementVNode("div",bn,[e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:N[2]||(N[2]=E=>w.$emit("add-part",0))},N[6]||(N[6]=[e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1),e.createElementVNode("span",{class:"zero-code-button-text"},"最初のパーツを追加",-1)]))])])]))])):e.createCommentVNode("",!0),w.modelValue==="page"?(e.openBlock(),e.createElementBlock("div",En,[e.createElementVNode("div",$n,[e.createElementVNode("div",wn,[e.createElementVNode("div",zn,[N[8]||(N[8]=e.createElementVNode("h4",{style:{margin:"0 0 16px 0",color:"#374151","font-size":"1.1rem"}},"Pageデータ（リアルタイム更新）",-1)),e.createElementVNode("pre",vn,e.toDisplayString(C.value),1)])])])])):e.createCommentVNode("",!0)])]))}}),Cn={class:"zero-code-modal-header"},kn={class:"zero-code-data-tabs"},An=["onClick"],Pn={class:"zero-code-modal-body"},_n={key:0,class:"zero-code-parts-section"},Sn={key:0,class:"zero-code-parts-list"},In={class:"zero-code-part-section-title"},Dn={class:"zero-code-modules-grid"},Tn=["onClick"],Vn={class:"zero-code-module-title"},Bn=["innerHTML"],Mn={key:1,class:"zero-code-empty-state"},Fn={key:1,class:"zero-code-parts-section"},On={key:0,class:"zero-code-parts-list"},Ln={class:"zero-code-part-section-title"},xn={class:"zero-code-modules-grid"},Rn=["onClick"],Hn={class:"zero-code-module-title"},Zn=["innerHTML"],Un={key:1,class:"zero-code-empty-state"},qo=e.defineComponent({__name:"PartSelector",props:{parts:{type:Array},isNested:{type:Boolean,default:!1}},emits:["close","select-part"],setup(t,{emit:r}){const o=t,n=e.ref("common"),a=["common","individual"],f=w=>({common:"共通パーツ",individual:"個別パーツ"})[w],y=e.computed(()=>o.parts.map(w=>({...w,module:w.module.filter(N=>{const E=N;return!E.category||E.category==="common"})})).filter(w=>w.module.length>0)),d=e.computed(()=>o.parts.map(w=>({...w,module:w.module.filter(N=>N.category==="individual")})).filter(w=>w.module.length>0)),g=r,C=(w,N)=>{g("select-part",w,N)},v=w=>{if(!w)return"";try{let N=w;return N=N.replace(/@slot\(\$[^)]+\)@/g,'<div class="zero-code-slot-placeholder">ネストコンテンツ</div>'),N=N.replace(/\{\$([^:]+):([^}]*)\}/g,(E,c,l)=>({title:"サンプルタイトル",text:"サンプルテキストです。",image:"/sample-image.jpg",link:"#",url:"https://example.com",alt:"サンプル画像",content:"サンプルコンテンツ",description:"サンプル説明文です。"})[c]||l||`[${c}]`),N=N.replace(/\(\$([^:]+):([^)]+)\)/g,(E,c,l)=>l.split("|").filter(s=>s.trim())[0]||""),N=N.replace(/\(\$([^:?]+)\?:([^)]*)\)/g,(E,c,l)=>l||""),N=N.replace(/z-for-wrapper="[^"]*"/g,""),N=N.replace(/z-for="[^"]*"/g,""),N=N.replace(/z-slot="[^"]*"/g,""),N=N.replace(/\$(\w+)/g,(E,c)=>({title:"タイトル",text:"テキスト",content:"コンテンツ"})[c]||`[${c}]`),N}catch{return w}};return(w,N)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:N[2]||(N[2]=E=>w.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:N[1]||(N[1]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Cn,[e.createElementVNode("h4",null,e.toDisplayString(o.isNested?"ネストパーツを選択":"パーツを選択"),1),e.createElementVNode("button",{class:"zero-code-close-button",onClick:N[0]||(N[0]=E=>w.$emit("close"))},"✖️")]),e.createElementVNode("div",kn,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(a,E=>e.createElementVNode("button",{key:E,class:e.normalizeClass(["zero-code-data-tab-button",{active:n.value===E}]),onClick:c=>n.value=E},e.toDisplayString(f(E)),11,An)),64))]),e.createElementVNode("div",Pn,[n.value==="common"?(e.openBlock(),e.createElementBlock("div",_n,[y.value.length>0?(e.openBlock(),e.createElementBlock("div",Sn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,(E,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"zero-code-part-section"},[e.createElementVNode("h5",In,e.toDisplayString(E.type),1),e.createElementVNode("div",Dn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.module,(l,m)=>(e.openBlock(),e.createElementBlock("div",{key:m,class:"zero-code-module-card",onClick:s=>C(E.type,l)},[e.createElementVNode("div",Vn,e.toDisplayString(l.title),1),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:v(l.body)},null,8,Bn)],8,Tn))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",Mn,N[3]||(N[3]=[e.createElementVNode("p",null,"共通パーツが登録されていません。",-1)])))])):e.createCommentVNode("",!0),n.value==="individual"?(e.openBlock(),e.createElementBlock("div",Fn,[d.value.length>0?(e.openBlock(),e.createElementBlock("div",On,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(E,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"zero-code-part-section"},[e.createElementVNode("h5",Ln,e.toDisplayString(E.type),1),e.createElementVNode("div",xn,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.module,(l,m)=>(e.openBlock(),e.createElementBlock("div",{key:m,class:"zero-code-module-card",onClick:s=>C(E.type,l)},[e.createElementVNode("div",Hn,e.toDisplayString(l.title),1),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:v(l.body)},null,8,Zn)],8,Rn))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",Un,N[4]||(N[4]=[e.createElementVNode("p",null,"個別パーツが登録されていません。",-1)])))])):e.createCommentVNode("",!0)])])]))}}),jn={class:"zero-code-array-field"},Wn={class:"zero-code-array-header"},Xn={key:0,class:"zero-code-empty-array-message"},Yn={class:"zero-code-empty-message-content"},Kn={class:"zero-code-empty-text"},Jn={class:"zero-code-button-text"},qn=["onDragstart","onDrop"],Gn={class:"zero-code-array-item-header"},Qn={class:"zero-code-array-item-controls"},ea=["onClick"],ta={class:"zero-code-array-item-fields"},oa=["for"],ra={key:0,class:"zero-code-radio-group"},na=["id","value","name","checked","onChange"],aa=["for"],sa={key:1,class:"zero-code-checkbox-group"},la=["id","checked","onChange"],ia=["for"],da=["id","value","onInput"],ca=["value"],pa=["id","value","onChange"],ua=["value","selected"],ma=["id","value","onInput"],fa=["id","value","type","onInput"],ga={key:0,class:"zero-code-nested-array-field"},ha={class:"zero-code-nested-array-label"},ya={class:"zero-code-nested-array-info"},ba={class:"zero-code-array-count"},Ea=["onClick"],$a=e.defineComponent({__name:"ArrayFieldEditor",props:{componentId:{type:String},arrayKey:{type:String},items:{type:Array},fields:{type:Object},label:{type:String},itemLabel:{type:String}},emits:["add","remove","update","reorder","edit-nested"],setup(t,{emit:r}){const o=t,n=r,a=(E,c,l)=>{n("update",E,c,l)},f=(E,c,l)=>{const m=E[c];return Array.isArray(m)&&m.includes(l)},y=(E,c,l,m)=>{let i=o.items[E][c]||[];Array.isArray(i)||(i=[]),m?i.includes(l)||(i=[...i,l]):i=i.filter(p=>p!==l),n("update",E,c,i)};let d=null;const g=(E,c)=>{d=c,E.dataTransfer&&(E.dataTransfer.effectAllowed="move",E.dataTransfer.setData("text/plain",c.toString()));const l=E.target;l.style.opacity="0.5"},C=E=>{E.preventDefault(),E.dataTransfer&&(E.dataTransfer.dropEffect="move")},v=(E,c)=>{E.preventDefault(),d!==null&&d!==c&&n("reorder",d,c),d=null},w=E=>{const c=E.target;c.style.opacity="1",d=null},N=(E,c)=>!Array.isArray(c)||E==="id"||["nested_parts","content"].includes(E)?!1:c.length>0&&typeof c[0]=="object"&&c[0]!==null;return(E,c)=>(e.openBlock(),e.createElementBlock("div",jn,[e.createElementVNode("div",Wn,[e.createElementVNode("h5",null,e.toDisplayString(E.label),1),e.createElementVNode("button",{class:"zero-code-btn zero-code-add-array-item",onClick:c[0]||(c[0]=l=>E.$emit("add"))},"+ 追加")]),E.items.length===0?(e.openBlock(),e.createElementBlock("div",Xn,[e.createElementVNode("div",Yn,[e.createElementVNode("p",Kn,e.toDisplayString(E.label)+"はまだ追加されていません",1),e.createElementVNode("button",{class:"zero-code-btn zero-code-add-array-item-empty",onClick:c[1]||(c[1]=l=>E.$emit("add"))},[c[2]||(c[2]=e.createElementVNode("span",{class:"zero-code-plus-icon"},"＋",-1)),e.createElementVNode("span",Jn,"最初の"+e.toDisplayString(E.label)+"を追加",1)])])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.items,(l,m)=>(e.openBlock(),e.createElementBlock("div",{key:(l==null?void 0:l.id)||m,class:"zero-code-array-item",draggable:"true",onDragstart:s=>g(s,m),onDragover:C,onDrop:s=>v(s,m),onDragend:w},[e.createElementVNode("div",Gn,[e.createElementVNode("div",Qn,[c[3]||(c[3]=e.createElementVNode("span",{class:"zero-code-drag-handle"},"⠿",-1)),e.createElementVNode("h6",null,e.toDisplayString(E.itemLabel)+" "+e.toDisplayString(m+1),1)]),e.createElementVNode("button",{class:"zero-code-btn zero-code-remove-array-item",onClick:s=>E.$emit("remove",m)},"削除",8,ea)]),e.createElementVNode("div",ta,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.fields,(s,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"zero-code-field-group"},[e.createElementVNode("label",{for:`${E.componentId}_${E.arrayKey}_${m}_${i}`},e.toDisplayString(s.label)+": ",9,oa),s.type==="radio"&&s.options&&s.options.length>0?(e.openBlock(),e.createElementBlock("div",ra,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,p=>(e.openBlock(),e.createElementBlock("div",{key:p,class:"zero-code-radio-item"},[e.createElementVNode("input",{id:`${E.componentId}_${E.arrayKey}_${m}_${i}_${p}`,value:p,type:"radio",name:`${E.componentId}_${E.arrayKey}_${m}_${i}`,class:"zero-code-radio-input",checked:l[i]===p||p==="指定なし"&&!l[i],onChange:u=>a(m,i,p==="指定なし"?"":p)},null,40,na),e.createElementVNode("label",{for:`${E.componentId}_${E.arrayKey}_${m}_${i}_${p}`,class:"zero-code-radio-label"},e.toDisplayString(p),9,aa)]))),128))])):e.createCommentVNode("",!0),s.type==="checkbox"&&s.options&&s.options.length>0?(e.openBlock(),e.createElementBlock("div",sa,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,p=>(e.openBlock(),e.createElementBlock("div",{key:p,class:"zero-code-checkbox-item"},[e.createElementVNode("input",{id:`${E.componentId}_${E.arrayKey}_${m}_${i}_${p}`,checked:f(l,i,p),type:"checkbox",class:"zero-code-checkbox-input",onChange:u=>{const b=u.target;y(m,i,p,b.checked)}},null,40,la),e.createElementVNode("label",{for:`${E.componentId}_${E.arrayKey}_${m}_${i}_${p}`,class:"zero-code-checkbox-label"},e.toDisplayString(p),9,ia)]))),128))])):s.type==="select"?(e.openBlock(),e.createElementBlock("select",{key:2,id:`${E.componentId}_${E.arrayKey}_${m}_${i}`,value:l[i],class:"zero-code-field-input zero-code-select-input",onInput:p=>{const u=p.target;a(m,i,u.value)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,ca))),128))],40,da)):s.type==="select-multiple"?(e.openBlock(),e.createElementBlock("select",{key:3,id:`${E.componentId}_${E.arrayKey}_${m}_${i}`,value:l[i]||s.defaultValue,multiple:"",class:"zero-code-field-input zero-code-select-multiple",onChange:p=>{const u=p.target,b=Array.from(u.selectedOptions).map(z=>z.value);a(m,i,b)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p,selected:Array.isArray(l[i])&&l[i].includes(p)},e.toDisplayString(p),9,ua))),128))],40,pa)):s.type==="textarea"?(e.openBlock(),e.createElementBlock("textarea",{key:4,id:`${E.componentId}_${E.arrayKey}_${m}_${i}`,value:l[i],class:"zero-code-field-input zero-code-field-textarea",onInput:p=>{const u=p.target;a(m,i,u.value)}},null,40,ma)):s.type==="text"||s.type==="number"?(e.openBlock(),e.createElementBlock("input",{key:5,id:`${E.componentId}_${E.arrayKey}_${m}_${i}`,value:l[i],type:s.type==="text"?"text":s.type,class:"zero-code-field-input",onInput:p=>{const u=p.target;a(m,i,u.value)}},null,40,fa)):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l,(s,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:`nested_${i}`},[Array.isArray(s)&&i!=="id"&&N(i,s)?(e.openBlock(),e.createElementBlock("div",ga,[e.createElementVNode("h6",ha,e.toDisplayString(i)+" (ネスト配列)",1),e.createElementVNode("div",ya,[e.createElementVNode("span",ba,e.toDisplayString(s.length)+"個の要素",1),e.createElementVNode("button",{class:"zero-code-btn zero-code-edit-nested-array-btn",title:"ネスト配列を編集",onClick:p=>E.$emit("edit-nested",m,i)}," 編集 ",8,Ea)])])):e.createCommentVNode("",!0)],64))),128))])],40,qn))),128))]))}}),_={debug:(t,...r)=>{},info:(t,...r)=>{},warn:(t,...r)=>{},error:(t,...r)=>{},success:(t,...r)=>{},process:(t,...r)=>{},time:t=>{},timeEnd:t=>{},group:t=>{},groupEnd:()=>{}};var oe=(t=>(t.VALIDATION="VALIDATION",t.NETWORK="NETWORK",t.COMPONENT="COMPONENT",t.TEMPLATE="TEMPLATE",t.FILE="FILE",t.PERMISSION="PERMISSION",t.IMAGE_LOAD_FAILED="IMAGE_LOAD_FAILED",t.UNKNOWN="UNKNOWN",t.NETWORK_ERROR="NETWORK",t.VALIDATION_ERROR="VALIDATION",t.PERMISSION_ERROR="PERMISSION",t.COMPONENT_ERROR="COMPONENT",t.TEMPLATE_PARSE_ERROR="TEMPLATE",t.UNKNOWN_ERROR="UNKNOWN",t))(oe||{});class wa{constructor(){zt(this,"errorHistory",[]);zt(this,"maxHistorySize",100)}handleError(r,o,n,a,f){const y={type:r,message:o,details:n,componentId:a,action:f,timestamp:Date.now()};return this.errorHistory.unshift(y),this.errorHistory.length>this.maxHistorySize&&(this.errorHistory=this.errorHistory.slice(0,this.maxHistorySize)),r==="VALIDATION"||r==="PERMISSION"?_.warn(`[${r}] ${o}`,n):_.error(`[${r}] ${o}`,n),y}componentError(r,o,n){return this.handleError("COMPONENT",r,n,o,"component_operation")}templateError(r,o){return this.handleError("TEMPLATE",r,o,void 0,"template_processing")}validationError(r,o){return this.handleError("VALIDATION",r,o,void 0,"validation")}fileError(r,o){return this.handleError("FILE",r,o,void 0,"file_operation")}networkError(r,o){return this.handleError("NETWORK",r,o,void 0,"network_request")}permissionError(r,o){return this.handleError("PERMISSION",r,o,void 0,"permission_check")}unknownError(r,o){return this.handleError("UNKNOWN",r,o,void 0,"unknown")}getErrorHistory(){return[...this.errorHistory]}getErrorsByType(r){return this.errorHistory.filter(o=>o.type===r)}clearHistory(){this.errorHistory=[],_.debug("エラー履歴をクリアしました")}getErrorStats(){const r=Object.values(oe).reduce((o,n)=>(o[n]=0,o),{});return this.errorHistory.forEach(o=>{r[o.type]++}),r}}function Ve(t,r,o,n="UNKNOWN"){try{return t()}catch(a){return r.handleError(n,o,a),null}}const Be=new wa,za=["content","nested_parts"],Go=["_isZForItem","_parentComponentId","_arrayName","_arrayIndex","_zForTemplate"];function Lt(t){const r=(h,$)=>{if($.length===0||$[0]>=h.length)return null;let k=h[$[0]];for(let P=1;P<$.length;P++){if(!k.nested_parts||!Array.isArray(k.nested_parts)||$[P]>=k.nested_parts.length)return null;k=k.nested_parts[$[P]]}return k},o=(h,$)=>{if($.length===1)return h;let k=h[$[0]];for(let P=1;P<$.length-1;P++){if(!k.nested_parts||!Array.isArray(k.nested_parts))return[];k=k.nested_parts[$[P]]}return k.nested_parts||[]},n=h=>h.split("-").map(Number),a=h=>h.join("-"),f=(h,$,k=[])=>{if(_.debug(`findComponentRecursively: 検索開始 - componentId=${$}, depth=${k.length}`),!h||!Array.isArray(h))return _.debug(`findComponentRecursively: 無効なデータ - data=${h}, isArray=${Array.isArray(h)}`),null;_.debug(`findComponentRecursively: ${h.length}個のコンポーネントを検索中`);for(let P=0;P<h.length;P++){const S=h[P],D=[...k,P];if(_.debug(`findComponentRecursively: [${P}] チェック中 - id=${S.id}, type=${S.type}`),S.id===$)return _.success(`findComponentRecursively: 発見！ - ${$} at path=${D.join("-")}`),S;if(S.nested_parts&&Array.isArray(S.nested_parts)){_.debug(`findComponentRecursively: nested_parts検索 - ${S.id} (${S.nested_parts.length}個)`);const I=f(S.nested_parts,$,D);if(I)return I}const M=Object.keys(S);for(const I of M){const V=S[I];if(Array.isArray(V)&&I!=="nested_parts"){_.debug(`findComponentRecursively: z-for配列検索 - ${S.id}.${I} (${V.length}個)`);for(let R=0;R<V.length;R++){const F=V[R];if(F&&typeof F=="object"&&F.id){if(_.debug(`findComponentRecursively: z-for配列アイテム - ${F.id} in ${S.id}.${I}[${R}]`),F.id===$)return _.success(`findComponentRecursively: z-for配列アイテムで発見！ - ${$}`),F;if(F.nested_parts&&Array.isArray(F.nested_parts)){_.debug(`findComponentRecursively: z-for配列アイテムのネストパーツ検索 - ${F.id}.nested_parts (${F.nested_parts.length}個)`);const X=f(F.nested_parts,$,[...D,R]);if(X)return _.success(`findComponentRecursively: z-for配列内のネストパーツで発見！ - ${$}`),X}}}}}}return _.debug(`findComponentRecursively: 未発見 - ${$}`),null},y=(h,$)=>Ve(()=>{if(!Array.isArray(t))throw new Error("Parts配列が無効です");if(!h||!$)throw new Error("Type または ModuleName が指定されていません");const k=t.find(S=>S.type===h);if(!k)throw new Error(`パーツタイプ "${h}" が見つかりません`);const P=k.module.find(S=>S.title===$);if(!P)throw new Error(`モジュール "${$}" が見つかりません (type: ${h})`);return P.body},Be,`テンプレート取得エラー: ${h}/${$}`,oe.TEMPLATE)||"",d=new Set,g=(h,$)=>{_.debug(`extractZForTemplate開始: arrayName=${$}`);const k=new RegExp(`<div[^>]*z-for="${$}"[^>]*>`),P=h.match(k);if(!P)return _.warn(`z-for="${$}" 開始タグが見つかりません`),_.debug("親テンプレート内容:",h.substring(0,500)),"";const S=h.indexOf(P[0]);let D=0,M=S,I=S;for(;I<h.length;)if(h.substring(I,I+4)==="<div"){const R=h.indexOf(">",I);R!==-1?(D++,I=R+1):I++}else if(h.substring(I,I+6)==="</div>"){if(D--,D===0){M=I+6;break}I+=6}else I++;if(D!==0)return _.warn(`z-for="${$}" の対応する終了タグが見つかりません（深度: ${D}）`),"";const V=h.substring(S,M).trim();return _.debug(`z-for内テンプレート抽出成功: ${$}`,{extractedContent:V.substring(0,200),fullContent:V,startIndex:S,endIndex:M,depth:0}),V},C=()=>"comp_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36),v=h=>{const $=`${h.id}_${h.type}_${h.module_name}`;if(d.has($))return _.warn(`getFieldInfo: 無限ループを検出、処理をスキップ: ${$}`),[];d.add($);try{let k=y(h.type,h.module_name);if(!k)return[];if(_.debug(`getFieldInfo: component.id=${h.id}, type=${h.type}, module=${h.module_name}`),_.debug(`getFieldInfo: _isZForItem=${h._isZForItem}`),h._isZForItem){const I=h._arrayName;if(_.debug(`getFieldInfo: z-for配列要素を検出, arrayName=${I}`),_.debug("getFieldInfo: componentプロパティ:",Object.keys(h)),I){_.debug("getFieldInfo: 元のテンプレート:",k.substring(0,300));const V=g(k,I);V?(k=V,_.debug("getFieldInfo: z-for内テンプレート抽出完了:",k)):_.warn(`getFieldInfo: z-for内テンプレートの抽出に失敗: arrayName=${I}`)}}else _.debug("getFieldInfo: 通常のコンポーネント処理");const P=[],S=k.match(/\(\$([^:]+):(.*?)\)/g)||[],D=[];if(k.includes("z-for=")){const I=/<div[^>]*z-for="([^"]+)"[^>]*>/g;let V;for(;(V=I.exec(k))!==null;){const R=V[1],F=V.index;let X=0,L=F,x=F;for(;x<k.length;){if(k.substring(x,x+4)==="<div")X++;else if(k.substring(x,x+6)==="</div>"&&(X--,X===0)){L=x+6;break}x++}if(X===0){const ee=k.substring(F,L).match(/\(\$([^:]+):(.*?)\)/g);ee&&ee.forEach(Ae=>{const Se=Ae.match(/\(\$([^:]+):(.*?)\)/);if(Se){const ge=Se[1].replace("?","");D.push(ge)}})}}}D.length>0&&_.debug("z-for配列内のフィールドを除外:",D);let M;return h._isZForItem?M=S.filter(I=>{const V=I.match(/\(\$([^:]+):(.*?)\)/);if(V){const R=V[1].replace("?",""),F=D.includes(R);return F&&_.debug(`z-for配列アイテム編集: フィールド ${R} を表示`),F}return!1}):M=S.filter(I=>{const V=I.match(/\(\$([^:]+):(.*?)\)/);if(V){const R=V[1].replace("?",""),F=D.includes(R);return F&&_.debug(`フィールド ${R} を z-for内フィールドとして除外`),!F}return!0}),M.forEach(I=>{const V=I.match(/\(\$([^:]+):(.*?)\)/);if(V){const[,R,F]=V,X=R.includes("?"),L=R.replace("?","");if(F.includes("|")){let x=F.split("|"),J=!1;if((F.includes("||")||F.startsWith("|")||F.endsWith("|"))&&(J=!0),x=x.filter(ee=>ee.trim()!==""),J&&x.unshift("指定なし"),X){const ee=x.length>0?[x[0]]:[],Ae={type:"checkbox",paramName:L,propKey:L,options:x,defaultValue:ee,label:`${L} (チェックボックス)`};P.push(Ae)}else{const ee=x[0]||"",Ae={type:"radio",paramName:L,propKey:L,options:x,defaultValue:ee,label:`${L} (ラジオボタン)`};P.push(Ae)}}else if(F.includes(",")){const x=F.split(",").map(J=>J.trim()).filter(J=>J!=="");if(X){const J=x.length>0?[x[0]]:[],ee={type:"select-multiple",paramName:L,propKey:L,options:x,defaultValue:J,label:`${L} (セレクトボックス・複数選択)`};P.push(ee)}else{const J=x[0]||"",ee={type:"select",paramName:L,propKey:L,options:x,defaultValue:J,label:`${L} (セレクトボックス)`};P.push(ee)}}else{const x={type:"text",paramName:L,propKey:L,options:[],defaultValue:F,label:`${L} (テキストボックス)`};P.push(x)}}}),_.debug(`getFieldInfo: 抽出されたフィールド数=${P.length}`,P.map(I=>({paramName:I.paramName,type:I.type}))),P}catch(k){return _.error(`getFieldInfo: エラーが発生しました: ${$}`,k),[]}finally{d.delete($)}},w=(h,$)=>{try{const k=y(h.type,h.module_name);if(!k)return!1;let P=k;if(h._isZForItem){const I=h._arrayName,V=g(k,I);V&&(P=V)}const S=new RegExp(`\\{\\$${$}:[^}]*\\}`),D=new RegExp(`\\(\\$${$}:[^)]*\\)`),M=new RegExp(`\\(\\$${$}\\?:[^)]*\\)`);return S.test(P)||D.test(P)||M.test(P)}catch(k){return _.warn(`isTemplateField error for ${$}:`,k),!1}},N=(h,$)=>!!(["content","nested_parts"].includes(h)||Array.isArray($)||typeof $=="object"&&$!==null);return{findComponentByPath:r,getParentContainer:o,parseHierarchyPath:n,stringifyHierarchyPath:a,findComponentRecursively:f,getTemplate:y,generateUniqueId:C,getFieldInfo:v,isTemplateField:w,shouldExcludeField:N,shouldShowBasicField:(h,$,k)=>h==="id"||h==="type"||h==="module_name"||k._isZForItem||Go.includes(h)||N(h,$)||w(k,h)||$===""||$===null||$===void 0||typeof $=="string"&&$.trim()===""||typeof $=="number"&&$===0?!1:typeof $=="string"&&$.trim()!==""||typeof $=="number"&&$!==0||typeof $=="boolean",shouldShowArrayField:(h,$,k)=>{const P=`${k.id}_${k.type}_${k.module_name}_array_${h}`;if(d.has(P))return _.warn(`shouldShowArrayField: 無限ループを検出、処理をスキップ: ${P}`),!1;d.add(P);try{if(_.debug(`shouldShowArrayField開始: key=${h}, component: ${k.id} (${k.type}/${k.module_name})`,{key:h,value:$,componentId:k.id}),za.includes(String(h)))return _.debug(`shouldShowArrayField: ${h} はシステム内部フィールドのため除外`),!1;if(k._isZForItem&&Go.includes(String(h)))return _.debug(`shouldShowArrayField: ${h} はz-forシステムフィールドのため除外`),!1;if(w(k,h))return _.debug(`shouldShowArrayField: ${h} はテンプレート記法フィールドのため除外`),!1;const S=y(k.type,k.module_name);if(S){if(_.debug("shouldShowArrayField: テンプレート取得成功:",S.substring(0,200)),new RegExp(`z-for="${h}"`).test(S))return _.success(`shouldShowArrayField: ${h}はz-for記法で使用されているため編集パネルでは非表示（プレビュー側で編集）`),Array.isArray($)||(_.debug(`shouldShowArrayField: ${h}は配列でないが、記法で使用されているため空配列で初期化`),k[h]=[]),!1;_.debug(`shouldShowArrayField: ${h}は配列記法で使用されていない`)}else _.debug("shouldShowArrayField: テンプレート取得失敗");return Array.isArray($)||_.debug(`shouldShowArrayField: ${h}は配列でなく、記法でも使用されていない`),!1}catch(S){return _.error(`shouldShowArrayField: エラーが発生しました: ${P}`,S),!1}finally{d.delete(P)}},shouldShowArrayItemField:(h,$,k,P,S)=>h==="id"||Array.isArray($)||typeof $=="object"&&$!==null||$===""||$===null||$===void 0||typeof $=="string"&&$.trim()===""||typeof $=="number"&&$===0?!1:(y(k.type,k.module_name),typeof $=="string"&&$.trim()!==""||typeof $=="number"&&$!==0||typeof $=="boolean"),getInputType:h=>h.includes("url")||h.includes("src")?"url":h.includes("email")?"email":h.includes("number")||h.includes("count")?"number":"text",updateCheckboxValue:(h,$,k,P)=>{h[$]||(h[$]=[]);const S=h[$];P?S.includes(k)||S.push(k):h[$]=S.filter(D=>D!==k)},isCheckboxChecked:(h,$,k)=>{const P=h[$];return Array.isArray(P)&&P.includes(k)},addArrayItem:(h,$)=>{h[$]||(h[$]=[]);const k={id:`${$}_${Date.now()}`},P=h[$];if(P.length>0){const S=P[0];Object.keys(S).forEach(D=>{D!=="id"&&(k[D]=typeof S[D]=="string"?"":S[D])})}P.push(k)},removeArrayItem:(h,$,k)=>{const P=h[$];P&&P.length>k&&P.splice(k,1)},createNewComponent:(h,$)=>Ve(()=>{if(!h||!$)throw new Error("partType または module が指定されていません");if(!$.title||!$.body)throw new Error("module.title または module.body が無効です");const k=C();_.debug(`createNewComponent開始: partType=${h}, module=${$.title}`);const P={id:k,type:h,module_name:$.title},S=$.body;_.debug("createNewComponent テンプレート:",S.substring(0,300));const D=S.match(/\{\$([^:}]+):([^}]+)\}/g);D&&D.forEach(R=>{const F=R.match(/\{\$([^:}]+):([^}]+)\}/);if(F){const[,X,L]=F;X!=="input"&&(P[X]=String(L))}});const M=S.match(/\(\$([^:?]+):(.*?)\)/g);M&&M.forEach(R=>{const F=R.match(/\(\$([^:?]+):(.*?)\)/);if(F){const[,X,L]=F,x=L.split("|").filter(J=>J.trim()!=="");x.length>0&&(P[X]=String(x[0]))}});const I=S.match(/\(\$([^:?]+)\?:(.*?)\)/g);I&&I.forEach(R=>{const F=R.match(/\(\$([^:?]+)\?:(.*?)\)/);if(F){const[,X,L]=F,x=L.split("|").filter(J=>J.trim()!=="");P[X]=x.length>0?[x[0]]:[]}});const V=S.match(/z-for="([^"]+)"/g);return V?(_.debug("createNewComponent: z-for記法発見:",V),V.forEach(R=>{const F=R.match(/z-for="([^"]+)"/);if(F){const[,X]=F;P[X]?_.debug(`createNewComponent: z-for配列 ${X} は既に初期化済み`):(_.debug(`createNewComponent: z-for配列 ${X} を空配列で初期化`),P[X]=[])}})):_.debug("createNewComponent: z-for記法が見つかりませんでした"),_.debug("createNewComponent完了: newComponent=",P),P},Be,`コンポーネント作成エラー: ${h}/${$==null?void 0:$.title}`,oe.COMPONENT)||{id:C(),type:h||"unknown",module_name:($==null?void 0:$.title)||"unknown"},createArrayItem:h=>{const $={id:C()},k=h.match(/\{\$([^:}]+):([^}]+)\}/g);k&&k.forEach(S=>{const D=S.match(/\{\$([^:}]+):([^}]+)\}/);if(D){const[,M,I]=D;$[M]=String(I)}});const P=h.match(/\(\$([^:?]+):(.*?)\)/g);return P&&P.forEach(S=>{const D=S.match(/\(\$([^:?]+):(.*?)\)/);if(D){const[,M,I]=D,V=I.split("|").filter(R=>R.trim()!=="");V.length>0&&($[M]=String(V[0]))}}),$},getArrayItemFieldInfo:(h,$)=>{const k=y(h.type,h.module_name);if(!k)return[];const P=[];let S="";const D=g(k,$);return D&&(S=D),S&&(S.match(/\(\$([^:]+):(.*?)\)/g)||[]).forEach(I=>{const V=I.match(/\(\$([^:]+):(.*?)\)/);if(V){const[,R,F]=V,X=R.includes("?"),L=R.replace("?","");if(F.includes("|")){let x=F.split("|"),J=!1;if((F.includes("||")||F.startsWith("|")||F.endsWith("|"))&&(J=!0),x=x.filter(ee=>ee.trim()!==""),J&&x.unshift("指定なし"),X){const ee=x.length>0?[x[0]]:[],Ae={type:"checkbox",paramName:L,propKey:L,options:x,defaultValue:ee,label:`${L} (チェックボックス)`};P.push(Ae)}else{const ee=x[0]||"",Ae={type:"radio",paramName:L,propKey:L,options:x,defaultValue:ee,label:`${L} (ラジオボタン)`};P.push(Ae)}}else if(F.includes(",")){const x=F.split(",").map(J=>J.trim()).filter(J=>J!=="");if(X){const J=x.length>0?[x[0]]:[],ee={type:"select-multiple",paramName:L,propKey:L,options:x,defaultValue:J,label:`${L} (セレクトボックス・複数選択)`};P.push(ee)}else{const J=x[0]||"",ee={type:"select",paramName:L,propKey:L,options:x,defaultValue:J,label:`${L} (セレクトボックス)`};P.push(ee)}}else{const x={type:"text",paramName:L,propKey:L,options:[],defaultValue:F,label:`${L} (テキストボックス)`};P.push(x)}}}),P}}}const va={class:"zero-code-content-sidebar"},Na={key:0,class:"zero-code-editable-component"},Ca={class:"zero-code-component-info"},ka={class:"zero-code-component-type"},Aa={class:"zero-code-component-module"},Pa={class:"zero-code-component-id"},_a={class:"zero-code-fields"},Sa={class:"zero-code-field-label"},Ia={key:0,class:"zero-code-text-group"},Da=["value","onInput"],Ta={key:1,class:"zero-code-radio-group"},Va=["id","value","name","checked","onChange"],Ba=["for"],Ma={key:2,class:"zero-code-checkbox-group"},Fa=["id","checked","onChange"],Oa=["for"],La={key:3,class:"zero-code-select-group"},xa=["value","onChange"],Ra=["value"],Ha={key:4,class:"zero-code-select-multiple-group"},Za=["value","onChange"],Ua=["value","selected"],ja={key:0,class:"zero-code-field-group"},Wa=["for"],Xa=["id","value","type","readonly","onInput"],Ya=e.defineComponent({__name:"EditorPanel",props:{showEditor:{type:Boolean},selectedComponent:{type:[Object,null]},getFieldInfo:{type:Function},shouldShowBasicField:{type:Function},shouldShowArrayField:{type:Function},shouldShowArrayItemField:{type:Function},getInputType:{type:Function},isCheckboxChecked:{type:Function},partsData:{type:Array}},emits:["close","update:value","update:array-item","update:checkbox","add:array-item","remove:array-item","reorder:array-item"],setup(t,{emit:r}){const o=t,n=r,a=()=>{n("close")},f=(l,m)=>{n("update:value",l,m)},y=()=>{if(!o.selectedComponent)return;o.getFieldInfo(o.selectedComponent).forEach(m=>{m.defaultValue&&!o.selectedComponent[m.propKey]&&((m.type==="checkbox"||m.type==="select-multiple")&&Array.isArray(m.defaultValue)?f(m.propKey,[...m.defaultValue]):f(m.propKey,m.defaultValue))})};e.watch(()=>o.selectedComponent,l=>{l&&y()},{immediate:!0});const d=(l,m,s,i)=>{if(!o.selectedComponent)return;const p=o.selectedComponent[l];if(!Array.isArray(p))return;const u={...p[m],[s]:i};n("update:array-item",l,m,u)},g=(l,m,s)=>{n("update:checkbox",l,m,s)},C=(l,m)=>{l&&n("add:array-item",m)},v=(l,m,s)=>{l&&n("remove:array-item",m,s)},w=(l,m,s)=>{if(!o.selectedComponent)return;const i=o.selectedComponent[l];if(!Array.isArray(i))return;const p=[...i],[u]=p.splice(m,1);p.splice(s,0,u),o.selectedComponent[l]=p,n("reorder:array-item",l,m,s)},N=l=>{if(!o.selectedComponent)return{};const m={};if(o.partsData){const p=Lt(o.partsData).getArrayItemFieldInfo(o.selectedComponent,l);if(p.forEach(u=>{m[u.propKey]={label:u.label,type:u.type,options:u.options,defaultValue:u.defaultValue}}),p.length>0)return m}const s=o.selectedComponent[l];if(Array.isArray(s)&&s.length>0){const i=s[0];typeof i=="object"&&i!==null&&Object.keys(i).forEach(p=>{p!=="id"&&(i[p],m[p]={label:p.replace(/_/g," ").replace(/\b\w/g,u=>u.toUpperCase()),type:p.includes("desc")||p.includes("content")?"textarea":"text"})})}return Object.keys(m).length===0?{title:{label:"タイトル",type:"text"},content:{label:"内容",type:"textarea"}}:m},E=l=>l.replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase()).concat(" 一覧"),c=l=>{let m=l;return l.endsWith("s")&&(m=l.slice(0,-1)),m.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())};return(l,m)=>l.showEditor&&l.selectedComponent?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-overlay",onClick:a},[e.createElementVNode("div",{class:"zero-code-sidebar",onClick:m[0]||(m[0]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",{class:"zero-code-header"},[m[1]||(m[1]=e.createElementVNode("h4",null,"コンポーネント編集",-1)),e.createElementVNode("div",{class:"zero-code-header-buttons"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-close-button",onClick:a},"✖️")])]),e.createElementVNode("div",va,[l.selectedComponent?(e.openBlock(),e.createElementBlock("div",Na,[e.createElementVNode("div",Ca,[e.createElementVNode("span",ka,e.toDisplayString(l.selectedComponent.type),1),e.createElementVNode("span",Aa,e.toDisplayString(l.selectedComponent.module_name),1),e.createElementVNode("span",Pa,"ID: "+e.toDisplayString(l.selectedComponent.id),1)]),e.createElementVNode("div",_a,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.getFieldInfo(l.selectedComponent),s=>(e.openBlock(),e.createElementBlock("div",{key:s.propKey,class:"zero-code-template-field"},[e.createElementVNode("label",Sa,e.toDisplayString(s.label)+":",1),s.type==="text"?(e.openBlock(),e.createElementBlock("div",Ia,[e.createElementVNode("input",{value:l.selectedComponent[s.propKey]||s.defaultValue,type:"text",class:"zero-code-field-input",onInput:i=>{const p=i.target;f(s.propKey,p.value)}},null,40,Da)])):e.createCommentVNode("",!0),s.type==="radio"?(e.openBlock(),e.createElementBlock("div",Ta,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,i=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"zero-code-radio-item"},[e.createElementVNode("input",{id:`${l.selectedComponent.id}_${s.propKey}_${i}`,value:i,type:"radio",name:`${l.selectedComponent.id}_${s.propKey}`,class:"zero-code-radio-input",checked:l.selectedComponent[s.propKey]===i||i==="指定なし"&&!l.selectedComponent[s.propKey],onChange:p=>f(s.propKey,i==="指定なし"?"":i)},null,40,Va),e.createElementVNode("label",{for:`${l.selectedComponent.id}_${s.propKey}_${i}`,class:"zero-code-radio-label"},e.toDisplayString(i),9,Ba)]))),128))])):e.createCommentVNode("",!0),s.type==="checkbox"?(e.openBlock(),e.createElementBlock("div",Ma,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,i=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"zero-code-checkbox-item"},[e.createElementVNode("input",{id:`${l.selectedComponent.id}_${s.propKey}_${i}`,checked:l.isCheckboxChecked(l.selectedComponent,s.propKey,i)||Array.isArray(s.defaultValue)&&s.defaultValue.includes(i)&&!l.selectedComponent[s.propKey],type:"checkbox",class:"zero-code-checkbox-input",onChange:p=>{const u=p.target;g(s.propKey,i,u.checked)}},null,40,Fa),e.createElementVNode("label",{for:`${l.selectedComponent.id}_${s.propKey}_${i}`,class:"zero-code-checkbox-label"},e.toDisplayString(i),9,Oa)]))),128))])):e.createCommentVNode("",!0),s.type==="select"?(e.openBlock(),e.createElementBlock("div",La,[e.createElementVNode("select",{value:l.selectedComponent[s.propKey]||s.defaultValue,class:"zero-code-field-input zero-code-select-input",onChange:i=>{const p=i.target;f(s.propKey,p.value)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,Ra))),128))],40,xa)])):e.createCommentVNode("",!0),s.type==="select-multiple"?(e.openBlock(),e.createElementBlock("div",Ha,[e.createElementVNode("select",{value:l.selectedComponent[s.propKey]||s.defaultValue,multiple:"",class:"zero-code-field-input zero-code-select-multiple",onChange:i=>{const p=i.target,u=Array.from(p.selectedOptions).map(b=>b.value);f(s.propKey,u)}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i,selected:Array.isArray(l.selectedComponent[s.propKey])&&l.selectedComponent[s.propKey].includes(i)},e.toDisplayString(i),9,Ua))),128))],40,Za)])):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.selectedComponent,(s,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:String(i)},[l.shouldShowBasicField(String(i),s,l.selectedComponent)?(e.openBlock(),e.createElementBlock("div",ja,[e.createElementVNode("label",{for:`${l.selectedComponent.id}_${String(i)}`},e.toDisplayString(i)+":",9,Wa),e.createElementVNode("input",{id:`${l.selectedComponent.id}_${String(i)}`,value:s,type:l.getInputType(String(i)),class:"zero-code-field-input",readonly:String(i)==="id",onInput:p=>{const u=p.target;f(String(i),u.value)}},null,40,Xa)])):e.createCommentVNode("",!0)],64))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.selectedComponent,(s,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:String(i)},[l.shouldShowArrayField(String(i),s,l.selectedComponent)?(e.openBlock(),e.createBlock($a,{key:0,"component-id":l.selectedComponent.id,"array-key":String(i),items:Array.isArray(s)?s:[],fields:N(String(i)),label:E(String(i)),"item-label":c(String(i)),onAdd:()=>C(l.selectedComponent,String(i)),onRemove:p=>v(l.selectedComponent,String(i),p),onReorder:(p,u)=>w(String(i),p,u),onUpdate:(p,u,b)=>d(String(i),p,u,b)},null,8,["component-id","array-key","items","fields","label","item-label","onAdd","onRemove","onReorder","onUpdate"])):e.createCommentVNode("",!0)],64))),128))])])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)}}),Ka={class:"zero-code-tab-content"},Ja=e.defineComponent({__name:"EditorMainPanel",props:{dataTab:{type:String},editablePageData:{type:Array},localParts:{type:Array},localCommonParts:{type:Array},localIndividualParts:{type:Array},parts:{type:Array},showPartSelector:{type:Boolean},showNestedPartSelector:{type:Boolean},showEditor:{type:Boolean},selectedComponent:{type:[Object,null]},renderComponentWithNested:{type:Function},getFieldInfo:{type:Function},shouldShowBasicField:{type:Function},shouldShowArrayField:{type:Function},shouldShowArrayItemField:{type:Function},getInputType:{type:Function},isCheckboxChecked:{type:Function},partsData:{type:Array},isTextEditing:{type:Boolean}},emits:["update:data-tab","add-part","edit-part","delete-part","reorder-parts","close-part-selector","select-part","close-nested-part-selector","select-nested-part","close-editor","update-editor-value","add-array-item","remove-array-item","update-array-item","update-checkbox"],setup(t,{emit:r}){return(o,n)=>(e.openBlock(),e.createElementBlock("div",Ka,[e.createVNode(Nn,{"model-value":o.dataTab,"page-data":o.editablePageData,parts:o.localParts&&o.localParts.length>0?o.localParts:o.parts||[],"common-parts":o.localCommonParts,"individual-parts":o.localIndividualParts,"render-component-with-nested":o.renderComponentWithNested,"is-text-editing":o.isTextEditing,"onUpdate:modelValue":n[0]||(n[0]=a=>o.$emit("update:data-tab",a)),onAddPart:n[1]||(n[1]=a=>o.$emit("add-part",a)),onEditPart:n[2]||(n[2]=a=>o.$emit("edit-part",a)),onDeletePart:n[3]||(n[3]=a=>o.$emit("delete-part",a)),onReorderParts:n[4]||(n[4]=a=>o.$emit("reorder-parts",a))},null,8,["model-value","page-data","parts","common-parts","individual-parts","render-component-with-nested","is-text-editing"]),o.showPartSelector?(e.openBlock(),e.createBlock(qo,{key:0,parts:o.localParts&&o.localParts.length>0?o.localParts:o.parts||[],onClose:n[5]||(n[5]=a=>o.$emit("close-part-selector")),onSelectPart:n[6]||(n[6]=(a,f)=>o.$emit("select-part",a,f))},null,8,["parts"])):e.createCommentVNode("",!0),o.showNestedPartSelector?(e.openBlock(),e.createBlock(qo,{key:1,parts:o.localParts&&o.localParts.length>0?o.localParts:o.parts||[],"is-nested":!0,onClose:n[7]||(n[7]=a=>o.$emit("close-nested-part-selector")),onSelectPart:n[8]||(n[8]=(a,f)=>o.$emit("select-nested-part",a,f))},null,8,["parts"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(Ya,{key:2,"show-editor":o.showEditor,"selected-component":o.selectedComponent,"get-field-info":o.getFieldInfo,"should-show-basic-field":o.shouldShowBasicField,"should-show-array-field":o.shouldShowArrayField,"should-show-array-item-field":o.shouldShowArrayItemField,"get-input-type":o.getInputType,"is-checkbox-checked":o.isCheckboxChecked,onClose:n[9]||(n[9]=a=>o.$emit("close-editor")),"onUpdate:value":n[10]||(n[10]=(a,f)=>o.$emit("update-editor-value",a,f)),"onAdd:arrayItem":n[11]||(n[11]=a=>o.$emit("add-array-item",a)),"onRemove:arrayItem":n[12]||(n[12]=(a,f)=>o.$emit("remove-array-item",a,f)),"onUpdate:arrayItem":n[13]||(n[13]=a=>o.$emit("update-array-item",a)),"onUpdate:checkbox":n[14]||(n[14]=a=>o.$emit("update-checkbox",a))},null,8,["show-editor","selected-component","get-field-info","should-show-basic-field","should-show-array-field","should-show-array-item-field","get-input-type","is-checkbox-checked"]))]))}}),qa={class:"zero-code-data-display"},Ga={class:"zero-code-component-header"},Qa={class:"zero-code-data-tabs"},es={class:"zero-code-form-group"},ts={class:"zero-code-form-group"},os=["value"],rs={class:"zero-code-data-content"},ns={key:0,class:"zero-code-rendered-content"},as={class:"zero-code-component-header"},ss={class:"zero-code-component-id"},ls={class:"zero-code-rendered-component"},is={class:"zero-code-component-header"},ds={class:"zero-code-header-actions"},cs=["onClick"],ps=["onClick"],us=["innerHTML"],ms={key:1,class:"zero-code-no-parts"},Qo=e.defineComponent({__name:"PartsManager",props:{parts:{type:Array},renderPartPreview:{type:Function}},emits:["show-registration","edit-part","delete-part","search","filter"],setup(t,{emit:r}){const o=t,n=r,a=e.ref(""),f=e.ref(""),y=e.computed(()=>Array.from(new Set(o.parts.map(v=>v.type)))),d=e.computed(()=>{let v=[...o.parts];if(f.value&&(v=v.filter(w=>w.type===f.value)),a.value){const w=a.value.toLowerCase();v=v.map(N=>({...N,module:N.module.filter(E=>E.title.toLowerCase().includes(w)||E.body.toLowerCase().includes(w))})).filter(N=>N.module.length>0)}return v}),g=()=>{n("search",a.value)},C=()=>{n("filter",f.value)};return(v,w)=>(e.openBlock(),e.createElementBlock("div",qa,[e.createElementVNode("div",Ga,[w[3]||(w[3]=e.createElementVNode("h4",null,"パーツ管理",-1)),e.createElementVNode("button",{class:"zero-code-add-part-button",onClick:w[0]||(w[0]=N=>v.$emit("show-registration"))},"＋ 新規パーツ登録")]),e.createElementVNode("div",Qa,[e.createElementVNode("div",es,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":w[1]||(w[1]=N=>a.value=N),placeholder:"パーツ名で検索...",class:"zero-code-form-input",onInput:g},null,544),[[e.vModelText,a.value]])]),e.createElementVNode("div",ts,[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":w[2]||(w[2]=N=>f.value=N),class:"zero-code-form-select",onChange:C},[w[4]||(w[4]=e.createElementVNode("option",{value:""},"すべてのType",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,N=>(e.openBlock(),e.createElementBlock("option",{key:N,value:N},e.toDisplayString(N),9,os))),128))],544),[[e.vModelSelect,f.value]])])]),e.createElementVNode("div",rs,[Array.isArray(d.value)&&d.value.length>0?(e.openBlock(),e.createElementBlock("div",ns,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(N,E)=>(e.openBlock(),e.createElementBlock("div",{key:E,class:"zero-code-data-section"},[e.createElementVNode("div",as,[e.createElementVNode("h5",null,e.toDisplayString(N.type),1),e.createElementVNode("span",ss,e.toDisplayString(N.module.length)+"個のパーツ",1)]),e.createElementVNode("div",ls,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.module,(c,l)=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"zero-code-draggable-item"},[e.createElementVNode("div",is,[e.createElementVNode("h6",null,e.toDisplayString(c.title),1),e.createElementVNode("div",ds,[e.createElementVNode("button",{class:"zero-code-edit-btn",onClick:m=>v.$emit("edit-part",{type:N.type,module:c})}," 編集 ",8,cs),e.createElementVNode("button",{class:"zero-code-delete-btn",onClick:m=>v.$emit("delete-part",{type:N.type,title:c.title})}," 削除 ",8,ps)])]),e.createElementVNode("div",{class:"zero-code-module-preview",innerHTML:o.renderPartPreview(c.body)},null,8,us)]))),128))])]))),128))])):(e.openBlock(),e.createElementBlock("div",ms,w[5]||(w[5]=[e.createElementVNode("p",null,"登録されたパーツがありません。",-1)])))])]))}}),fs={class:"zero-code-modal-header"},gs={class:"zero-code-modal-title"},hs={class:"zero-code-title-main"},ys={class:"zero-code-modal-subtitle"},bs={class:"zero-code-modal-body"},Es={class:"zero-code-form-layout"},$s={class:"zero-code-form-section"},ws={key:0,class:"zero-code-form-group"},zs={class:"zero-code-type-input-group"},vs=["value"],Ns={key:1,class:"zero-code-form-group"},Cs={class:"zero-code-form-group"},ks={class:"zero-code-body-editor-container"},As={class:"zero-code-preview-section"},Ps={class:"zero-code-preview-container"},_s=["innerHTML"],Ss={class:"zero-code-modal-footer"},Is={class:"zero-code-modal-actions"},Ds=["disabled"],Ts=e.defineComponent({__name:"PartRegistrationModal",props:{isEditing:{type:Boolean,default:!1},existingTypes:{type:Array},partCategory:{default:"common",type:String},editingPart:{default:null,type:[Object,null]},initialData:{default:()=>({type:"",title:"",body:""}),type:Object},renderPartPreview:{type:Function}},emits:["close","save"],setup(t,{emit:r}){const o=t,n=r,a=()=>o.isEditing&&o.editingPart?{type:o.editingPart.type,title:o.editingPart.module.title,body:o.editingPart.module.body}:{type:o.initialData.type,title:o.initialData.title,body:o.initialData.body},f=e.ref(a()),y=e.computed(()=>(o.isEditing||f.value.type.trim()!==""&&f.value.title.trim()!=="")&&f.value.body.trim()!==""),d=()=>{},g=()=>{y.value&&n("save",{type:f.value.type,title:f.value.title,body:f.value.body,category:o.partCategory||"common"})};return(C,v)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:v[7]||(v[7]=w=>C.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-part-modal",onClick:v[6]||(v[6]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",fs,[e.createElementVNode("div",gs,[e.createElementVNode("div",hs,[e.createElementVNode("h3",null,e.toDisplayString(C.isEditing?"パーツ編集":"新規パーツ登録"),1),e.createElementVNode("span",{class:e.normalizeClass(["zero-code-badge",C.partCategory])},e.toDisplayString(C.partCategory==="common"?"共通パーツ":"個別パーツ"),3)]),e.createElementVNode("p",ys,e.toDisplayString(C.isEditing?"パーツの内容を編集できます":"新しいパーツを作成します"),1)]),e.createElementVNode("button",{class:"zero-code-modal-close-btn",onClick:v[0]||(v[0]=w=>C.$emit("close"))},v[8]||(v[8]=[e.createElementVNode("span",null,"✖️",-1)]))]),e.createElementVNode("div",bs,[e.createElementVNode("div",Es,[e.createElementVNode("div",$s,[C.isEditing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ws,[v[10]||(v[10]=e.createElementVNode("label",{for:"part-type",class:"zero-code-form-label"},"Type",-1)),e.createElementVNode("div",zs,[e.withDirectives(e.createElementVNode("select",{id:"part-type","onUpdate:modelValue":v[1]||(v[1]=w=>f.value.type=w),class:"zero-code-form-select"},[v[9]||(v[9]=e.createElementVNode("option",{value:""},"新しいTypeを選択",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.existingTypes,w=>(e.openBlock(),e.createElementBlock("option",{key:w,value:w},e.toDisplayString(w),9,vs))),128))],512),[[e.vModelSelect,f.value.type]]),!f.value.type||!C.existingTypes.includes(f.value.type)?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":v[2]||(v[2]=w=>f.value.type=w),placeholder:"新しいType名を入力",class:"zero-code-form-input"},null,512)),[[e.vModelText,f.value.type]]):e.createCommentVNode("",!0)])])),C.isEditing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ns,[v[11]||(v[11]=e.createElementVNode("label",{for:"part-title",class:"zero-code-form-label"},"Title",-1)),e.withDirectives(e.createElementVNode("input",{id:"part-title","onUpdate:modelValue":v[3]||(v[3]=w=>f.value.title=w),placeholder:"パーツのタイトルを入力",class:"zero-code-form-input"},null,512),[[e.vModelText,f.value.title]])])),e.createElementVNode("div",Cs,[v[12]||(v[12]=e.createElementVNode("label",{for:"part-body",class:"zero-code-form-label"},"HTML Template",-1)),e.createElementVNode("div",ks,[e.withDirectives(e.createElementVNode("textarea",{id:"part-body","onUpdate:modelValue":v[4]||(v[4]=w=>f.value.body=w),class:"zero-code-body-editor",placeholder:"HTMLソースを直接編集してください...",onInput:d},null,544),[[e.vModelText,f.value.body]])])])]),e.createElementVNode("div",As,[v[13]||(v[13]=e.createElementVNode("div",{class:"zero-code-preview-header"},[e.createElementVNode("h4",null,"プレビュー"),e.createElementVNode("span",{class:"zero-code-preview-info"},"リアルタイムで表示を確認")],-1)),e.createElementVNode("div",Ps,[e.createElementVNode("div",{class:"zero-code-preview-content",innerHTML:C.renderPartPreview(f.value.body)},null,8,_s)])])])]),e.createElementVNode("div",Ss,[e.createElementVNode("div",Is,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:v[5]||(v[5]=w=>C.$emit("close"))}," キャンセル "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",disabled:!y.value,onClick:g},e.toDisplayString(C.isEditing?"更新":"登録"),9,Ds)])])])]))}}),Vs={class:"zero-code-tab-content"},Bs={class:"zero-code-data-tabs"},Ms=["onClick"],Fs={class:"zero-code-parts-content"},Os={key:0,class:"zero-code-parts-section"},Ls={class:"zero-code-section-header"},xs={key:1,class:"zero-code-parts-section"},Rs={class:"zero-code-section-header"},Hs={key:2,class:"zero-code-parts-section"},Zs={class:"zero-code-data-display-section"},Us={class:"zero-code-parts-sub-tabs"},js={class:"zero-code-parts-sub-content"},Ws={key:0,class:"zero-code-parts-sub-section"},Xs={key:0},Ys={class:"zero-code-data-display-pre"},Ks={key:1},Js={key:1,class:"zero-code-parts-sub-section"},qs={key:0},Gs={class:"zero-code-data-display-pre"},Qs={key:1},el=e.defineComponent({__name:"PartsManagementPanel",props:{localParts:{type:Array},localCommonParts:{type:Array},localIndividualParts:{type:Array},showPartRegistration:{type:Boolean},existingPartTypes:{type:Array},editingPart:{type:null},renderPartPreview:{type:Function}},emits:["update-parts","show-registration","edit-part","delete-part","close-registration","save-part"],setup(t,{emit:r}){const o=t,n=r,a=e.ref("common"),f=e.ref("common"),y=e.ref("common"),d=["common","individual","data"],g=s=>({common:"共通パーツ",individual:"個別パーツ",data:"データ表示"})[s],C=e.computed(()=>o.localCommonParts&&o.localCommonParts.length>0?o.localCommonParts:o.localParts.map(s=>({...s,module:s.module.filter(i=>{const p=i;return!p.category||p.category==="common"})})).filter(s=>s.module.length>0)),v=e.computed(()=>o.localIndividualParts&&o.localIndividualParts.length>0?o.localIndividualParts:o.localParts.map(s=>({...s,module:s.module.filter(i=>i.category==="individual")})).filter(s=>s.module.length>0)),w=s=>{f.value=s,n("show-registration")},N=()=>{n("close-registration")},E=s=>{const i=s.module;f.value=i.category||"common",n("edit-part",s)},c=s=>{n("delete-part",s.type,s.title)},l=s=>{const i={...s,category:f.value};n("save-part",i)},m=s=>{const i=(p,u=0)=>{const b="  ".repeat(u),z="  ".repeat(u+1);if(Array.isArray(p))return p.length===0?"[]":`[
${p.map(h=>z+i(h,u+1)).join(`,
`)}
${b}]`;if(typeof p=="object"&&p!==null){const A=Object.entries(p);return A.length===0?"{}":`{
${A.map(([$,k])=>{let P;if(typeof k=="string"){const S=k.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");if(S.includes(`
`)){const D=S.split(`
`);P=D.map((I,V)=>V===0?`\`${I}`:V===D.length-1?`${z}${I}\``:`${z}${I}`).join(`
`)}else P=`"${S}"`}else P=i(k,u+1);return`${z}"${$}": ${P}`}).join(`,
`)}
${b}}`}return typeof p=="string"?`"${p.replace(/"/g,'\\"')}"`:JSON.stringify(p)};return i(s)};return(s,i)=>(e.openBlock(),e.createElementBlock("div",Vs,[e.createElementVNode("div",Bs,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(d,p=>e.createElementVNode("button",{key:p,class:e.normalizeClass(["zero-code-data-tab-button",{active:a.value===p}]),onClick:u=>a.value=p},e.toDisplayString(g(p)),11,Ms)),64))]),e.createElementVNode("div",Fs,[a.value==="common"?(e.openBlock(),e.createElementBlock("div",Os,[e.createElementVNode("div",Ls,[e.createElementVNode("h4",null,"共通パーツ ("+e.toDisplayString(C.value.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-add-part-btn",onClick:i[0]||(i[0]=p=>w("common"))}," ＋ 共通パーツ登録 ")]),e.createVNode(Qo,{parts:C.value,"render-part-preview":s.renderPartPreview,onShowRegistration:i[1]||(i[1]=()=>w("common")),onEditPart:E,onDeletePart:c},null,8,["parts","render-part-preview"])])):e.createCommentVNode("",!0),a.value==="individual"?(e.openBlock(),e.createElementBlock("div",xs,[e.createElementVNode("div",Rs,[e.createElementVNode("h4",null,"個別パーツ ("+e.toDisplayString(v.value.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-add-part-btn",onClick:i[2]||(i[2]=p=>w("individual"))}," ＋ 個別パーツ登録 ")]),e.createVNode(Qo,{parts:v.value,"render-part-preview":s.renderPartPreview,onShowRegistration:i[3]||(i[3]=()=>w("individual")),onEditPart:E,onDeletePart:c},null,8,["parts","render-part-preview"])])):e.createCommentVNode("",!0),a.value==="data"?(e.openBlock(),e.createElementBlock("div",Hs,[e.createElementVNode("div",Zs,[e.createElementVNode("div",Us,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:y.value==="common"}]),onClick:i[4]||(i[4]=p=>y.value="common")}," 共通Partsデータ ",2),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-parts-sub-tab-button",{active:y.value==="individual"}]),onClick:i[5]||(i[5]=p=>y.value="individual")}," 個別Partsデータ ",2)]),e.createElementVNode("div",js,[y.value==="common"?(e.openBlock(),e.createElementBlock("div",Ws,[s.localCommonParts&&s.localCommonParts.length>0?(e.openBlock(),e.createElementBlock("div",Xs,[e.createElementVNode("pre",Ys,e.toDisplayString(m(s.localCommonParts)),1)])):(e.openBlock(),e.createElementBlock("div",Ks,i[6]||(i[6]=[e.createElementVNode("p",null,"共通パーツデータがありません",-1)])))])):e.createCommentVNode("",!0),y.value==="individual"?(e.openBlock(),e.createElementBlock("div",Js,[s.localIndividualParts&&s.localIndividualParts.length>0?(e.openBlock(),e.createElementBlock("div",qs,[e.createElementVNode("pre",Gs,e.toDisplayString(m(s.localIndividualParts)),1)])):(e.openBlock(),e.createElementBlock("div",Qs,i[7]||(i[7]=[e.createElementVNode("p",null,"個別パーツデータがありません",-1)])))])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)]),s.showPartRegistration?(e.openBlock(),e.createBlock(Ts,{key:0,"existing-types":s.existingPartTypes,"render-part-preview":s.renderPartPreview,"editing-part":s.editingPart,"is-editing":!!s.editingPart,"part-category":f.value,onClose:N,onSave:l},null,8,["existing-types","render-part-preview","editing-part","is-editing","part-category"])):e.createCommentVNode("",!0)]))}});function G(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}let ue=null;function er(t,r){return ue!==null&&ue.slotName===r}let Et,Le;function tl(t,r){Et=t,Le=r}function lo(t,r){t.querySelectorAll("[z-if]").forEach(n=>{const a=n.getAttribute("z-if");a&&(r[a]?(n.removeAttribute("z-if"),_.debug(`z-if要素を表示: ${a}`)):(n.remove(),_.debug(`z-if要素を非表示: ${a}`)))})}function ol(t,r){const o=t.querySelectorAll("[z-for-wrapper]");_.debug(`z-for-wrapper要素検索結果: ${o.length}個発見`),o.forEach(n=>{const a=n.getAttribute("z-for-wrapper");if(a){const f=r[a];_.debug(`z-for-wrapper処理: ${a}`,{arrayData:f,length:Array.isArray(f)?f.length:"not array"}),!Array.isArray(f)||f.length===0?(_.debug(`z-for-wrapper空配列: ${a} - wrapper要素は保持、属性のみ除去`),n.removeAttribute("z-for-wrapper")):(_.success(`z-for-wrapper配列あり: ${a} - 属性除去`),n.removeAttribute("z-for-wrapper"))}})}function rl(t,r){return`
    <div class="zero-code-add-array-item-button-container">
      <button class="zero-code-add-array-item-button" onclick="window.addArrayItem('${G(t)}', '${G(r)}')">
        <span class="zero-code-plus-icon">＋</span>
        <span class="zero-code-button-text">${r}を追加</span>
      </button>
    </div>
  `}function tr(t,r,o,n,a){const f=t.querySelectorAll("[z-for]");_.debug("=== processZForElements(DOM版)開始 ==="),_.debug(`z-for要素検索結果: ${f.length}個発見`),_.debug("コンポーネントデータ:",r),f.forEach(y=>{const d=y.getAttribute("z-for");if(d){const g=r[d];if(_.debug(`z-for処理: ${d}`,{arrayData:g,length:Array.isArray(g)?g.length:"not array"}),Array.isArray(g)&&g.length>0){const C=a(r.type,r.module_name),v=new RegExp(`<div[^>]*z-for="${d}"[^>]*>`),w=C.match(v),N=w?C.indexOf(w[0]):-1;if(N!==-1){let E=0,c=N;for(let s=N;s<C.length;s++)if(C.substring(s,s+4)==="<div")E++;else if(C.substring(s,s+6)==="</div>"&&(E--,E===0)){c=s+6;break}const l=C.substring(N,c),m=[l];if(m&&m[0]){let s="";const i=l.match(/<div([^>]*z-for="[^"]*"[^>]*)>/);let p="";i&&i[1]&&(p=i[1].replace(/\s*z-for="[^"]*"\s*/,"").trim());const u=l.indexOf(">")+1,b=l.lastIndexOf("</div>"),z=l.substring(u,b).trim();if(z){const A=z;_.debug(`z-for処理開始: ${d}`,{arrayLength:g.length,template:A,arrayData:g}),g.forEach((k,P)=>{_.debug(`z-forアイテム処理: ${P}`,k);let S=A;const D=`
                  <div class="zero-code-z-for-controls" data-component-id="${r.id}" data-array-name="${d}" data-index="${P}">
                    <div class="zero-code-z-for-controls-inner">
                      <button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${G(r.id)}', '${G(d)}', ${P})" title="上に追加">
                        <span class="zero-code-control-icon">＋</span>
                      </button>
                      <span class="zero-code-z-for-drag-handle" 
                            class="zero-code-drag-disabled"
                            title="ドラッグして並び替え">⠿</span>
                      <button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${G(r.id)}', '${G(d)}', ${P})" title="編集">
                        <span class="zero-code-control-icon">✎</span>
                      </button>
                      <button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${G(r.id)}', '${G(d)}', ${P})" title="削除">
                        <span class="zero-code-control-icon">✕</span>
                      </button>
                    </div>
                  </div>
                `;if(Et&&(_.debug("テキスト置換前:",{itemHtml:S,item:k}),S=Et(S,k,r,C,d),_.debug("テキスト置換後:",{itemHtml:S})),Le&&(S=Le(S,k)),S.includes("z-if")||S.includes("z-slot")||S.includes("z-for")){const L=new DOMParser().parseFromString(`<div>${S}</div>`,"text/html"),x=`${r.id}_${d}_${P}`,J={...k,type:r.type,module_name:r.module_name,id:x};lo(L,J),L.querySelectorAll("[z-slot]").forEach(Se=>{const ge=Se.getAttribute("z-slot");if(ge&&J[ge]){const Ie=J[ge];if(Array.isArray(Ie)&&Ie.length>0){let Re='<div class="zero-code-z-for-nested-parts">';Ie.forEach(($t,qe)=>{const Ht=`${r.id}.${d}[${P}].${ge}`;Re+=`
                            <div class="zero-code-add-nested-part-button-container">
                              <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(Ht)}', ${qe})">
                                <span class="zero-code-plus-icon">＋</span>
                                <span class="zero-code-button-text">上にパーツを追加</span>
                              </button>
                            </div>
                          `;const po=ue;ue=null;const it=n($t,a,o+2);ue=po;const He=`${r.id}.${d}[${P}].${ge}[${qe}]`,uo=o+2;Re+=`
                            <div class="zero-code-nested-component zero-code-nested-depth-${uo} zero-code-z-for-nested-part" 
                                 draggable="true"
                                 data-component-id="${$t.id}" 
                                 data-path="${He}" 
                                 data-parent-path="${r.id}.${d}[${P}].${ge}"
                                 data-index="${qe}"
                                 data-nested-path="${He}"
                                 data-slot-name="${ge}"
                                 data-part-index="${qe}"
                                 ondragstart="window.handleNestedPartDragStart && window.handleNestedPartDragStart(event)"
                                 ondragend="window.handleNestedPartDragEnd && window.handleNestedPartDragEnd(event)"
                                 class="zero-code-nested-component"
                                 onmousedown="this.style.cursor = 'grabbing'"
                                 onmouseup="this.style.cursor = 'grab'">
                              <div class="zero-code-component-header zero-code-nested-header">
                                <!-- ドラッグハンドル（視覚的インジケーター） -->
                                <div class="zero-code-drag-handle-nested" title="ドラッグして並び替え">
                                  ⠿
                                </div>
                                <div class="zero-code-header-actions">
                                  <button class="zero-code-edit-button" onclick="window.openNestedEditor('${G(He)}')">編集</button>
                                  <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${G(He)}')">削除</button>
                                </div>
                              </div>
                              <div class="zero-code-nested-component-content" 
                                   ondragover="window.handleNestedPartDragOver && window.handleNestedPartDragOver(event)"
                                   ondrop="window.handleNestedPartDrop && window.handleNestedPartDrop(event)"
                                   data-slot-name="${ge}" 
                                   data-part-index="${qe}" 
                                   data-parent-path="${r.id}.${d}[${P}].${ge}">${it}</div>
                            </div>
                          `});const Rt=`${r.id}.${d}[${P}].${ge}`;Re+=`
                          <div class="zero-code-add-nested-part-button-container">
                            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(Rt)}', ${Ie.length})">
                              <span class="zero-code-plus-icon">＋</span>
                              <span class="zero-code-button-text">下にパーツを追加</span>
                            </button>
                          </div>
                        `,Re+="</div>",Se.innerHTML=Re}else{const Re=`${r.id}.${d}[${P}].${ge}`;Se.innerHTML=`
                          <div class="zero-code-z-for-empty-slot">
                            スロット "${ge}" は空です
                            <div class="zero-code-add-nested-part-button-container">
                              <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(Re)}', 0)">
                                <span class="zero-code-plus-icon">＋</span>
                                <span class="zero-code-button-text">パーツを追加</span>
                              </button>
                            </div>
                          </div>
                        `}Se.removeAttribute("z-slot")}else if(ge){const Ie=`${r.id}.${d}[${P}].${ge}`;Se.innerHTML=`
                        <div class="zero-code-z-for-empty-slot">
                          スロット "${ge}" にデータがありません
                          <div class="zero-code-add-nested-part-button-container">
                            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(Ie)}', 0)">
                              <span class="zero-code-plus-icon">＋</span>
                              <span class="zero-code-button-text">パーツを追加</span>
                            </button>
                          </div>
                        </div>
                      `,Se.removeAttribute("z-slot")}}),L.querySelectorAll("[z-for]").length>0&&tr(L,J,o+1,n,a),S=L.body.innerHTML.replace(/^<div>|<\/div>$/g,"")}let M=p;M.includes("($")&&Le&&(M=Le(M,k));let I="",V=M;if(M){const L=M.match(/class="([^"]*)"/);L&&(I=L[1],V=M.replace(/\s*class="[^"]*"\s*/,"").trim())}let F=`class="${I?`zero-code-z-for-item-wrapper ${I}`:"zero-code-z-for-item-wrapper"}" 
                       draggable="true"
                       data-component-id="${r.id}"
                       data-array-name="${d}"
                       data-item-index="${P}"
                       ondragstart="window.handleZForDragStart && window.handleZForDragStart(event, '${r.id}', '${d}', ${P})"
                       ondragend="window.handleZForDragEnd && window.handleZForDragEnd(event)"
                       ondragover="window.handleZForArrayItemDragOver && window.handleZForArrayItemDragOver(event)"
                       ondrop="window.handleZForArrayItemDrop && window.handleZForArrayItemDrop(event)"
                       class="zero-code-draggable-item"
                       onmousedown="this.style.cursor = 'grabbing'"
                       onmouseup="this.style.cursor = 'grab'"`;V&&(F+=` ${V}`);const X=`
                  <div ${F}>
                    ${D}
                    <div class="zero-code-z-for-item-content">${S}</div>
                  </div>
                `;s+=X});const h=`
                <div class="zero-code-z-for-add-last-button">
                  <button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${r.id}', '${d}', ${g.length})" title="最後に追加">
                    <span class="zero-code-control-icon">＋</span>
                    <span class="zero-code-button-text">追加</span>
                  </button>
                </div>
              `;s+=h,_.debug(`z-for最終結果: ${d}`,{itemsHtml:s,itemCount:g.length});const $=y.parentNode;if($){const k=document.createElement("div");k.innerHTML=s;const P=document.createDocumentFragment();for(;k.firstChild;)P.appendChild(k.firstChild);$.replaceChild(P,y)}else y.outerHTML=s}}}}else{_.debug(`z-for空配列: ${d}に追加ボタンを設置`);const C=`
          <div class="zero-code-z-for-empty-array">
            <div class="zero-code-z-for-empty-message">
              <p class="zero-code-empty-text">${d}はまだ追加されていません</p>
              <button class="zero-code-z-for-btn zero-code-z-for-add-first-btn" onclick="window.addZForArrayItem('${r.id}', '${d}', 0)" title="最初の要素を追加">
                <span class="zero-code-control-icon">＋</span>
                <span class="zero-code-button-text">最初の${d}を追加</span>
              </button>
            </div>
          </div>
        `;y.innerHTML=C,y.removeAttribute("z-for")}}})}function nl(t,r,o){let n=t;const a=/<div([^>]*z-for="([^"]*)"[^>]*)>([\s\S]*?)<\/div>/g;let f;for(;(f=a.exec(t))!==null;){const[y,d,g,C]=f,v=r[g];if(_.debug(`=== processZForWithRegex(正規表現版)処理: ${g}`,{arrayData:v,length:Array.isArray(v)?v.length:"not array"}),Array.isArray(v)&&v.length>0){let w="";v.forEach((E,c)=>{let l=C;if(`${G(r.id)}${G(g)}${c}`,Et&&(l=Et(l,E,r,t,g)),Le&&(l=Le(l,E)),l.includes("z-if")||l.includes("z-slot")||l.includes("z-for")){const A=new DOMParser().parseFromString(`<div>${l}</div>`,"text/html"),h=`${r.id}_${g}_0`,$={...E,type:r.type,module_name:r.module_name,id:h};lo(A,$),A.querySelectorAll("[z-slot]").forEach(P=>{const S=P.getAttribute("z-slot");if(S&&$[S]){const D=$[S];if(Array.isArray(D)&&D.length>0){let M='<div class="zero-code-z-for-nested-parts">';D.forEach((V,R)=>{const F=`${r.id}.${g}[0].${S}`;M+=`
                    <div class="zero-code-add-nested-part-button-container">
                      <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(F)}', ${R})">
                        <span class="zero-code-plus-icon">＋</span>
                        <span class="zero-code-button-text">上にパーツを追加</span>
                      </button>
                    </div>
                  `;let X=V.content||V.title||V.name||"(内容なし)";const L=`${r.id}.${g}[0].${S}[${R}]`;M+=`
                    <div class="zero-code-z-for-nested-part">
                      <div class="zero-code-z-for-part-header">
                        <small>${V.type||"unknown"} (ID: ${V.id}) [z-for内]</small>
                        <div class="zero-code-z-for-part-actions">
                          <button class="zero-code-edit-button" onclick="window.openNestedEditor('${G(L)}')">編集</button>
                          <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${G(L)}')">削除</button>
                        </div>
                      </div>
                      <div>${X}</div>
                    </div>
                  `});const I=`${r.id}.${g}[0].${S}`;M+=`
                  <div class="zero-code-add-nested-part-button-container">
                    <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(I)}', ${D.length})">
                      <span class="zero-code-plus-icon">＋</span>
                      <span class="zero-code-button-text">ネストパーツを追加</span>
                    </button>
                  </div>
                `,M+="</div>",P.innerHTML=M}else P.innerHTML=`
                  <div class="zero-code-z-for-empty-slot">
                    スロット "${S}" は空です
                    <div class="zero-code-add-nested-part-button-container">
                      <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(r.id)}', 0)">
                        <span class="zero-code-plus-icon">＋</span>
                        <span class="zero-code-button-text">ネストパーツを追加</span>
                      </button>
                    </div>
                  </div>
                `;P.removeAttribute("z-slot")}else S&&(P.innerHTML=`
                <div class="zero-code-z-for-empty-slot">
                  スロット "${S}" にデータがありません
                  <div class="zero-code-add-nested-part-button-container">
                    <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(r.id)}', 0)">
                      <span class="zero-code-plus-icon">＋</span>
                      <span class="zero-code-button-text">ネストパーツを追加</span>
                    </button>
                  </div>
                </div>
              `,P.removeAttribute("z-slot"))}),l=A.body.innerHTML.replace(/^<div>|<\/div>$/g,"")}let m=d.replace(/\s*z-for="[^"]*"\s*/,"").trim();m.includes("($")&&Le&&(m=Le(m,E));let s="",i=m;if(m){const A=m.match(/class="([^"]*)"/);A&&(s=A[1],i=m.replace(/\s*class="[^"]*"\s*/,"").trim())}const p=s?`zero-code-z-for-item-wrapper ${s}`:"zero-code-z-for-item-wrapper",u=`
          <div class="zero-code-z-for-controls" data-component-id="${r.id}" data-array-name="${g}" data-index="${c}">
            <div class="zero-code-z-for-controls-inner">
              <button class="zero-code-z-for-btn zero-code-z-for-add-btn" onclick="window.addZForArrayItem('${G(r.id)}', '${G(g)}', ${c})" title="上に追加">
                <span class="zero-code-control-icon">＋</span>
              </button>
              <span class="zero-code-z-for-drag-handle" 
                    style="pointer-events: none; cursor: grab;"
                    title="ドラッグして並び替え">⠿</span>
              <button class="zero-code-z-for-btn zero-code-z-for-edit-btn" onclick="window.editZForArrayItem('${G(r.id)}', '${G(g)}', ${c})" title="編集">
                <span class="control-icon">✎</span>
              </button>
              <button class="zero-code-z-for-btn zero-code-z-for-delete-btn" onclick="window.removeZForArrayItem('${G(r.id)}', '${G(g)}', ${c})" title="削除">
                <span class="control-icon">✕</span>
              </button>
            </div>
          </div>
        `;let b=`class="${p}" 
               draggable="true"
               data-component-id="${r.id}"
               data-array-name="${g}"
               data-item-index="${c}"
               ondragstart="window.handleZForDragStart && window.handleZForDragStart(event, '${r.id}', '${g}', ${c})"
               ondragend="window.handleZForDragEnd && window.handleZForDragEnd(event)"
               ondragover="window.handleZForArrayItemDragOver && window.handleZForArrayItemDragOver(event)"
               ondrop="window.handleZForArrayItemDrop && window.handleZForArrayItemDrop(event)"
               style="cursor: grab; position: relative; transition: all 0.3s ease;"
               onmousedown="this.style.cursor = 'grabbing'"
               onmouseup="this.style.cursor = 'grab'"`;i&&(b+=` ${i}`);const z=`
          <div ${b}>
            ${u}
            <div class="zero-code-z-for-item-content">${l}</div>
          </div>
        `;w+=z});const N=`
        <div class="zero-code-z-for-add-last-button">
          <button class="zero-code-z-for-btn zero-code-z-for-add-last-btn" onclick="window.addZForArrayItem('${r.id}', '${g}', ${v.length})" title="最後に追加">
            <span class="zero-code-control-icon">＋</span>
            <span class="zero-code-button-text">追加</span>
          </button>
        </div>
      `;w+=N,n=n.replace(y,w)}else _.debug(`正規表現z-for空配列: ${g}に追加ボタンを設置`),n=n.replace(y,rl(r.id,g))}return n}function al(t,r,o,n,a){const f=t.querySelectorAll("[z-slot]");_.debug(`z-slot要素発見: ${f.length}個`),f.forEach(y=>{const d=y.getAttribute("z-slot");if(_.debug(`z-slot処理: ${d}`),d){const g=r[d],C=Array.isArray(g)?g:[];if(_.debug(`ネストパーツ数: ${C.length}個`),C.length===0){const v=ue?`${ue.parentId}.${ue.arrayName}[${ue.arrayIndex}].${ue.slotName}`:r.id;y.innerHTML=`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${v}', 0)">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">パーツを追加</span>
            </button>
          </div>
        `,_.debug(`空のネストパーツに追加ボタンを設置 - パス: ${v}`)}else{let v="";C.forEach((N,E)=>{const c=N.id,l=ue&&er(r,d)?`${ue.parentId}.${ue.arrayName}[${ue.arrayIndex}].${ue.slotName}`:r.id,m=o+1;v+=`
            <div class="zero-code-add-nested-part-button-container">
              <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(l)}', ${E})">
                <span class="zero-code-plus-icon">＋</span>
                <span class="zero-code-button-text">上にパーツを追加（${m}階層目）</span>
              </button>
            </div>
          `,v+=`
            <div class="nested-component nested-depth-${m} draggable-nested" 
                 draggable="true" 
                 data-component-id="${N.id}" 
                 data-path="${c}" 
                 data-parent-path="${l}"
                 data-index="${E}"
                 class="zero-code-nested-component">
              <div class="zero-code-component-header zero-code-nested-header">
                <!-- ドラッグハンドル -->
                <div class="zero-code-drag-handle-nested">
                  ⠿
                </div>
                <div class="zero-code-header-actions">
                  <button class="zero-code-edit-button" onclick="window.openNestedEditor('${c}')">編集</button>
                  <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${c}')">削除</button>
                </div>
              </div>
              <div class="zero-code-nested-component-content">
                ${n(N,a,m)}
              </div>
            </div>
          `});const w=ue&&er(r,d)?`${ue.parentId}.${ue.arrayName}[${ue.arrayIndex}].${ue.slotName}`:r.id;v+=`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${G(w)}', ${C.length})">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">下にパーツを追加（${o+1}階層目）</span>
            </button>
          </div>
        `,y.innerHTML=v,_.debug(`ネストパーツを編集UI付きで表示（重複防止版）: ${C.length}個`)}y.removeAttribute("z-slot"),_.success(`z-slot属性を除去: ${d}`)}})}const sl=[/v-[a-zA-Z-]+(?::[a-zA-Z-\.]+)?="[^"]*"/g,/@[a-zA-Z-]+(?:\.[a-zA-Z-]+)*="[^"]*"/g,/:[a-zA-Z-]+(?:\.[a-zA-Z-]+)*="[^"]*"/g,/v-slot:[a-zA-Z-]+="[^"]*"/g,/#[a-zA-Z-]+="[^"]*"/g],ll=[/\{\{[^}]+\}\}/g,/v-text="[^"]*"/g,/v-html="[^"]*"/g];function il(t){return Ve(()=>{const r=new Map,o=new Map;let n=t;return _.debug("Vue.jsディレクティブ保護開始",{htmlLength:t.length}),sl.forEach((a,f)=>{n=n.replace(a,y=>{const d=`__VUE_DIR_${f}_${r.size}__`;return r.set(d,y),_.debug(`ディレクティブ保護: ${y} → ${d}`),d})}),ll.forEach((a,f)=>{n=n.replace(a,y=>{const d=`__VUE_INT_${f}_${o.size}__`;return o.set(d,y),_.debug(`補間記法保護: ${y} → ${d}`),d})}),_.success("Vue.jsディレクティブ保護完了",{directiveCount:r.size,interpolationCount:o.size,resultLength:n.length}),{html:n,directives:r,interpolations:o}},Be,"Vue.jsディレクティブ保護中にエラーが発生しました",oe.TEMPLATE)||{html:t,directives:new Map,interpolations:new Map}}function or(t,r){return Ve(()=>{let o=t;return _.debug("Vue.jsディレクティブ復元開始",{directiveCount:r.directives.size,interpolationCount:r.interpolations.size}),r.directives.forEach((n,a)=>{o=o.replace(new RegExp(a,"g"),n),_.debug(`ディレクティブ復元: ${a} → ${n}`)}),r.interpolations.forEach((n,a)=>{o=o.replace(new RegExp(a,"g"),n),_.debug(`補間記法復元: ${a} → ${n}`)}),_.success("Vue.jsディレクティブ復元完了",{resultLength:o.length}),o},Be,"Vue.jsディレクティブ復元中にエラーが発生しました",oe.TEMPLATE)||t}function dl(t){return Ve(()=>{const r=il(t),n=new DOMParser().parseFromString(r.html,"text/html");return _.debug("安全DOMパース完了",{originalLength:t.length,protectedLength:r.html.length,parsedElementCount:n.body.children.length}),{doc:n,preservation:r}},Be,"安全DOMパース中にエラーが発生しました",oe.TEMPLATE)||{doc:new DOMParser().parseFromString("<div></div>","text/html"),preservation:{html:t,directives:new Map,interpolations:new Map}}}function rr(t){return t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," "):""}function cl(t,r,o){return Ve(()=>{_.debug("統合テンプレート処理開始",{componentId:r.id,htmlLength:t.length});let n=t;return n=n.replace(/(\(\$[^:)]+\?:[^)]*\)|\(\$[^:)]+:[^)]*\)|\{\$[^:}]+:[^}]*\})/g,a=>a.includes("?:")?pl(a,r):a.startsWith("(")&&a.includes(":")?ul(a,r):a.startsWith("{")&&a.includes(":")?ml(a,r,o):a),_.success("統合テンプレート処理完了",{componentId:r.id,resultLength:n.length}),n},Be,`統合テンプレート処理中にエラーが発生しました (componentId: ${r.id})`,oe.TEMPLATE)||t}function pl(t,r){const o=t.match(/\(\$([^:?]+)\?:([^)]*)\)/);if(!o)return t;const[,n,a]=o,f=a.split("|"),y=r[n];return Array.isArray(y)?y.join(" "):y&&f.includes(String(y))?String(y):f[0]||""}function ul(t,r){const o=t.match(/\(\$([^:]+):([^)]*)\)/);if(!o)return t;const[,n,a]=o,f=a.split("|"),y=r[n];return y&&f.includes(String(y))?String(y):f[0]||""}function ml(t,r,o){const n=t.match(/\{\$([^:]+):([^}]*)\}/);if(!n)return t;const[,a,f]=n,y=r[a],d=rr(y?String(y):f);return fl(o,a)?`<div class="tiptap-content" data-component-id="${r.id}" data-param-name="${a}">${d}</div>`:d}function fl(t,r){const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`\\{\\$${o}:[^}]*\\}`,"g");let a;for(;(a=n.exec(t))!==null;){const f=a.index,y=t.substring(0,f),d=y.lastIndexOf("<"),g=y.lastIndexOf(">");if(d>g)continue;const C=[];if([/<(pre|code)[^>]*>[\s\S]*?<\/(pre|code)>/gi,/<div[^>]*class="[^"]*code-block[^"]*"[^>]*>[\s\S]*?<\/div>/gi].forEach(c=>{c.lastIndex=0;let l;for(;(l=c.exec(t))!==null;)C.push({start:l.index,end:l.index+l[0].length})}),!C.some(c=>f>=c.start&&f<=c.end))return!0}return!1}const xt=new Map;function gl(t,r,o){const n=`${t}:${r}`;if(xt.has(n))return xt.get(n);const a=o(t,r);return xt.set(n,a),a}function hl(){xt.clear(),_.debug("テンプレートキャッシュをクリアしました")}function yl(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}const nr=new DOMParser,Je=new Map,bl=50;function El(t){return Ve(()=>{if(Je.has(t)){const o=Je.get(t);if(o)return _.debug("DOMParser: キャッシュからヒット"),o.cloneNode(!0)}const r=nr.parseFromString(t,"text/html");if(Je.size>=bl){const o=Je.keys().next().value;o&&Je.delete(o)}return Je.set(t,r.cloneNode(!0)),_.debug("DOMParser: 新規パース＆キャッシュ保存"),r},Be,"HTML解析中にエラーが発生しました",oe.TEMPLATE)||nr.parseFromString("<div></div>","text/html")}function $l(t,r,o,n=1){return Ve(()=>{_.debug("最適化z-directive処理開始",{componentId:r.id,currentDepth:n});let a=t;return a=wl(a,r),a=zl(a,r,o),a=vl(a,r,n,o),_.success("最適化z-directive処理完了",{componentId:r.id,resultLength:a.length}),a},Be,`z-directive処理中にエラーが発生しました (componentId: ${r.id})`,oe.TEMPLATE)||t}function wl(t,r){return t.replace(/<([^>]*z-if="([^"]*)"[^>]*)>([\\s\\S]*?)<\/[^>]*>/g,(o,n,a,f)=>{if(!r[a])return _.debug(`z-if要素を非表示: ${a}`),"";const d=n.replace(/\s*z-if="[^"]*"\s*/," ").trim();return _.debug(`z-if要素を表示: ${a}`),`<div ${d}>${f}</div>`})}function zl(t,r,o){return t.replace(/<div([^>]*z-for="([^"]*)"[^>]*)>([\\s\\S]*?)<\/div>/g,(n,a,f,y)=>{const d=r[f];return _.debug(`z-for処理: ${f}`,{length:Array.isArray(d)?d.length:"not array"}),!Array.isArray(d)||d.length===0?`
          <div class="add-array-item-button-container">
            <button class="add-array-item-button" onclick="window.addArrayItem('${r.id}', '${f}')">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">${f}を追加</span>
            </button>
          </div>
        `:d.map(C=>{let v=y;return Object.keys(C).forEach(w=>{if(w!=="id"){const N=C[w];if(typeof N=="string")[new RegExp(`\\{\\$${w}:([^}]+)\\}`,"g"),new RegExp(`\\(\\$${w}:([^)]+)\\)`,"g")].forEach(c=>{v=v.replace(c,N)});else if(Array.isArray(N)){const E=new RegExp(`\\(\\$${w}\\?:([^)]+)\\)`,"g");v=v.replace(E,N.join(" "))}}}),v}).join("")})}function vl(t,r,o,n){const a=El(t),f=a.querySelectorAll("[z-slot]");return _.debug(`z-slot要素発見: ${f.length}個`),f.forEach(y=>{const d=y.getAttribute("z-slot");if(d){const g=r[d],C=Array.isArray(g)?g:[];if(C.length===0)y.innerHTML=`
          <div class="zero-code-add-nested-part-button-container">
            <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${yl(r.id)}', 0)">
              <span class="zero-code-plus-icon">＋</span>
              <span class="zero-code-button-text">ネストパーツを追加</span>
            </button>
          </div>
        `;else{const v=C.map((w,N)=>{const E=o+1,c=Math.max(0,E-1)*20;return`
            <div class="nested-component nested-depth-${E}" style="margin-left: ${c}px;">
              <div class="component-header">
                <span class="component-type">${w.type}</span>
                <span class="component-module">${w.module_name}</span>
                <button onclick="window.openNestedEditor('${w.id}')">編集</button>
                <button onclick="window.deleteNestedPart('${w.id}')">削除</button>
              </div>
            </div>
          `}).join("");y.innerHTML=v}y.removeAttribute("z-slot")}}),a.body.innerHTML}function Nl(){Je.clear(),_.debug("DOMキャッシュをクリアしました")}function io(t){return t?t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}function ar(t){return t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," "):""}function sr(){const t=e.ref(null);let r=!1;const o=(s,i)=>{const p=`\\{\\$${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}:[^}]*\\}`,u=new RegExp(p,"g");let b;for(;(b=u.exec(s))!==null;){const z=b.index,A=s.substring(0,z),h=A.lastIndexOf("<"),$=A.lastIndexOf(">");if(h>$)continue;const k=[];if([/<(pre|code)[^>]*>[\s\S]*?<\/(pre|code)>/gi,/<div[^>]*class="[^"]*code-block[^"]*"[^>]*>[\s\S]*?<\/div>/gi].forEach(I=>{I.lastIndex=0;let V;for(;(V=I.exec(s))!==null;)k.push({start:V.index,end:V.index+V[0].length})}),!k.some(I=>z>=I.start&&z<=I.end))return!0}return!1},n=(s,i,p)=>s.replace(/\{\$([^:]+):(.*?)\}/g,(u,b,z)=>{const A=String(i[b]||z),h=ar(A);return o(p,b)?b==="content"?`<div class="zero-code-rich-editable-text block-editable" data-component-id="${i.id}" data-param="${b}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${i.id}', '${b}', this.innerHTML, this);">${h}</div>`:`<span class="zero-code-rich-editable-text inline-editable" data-component-id="${i.id}" data-param="${b}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${i.id}', '${b}', this.innerHTML, this);">${h}</span>`:h}),a=(s,i,p,u,b)=>s.replace(/\{\$([^:]+):(.*?)\}/g,(z,A,h)=>{const $=String(i[A]||h),k=ar($);if(o(u,A)){const D=p[b].indexOf(i),M=`${p.id}_${b}_${D}_${A}`;return A==="content"?`<div class="zero-code-rich-editable-text array-item-text block-editable" data-component-id="${M}" data-param="${A}" data-array-name="${b}" data-item-index="${D}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${M}', '${A}', this.innerHTML, this);">${k}</div>`:`<span class="zero-code-rich-editable-text array-item-text inline-editable" data-component-id="${M}" data-param="${A}" data-array-name="${b}" data-item-index="${D}" onclick="event.stopPropagation(); if(window.getSelection && window.getSelection().toString().length > 0) return; if(window.startRichTextEdit) window.startRichTextEdit('${M}', '${A}', this.innerHTML, this);">${k}</span>`}return k}),f=(s,i)=>s.replace(/\(\$([^:]+):(.*?)\)/g,(p,u,b)=>{if(i[u]){let h=i[u];return h==="指定無し"&&(h=""),Array.isArray(h)?h.join(" "):String(h)}const z=u;if(i[z]){let h=i[z];return h==="指定無し"&&(h=""),Array.isArray(h)?h.join(" "):String(h)}return b.split("|").filter(h=>h.trim())[0]||""}),y=(s,i)=>s.replace(/\(\$([^:?]+):(.*?)\)/g,(p,u,b)=>{let z=i[u];return z==="指定無し"&&(z=""),Array.isArray(z)?z.join(" "):z?String(z):b.split("|").filter(h=>h.trim())[0]||""}),d=(s,i)=>s.replace(/\(\$([^:?]+)\?:(.*?)\)/g,(p,u,b)=>{const z=i[u];return Array.isArray(z)?z.join(" "):String(z||"")}),g=(s,i,p,u,b)=>s.replace(/@slot\(\$([^)]+)\)@/g,(z,A)=>{const h=i[A],$=Array.isArray(h)?h:[];return p($,[u],k=>k.join("-"),b)}),C=(s,i,p,u)=>{const b=p(s.type,s.module_name);if(!b)return`<div>テンプレートが見つかりません: ${s.type}/${s.module_name}</div>`;let z=b;return z=y(z,s),z=d(z,s),z=n(z,s,b),z=g(z,s,u,i,p),z=E(z,s,p,i,1),z},v=(s,i,p=0)=>{const u=i(s.type,s.module_name);if(!u)return`<div>テンプレートが見つかりません: ${s.type}/${s.module_name}</div>`;let b=u;return b=y(b,s),b=d(b,s),b=n(b,s,u),b=b.replace(/@slot\(\$([^)]+)\)@/g,""),b=E(b,s,i,p,1),b},w=(s,i,p,u)=>{const b=i(s.type,s.module_name);if(!b)return`<div>テンプレートが見つかりません: ${s.type}/${s.module_name}</div>`;let z=b;return z=y(z,s),z=d(z,s),z=n(z,s,b),z=z.replace(/@slot\(\$([^)]+)\)@/g,""),z=E(z,s,i,0,p),z},N=(s,i=[],p,u)=>{if(!s||s.length===0)return`
        <div class="zero-code-add-nested-part-button-container">
          <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${io(p(i))}', 0)">
            <span class="zero-code-plus-icon">＋</span>
            <span class="zero-code-button-text">ネストパーツを追加（${i.length+1}階層目）</span>
          </button>
        </div>
      `;let b="";return s.forEach((z,A)=>{const h=[...i,A],$=p(h),k=h.length;b+=`
        <div class="zero-code-add-nested-part-button-container">
          <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${io(p(i))}', ${A})">
            <span class="zero-code-plus-icon">＋</span>
            <span class="zero-code-button-text">上にパーツを追加（${i.length+1}階層目）</span>
          </button>
        </div>
      `,b+=`
        <div class="zero-code-nested-component zero-code-nested-depth-${k} zero-code-draggable-nested" 
             draggable="true" 
             data-component-id="${z.id}" 
             data-path="${$}" 
             data-parent-path="${p(i)}"
             data-index="${A}"
>
          <div class="zero-code-component-header zero-code-nested-header">
            <!-- ドラッグハンドル -->
            <div class="zero-code-drag-handle-nested">
              ⠿
            </div>
            <div class="zero-code-header-actions">
              <button class="zero-code-edit-button" onclick="window.openNestedEditor('${$}')">編集</button>
              <button class="zero-code-delete-button" onclick="window.deleteNestedPart('${$}')">削除</button>
            </div>
          </div>
          <div class="zero-code-nested-component-content">
            ${u?v(z,u):`<div>テンプレートが見つかりません: ${z.type}/${z.module_name}</div>`}
          </div>
        </div>
      `,z.nested_parts&&Array.isArray(z.nested_parts)&&z.nested_parts.length>0&&(b+=N(z.nested_parts,h,p,u))}),b+=`
      <div class="zero-code-add-nested-part-button-container">
        <button class="zero-code-add-nested-part-button" onclick="window.openNestedPartSelector('${io(p(i))}', ${s.length})">
          <span class="zero-code-plus-icon">＋</span>
          <span class="zero-code-button-text">下にパーツを追加（${i.length+1}階層目）</span>
        </button>
      </div>
    `,b},E=(s,i,p,u=0,b=1)=>Ve(()=>{_.debug("processZDirectives開始",{componentId:i.id,type:i.type,htmlLength:s.length,currentDepth:b}),r||(tl(a,f),r=!0);const{doc:z,preservation:A}=dl(s),h=(D,M,I)=>w(D,M,I);lo(z,i),ol(z,i),tr(z,i,b,h,p);const $=A.html.match(/z-for="[^"]*"/g),k=z.querySelectorAll("[z-for]");if(_.debug(`元のHTML内z-for: ${$?$.length:0}個、DOM処理後: ${k.length}個`),$&&$.length>0&&k.length===0)_.debug("DOM処理でz-forが処理された - 正規表現フォールバックをスキップ");else if(k.length>0){_.debug("DOM処理で未処理のz-for要素あり - 正規表現フォールバック実行");const D=nl(A.html,i);if(D!==A.html)return _.debug("正規表現処理で変更あり - Vue.js復元して終了"),or(D,A)}al(z,i,b,h,p);const P=z.body.innerHTML,S=or(P,A);return _.success("processZDirectives完了（Vue.jsディレクティブ復元済み）",{componentId:i.id,resultLength:S.length,directiveCount:A.directives.size,interpolationCount:A.interpolations.size}),S},Be,`Z-Directive処理中にエラーが発生しました (componentId: ${i.id})`,oe.TEMPLATE)||s;return{editingText:t,shouldApplyTiptap:o,processTextReplacementWithTemplate:n,processArrayItemTextReplacement:a,processArrayItemParameterReplacement:f,processSelectionSyntax:y,processConditionalClassSyntax:d,processSlotSyntax:g,processZDirectives:E,renderComponentWithNested:C,renderComponentWithoutSlot:v,renderNestedComponentWithDepth:w,renderNestedComponentsWithUI:N,hasNestedSlot:(s,i)=>{const p=i(s.type,s.module_name);return p?p.includes("@slot($nested_parts)@"):!1},renderComponentOptimized:(s,i)=>Ve(()=>{_.debug("最適化レンダリング開始",{componentId:s.id,type:s.type});const p=gl(s.type,s.module_name,i);if(!p)return`<div>テンプレートが見つかりません: ${s.type}/${s.module_name}</div>`;let u=cl(p,s,p);return u=$l(u,s,i,1),_.success("最適化レンダリング完了",{componentId:s.id,resultLength:u.length}),u},Be,`最適化レンダリング中にエラーが発生しました (componentId: ${s.id})`,oe.TEMPLATE)||`<div>レンダリングエラー: ${s.id}</div>`,clearAllCaches:()=>{hl(),Nl(),_.debug("全ての最適化キャッシュをクリアしました")}}}const Cl={class:"zero-code-page-preview"},kl={class:"zero-code-data-tabs"},Al={class:"zero-code-page-preview-content"},Pl=["innerHTML"],_l={key:1,class:"zero-code-html-source"},Sl={class:"zero-code-html-source-pre"},Il=e.defineComponent({__name:"PagePreview",props:{pageData:{type:Array},parts:{type:Array}},setup(t){const r=t;sr();const o=e.ref("rendered"),n=N=>{if(!N)return"";try{const l=new globalThis.DOMParser().parseFromString(`<root>${N}</root>`,"text/html").body.firstChild;if(!l)return N;const m=new Set(["img","br","hr","input","meta","link","area","base","col","embed","source","track","wbr"]),s=new Set(["span","a","strong","em","u","mark","code","small","sub","sup","i","b"]),i=(u,b=0,z=!1)=>{var R;const A=u.tagName.toLowerCase(),h=z?"":"  ".repeat(b),$=m.has(A),k=s.has(A);let P=`<${A}`;for(let F=0;F<u.attributes.length;F++){const X=u.attributes[F];P+=` ${X.name}="${X.value}"`}P+=">";let S=h+P;if($)return S;let D=!1,M=!1;const I=[];let V="";for(let F=0;F<u.childNodes.length;F++){const X=u.childNodes[F];if(X.nodeType===1){D=!0;const x=i(X,b+1,k||z);I.push(x)}else if(X.nodeType===3){const L=(R=X.textContent)==null?void 0:R.replace(/\s+/g," ").trim();L&&(M=!0,V+=L)}}return D&&M?k||z?S+=V+I.join(""):(S+=V+`
`+I.join(`
`),I.length>0&&(S+=`
`+h)):D?k||z?S+=I.join(""):(S+=`
`+I.join(`
`),I.length>0&&(S+=`
`+h)):M&&(S+=V),S+=`</${A}>`,S};let p="";for(let u=0;u<l.childNodes.length;u++){const b=l.childNodes[u];b.nodeType===1&&(p+=i(b)+`
`)}return p.replace(/\n{3,}/g,`

`).replace(/\n\s*\n\s*</g,`
<`).trim()}catch{return N.replace(/>\s*</g,`>
<`).split(`
`).filter(c=>c.trim()).map((c,l,m)=>{const s=c.trim();if(!s)return"";let i=0;for(let p=0;p<l;p++){const u=m[p].trim();u.match(/<[^\/!][^>]*[^\/]>$/)&&i++,u.match(/<\/[^>]+>$/)&&i--}return s.startsWith("</")&&i--,"  ".repeat(Math.max(0,i))+s}).join(`
`)}},a=(N,E)=>{if(!Array.isArray(r.parts))return"";const c=r.parts.find(m=>m.type===N);if(!c)return"";const l=c.module.find(m=>m.title===E);return l?l.body:""},f=()=>{if(!Array.isArray(r.pageData)||r.pageData.length===0)return'<div class="zero-code-no-content">ページにコンテンツがありません</div>';let N='<div class="zero-code-page-container">';return r.pageData.forEach((E,c)=>{const l=y(E);!l||l.trim()===""?N+=`<div class="zero-code-error-component">テンプレートが見つかりません: ${E.type}/${E.module_name}</div>`:N+=l}),N+="</div>",N},y=N=>{const E=a(N.type,N.module_name);if(!E)return"";let c=E;return c=d(c,N),c=C(c,N),c=v(c,N),c},d=(N,E)=>{const l=new globalThis.DOMParser().parseFromString(N,"text/html");return l.querySelectorAll("[z-if]").forEach(u=>{const b=u.getAttribute("z-if");b&&(E[b]?u.removeAttribute("z-if"):u.remove())}),l.querySelectorAll("[z-for-wrapper]").forEach(u=>{const b=u.getAttribute("z-for-wrapper");if(b){const z=E[b];!Array.isArray(z)||z.length===0?u.remove():u.removeAttribute("z-for-wrapper")}}),l.querySelectorAll("[z-for]").forEach(u=>{const b=u.getAttribute("z-for");if(b){const z=E[b];if(Array.isArray(z)&&z.length>0){const A=a(E.type,E.module_name),h=g(A,b);if(h){const $=z.map(k=>{let P=h;return P=d(P,k),P=C(P,k),P=v(P,k),P}).join("");u.outerHTML=$}else u.remove()}else u.remove()}}),l.querySelectorAll("[z-slot]").forEach(u=>{const b=u.getAttribute("z-slot");if(b)if(E[b]&&Array.isArray(E[b])){const z=w(E[b]);u.outerHTML=z}else u.remove()}),l.body.innerHTML},g=(N,E)=>{const c=new RegExp(`<div[^>]*z-for="${E}"[^>]*>`),l=N.match(c);if(!l)return"";const m=N.indexOf(l[0]);if(m===-1)return"";let s=0,i=m;for(let h=m;h<N.length;h++)if(N.substring(h,h+4)==="<div")s++;else if(N.substring(h,h+6)==="</div>"&&(s--,s===0)){i=h+6;break}if(s!==0)return"";const p=N.substring(m,i),u=l[0].replace(/\s*z-for="[^"]*"\s*/," ").replace(/\s+>/,">"),b=p.indexOf(">")+1,z=p.lastIndexOf("</div>"),A=p.substring(b,z);return u+A+"</div>"},C=(N,E)=>(N=N.replace(/\(\$([^:?]+)\?:(.*?)\)/g,(c,l,m)=>{const s=E[l];return Array.isArray(s)?s.join(" "):s||""}),N=N.replace(/\(\$([^:]+):(.*?)\)/g,(c,l,m)=>{let s=E[l];return(s==="指定なし"||s==="")&&(s=""),s?Array.isArray(s)?s.join(" "):s:m.includes("|")?m.split("|").filter(p=>p.trim()!=="")[0]||"":m.includes(",")?m.split(",").map(p=>p.trim()).filter(p=>p!=="")[0]||"":m}),N),v=(N,E)=>N.replace(/\{\$([^:]+):(.*?)\}/g,(c,l,m)=>String(E[l]||m)),w=N=>{if(!N||N.length===0)return"";let E="";return N.forEach(c=>{const l=y(c);l&&l.trim()!==""&&(E+=l)}),E};return(N,E)=>(e.openBlock(),e.createElementBlock("div",Cl,[e.createElementVNode("div",kl,[e.createElementVNode("button",{class:e.normalizeClass(["zero-code-data-tab-button",{active:o.value==="rendered"}]),onClick:E[0]||(E[0]=c=>o.value="rendered")}," レンダリング結果 ",2),e.createElementVNode("button",{class:e.normalizeClass(["zero-code-data-tab-button",{active:o.value==="source"}]),onClick:E[1]||(E[1]=c=>o.value="source")}," HTMLソース ",2)]),e.createElementVNode("div",Al,[o.value==="rendered"?(e.openBlock(),e.createElementBlock("div",{key:0,innerHTML:f()},null,8,Pl)):e.createCommentVNode("",!0),o.value==="source"?(e.openBlock(),e.createElementBlock("div",_l,[E[2]||(E[2]=e.createElementVNode("div",{class:"zero-code-source-header"},[e.createElementVNode("p",{class:"zero-code-source-description"},"パーツごとに改行・インデントされたHTMLソース")],-1)),e.createElementVNode("pre",Sl,[e.createElementVNode("code",null,e.toDisplayString(n(f())),1)])])):e.createCommentVNode("",!0)])]))}}),Dl={class:"zero-code-tab-content"},Tl=e.defineComponent({__name:"PreviewPanel",props:{editablePageData:{type:Array},localParts:{type:Array},parts:{type:Array}},setup(t){return(r,o)=>(e.openBlock(),e.createElementBlock("div",Dl,[e.createVNode(Il,{"page-data":r.editablePageData,parts:r.localParts&&r.localParts.length>0?r.localParts:r.parts||[]},null,8,["page-data","parts"])]))}}),Vl={class:"zero-code-modal-header"},Bl={class:"zero-code-modal-body"},Ml={class:"zero-code-img-file-input-section"},Fl={key:0,class:"zero-code-img-file-info"},Ol={class:"zero-code-img-file-preview"},Ll=["src"],xl={class:"zero-code-img-file-details"},Rl={class:"zero-code-form-section"},Hl={class:"zero-code-form-group"},Zl=["disabled"],Ul={class:"zero-code-form-group"},jl=["disabled"],Wl={key:0,class:"zero-code-form-group"},Xl=["disabled"],Yl={class:"zero-code-modal-footer"},Kl=["disabled"],Jl=e.defineComponent({__name:"ImageUploadModal",props:{category:{type:String},componentId:{type:String}},emits:["close","upload"],setup(t,{emit:r}){const o=t,n=r,a=e.ref(null),f=e.ref(""),y=e.ref(""),d=e.ref(""),g=e.ref(o.componentId||""),C=e.computed(()=>a.value&&y.value.trim()&&d.value.trim()),v=i=>{const p=i.target;p.files&&p.files[0]&&N(p.files[0])},w=i=>{i.preventDefault(),i.dataTransfer&&i.dataTransfer.files[0]&&N(i.dataTransfer.files[0])},N=i=>{a.value=i,y.value=i.name.replace(/\.[^/.]+$/,""),d.value=i.name,f.value&&URL.revokeObjectURL(f.value),f.value=URL.createObjectURL(i)},E=i=>new Promise((p,u)=>{const b=new FileReader;b.readAsDataURL(i),b.onload=()=>p(b.result),b.onerror=z=>u(z)}),c=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),l=i=>{if(i===0)return"0 Bytes";const p=1024,u=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(i)/Math.log(p));return parseFloat((i/Math.pow(p,b)).toFixed(2))+" "+u[b]},m=async()=>{if(!(!a.value||!C.value))try{const i=await E(a.value),p={id:c(),name:y.value,originalName:a.value.name,url:i,alt:d.value,size:a.value.size,type:a.value.type,uploadedAt:new Date().toISOString(),category:o.category,componentId:o.category==="individual"?g.value:void 0,fileData:{base64:i}};n("upload",p)}catch{alert("画像のアップロードに失敗しました。")}},s=()=>{f.value&&URL.revokeObjectURL(f.value)};return e.onUnmounted(s),(i,p)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:p[8]||(p[8]=u=>i.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:p[7]||(p[7]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",Vl,[e.createElementVNode("h4",null,"画像アップロード（"+e.toDisplayString(i.category==="common"?"共通":"個別")+"）",1),e.createElementVNode("button",{class:"zero-code-img-close-btn",onClick:p[0]||(p[0]=u=>i.$emit("close"))},"×")]),e.createElementVNode("div",Bl,[e.createElementVNode("div",Ml,[p[9]||(p[9]=e.createElementVNode("label",{for:"file-input",class:"zero-code-img-file-input-label"},[e.createElementVNode("div",{class:"zero-code-img-file-input-area"},[e.createElementVNode("span",{class:"zero-code-img-file-input-text"},"クリックしてファイルを選択"),e.createElementVNode("span",{class:"zero-code-img-file-input-hint"},"またはドラッグ&ドロップ")])],-1)),e.createElementVNode("input",{id:"file-input",type:"file",accept:"image/*",style:{display:"none"},onChange:v,onDrop:w,onDragover:p[1]||(p[1]=e.withModifiers(()=>{},["prevent"])),onDragenter:p[2]||(p[2]=e.withModifiers(()=>{},["prevent"]))},null,32)]),a.value?(e.openBlock(),e.createElementBlock("div",Fl,[e.createElementVNode("div",Ol,[e.createElementVNode("img",{src:f.value,alt:"プレビュー"},null,8,Ll)]),e.createElementVNode("div",xl,[e.createElementVNode("p",null,[p[10]||(p[10]=e.createElementVNode("strong",null,"ファイル名:",-1)),e.createTextVNode(" "+e.toDisplayString(a.value.name),1)]),e.createElementVNode("p",null,[p[11]||(p[11]=e.createElementVNode("strong",null,"サイズ:",-1)),e.createTextVNode(" "+e.toDisplayString(l(a.value.size)),1)]),e.createElementVNode("p",null,[p[12]||(p[12]=e.createElementVNode("strong",null,"タイプ:",-1)),e.createTextVNode(" "+e.toDisplayString(a.value.type),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("div",Rl,[e.createElementVNode("div",Hl,[p[13]||(p[13]=e.createElementVNode("label",{for:"image-name"},"保存名:",-1)),e.withDirectives(e.createElementVNode("input",{id:"image-name","onUpdate:modelValue":p[3]||(p[3]=u=>y.value=u),type:"text",placeholder:"画像の保存名を入力",disabled:!a.value},null,8,Zl),[[e.vModelText,y.value]])]),e.createElementVNode("div",Ul,[p[14]||(p[14]=e.createElementVNode("label",{for:"image-alt"},"alt属性:",-1)),e.withDirectives(e.createElementVNode("input",{id:"image-alt","onUpdate:modelValue":p[4]||(p[4]=u=>d.value=u),type:"text",placeholder:"画像の説明を入力",disabled:!a.value},null,8,jl),[[e.vModelText,d.value]])]),i.category==="individual"?(e.openBlock(),e.createElementBlock("div",Wl,[p[15]||(p[15]=e.createElementVNode("label",{for:"component-id"},"コンポーネントID:",-1)),e.withDirectives(e.createElementVNode("input",{id:"component-id","onUpdate:modelValue":p[5]||(p[5]=u=>g.value=u),type:"text",placeholder:"コンポーネントIDを入力",disabled:!a.value},null,8,Xl),[[e.vModelText,g.value]])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",Yl,[e.createElementVNode("button",{class:"zero-code-img-btn zero-code-img-btn-secondary",onClick:p[6]||(p[6]=u=>i.$emit("close"))},"キャンセル"),e.createElementVNode("button",{class:"zero-code-img-btn zero-code-img-btn-primary",disabled:!C.value,onClick:m}," アップロード ",8,Kl)])])]))}}),ql={class:"zero-code-modal-header"},Gl={class:"zero-code-modal-body"},Ql={class:"zero-code-img-detail-preview"},ei=["src","alt"],ti={class:"zero-code-form-section"},oi={class:"zero-code-form-group"},ri={class:"zero-code-form-group"},ni={key:0,class:"zero-code-form-group"},ai={class:"zero-code-img-detail-info"},si={class:"zero-code-img-detail-info-group"},li={class:"zero-code-img-detail-info-group"},ii={class:"zero-code-img-detail-info-group"},di={class:"zero-code-img-detail-info-group"},ci={class:"zero-code-img-detail-info-group"},pi={class:"zero-code-img-detail-url-group"},ui={class:"zero-code-modal-footer"},mi={class:"zero-code-modal-footer-right"},fi=e.defineComponent({__name:"ImageDetailModal",props:{image:{type:Object}},emits:["close","delete","replace"],setup(t,{emit:r}){const o=t,n=r,a=e.reactive({...o.image}),f=e.ref(null),y=()=>{confirm("この画像を削除しますか？この操作は取り消せません。")&&n("delete",a.id)},d=()=>{f.value&&f.value.click()},g=async E=>{const c=E.target;if(!c.files||!c.files[0])return;const l=c.files[0];if(!confirm(`画像を "${l.name}" に差し替えますか？この操作は取り消せません。`)){c.value="";return}try{const m=await C(l),s={...a,originalName:l.name,url:m,size:l.size,type:l.type,uploadedAt:new Date().toISOString(),fileData:{base64:m}};n("replace",a.id,s)}catch{alert("画像の差し替えに失敗しました。")}finally{c.value=""}},C=E=>new Promise((c,l)=>{const m=new FileReader;m.readAsDataURL(E),m.onload=()=>c(m.result),m.onerror=s=>l(s)}),v=async E=>{try{await navigator.clipboard.writeText(E),alert("URLをクリップボードにコピーしました")}catch{const l=document.createElement("textarea");l.value=E,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),alert("URLをクリップボードにコピーしました")}},w=E=>{if(E===0)return"0 Bytes";const c=1024,l=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(E)/Math.log(c));return parseFloat((E/Math.pow(c,m)).toFixed(2))+" "+l[m]},N=E=>new Date(E).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(E,c)=>(e.openBlock(),e.createElementBlock("div",{class:"zero-code-modal-overlay",onClick:c[8]||(c[8]=l=>E.$emit("close"))},[e.createElementVNode("div",{class:"zero-code-modal-content",onClick:c[7]||(c[7]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("div",ql,[c[9]||(c[9]=e.createElementVNode("h4",null,"画像詳細",-1)),e.createElementVNode("button",{class:"zero-code-close-button",onClick:c[0]||(c[0]=l=>E.$emit("close"))},"✖️")]),e.createElementVNode("div",Gl,[e.createElementVNode("div",Ql,[e.createElementVNode("img",{src:a.url,alt:a.alt},null,8,ei)]),e.createElementVNode("div",ti,[e.createElementVNode("div",oi,[c[10]||(c[10]=e.createElementVNode("label",{for:"detail-image-name"},"ファイル名:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-image-name","onUpdate:modelValue":c[1]||(c[1]=l=>a.name=l),type:"text",readonly:""},null,512),[[e.vModelText,a.name]])]),e.createElementVNode("div",ri,[c[11]||(c[11]=e.createElementVNode("label",{for:"detail-image-alt"},"alt属性:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-image-alt","onUpdate:modelValue":c[2]||(c[2]=l=>a.alt=l),type:"text",readonly:""},null,512),[[e.vModelText,a.alt]])]),a.componentId?(e.openBlock(),e.createElementBlock("div",ni,[c[12]||(c[12]=e.createElementVNode("label",{for:"detail-component-id"},"コンポーネントID:",-1)),e.withDirectives(e.createElementVNode("input",{id:"detail-component-id","onUpdate:modelValue":c[3]||(c[3]=l=>a.componentId=l),type:"text",readonly:""},null,512),[[e.vModelText,a.componentId]])])):e.createCommentVNode("",!0),e.createElementVNode("div",ai,[e.createElementVNode("div",si,[c[13]||(c[13]=e.createElementVNode("label",null,"カテゴリ:",-1)),e.createElementVNode("span",{class:e.normalizeClass(["zero-code-img-detail-category",a.category])},e.toDisplayString(a.category==="common"?"共通画像":"個別画像"),3)]),e.createElementVNode("div",li,[c[14]||(c[14]=e.createElementVNode("label",null,"ファイルサイズ:",-1)),e.createElementVNode("span",null,e.toDisplayString(w(a.size)),1)]),e.createElementVNode("div",ii,[c[15]||(c[15]=e.createElementVNode("label",null,"ファイルタイプ:",-1)),e.createElementVNode("span",null,e.toDisplayString(a.type),1)]),e.createElementVNode("div",di,[c[16]||(c[16]=e.createElementVNode("label",null,"アップロード日時:",-1)),e.createElementVNode("span",null,e.toDisplayString(N(a.uploadedAt)),1)]),e.createElementVNode("div",ci,[c[17]||(c[17]=e.createElementVNode("label",null,"画像URL:",-1)),e.createElementVNode("div",pi,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":c[4]||(c[4]=l=>a.url=l),type:"text",readonly:"",class:"zero-code-img-detail-url-input"},null,512),[[e.vModelText,a.url]]),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary zero-code-copy-btn",title:"URLをコピー",onClick:c[5]||(c[5]=l=>v(a.url))}," 📋 ")])])])])]),e.createElementVNode("div",ui,[e.createElementVNode("div",{class:"zero-code-modal-footer-left"},[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-danger",onClick:y}," 削除 "),e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-primary",onClick:d}," 差し替え ")]),e.createElementVNode("div",mi,[e.createElementVNode("button",{class:"zero-code-btn zero-code-btn-secondary",onClick:c[6]||(c[6]=l=>E.$emit("close"))}," 閉じる ")]),e.createElementVNode("input",{ref_key:"fileInputRef",ref:f,type:"file",accept:"image/*",style:{display:"none"},onChange:g},null,544)])])]))}}),gi={class:"zero-code-tab-content"},hi={class:"zero-code-data-tabs"},yi=["onClick"],bi={class:"zero-code-image-content"},Ei={key:0,class:"zero-code-image-section"},$i={class:"zero-code-section-header"},wi={class:"zero-code-img-grid"},zi=["onClick"],vi=["src","alt"],Ni={class:"zero-code-img-info"},Ci={class:"zero-code-img-name"},ki={class:"zero-code-img-size"},Ai=["onClick"],Pi={key:0,class:"zero-code-empty-state"},_i={key:1,class:"zero-code-image-section"},Si={class:"zero-code-section-header"},Ii={class:"zero-code-img-grid"},Di=["onClick"],Ti=["src","alt"],Vi={class:"zero-code-img-info"},Bi={class:"zero-code-img-name"},Mi={class:"zero-code-img-size"},Fi=["onClick"],Oi={key:0,class:"zero-code-empty-state"},Li={class:"zero-code-debug-info"},xi=e.defineComponent({__name:"ImageManagementPanel",props:{commonImages:{type:Array},individualImages:{type:Array}},emits:["updateCommonImages","updateIndividualImages","sendCommonImagesData","sendIndividualImagesData"],setup(t,{emit:r}){const o=t,n=r,a=e.ref("common"),f=e.ref(!1),y=e.ref(!1),d=e.ref("common"),g=e.ref(null),C=e.computed(()=>o.commonImages.length+o.individualImages.length),v=["common","individual"],w=b=>({common:"共通画像",individual:"個別画像"})[b],N=b=>{if(b===0)return"0 Bytes";const z=1024,A=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(b)/Math.log(z));return parseFloat((b/Math.pow(z,h)).toFixed(2))+" "+A[h]},E=b=>{d.value=b,f.value=!0},c=()=>{f.value=!1},l=b=>{g.value=b,y.value=!0},m=()=>{y.value=!1,g.value=null},s=b=>{if(d.value==="common"){const z=[...o.commonImages,b];n("updateCommonImages",z)}else{const z=[...o.individualImages,b];n("updateIndividualImages",z)}c()},i=b=>{if(!g.value)return;if(g.value.category==="common"){const A=o.commonImages.filter(h=>h.id!==b);n("updateCommonImages",A)}else{const A=o.individualImages.filter(h=>h.id!==b);n("updateIndividualImages",A)}m()},p=(b,z)=>{if(z.category==="common"){const h=o.commonImages.map($=>$.id===b?z:$);n("updateCommonImages",h)}else{const h=o.individualImages.map($=>$.id===b?z:$);n("updateIndividualImages",h)}m()},u=(b,z)=>{if(confirm("この画像を削除しますか？"))if(z==="common"){const A=o.commonImages.filter(h=>h.id!==b);n("updateCommonImages",A)}else{const A=o.individualImages.filter(h=>h.id!==b);n("updateIndividualImages",A)}};return(b,z)=>(e.openBlock(),e.createElementBlock("div",gi,[e.createElementVNode("div",hi,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(v,A=>e.createElementVNode("button",{key:A,class:e.normalizeClass(["zero-code-data-tab-button",{active:a.value===A}]),onClick:h=>a.value=A},e.toDisplayString(w(A)),11,yi)),64))]),e.createElementVNode("div",bi,[a.value==="common"?(e.openBlock(),e.createElementBlock("div",Ei,[e.createElementVNode("div",$i,[e.createElementVNode("h4",null,"共通画像 ("+e.toDisplayString(b.commonImages.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-img-upload-btn common",onClick:z[0]||(z[0]=A=>E("common"))}," 共通画像をアップロード ")]),e.createElementVNode("div",wi,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.commonImages,A=>(e.openBlock(),e.createElementBlock("div",{key:A.id,class:"zero-code-img-item",onClick:h=>l(A)},[e.createElementVNode("img",{src:A.url,alt:A.alt},null,8,vi),e.createElementVNode("div",Ni,[e.createElementVNode("p",Ci,e.toDisplayString(A.name),1),e.createElementVNode("p",ki,e.toDisplayString(N(A.size)),1)]),e.createElementVNode("button",{class:"zero-code-img-delete-btn",onClick:e.withModifiers(h=>u(A.id,"common"),["stop"])}," 削除 ",8,Ai)],8,zi))),128))]),b.commonImages.length===0?(e.openBlock(),e.createElementBlock("div",Pi,z[2]||(z[2]=[e.createElementVNode("p",null,"共通画像が登録されていません。",-1)]))):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),a.value==="individual"?(e.openBlock(),e.createElementBlock("div",_i,[e.createElementVNode("div",Si,[e.createElementVNode("h4",null,"個別画像 ("+e.toDisplayString(b.individualImages.length)+"件)",1),e.createElementVNode("button",{class:"zero-code-img-upload-btn individual",onClick:z[1]||(z[1]=A=>E("individual"))}," 個別画像をアップロード ")]),e.createElementVNode("div",Ii,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.individualImages,A=>(e.openBlock(),e.createElementBlock("div",{key:A.id,class:"zero-code-img-item",onClick:h=>l(A)},[e.createElementVNode("img",{src:A.url,alt:A.alt},null,8,Ti),e.createElementVNode("div",Vi,[e.createElementVNode("p",Bi,e.toDisplayString(A.name),1),e.createElementVNode("p",Mi,e.toDisplayString(N(A.size)),1)]),e.createElementVNode("button",{class:"zero-code-img-delete-btn",onClick:e.withModifiers(h=>u(A.id,"individual"),["stop"])}," 削除 ",8,Fi)],8,Di))),128))]),b.individualImages.length===0?(e.openBlock(),e.createElementBlock("div",Oi,z[3]||(z[3]=[e.createElementVNode("p",null,"個別画像が登録されていません。",-1)]))):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Li,[z[4]||(z[4]=e.createElementVNode("strong",null,"🔍 デバッグ情報:",-1)),e.createTextVNode(" 共通画像: "+e.toDisplayString(b.commonImages.length)+"件, 個別画像: "+e.toDisplayString(b.individualImages.length)+"件, 合計: "+e.toDisplayString(C.value)+"件 ",1),z[5]||(z[5]=e.createElementVNode("br",null,null,-1))]),f.value?(e.openBlock(),e.createBlock(Jl,{key:0,category:d.value,onClose:c,onUpload:s},null,8,["category"])):e.createCommentVNode("",!0),y.value&&g.value?(e.openBlock(),e.createBlock(fi,{key:1,image:g.value,onClose:m,onDelete:i,onReplace:p},null,8,["image"])):e.createCommentVNode("",!0)]))}});function Ri(){const t=e.ref("editor"),r=g=>{t.value!==g&&(_.info(`🔄 タブ切り替え: ${t.value} → ${g}`),t.value=g)};return{activeTab:t,availableTabs:["editor","parts","preview","images"],switchToTab:r,isActiveTab:g=>t.value===g,showEditor:()=>{r("editor")},showPartsManager:()=>{r("parts")},showPreview:()=>{r("preview")},showImageManager:()=>{r("images")}}}function Hi(t){const r=e.reactive({editablePageData:[],localParts:[],localCommonParts:[],localIndividualParts:[],activeTab:"editor",dataTab:"rendered",showEditor:!1,showPartSelector:!1,showNestedPartSelector:!1,selectedComponent:null,selectedComponentIndex:null,editingText:null,insertPosition:0,nestedInsertPath:"",nestedInsertPosition:0}),o={currentComponentIndex:e.computed(()=>r.selectedComponentIndex===null?-1:typeof r.selectedComponentIndex=="number"?r.selectedComponentIndex:parseInt(r.selectedComponentIndex.toString())),pageDataLength:e.computed(()=>r.editablePageData.length),hasSelectedComponent:e.computed(()=>r.selectedComponent!==null),isEditing:e.computed(()=>r.showEditor&&r.selectedComponent!==null),isTiptapEditing:e.computed(()=>r.editingText!==null)},n={switchToTab:d=>{r.activeTab=d,r.dataTab="rendered"},setDataTab:d=>{r.dataTab=d}},a={openEditor:(d,g)=>{r.selectedComponent=d,r.selectedComponentIndex=g,r.showEditor=!0},closeEditor:()=>{r.showEditor=!1,r.selectedComponent=null,r.selectedComponentIndex=null},openPartSelector:d=>{r.insertPosition=d,r.showPartSelector=!0},closePartSelector:()=>{r.showPartSelector=!1},openNestedPartSelector:(d,g)=>{r.nestedInsertPath=d,r.nestedInsertPosition=g,r.showNestedPartSelector=!0},closeNestedPartSelector:()=>{r.showNestedPartSelector=!1}},f={startTiptapEdit:(d,g,C=[],v=0,w,N)=>{r.editingText={componentId:d,paramName:g,hierarchyPath:C,depth:v,arrayName:w,itemIndex:N}},stopTiptapEdit:()=>{r.editingText=null}},y=()=>{r.editablePageData=Array.isArray(t.page)?[...t.page]:[],r.localParts=Array.isArray(t.parts)?[...t.parts]:[],r.localCommonParts=Array.isArray(t.commonParts)?[...t.commonParts]:[],r.localIndividualParts=Array.isArray(t.individualParts)?[...t.individualParts]:[]};return e.watch(()=>t.page,d=>{Array.isArray(d)&&(r.editablePageData=[...d])},{deep:!0,immediate:!0}),e.watch(()=>t.parts,d=>{Array.isArray(d)&&(r.localParts=[...d])},{deep:!0,immediate:!0}),e.watch(()=>t.commonParts,d=>{Array.isArray(d)&&(r.localCommonParts=[...d])},{deep:!0,immediate:!0}),e.watch(()=>t.individualParts,d=>{Array.isArray(d)&&(r.localIndividualParts=[...d])},{deep:!0,immediate:!0}),y(),{...e.toRefs(r),...o,...n,...a,...f,initializeData:y}}function Zi(){const t=d=>d.includes("url")||d.includes("src")||d.includes("link")?"url":d.includes("email")?"email":d.includes("number")||d.includes("count")?"number":d.includes("date")?"date":d.includes("time")?"time":d.includes("password")?"password":d.includes("tel")||d.includes("phone")?"tel":"text";return{getInputType:t,formatFileSize:d=>{if(d===0)return"0 Bytes";const g=1024,C=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(d)/Math.log(g));return parseFloat((d/Math.pow(g,v)).toFixed(2))+" "+C[v]},component:{findComponentByPath:(d,g)=>{let C=d,v=null;for(let w=0;w<g.length;w++){const N=g[w];if(N>=0&&N<C.length)v=C[N],w<g.length-1&&(C=v.nested_parts||[]);else return null}return v},createNewComponent:(d,g)=>({id:`comp_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,type:d,module_name:g,nested_parts:[]}),deleteComponent:(d,g)=>d.filter((C,v)=>v!==g),duplicateComponent:d=>{const g=`comp_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;return{...JSON.parse(JSON.stringify(d)),id:g}},addArrayItem:(d,g)=>{d[g]||(d[g]=[]);const C=d[g],v={id:`item_${Date.now()}_${Math.random().toString(36).substring(2,11)}`};C.push(v)},removeArrayItem:(d,g,C)=>{const v=d[g];Array.isArray(v)&&C>=0&&C<v.length&&v.splice(C,1)}},template:{getTemplate:(d,g,C)=>{const v=C.find(N=>N.type===d);if(!v)return"";const w=v.module.find(N=>N.title===g);return(w==null?void 0:w.body)||""},extractFields:d=>{const g=[];return[/\{\$([^:}]+):/g,/\(\$([^:}]+):/g,/\(\$([^?}]+)\?:/g].forEach(v=>{let w;for(;(w=v.exec(d))!==null;){const N=w[1];g.includes(N)||g.push(N)}}),g},extractSlots:d=>{const g=[],C=/@slot\(\$([^)]+)\)@/g;let v;for(;(v=C.exec(d))!==null;){const w=v[1];g.includes(w)||g.push(w)}return g}},array:{addArrayItem:(d,g)=>[...d,g],removeArrayItem:(d,g)=>d.filter((C,v)=>v!==g),updateArrayItem:(d,g,C)=>d.map((v,w)=>w===g?C:v),moveArrayItem:(d,g,C)=>{const v=[...d],[w]=v.splice(g,1);return v.splice(C,0,w),v}},field:{getFieldValue:(d,g)=>d[g]||"",setFieldValue:(d,g,C)=>({...d,[g]:C}),validateField:(d,g)=>{switch(t(d)){case"email":return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g);case"url":try{return new URL(g),!0}catch{return!1}case"number":return!isNaN(Number(g));default:return!0}}},string:{stringifyHierarchyPath:d=>d.join("."),parseHierarchyPath:d=>{if(!d||typeof d!="string")return[];try{const g=d.split("."),C=[];for(const v of g){const w=v.trim();if(w==="")continue;const N=parseInt(w,10);if(!isNaN(N)&&N>=0)C.push(N);else return[]}return C}catch{return[]}},camelToKebab:d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kebabToCamel:d=>d.replace(/-([a-z])/g,(g,C)=>C.toUpperCase())}}}function Ui(){let t=null;const r=u=>{if(!u||typeof u!="string"||u.trim()==="")return"<p></p>";const b=["p","strong","em","u","s","a","span","br"],z=["href","target","style"],A=document.createElement("div");A.innerHTML=u;const h=k=>{const P=k.tagName.toLowerCase();if(!b.includes(P)){const S=k.parentNode;if(S){for(;k.firstChild;)S.insertBefore(k.firstChild,k);S.removeChild(k)}return}Array.from(k.attributes).forEach(S=>{z.includes(S.name.toLowerCase())||k.removeAttribute(S.name)}),Array.from(k.children).forEach(S=>{h(S)})};Array.from(A.children).forEach(k=>{h(k)});let $=A.innerHTML;return $=$.replace(/<p>\s*<\/p>/g,"<p><br></p>").replace(/<p>\s*<br>\s*<\/p>/g,"<p><br></p>").replace(/(<\w+>)\s*(<\/\w+>)/g,"$1<br>$2"),$.includes("<")||($=`<p>${$}</p>`),(!$||$.trim()==="")&&($="<p><br></p>"),$},o=()=>{const u=window.getSelection();if(!u||u.rangeCount===0)return{selection:null,range:null};const b=u.getRangeAt(0);return t!=null&&t.contains(b.commonAncestorContainer)?{selection:u,range:b}:{selection:null,range:null}},n=(u,b)=>{const z=document.createElement(u);return b&&Object.entries(b).forEach(([A,h])=>{z.setAttribute(A,h)}),z},a=(u,b)=>{try{u.surroundContents(b)}catch{const z=u.extractContents();b.appendChild(z),u.insertNode(b)}},f=(u,b,z)=>{const A=n(b,z);a(u,A)},y=(u,b)=>{const z=document.createElement("span");Object.assign(z.style,b),a(u,z)},d=(u,b)=>{if(!u.collapsed)return;const z=document.createTextNode("テキスト");u.insertNode(z),u.selectNodeContents(z),b.removeAllRanges(),b.addRange(u)},g=u=>{const{selection:b,range:z}=o();if(!b||!z)return;let A=z.commonAncestorContainer;A.nodeType===Node.TEXT_NODE&&(A=A.parentElement||A);const h=A.closest("p");if(h){const $={left:"left",center:"center",right:"right"};h.style.textAlign=$[u]}},C=(u,b)=>{if(!t)return;t.focus();const{selection:z,range:A}=o();if(!z||!A)return;d(A,z);const h={bold:()=>f(A,"strong"),italic:()=>f(A,"em"),underline:()=>f(A,"u"),strikeThrough:()=>f(A,"s"),justifyLeft:()=>g("left"),justifyCenter:()=>g("center"),justifyRight:()=>g("right"),createLink:()=>b&&f(A,"a",{href:b,target:"_blank"}),backColor:()=>b&&y(A,{backgroundColor:b})};try{const $=h[u];$&&$()}catch{try{document.execCommand(u,!1,b)}catch{}}},v=(u,b)=>{if(!t)return;t.focus();const z=window.getSelection();if(z!=null&&z.rangeCount&&t.contains(z.getRangeAt(0).commonAncestorContainer)){const A=z.getRangeAt(0);z.removeAllRanges(),z.addRange(A)}C(u,b)},w={toggleBold:()=>v("bold"),toggleItalic:()=>v("italic"),toggleUnderline:()=>v("underline"),toggleStrike:()=>v("strikeThrough"),alignLeft:()=>v("justifyLeft"),alignCenter:()=>v("justifyCenter"),alignRight:()=>v("justifyRight"),setLink:()=>{const u=window.prompt("URLを入力してください:");u&&v("createLink",u)},isActive:u=>{var h;if(!t)return!1;const b=window.getSelection();if(!(b!=null&&b.rangeCount))return!1;const z=b.getRangeAt(0);if(!t.contains(z.commonAncestorContainer))return!1;const A={bold:()=>N("strong"),italic:()=>N("em"),underline:()=>N("u"),strike:()=>N("s")};return((h=A[u])==null?void 0:h.call(A))??!1}},N=u=>{const{selection:b,range:z}=o();if(!b||!z)return!1;let A=z.commonAncestorContainer;for(A.nodeType===window.Node.TEXT_NODE&&(A=A.parentElement||A);A&&A!==t;){if(A.nodeType===window.Node.ELEMENT_NODE&&A.tagName.toLowerCase()===u.toLowerCase())return!0;A=A.parentElement}return!1},E=()=>`
    border: 2px solid #3b82f6;
    border-radius: 8px;
    padding: 12px 16px;
    min-height: 60px;
    background: white;
    outline: none;
    line-height: 1.6;
    color: #1f2937;
    font-size: 14px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    transition: all 0.2s ease;
  `,c=u=>{Object.entries({"data-gramm":"false",spellcheck:"false",autocomplete:"off",autocorrect:"off",autocapitalize:"off"}).forEach(([z,A])=>{u.setAttribute(z,A)})},l=(u,b)=>{let z=null,A=null;u.addEventListener("focus",()=>{u.style.borderColor="#3b82f6",u.style.boxShadow="0 0 0 3px rgba(59,130,246,0.1), 0 1px 3px rgba(0,0,0,0.1)"}),u.addEventListener("blur",()=>{u.style.borderColor="#3b82f6",u.style.boxShadow="0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)"}),u.addEventListener("keydown",$=>{var k;if($.key==="Enter"&&!$.shiftKey){$.preventDefault();const P=window.getSelection();if(!(P!=null&&P.rangeCount))return;const S=P.getRangeAt(0),D=S.startContainer;let M=null;if(D.nodeType===window.Node.TEXT_NODE?M=((k=D.parentElement)==null?void 0:k.closest("p"))||null:D.nodeType===window.Node.ELEMENT_NODE&&(M=D.closest("p")||null),M){const I=document.createElement("p");I.innerHTML="<br>",M.insertAdjacentElement("afterend",I);const V=document.createRange();V.setStart(I,0),V.setEnd(I,0),P.removeAllRanges(),P.addRange(V)}else{const I=document.createElement("p");I.innerHTML="<br>",S.deleteContents(),S.insertNode(I);const V=document.createRange();V.setStart(I,0),V.setEnd(I,0),P.removeAllRanges(),P.addRange(V)}u.dispatchEvent(new Event("input",{bubbles:!0}))}}),u.addEventListener("input",()=>{z&&window.clearTimeout(z),z=window.setTimeout(()=>{const $=r(u.innerHTML);if($!==u.innerHTML){const k=window.getSelection();let P=null;if(k&&k.rangeCount>0&&(P=k.getRangeAt(0).cloneRange()),u.innerHTML=$,P&&k)try{k.removeAllRanges(),k.addRange(P)}catch{const D=document.createRange();D.selectNodeContents(u),D.collapse(!1),k.removeAllRanges(),k.addRange(D)}}b==null||b(u.innerHTML)},300)}),u.addEventListener("selectionchange",()=>{try{u.dispatchEvent(new CustomEvent("selectionchange"))}catch{}});const h=new globalThis.MutationObserver(()=>{A&&window.clearTimeout(A),A=window.setTimeout(()=>{b==null||b(u.innerHTML)},100)});return h.observe(u,{childList:!0,subtree:!0,characterData:!0}),{saveTimeout:z,updateTimeout:A,observer:h}},m=(u,b,z)=>{const A=b.querySelector(".simple-editor-content");A&&A.remove();const h=document.createElement("div");h.className="simple-editor-content",h.contentEditable="true";const $=r(u);h.innerHTML=$,h.style.cssText=E(),c(h);const{saveTimeout:k,updateTimeout:P,observer:S}=l(h,z);return b.appendChild(h),t=h,{element:h,getHTML:()=>h.innerHTML,setContent:D=>h.innerHTML=D,destroy:()=>{window.clearTimeout(k),window.clearTimeout(P),S.disconnect(),h.remove(),t=null},isActive:D=>w.isActive(D),isInitialized:!0,isDestroyed:!1,isFocused:!1,chain:()=>({focus:()=>({toggleMark:D=>({run:()=>{var I;const M={bold:w.toggleBold,italic:w.toggleItalic,underline:w.toggleUnderline,strike:w.toggleStrike};(I=M[D])==null||I.call(M)}}),setTextAlign:D=>({run:()=>{var I;const M={left:w.alignLeft,center:w.alignCenter,right:w.alignRight};(I=M[D])==null||I.call(M)}})})})}},s=(u,b,z)=>{try{return b.innerHTML="",m(u,b,z)}catch(A){throw A}},i=()=>{if(t)try{t.remove(),t=null}catch{}},p=()=>!!t;return e.onBeforeUnmount(()=>i()),{initEditor:s,destroyEditor:i,getEditor:()=>t,isEditorReady:p}}class ji{constructor(){zt(this,"events",new Map);zt(this,"isEnabled",!0)}on(r,o){this.events.has(r)||this.events.set(r,new Set);const n=this.events.get(r);return n.add(o),_.debug(`EventBus: イベントリスナー登録 - ${r}`),()=>{n.delete(o),_.debug(`EventBus: イベントリスナー削除 - ${r}`)}}emit(r,o){if(!this.isEnabled){_.warn(`EventBus: 無効化されているため ${r} イベントを無視`);return}const n=this.events.get(r);if(!n||n.size===0){_.warn(`EventBus: ${r} イベントのリスナーが見つかりません`);return}_.debug(`EventBus: ${r} イベントを発火`,o);const a=[];n.forEach(f=>{try{const y=f(o);y instanceof Promise&&a.push(y)}catch(y){_.error(`EventBus: ${r} イベントリスナーでエラー`,y)}}),a.length>0&&Promise.allSettled(a).then(f=>{f.forEach((y,d)=>{y.status==="rejected"&&_.error(`EventBus: ${r} 非同期リスナー[${d}]でエラー`,y.reason)})})}off(r){this.events.delete(r),_.debug(`EventBus: ${r} の全リスナーを削除`)}clear(){this.events.clear(),_.debug("EventBus: 全イベントリスナーをクリア")}disable(){this.isEnabled=!1,_.debug("EventBus: 無効化")}enable(){this.isEnabled=!0,_.debug("EventBus: 有効化")}getListenerCount(r){var n;if(r)return((n=this.events.get(r))==null?void 0:n.size)||0;let o=0;return this.events.forEach(a=>{o+=a.size}),o}}const fe=new ji,xe={addArrayItem:(t,r)=>{fe.emit("addArrayItem",{componentId:t,arrayKey:r})},addZForArrayItem:(t,r,o)=>{fe.emit("addZForArrayItem",{componentId:t,arrayName:r,insertIndex:o})},removeZForArrayItem:(t,r,o)=>{fe.emit("removeZForArrayItem",{componentId:t,arrayName:r,index:o})},reorderZForArrayItem:(t,r,o,n)=>{fe.emit("reorderZForArrayItem",{componentId:t,arrayName:r,fromIndex:o,toIndex:n})},editZForArrayItem:(t,r,o)=>{fe.emit("editZForArrayItem",{componentId:t,arrayName:r,index:o})},deleteNestedPart:t=>{fe.emit("deleteNestedPart",{pathString:t})},openNestedEditor:t=>{fe.emit("openNestedEditor",{pathString:t})},openNestedPartSelector:(t,r)=>{fe.emit("openNestedPartSelector",{pathString:t,position:r})},startRichTextEdit:(t,r,o)=>fe.emit("startRichTextEdit",{componentId:t,paramName:r,currentValue:o}),selectImage:(t,r)=>{fe.emit("selectImage",{componentId:t,paramName:r})},uploadImage:(t,r,o)=>{fe.emit("uploadImage",{file:t,category:r,componentId:o})}};function Wi(t,r){const o=Hi(t),n=Zi(),a=sr(),f=Ui(),y=(c,l)=>{for(const m of c){if(m.id===l)return m;if(m.nested_parts&&Array.isArray(m.nested_parts)){const s=y(m.nested_parts,l);if(s)return s}for(const[s,i]of Object.entries(m))if(Array.isArray(i)&&s!=="nested_parts"){for(const p of i)if(p&&typeof p=="object"){for(const[u,b]of Object.entries(p))if(Array.isArray(b)){const z=y(b,l);if(z)return z}}}}return null},d=(c,l,m)=>{for(let s=0;s<c.length;s++){const i=c[s];if(i.id===l)return c[s]=m,!0;if(i.nested_parts&&Array.isArray(i.nested_parts)&&d(i.nested_parts,l,m))return!0;for(const[p,u]of Object.entries(i))if(Array.isArray(u)&&p!=="nested_parts"){for(const b of u)if(b&&typeof b=="object"){for(const[z,A]of Object.entries(b))if(Array.isArray(A)&&d(A,l,m))return!0}}}return!1},g=(c,l)=>{for(let m=0;m<c.length;m++){if(c[m].id===l)return c.splice(m,1),!0;if(c[m].nested_parts&&Array.isArray(c[m].nested_parts)&&g(c[m].nested_parts,l))return!0;for(const[s,i]of Object.entries(c[m]))if(Array.isArray(i)&&s!=="nested_parts"){for(const p of i)if(p&&typeof p=="object"){for(const[u,b]of Object.entries(p))if(Array.isArray(b)&&g(b,l))return!0}}}return!1},C={addPart:(c,l)=>{const m=[...o.editablePageData.value];m.splice(l,0,c),o.editablePageData.value=m,r("update:page",m)},deletePart:c=>{if(window.confirm("このパーツを削除しますか？")){const l=n.component.deleteComponent(o.editablePageData.value,c);o.editablePageData.value=l,r("update:page",l)}},duplicatePart:c=>{const l=o.editablePageData.value[c];if(l){const m=n.component.duplicateComponent(l),s=[...o.editablePageData.value];s.splice(c+1,0,m),o.editablePageData.value=s,r("update:page",s)}},reorderParts:c=>{o.editablePageData.value=c,r("update:page",c)},movePart:(c,l)=>{const m=[...o.editablePageData.value],[s]=m.splice(c,1);m.splice(l,0,s),o.editablePageData.value=m,r("update:page",m)},reorderNestedParts:(c,l)=>{const m=n.string.parseHierarchyPath(c),s=JSON.parse(JSON.stringify(o.editablePageData.value)),i=n.component.findComponentByPath(s,m);i&&(i.nested_parts=[...l],o.editablePageData.value=s,r("update:page",s))},moveNestedPart:(c,l,m)=>{const s=n.string.parseHierarchyPath(c),i=JSON.parse(JSON.stringify(o.editablePageData.value)),p=n.component.findComponentByPath(i,s);if(p!=null&&p.nested_parts&&p.nested_parts.length>Math.max(l,m)){const u=[...p.nested_parts];if(l>=0&&l<u.length&&m>=0&&m<u.length&&l!==m){const[b]=u.splice(l,1);u.splice(m,0,b),p.nested_parts=u,o.editablePageData.value=i,r("update:page",i)}}},moveNestedPartBetweenLevels:(c,l,m,s)=>{const i=n.string.parseHierarchyPath(c),p=n.string.parseHierarchyPath(m),u=[...o.editablePageData.value],b=n.component.findComponentByPath(u,i);if(!(b!=null&&b.nested_parts))return;const[z]=b.nested_parts.splice(l,1),A=n.component.findComponentByPath(u,p);A&&(A.nested_parts||(A.nested_parts=[]),A.nested_parts.splice(s,0,z),o.editablePageData.value=u,r("update:page",u))},moveNestedPartById:(c,l,m)=>{const s=JSON.parse(JSON.stringify(o.editablePageData.value)),i=y(s,c);if(i!=null&&i.nested_parts&&i.nested_parts.length>Math.max(l,m)){const p=[...i.nested_parts];if(l>=0&&l<p.length&&m>=0&&m<p.length&&l!==m){const[u]=p.splice(l,1);p.splice(m,0,u),i.nested_parts=p,o.editablePageData.value=s,r("update:page",s)}}},moveNestedPartBetweenLevelsById:(c,l,m,s)=>{const i=JSON.parse(JSON.stringify(o.editablePageData.value)),p=y(i,c);if(!(p!=null&&p.nested_parts))return;const[u]=p.nested_parts.splice(l,1),b=y(i,m);b&&(b.nested_parts||(b.nested_parts=[]),b.nested_parts.splice(s,0,u),o.editablePageData.value=i,r("update:page",i))},moveZForNestedPart:(c,l,m)=>{const s=c.match(/^(\w+)\.(\w+)\[(\d+)\]\.(\w+)$/);if(!s)return;const[,i,p,u,b]=s,z=parseInt(u),A=JSON.parse(JSON.stringify(o.editablePageData.value)),h=y(A,i);if(!h)return;const $=h[p];if(!Array.isArray($)||z>=$.length)return;const k=$[z];if(!k||!k[b]||!Array.isArray(k[b]))return;const P=k[b];if(l<0||l>=P.length||m<0||m>=P.length||l===m)return;const[S]=P.splice(l,1);P.splice(m,0,S),o.editablePageData.value=A,r("update:page",A)},openEditor:c=>{const l=o.editablePageData.value[c];l&&o.openEditor(l,c)},saveComponent:c=>{const l=o.selectedComponentIndex.value;if(c._isZForItem){const m=c._parentComponentId,s=c._arrayName,i=c._arrayIndex,p=JSON.parse(JSON.stringify(o.editablePageData.value)),u=y(p,m);if(u&&Array.isArray(u[s])){const b=u[s];if(i>=0&&i<b.length){const{_isZForItem:z,_parentComponentId:A,_arrayName:h,_arrayIndex:$,_zForTemplate:k,...P}=c;b[i]={...b[i],...P},o.editablePageData.value=p,r("update:page",p)}}o.closeEditor();return}if(typeof l=="number"&&l>=0){const m=[...o.editablePageData.value];m[l]=c,o.editablePageData.value=m,r("update:page",m)}else if(typeof l=="string"){const m=JSON.parse(JSON.stringify(o.editablePageData.value));d(m,l,c)&&(o.editablePageData.value=m,r("update:page",m))}o.closeEditor()},addNestedPart:(c,l,m)=>{const s=JSON.parse(JSON.stringify(o.editablePageData.value)),i=/^(.+)\.(.+)\[(\d+)\]\.(.+)$/,p=c.match(i);let u=!1;if(p){const[,b,z,A,h]=p,$=y(s,b);if($&&$[z]&&Array.isArray($[z])){const k=$[z][parseInt(A)];k&&(k[h]||(k[h]=[]),k[h].splice(l,0,m),u=!0)}}else{const b=y(s,c);b&&(b.nested_parts||(b.nested_parts=[]),b.nested_parts.splice(l,0,m),u=!0)}u&&(o.editablePageData.value=s,r("update:page",s))},deleteNestedPart:c=>{if(window.confirm("このネストパーツを削除しますか？")){const l=JSON.parse(JSON.stringify(o.editablePageData.value)),m=/^(.+)\.(.+)\[(\d+)\]\.(.+)\[(\d+)\]$/,s=c.match(m);let i=!1;if(s){const[,p,u,b,z,A]=s,h=y(l,p);if(h&&h[u]&&Array.isArray(h[u])){const $=h[u][parseInt(b)];$&&$[z]&&Array.isArray($[z])&&($[z].splice(parseInt(A),1),i=!0)}}else i=g(l,c);i&&(o.editablePageData.value=l,r("update:page",l))}},startTiptapEdit:(c,l,m=[],s=0)=>{o.startTiptapEdit(c,l,m,s)},startSimpleTiptapEdit:(c,l)=>{o.startTiptapEdit(c,l,[],0)},stopTiptapEdit:()=>{o.stopTiptapEdit()},sendPageData:()=>{r("update:page",o.editablePageData.value)},sendPartsData:()=>{r("update:parts",o.localParts.value)},sendCommonPartsData:()=>{r("update:commonParts",o.localCommonParts.value)},sendIndividualPartsData:()=>{r("update:individualParts",o.localIndividualParts.value)},addArrayItem:(c,l)=>{n.component.addArrayItem(c,l),r("update:page",o.editablePageData.value)},removeArrayItem:(c,l,m)=>{n.component.removeArrayItem(c,l,m),r("update:page",o.editablePageData.value)},resetPageData:()=>{o.editablePageData.value=Array.isArray(t.page)?[...t.page]:[],r("update:page",o.editablePageData.value)},resetPartsData:()=>{o.localParts.value=Array.isArray(t.parts)?[...t.parts]:[],r("update:parts",o.localParts.value)}},v={currentComponent:e.computed(()=>o.selectedComponent.value),currentTemplate:e.computed(()=>{const c=o.selectedComponent.value;return c?n.template.getTemplate(c.type,c.module_name,o.localParts.value):""}),currentFields:e.computed(()=>{const c=v.currentTemplate.value;return n.template.extractFields(c)}),currentSlots:e.computed(()=>{const c=v.currentTemplate.value;return n.template.extractSlots(c)}),renderComponent:c=>a.renderComponentWithoutSlot(c,(l,m)=>n.template.getTemplate(l,m,o.localParts.value)),renderPartPreview:c=>{if(!c)return"";try{let l=c;return l=l.replace(/\{\$([^:]+):([^}]*)\}/g,(m,s,i)=>({title:"サンプルタイトル",text:"サンプルテキスト",content:"サンプルコンテンツ",heading:"見出し",description:"説明文",label:"ラベル",source:"情報源",tooltip:"ツールチップ"})[s]||i||`[${s}]`),l=l.replace(/\(\$([^:]+):([^)]+)\)/g,(m,s,i)=>i.split("|").filter(u=>u.trim())[0]||""),l=l.replace(/\(\$([^:?]+)\?:([^)]*)\)/g,(m,s,i)=>i||""),l=l.replace(/z-slot="[^"]*"/g,""),l=l.replace(/z-for="[^"]*"/g,""),l=l.replace(/z-for-wrapper="[^"]*"/g,""),l}catch{return c}}},w=()=>{fe.on("addArrayItem",({componentId:c,arrayKey:l})=>{try{if(_.debug(`EventBus: addArrayItem - componentId=${c}, arrayKey=${l}`),!c||!l)throw new Error("componentId または arrayKey が指定されていません");const m=y(o.editablePageData.value,c);if(!m)throw new Error(`Component not found: ${c}`);_.success(`Component found: ${m.id}, adding array item to ${l}`);const s=o.localParts.value&&o.localParts.value.length>0?o.localParts.value:[];s.length>0?Lt(s).addArrayItem(m,l):C.addArrayItem(m,l),r("update:page",o.editablePageData.value)}catch(m){_.error(`配列アイテム追加エラー: ${m}`,{componentId:c,arrayKey:l})}}),fe.on("addZForArrayItem",({componentId:c,arrayName:l,insertIndex:m})=>{try{_.debug(`EventBus: addZForArrayItem - componentId=${c}, arrayName=${l}, insertIndex=${m}`);const s=y(o.editablePageData.value,c);if(!s)throw new Error(`Component not found: ${c}`);Array.isArray(s[l])||(s[l]=[]);const i=o.localParts.value&&o.localParts.value.length>0?o.localParts.value:[],p=Lt(i),u=p.getTemplate(s.type,s.module_name),b={id:p.generateUniqueId()};if(u){const A=u.match(/\(\$([^:?]+)(:|\?:)([^)]*)\)/g);A&&A.forEach($=>{const[,k,P,S]=$.match(/\(\$([^:?]+)(:|\?:)([^)]*)\)/)||[];if(k&&!b[k])if(P===":"){const D=S.split("|").filter(Boolean);b[k]=D[0]||""}else P==="?:"&&(b[k]=[])});const h=u.match(/\$([a-zA-Z_][a-zA-Z0-9_]*)/g);h&&h.forEach($=>{const k=$.substring(1);!b[k]&&!k.includes("(")&&(b[k]=`デフォルト${k}`)})}s[l].splice(m,0,b),_.success(`z-for配列アイテム追加完了: ${l}[${m}]`),r("update:page",o.editablePageData.value)}catch(s){_.error(`z-for配列アイテム追加エラー: ${s}`,{componentId:c,arrayName:l,insertIndex:m})}}),fe.on("removeZForArrayItem",({componentId:c,arrayName:l,index:m})=>{try{_.debug(`EventBus: removeZForArrayItem - componentId=${c}, arrayName=${l}, index=${m}`);const s=y(o.editablePageData.value,c);if(!s)throw new Error(`Component not found: ${c}`);const i=s[l];if(!Array.isArray(i)||m<0||m>=i.length)throw new Error(`Invalid array or index: ${l}[${m}]`);i.splice(m,1),_.success(`z-for配列アイテム削除完了: ${l}[${m}]`),r("update:page",o.editablePageData.value)}catch(s){_.error(`z-for配列アイテム削除エラー: ${s}`,{componentId:c,arrayName:l,index:m})}}),fe.on("reorderZForArrayItem",({componentId:c,arrayName:l,fromIndex:m,toIndex:s})=>{try{_.debug(`EventBus: reorderZForArrayItem - componentId=${c}, arrayName=${l}, fromIndex=${m}, toIndex=${s}`);const i=y(o.editablePageData.value,c);if(!i)throw new Error(`Component not found: ${c}`);const p=i[l];if(!Array.isArray(p)||m<0||m>=p.length||s<0||s>=p.length)throw new Error(`Invalid array or indices: ${l}[${m}] -> [${s}]`);const u=JSON.parse(JSON.stringify(o.editablePageData.value)),b=y(u,c);if(b){const z=b[l],A=z.splice(m,1)[0];z.splice(s,0,A),o.editablePageData.value=u,r("update:page",u),_.success(`z-for配列アイテム並び替え完了: ${l}[${m}] -> [${s}]`)}else throw new Error(`Component not found in new data: ${c}`)}catch(i){_.error(`z-for配列アイテム並び替えエラー: ${i}`,{componentId:c,arrayName:l,fromIndex:m,toIndex:s})}}),fe.on("editZForArrayItem",({componentId:c,arrayName:l,index:m})=>{try{_.debug(`EventBus: editZForArrayItem - componentId=${c}, arrayName=${l}, index=${m}`);const s=y(o.editablePageData.value,c);if(!s)throw new Error(`Component not found: ${c}`);const i=s[l];if(!Array.isArray(i)||m<0||m>=i.length)throw new Error(`Invalid array or index: ${l}[${m}]`);const p=i[m],u={...p,id:`${c}_${l}_${m}`,type:p.type||s.type,module_name:p.module_name||s.module_name,_isZForItem:!0,_parentComponentId:c,_arrayName:l,_arrayIndex:m,_zForTemplate:null};_.debug("z-for配列アイテム編集: コンポーネント検索結果",{componentId:c,componentFound:!!s,componentType:s.type,componentModuleName:s.module_name,arrayName:l,arrayLength:i.length,index:m,itemKeys:Object.keys(p),tempComponentId:u.id}),o.openEditor(u,`${c}_${l}_${m}`),_.success(`z-for配列アイテム編集開始: ${l}[${m}]`)}catch(s){_.error(`z-for配列アイテム編集エラー: ${s}`,{componentId:c,arrayName:l,index:m})}}),fe.on("deleteNestedPart",({pathString:c})=>{_.debug(`EventBus: deleteNestedPart - path=${c}`),C.deleteNestedPart(c)}),fe.on("openNestedEditor",({pathString:c})=>{if(_.debug(`EventBus: openNestedEditor - path=${c}`),!c||typeof c!="string"){_.error("Invalid pathString:",c);return}const l=/^(.+)\.(.+)\[(\d+)\]\.(.+)\[(\d+)\]$/,m=c.match(l);let s=null;if(m){const[,i,p,u,b,z]=m;_.debug("z-for内パス解析:",{parentId:i,arrayName:p,arrayIndex:u,slotName:b,partIndex:z});const A=y(o.editablePageData.value,i);if(A&&A[p]&&Array.isArray(A[p])){const h=A[p][parseInt(u)];h&&h[b]&&Array.isArray(h[b])&&(s=h[b][parseInt(z)],_.debug("z-for内ネストパーツを発見:",s))}}else s=y(o.editablePageData.value,c);s?(_.debug("Found component:",{id:s.id,type:s.type,module:s.module_name}),o.openEditor(s,c)):_.error(`Component not found with ID: ${c}`)}),fe.on("openNestedPartSelector",({pathString:c,position:l})=>{_.debug(`EventBus: openNestedPartSelector - path=${c}, position=${l}`),o.openNestedPartSelector(c,l)})},N=c=>{["startTiptapEdit","stopTiptapEdit","openPartSelector","openNestedPartSelector","openNestedEditor","deleteNestedPart","addArrayItem","addZForArrayItem","removeZForArrayItem","reorderZForArrayItem","editZForArrayItem","handleZForDragStart","handleZForDragEnd","handleZForArrayItemDragOver","handleZForArrayItemDrop"].forEach(i=>{delete window[i]}),window.startTiptapEdit=c||C.startSimpleTiptapEdit,window.stopTiptapEdit=C.stopTiptapEdit,window.openPartSelector=i=>o.openPartSelector(i),window.openNestedPartSelector=xe.openNestedPartSelector,window.openNestedEditor=xe.openNestedEditor,window.deleteNestedPart=xe.deleteNestedPart,window.addArrayItem=xe.addArrayItem,window.addZForArrayItem=xe.addZForArrayItem,window.removeZForArrayItem=xe.removeZForArrayItem,window.reorderZForArrayItem=xe.reorderZForArrayItem,window.editZForArrayItem=xe.editZForArrayItem;let m=null,s=null;window.handleZForDragStart=(i,p,u,b)=>{const z=i.target;if(z.tagName==="BUTTON"||z.tagName==="A"||z.closest("button, a")){i.preventDefault();return}i.stopPropagation(),m={componentId:p,arrayName:u,index:b};const A=z.closest(".zero-code-z-for-item-wrapper");A?(A.style.opacity="0.5",A.style.transform="scale(0.95)",A.classList.add("dragging")):z.style.opacity="0.5",i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/html",z.outerHTML),_.debug("z-for drag start",{componentId:p,arrayName:u,index:b})},window.handleZForDragEnd=i=>{const p=i.target,u=p.closest(".zero-code-z-for-item-wrapper");u?(u.style.opacity="1",u.style.transform="scale(1)",u.classList.remove("dragging")):p.style.opacity="1",document.querySelectorAll(".z-for-item-wrapper.drag-over").forEach(b=>{b.classList.remove("drag-over")}),setTimeout(()=>{m=null,_.debug("z-for drag end - draggedItem reset")},50),_.debug("z-for drag end")},window.handleZForArrayItemDragOver=i=>{i.preventDefault(),i.dataTransfer.dropEffect="move";const u=i.currentTarget.closest(".zero-code-z-for-item-wrapper");u&&!u.classList.contains("dragging")&&(document.querySelectorAll(".z-for-item-wrapper.drag-over").forEach(b=>{b.classList.remove("drag-over")}),u.classList.add("drag-over"))},window.handleZForArrayItemDrop=i=>{i.preventDefault(),i.stopPropagation();const p=i.currentTarget,u=p.closest(".zero-code-z-for-item-wrapper");if(u&&u.classList.remove("drag-over"),!m){_.warn("No dragged item found");return}const b=(u==null?void 0:u.getAttribute("data-component-id"))||p.getAttribute("data-component-id"),z=(u==null?void 0:u.getAttribute("data-array-name"))||p.getAttribute("data-array-name"),A=(u==null?void 0:u.getAttribute("data-item-index"))||p.getAttribute("data-item-index"),h=parseInt(A||"0");m.componentId===b&&m.arrayName===z&&m.index!==h&&(xe.reorderZForArrayItem(m.componentId,m.arrayName,m.index,h),_.success("z-for array item reordered",{from:m.index,to:h})),m=null},window.handleNestedPartDragStart=i=>{const p=i.target;if(p.tagName==="BUTTON"||p.tagName==="A"||p.closest("button, a")){i.preventDefault();return}const u=p.closest(".z-for-nested-part");if(u){const b=u.getAttribute("data-nested-path"),z=u.getAttribute("data-slot-name"),A=u.getAttribute("data-part-index");b&&z&&A!==null&&(s={path:b,slotName:z,index:parseInt(A)},u.classList.add("dragging"),u.style.opacity="0.5",i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/html",u.outerHTML),_.debug("z-for nested part drag start",s))}},window.handleNestedPartDragEnd=i=>{const u=i.target.closest(".z-for-nested-part");u&&(u.classList.remove("dragging"),u.style.opacity="1"),document.querySelectorAll(".z-for-nested-part.drag-over").forEach(b=>{b.classList.remove("drag-over")}),s=null,_.debug("z-for nested part drag end")},window.handleNestedPartDragOver=i=>{i.preventDefault(),i.dataTransfer.dropEffect="move";const u=i.currentTarget.closest(".z-for-nested-part");u&&!u.classList.contains("dragging")&&(document.querySelectorAll(".z-for-nested-part.drag-over").forEach(b=>{b.classList.remove("drag-over")}),u.classList.add("drag-over"))},window.handleNestedPartDrop=i=>{i.preventDefault();const p=i.currentTarget,u=p.closest(".z-for-nested-part")||p.closest(".nested-component");if(u&&u.classList.remove("drag-over"),!s){_.warn("No dragged nested part found");return}const b=p.getAttribute("data-slot-name"),z=p.getAttribute("data-part-index");if(b&&z!==null){const A=parseInt(z);if(b===s.slotName){const h=s.path.match(/^(.+\.\w+\[\d+\]\.\w+)\[\d+\]$/);if(h){const $=h[1];_.debug("z-for nested part reorder",{parentPath:$,fromIndex:s.index,toIndex:A}),C.moveZForNestedPart($,s.index,A)}}}s=null},_.debug("グローバル関数を安全に公開完了")},E=()=>{};return{state:{editablePageData:o.editablePageData,localParts:o.localParts,localCommonParts:o.localCommonParts,localIndividualParts:o.localIndividualParts,activeTab:o.activeTab,dataTab:o.dataTab,showEditor:o.showEditor,showPartSelector:o.showPartSelector,showNestedPartSelector:o.showNestedPartSelector,selectedComponent:o.selectedComponent,selectedComponentIndex:o.selectedComponentIndex,editingText:o.editingText,insertPosition:o.insertPosition,nestedInsertPath:o.nestedInsertPath,nestedInsertPosition:o.nestedInsertPosition},computed:{currentComponentIndex:o.currentComponentIndex,pageDataLength:o.pageDataLength,hasSelectedComponent:o.hasSelectedComponent,isEditing:o.isEditing,isTiptapEditing:o.isTiptapEditing,...v},actions:C,utils:n,templateProcessor:a,simpleEditor:f,switchToTab:o.switchToTab,setDataTab:o.setDataTab,openEditor:o.openEditor,closeEditor:o.closeEditor,openPartSelector:o.openPartSelector,closePartSelector:o.closePartSelector,openNestedPartSelector:o.openNestedPartSelector,closeNestedPartSelector:o.closeNestedPartSelector,setupEventListeners:w,exposeGlobalFunctions:N,cleanup:E}}const Xi={class:"zero-code-tab-navigation"},Yi=["onClick"],Ki=e.defineComponent({__name:"TabNavigation",props:{activeTab:{type:String}},emits:["update:active-tab"],setup(t){const r=["editor","preview","parts","images"],o=n=>({editor:"エディタ",preview:"ページプレビュー",parts:"パーツ管理",images:"画像管理"})[n];return(n,a)=>(e.openBlock(),e.createElementBlock("div",Xi,[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(r,f=>e.createElementVNode("button",{key:f,class:e.normalizeClass(["zero-code-tab-button",{active:n.activeTab===f}]),onClick:y=>n.$emit("update:active-tab",f)},e.toDisplayString(o(f)),11,Yi)),64))]))}});function Ji(){const t=e.ref([]),r=e.computed(()=>t.value.length>0),o=(d,g=oe.UNKNOWN,C)=>{const v={id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:g,message:d instanceof Error?d.message:d,details:d instanceof Error?d.stack:void 0,timestamp:new Date,context:C};t.value.push(v),setTimeout(()=>{a(v.id)},1e4)},n=()=>{t.value=[]},a=d=>{const g=t.value.findIndex(C=>C.id===d);g!==-1&&t.value.splice(g,1)},f=d=>t.value.filter(g=>g.type===d),y=(d,g=oe.UNKNOWN)=>{o(d,g)};return{errors:t.value,hasErrors:r.value,handleError:o,clearErrors:n,clearError:a,getErrorsByType:f,showErrorNotification:y}}const qi={class:"zero-code-error-boundary"},Gi={key:0,class:"zero-code-error-notifications"},Qi={class:"zero-code-error-content"},ed={class:"zero-code-error-message"},td={class:"zero-code-error-icon"},od={class:"zero-code-error-text"},rd=["onClick"],nd={key:0,class:"zero-code-error-details"},ad={class:"zero-code-error-details-pre"},sd={class:"zero-code-error-boundary-content"},ld=e.defineComponent({__name:"ErrorBoundary",props:{showDetails:{type:Boolean,default:!1}},setup(t){const{errors:r,hasErrors:o,clearError:n}=Ji(),a=y=>{switch(y){case oe.NETWORK_ERROR:return"error-network";case oe.VALIDATION_ERROR:return"error-validation";case oe.PERMISSION_ERROR:return"error-permission";case oe.COMPONENT_ERROR:return"error-component";case oe.IMAGE_LOAD_FAILED:return"error-image";case oe.TEMPLATE_PARSE_ERROR:return"error-template";default:return"error-unknown"}},f=y=>{switch(y){case oe.NETWORK_ERROR:return"🌐";case oe.VALIDATION_ERROR:return"⚠️";case oe.PERMISSION_ERROR:return"🔒";case oe.COMPONENT_ERROR:return"🧩";case oe.IMAGE_LOAD_FAILED:return"🖼️";case oe.TEMPLATE_PARSE_ERROR:return"📄";default:return"❌"}};return(y,d)=>(e.openBlock(),e.createElementBlock("div",qi,[e.unref(o)?(e.openBlock(),e.createElementBlock("div",Gi,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),g=>(e.openBlock(),e.createElementBlock("div",{key:g.id,class:e.normalizeClass(["zero-code-error-notification",a(g.type)])},[e.createElementVNode("div",Qi,[e.createElementVNode("div",ed,[e.createElementVNode("span",td,e.toDisplayString(f(g.type)),1),e.createElementVNode("span",od,e.toDisplayString(g.message),1)]),e.createElementVNode("button",{class:"zero-code-error-close",title:"エラーを閉じる",onClick:C=>e.unref(n)(g.id)}," × ",8,rd)]),g.details&&y.showDetails?(e.openBlock(),e.createElementBlock("div",nd,[e.createElementVNode("pre",ad,e.toDisplayString(g.details),1)])):e.createCommentVNode("",!0)],2))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",sd,[e.renderSlot(y.$slots,"default")])]))}}),id={class:"zero-code-toolbar-content"},dd={class:"zero-code-toolbar-section"},cd={key:0,class:"zero-code-toolbar-separator"},pd=["title","disabled","onClick"],ud={class:"zero-code-toolbar-section"},md=e.defineComponent({__name:"RichTextToolbar",props:{show:{type:Boolean},position:{type:Object},actions:{type:Array},editingState:{type:null},isEditing:{type:Boolean}},emits:["executeCommand","save","cancel"],setup(t,{emit:r}){const o=t;e.onMounted(()=>{}),e.watch(()=>o.show,d=>{},{immediate:!0}),e.watch(()=>o.position,d=>{},{deep:!0,immediate:!0}),e.watch(()=>o.actions,d=>{},{immediate:!0});const n=r,a=d=>{n("executeCommand",d)},f=()=>{n("save")},y=()=>{n("cancel")};return(d,g)=>d.show?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zero-code-rich-text-toolbar",style:e.normalizeStyle({top:d.position.top+"px",left:d.position.left+"px"})},[e.createElementVNode("div",id,[e.createElementVNode("div",dd,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.actions,(C,v)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:v},[C&&C.name==="separator"?(e.openBlock(),e.createElementBlock("div",cd)):C?(e.openBlock(),e.createElementBlock("button",{key:1,class:e.normalizeClass(["zero-code-toolbar-btn",{active:C.active,disabled:!d.isEditing}]),title:C.title||"",disabled:!d.isEditing,tabindex:"-1",onClick:w=>a(C.command||""),onMousedown:g[0]||(g[0]=e.withModifiers(()=>{},["prevent","stop"]))},e.toDisplayString(C.icon||""),43,pd)):e.createCommentVNode("",!0)],64))),128))]),g[3]||(g[3]=e.createElementVNode("div",{class:"zero-code-toolbar-separator"},null,-1)),e.createElementVNode("div",ud,[e.createElementVNode("button",{class:"zero-code-toolbar-btn zero-code-save-btn",title:"保存 (Ctrl+S)",tabindex:"-1",onClick:f,onMousedown:g[1]||(g[1]=e.withModifiers(()=>{},["prevent","stop"]))}," ✓ ",32),e.createElementVNode("button",{class:"zero-code-toolbar-btn zero-code-cancel-btn",title:"キャンセル (Esc)",tabindex:"-1",onClick:y,onMousedown:g[2]||(g[2]=e.withModifiers(()=>{},["prevent","stop"]))}," ✕ ",32)])])],4)):e.createCommentVNode("",!0)}}),fd={class:"zero-code editor-container"},gd={class:"zero-code-editor-content"},hd=e.defineComponent({__name:"ZeroCode.ce",props:{parts:{default:()=>[],type:Array},commonParts:{default:()=>[],type:Array},individualParts:{default:()=>[],type:Array},page:{default:()=>[],type:Array},commonImages:{default:()=>[],type:Array},individualImages:{default:()=>[],type:Array}},emits:["update:parts","update:commonParts","update:individualParts","update:page","update:commonImages","update:individualImages"],setup(t,{emit:r}){const o=t,n=r,a=Wi(o,n),f=a.state.selectedComponent;a.state.selectedComponentIndex;const y=a.state.editablePageData,d=a.state.localParts,g=a.state.dataTab,C=e.ref(!1),v=e.ref({top:0,left:0}),w=e.ref(null),N=e.ref(""),E=e.ref(""),c=e.ref(""),l=e.computed(()=>w.value!==null),m=e.reactive({showToolbar:e.computed(()=>C.value),position:e.computed(()=>v.value),actions:[{name:"bold",icon:"B",title:"太字",command:"bold"},{name:"italic",icon:"I",title:"斜体",command:"italic"},{name:"underline",icon:"U",title:"下線",command:"underline"},{name:"separator"},{name:"link",icon:"🔗",title:"リンク",command:"link"}],editingState:{},executeCommand:T=>{s(T)},stopEdit:T=>{u(T)}}),s=T=>{if(w.value)try{if(T==="link"){const O=prompt("リンクのURLを入力してください:","https://");if(O&&O.trim()){const H=document.execCommand("createLink",!1,O)}}else{const O=document.execCommand(T,!1,void 0)}}catch{}},i=T=>{if(!T)return T;let O=T.replace(/(<br\s*\/?>)+$/gi,"");return O=O.replace(/\s+$/,""),O},p=()=>{if(!w.value||!E.value||!c.value)return;const T=w.value.innerHTML,O=i(T),H=Q=>{const W=E.value.match(/^(.+)_(.+)_(\d+)_(.+)$/);if(W){const[se,de,te,Y,me]=W,re=(he,ze)=>{for(const Ge of he){if(Ge.id===ze)return Ge;if(Ge.nested_parts&&Array.isArray(Ge.nested_parts)){const Qe=re(Ge.nested_parts,ze);if(Qe)return Qe}for(const[Qe,wt]of Object.entries(Ge))if(Array.isArray(wt)&&Qe!=="nested_parts"){for(const fo of wt)if(fo&&typeof fo=="object"){for(const[Dd,cr]of Object.entries(fo))if(Array.isArray(cr)){const pr=re(cr,ze);if(pr)return pr}}}}return null},le=re(Q,de);if(le&&Array.isArray(le[te])){const he=le[te][parseInt(Y)];if(he&&typeof he=="object")return he[me]=O,!0}return!1}for(const se of Q){if(se.id===E.value)return se[c.value]=O,!0;if(se.nested_parts&&Array.isArray(se.nested_parts)&&H(se.nested_parts))return!0;for(const[de,te]of Object.entries(se))if(Array.isArray(te)&&de!=="nested_parts"){for(const Y of te)if(Y&&typeof Y=="object"){if(Y.id===E.value)return Y[c.value]=O,!0;for(const[me,re]of Object.entries(Y))if(Array.isArray(re)&&H(re))return!0}}}return!1};H(y.value)&&(w.value&&T!==O&&(w.value.innerHTML=O),n("update:page",y.value))},u=T=>{w.value&&(T?p():w.value.innerHTML=N.value,w.value.contentEditable="false",w.value.classList.remove("editing"),w.value.style.userSelect="",w.value.style.webkitUserSelect="",w.value._cleanup&&(w.value._cleanup(),delete w.value._cleanup),w.value=null,N.value="",E.value="",c.value="",C.value=!1)},b=T=>{a.actions.openEditor(T)},z=()=>{a.closeEditor()},A=T=>{a.actions.deletePart(T)},h=T=>{a.actions.reorderParts(T)},$=()=>{const T=document.querySelector(".zero-code");if(!T)return;let O=null,H=null;const Q=te=>{const Y=te,me=Y.target;if(me.classList.contains("draggable-nested")){if(w.value){Y.preventDefault();return}if(me.classList.contains("z-for-nested-part"))return;O=me;const re=me.dataset.componentId||"",le=me.dataset.path||"",he=me.dataset.parentPath||"",ze=parseInt(me.dataset.index||"0");H={componentId:re,path:le,parentPath:he,index:ze},Y.dataTransfer&&(Y.dataTransfer.effectAllowed="move",Y.dataTransfer.setData("text/plain","nested-component")),me.style.opacity="0.5"}},W=te=>{const Y=te;Y.preventDefault(),Y.dataTransfer&&(Y.dataTransfer.dropEffect="move")},se=te=>{const Y=te;if(Y.preventDefault(),!O||!H)return;const re=Y.target.closest(".draggable-nested");if(re&&re!==O){const le=re.dataset.parentPath||"",he=parseInt(re.dataset.index||"0");H.parentPath===le&&a.actions.moveNestedPartById(H.parentPath,H.index,he)}O&&(O.style.opacity="1"),O=null,H=null},de=te=>{const Y=te.target;Y.classList.contains("draggable-nested")&&(Y.style.opacity="1"),O=null,H=null};return T.addEventListener("dragstart",Q),T.addEventListener("dragover",W),T.addEventListener("drop",se),T.addEventListener("dragend",de),()=>{T.removeEventListener("dragstart",Q),T.removeEventListener("dragover",W),T.removeEventListener("drop",se),T.removeEventListener("dragend",de)}},k=()=>{a.actions.sendPageData()},P=()=>{a.actions.sendPartsData()},S=()=>{a.actions.sendCommonPartsData()},D=()=>{a.actions.sendIndividualPartsData()},M=()=>{a.actions.resetPageData()},I=e.ref(null),V=e.computed(()=>{const T=new Set;return d.value&&d.value.forEach(O=>{O.parts&&O.parts.forEach(H=>{T.add(H.type)})}),Array.from(T)}),R=(T,O)=>{let H=O;return H===void 0&&(H=y.value.findIndex(Q=>Q.id===T.id),H===-1&&(H=0)),a.templateProcessor.renderComponentWithNested(T,H,(Q,W)=>a.utils.template.getTemplate(Q,W,d.value),(Q,W,se,de)=>a.templateProcessor.renderNestedComponentsWithUI(Q,W,te=>te.join("-"),de||((te,Y)=>a.utils.template.getTemplate(te,Y,d.value))))},F=T=>{n("update:parts",T)},X=T=>{I.value=T,Ie.value=!0},L=(T,O)=>{if(confirm(`パーツ「${O}」を削除しますか？`)){const H=d.value.map(Q=>Q.type===T?{...Q,module:Q.module.filter(W=>W.title!==O)}:Q).filter(Q=>Q.module.length>0);d.value=H,n("update:parts",H)}},x=T=>{const O=typeof T=="string"?T:T.body||"";return a.computed.renderPartPreview(O)},J=T=>{const{type:O,title:H,body:Q,category:W="common"}=T,se=[...d.value];let de=se.find(Y=>Y.type===O);de||(de={type:O,module:[]},se.push(de));const te={title:H,body:Q,category:W};if(I.value){const Y=de.module.findIndex(me=>me.title===I.value.module.title);Y!==-1&&(de.module[Y]=te)}else de.module.push(te);d.value=se,n("update:parts",se),Ht()},{activeTab:ee,switchToTab:Ae}=Ri(),Se=a.state.showPartSelector,ge=a.state.showNestedPartSelector,Ie=e.ref(!1),Re=T=>{a.openPartSelector(T)},Rt=()=>{a.closePartSelector()},$t=()=>{a.closeNestedPartSelector()},qe=()=>{Ie.value=!0},Ht=()=>{Ie.value=!1,I.value=null},po=a.state.showEditor,it=e.ref([]),He=e.ref([]),uo=T=>{it.value=T,n("update:commonImages",T)},yd=T=>{He.value=T,n("update:individualImages",T)},lr=()=>{n("update:commonImages",it.value)},ir=()=>{n("update:individualImages",He.value)},bd=(T,O,H)=>{const Q=We.value.createNewComponent(T,O),W=H!==void 0?H:a.state.insertPosition.value;a.actions.addPart(Q,W),Rt()},Ed=(T,O)=>{const H=a.state.nestedInsertPath.value,Q=a.state.nestedInsertPosition.value,W=We.value.createNewComponent(T,O);a.actions.addNestedPart(H,Q,W),$t()},We=e.computed(()=>{const T=d.value&&d.value.length>0?d.value:o.parts||[];return Lt(T)}),$d=T=>We.value.getFieldInfo(T),wd=(T,O,H)=>We.value.shouldShowBasicField(T,O,H),zd=(T,O,H)=>We.value.shouldShowArrayField(T,O,H),vd=(T,O,H,Q,W)=>We.value.shouldShowArrayItemField(T,O,H,Q,W),Nd=T=>We.value.getInputType(T),Cd=(T,O,H)=>We.value.isCheckboxChecked(T,O,H),kd=(T,O)=>{const H=f.value;if(H){if(H[T]=O,H._isZForItem){const Q=H._parentComponentId,W=H._arrayName,se=H._arrayIndex,de=(Y,me)=>{for(const re of Y){if(re.id===me)return re;if(re.nested_parts&&Array.isArray(re.nested_parts)){const le=de(re.nested_parts,me);if(le)return le}for(const[le,he]of Object.entries(re))if(Array.isArray(he)&&le!=="nested_parts"){for(const ze of he)if(ze&&typeof ze=="object"){for(const[Ge,Qe]of Object.entries(ze))if(Array.isArray(Qe)){const wt=de(Qe,me);if(wt)return wt}}}}return null},te=de(y.value,Q);if(te&&Array.isArray(te[W])){const Y=te[W];se>=0&&se<Y.length&&(Y[se][T]=O)}}n("update:page",y.value)}};e.watch(()=>o.commonImages,T=>{Array.isArray(T)&&(it.value=JSON.parse(JSON.stringify(T)))},{immediate:!0}),e.watch(()=>o.individualImages,T=>{Array.isArray(T)&&(He.value=JSON.parse(JSON.stringify(T)))},{immediate:!0});const dr=T=>{if(!w.value||!C.value)return;const O=T.target;O.closest(".zero-code-rich-text-toolbar")||O===w.value||w.value.contains(O)||u(!0)};let mo=null;return e.onMounted(async()=>{document.addEventListener("click",dr),a.setupEventListeners(),a.exposeGlobalFunctions((T,O)=>{C.value=!0,a.actions.startTiptapEdit(T,O,[],0)}),mo=$()||null,window.startRichTextEdit=async(T,O,H,Q)=>{var se;const W=Q||((se=window.event)==null?void 0:se.target);if(w.value!==W&&W){w.value&&u(!1),w.value=W,N.value=W.innerHTML,E.value=T,c.value=O,await e.nextTick(),W.contentEditable="true",W.style.userSelect="text",W.style.webkitUserSelect="text",W.classList.add("editing");const de=re=>{const le=re.relatedTarget;le&&le.closest(".zero-code-rich-text-toolbar")||setTimeout(()=>{w.value===W&&u(!0)},150)};W.addEventListener("blur",de),W._cleanup=()=>{W.removeEventListener("blur",de)};const te=W.getBoundingClientRect(),Y=window.pageYOffset||document.documentElement.scrollTop,me=window.pageXOffset||document.documentElement.scrollLeft;v.value={top:te.top+Y-50,left:te.left+me},C.value=!0,await e.nextTick(),setTimeout(()=>{var re;if(W&&w.value===W){W.focus();const le=document.createRange(),he=window.getSelection();if(he&&W.childNodes.length>0){const ze=W.childNodes[W.childNodes.length-1];ze.nodeType===Node.TEXT_NODE?le.setStart(ze,((re=ze.textContent)==null?void 0:re.length)||0):le.setStartAfter(ze),le.collapse(!0),he.removeAllRanges(),he.addRange(le)}else he&&(le.selectNodeContents(W),le.collapse(!1),he.removeAllRanges(),he.addRange(le))}},10)}}}),e.onUnmounted(()=>{document.removeEventListener("click",dr),mo&&mo()}),(T,O)=>(e.openBlock(),e.createBlock(ld,null,{default:e.withCtx(()=>[e.createElementVNode("div",fd,[e.createVNode(Ki,{"active-tab":e.unref(ee),"onUpdate:activeTab":e.unref(Ae)},null,8,["active-tab","onUpdate:activeTab"]),e.createVNode(md,{show:C.value,position:v.value,actions:m.actions,"editing-state":m.editingState,"is-editing":C.value,onExecuteCommand:m.executeCommand,onSave:O[0]||(O[0]=H=>m.stopEdit(!0)),onCancel:O[1]||(O[1]=H=>m.stopEdit(!1))},null,8,["show","position","actions","editing-state","is-editing","onExecuteCommand"]),e.createElementVNode("div",gd,[e.unref(ee)==="editor"?(e.openBlock(),e.createBlock(Ja,{key:0,"data-tab":e.unref(g),"editable-page-data":e.unref(y),"local-parts":e.unref(d),"local-common-parts":e.unref(a).state.localCommonParts.value,"local-individual-parts":e.unref(a).state.localIndividualParts.value,parts:o.parts||[],"show-part-selector":e.unref(Se),"show-nested-part-selector":e.unref(ge),"show-editor":e.unref(po),"selected-component":e.unref(f),"render-component-with-nested":R,"get-field-info":$d,"should-show-basic-field":wd,"should-show-array-field":zd,"should-show-array-item-field":vd,"get-input-type":Nd,"is-checkbox-checked":Cd,"parts-data":e.unref(d)&&e.unref(d).length>0?e.unref(d):o.parts||[],"is-text-editing":l.value,"onUpdate:dataTab":O[2]||(O[2]=H=>g.value=H),onAddPart:Re,onEditPart:b,onDeletePart:A,onReorderParts:h,onClosePartSelector:Rt,onSelectPart:bd,onCloseNestedPartSelector:$t,onSelectNestedPart:Ed,onCloseEditor:z,onUpdateEditorValue:kd},null,8,["data-tab","editable-page-data","local-parts","local-common-parts","local-individual-parts","parts","show-part-selector","show-nested-part-selector","show-editor","selected-component","parts-data","is-text-editing"])):e.createCommentVNode("",!0),e.unref(ee)==="parts"?(e.openBlock(),e.createBlock(el,{key:1,"local-parts":e.unref(d),"local-common-parts":e.unref(a).state.localCommonParts.value,"local-individual-parts":e.unref(a).state.localIndividualParts.value,"show-part-registration":Ie.value,"existing-part-types":V.value,"editing-part":I.value,"render-part-preview":x,onUpdateParts:F,onShowRegistration:qe,onEditPart:X,onDeletePart:L,onCloseRegistration:Ht,onSavePart:J},null,8,["local-parts","local-common-parts","local-individual-parts","show-part-registration","existing-part-types","editing-part"])):e.createCommentVNode("",!0),e.unref(ee)==="preview"?(e.openBlock(),e.createBlock(Tl,{key:2,"editable-page-data":e.unref(y),"local-parts":e.unref(d),parts:o.parts||[]},null,8,["editable-page-data","local-parts","parts"])):e.createCommentVNode("",!0),e.unref(ee)==="images"?(e.openBlock(),e.createBlock(xi,{key:3,"common-images":it.value,"individual-images":He.value,onUpdateCommonImages:uo,onUpdateIndividualImages:yd,onSendCommonImagesData:lr,onSendIndividualImagesData:ir},null,8,["common-images","individual-images"])):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"zero-code-button-section"},[e.createElementVNode("button",{class:"zero-code-send-btn zero-code-page-btn",onClick:k},"Pageデータを送信"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-parts-btn",onClick:P},"Partsデータを送信"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-common-parts-btn",onClick:S},"共通Partsデータを送信"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-individual-parts-btn",onClick:D},"個別Partsデータを送信"),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-common-images-btn",onClick:lr}," 共通画像データを送信 "),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-individual-images-btn",onClick:ir}," 個別画像データを送信 "),e.createElementVNode("button",{class:"zero-code-send-btn zero-code-reset-btn",onClick:M},"リセット")])])]),_:1}))}}),co=e.defineCustomElement(hd,{shadowRoot:!1});customElements.define("zero-code",co),$e.ZeroCode=co,$e.default=co,Object.defineProperties($e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
